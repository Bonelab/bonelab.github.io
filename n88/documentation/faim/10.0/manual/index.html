<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 2.0.10">
  <meta name="author" content="Eric Nodwell and Steven K. Boyd">
  <meta name="copyright" content="Copyright (c) 2020, Numerics88 Solutions Ltd.">
  <title>Faim Finite Element Analysis Manual</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
  <style>
    /* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
    /* Uncomment @import statement to use as custom stylesheet */
    /*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
    article,
    aside,
    details,
    figcaption,
    figure,
    footer,
    header,
    hgroup,
    main,
    nav,
    section {
      display: block
    }

    audio,
    video {
      display: inline-block
    }

    audio:not([controls]) {
      display: none;
      height: 0
    }

    html {
      font-family: sans-serif;
      -ms-text-size-adjust: 100%;
      -webkit-text-size-adjust: 100%
    }

    a {
      background: none
    }

    a:focus {
      outline: thin dotted
    }

    a:active,
    a:hover {
      outline: 0
    }

    h1 {
      font-size: 2em;
      margin: .67em 0
    }

    abbr[title] {
      border-bottom: 1px dotted
    }

    b,
    strong {
      font-weight: bold
    }

    dfn {
      font-style: italic
    }

    hr {
      -moz-box-sizing: content-box;
      box-sizing: content-box;
      height: 0
    }

    mark {
      background: #ff0;
      color: #000
    }

    code,
    kbd,
    pre,
    samp {
      font-family: monospace;
      font-size: 1em
    }

    pre {
      white-space: pre-wrap
    }

    q {
      quotes: "\201C" "\201D" "\2018" "\2019"
    }

    small {
      font-size: 80%
    }

    sub,
    sup {
      font-size: 75%;
      line-height: 0;
      position: relative;
      vertical-align: baseline
    }

    sup {
      top: -.5em
    }

    sub {
      bottom: -.25em
    }

    img {
      border: 0
    }

    svg:not(:root) {
      overflow: hidden
    }

    figure {
      margin: 0
    }

    fieldset {
      border: 1px solid silver;
      margin: 0 2px;
      padding: .35em .625em .75em
    }

    legend {
      border: 0;
      padding: 0
    }

    button,
    input,
    select,
    textarea {
      font-family: inherit;
      font-size: 100%;
      margin: 0
    }

    button,
    input {
      line-height: normal
    }

    button,
    select {
      text-transform: none
    }

    button,
    html input[type="button"],
    input[type="reset"],
    input[type="submit"] {
      -webkit-appearance: button;
      cursor: pointer
    }

    button[disabled],
    html input[disabled] {
      cursor: default
    }

    input[type="checkbox"],
    input[type="radio"] {
      box-sizing: border-box;
      padding: 0
    }

    button::-moz-focus-inner,
    input::-moz-focus-inner {
      border: 0;
      padding: 0
    }

    textarea {
      overflow: auto;
      vertical-align: top
    }

    table {
      border-collapse: collapse;
      border-spacing: 0
    }

    *,
    *::before,
    *::after {
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
      box-sizing: border-box
    }

    html,
    body {
      font-size: 100%
    }

    body {
      background: #fff;
      color: rgba(0, 0, 0, .8);
      padding: 0;
      margin: 0;
      font-family: "Noto Serif", "DejaVu Serif", serif;
      font-weight: 400;
      font-style: normal;
      line-height: 1;
      position: relative;
      cursor: auto;
      tab-size: 4;
      -moz-osx-font-smoothing: grayscale;
      -webkit-font-smoothing: antialiased
    }

    a:hover {
      cursor: pointer
    }

    img,
    object,
    embed {
      max-width: 100%;
      height: auto
    }

    object,
    embed {
      height: 100%
    }

    img {
      -ms-interpolation-mode: bicubic
    }

    .left {
      float: left !important
    }

    .right {
      float: right !important
    }

    .text-left {
      text-align: left !important
    }

    .text-right {
      text-align: right !important
    }

    .text-center {
      text-align: center !important
    }

    .text-justify {
      text-align: justify !important
    }

    .hide {
      display: none
    }

    img,
    object,
    svg {
      display: inline-block;
      vertical-align: middle
    }

    textarea {
      height: auto;
      min-height: 50px
    }

    select {
      width: 100%
    }

    .center {
      margin-left: auto;
      margin-right: auto
    }

    .stretch {
      width: 100%
    }

    .subheader,
    .admonitionblock td.content>.title,
    .audioblock>.title,
    .exampleblock>.title,
    .imageblock>.title,
    .listingblock>.title,
    .literalblock>.title,
    .stemblock>.title,
    .openblock>.title,
    .paragraph>.title,
    .quoteblock>.title,
    table.tableblock>.title,
    .verseblock>.title,
    .videoblock>.title,
    .dlist>.title,
    .olist>.title,
    .ulist>.title,
    .qlist>.title,
    .hdlist>.title {
      line-height: 1.45;
      color: #7a2518;
      font-weight: 400;
      margin-top: 0;
      margin-bottom: .25em
    }

    div,
    dl,
    dt,
    dd,
    ul,
    ol,
    li,
    h1,
    h2,
    h3,
    #toctitle,
    .sidebarblock>.content>.title,
    h4,
    h5,
    h6,
    pre,
    form,
    p,
    blockquote,
    th,
    td {
      margin: 0;
      padding: 0;
      direction: ltr
    }

    a {
      color: #2156a5;
      text-decoration: underline;
      line-height: inherit
    }

    a:hover,
    a:focus {
      color: #1d4b8f
    }

    a img {
      border: 0
    }

    p {
      font-family: inherit;
      font-weight: 400;
      font-size: 1em;
      line-height: 1.6;
      margin-bottom: 1.25em;
      text-rendering: optimizeLegibility
    }

    p aside {
      font-size: .875em;
      line-height: 1.35;
      font-style: italic
    }

    h1,
    h2,
    h3,
    #toctitle,
    .sidebarblock>.content>.title,
    h4,
    h5,
    h6 {
      font-family: "Open Sans", "DejaVu Sans", sans-serif;
      font-weight: 300;
      font-style: normal;
      color: #ba3925;
      text-rendering: optimizeLegibility;
      margin-top: 1em;
      margin-bottom: .5em;
      line-height: 1.0125em
    }

    h1 small,
    h2 small,
    h3 small,
    #toctitle small,
    .sidebarblock>.content>.title small,
    h4 small,
    h5 small,
    h6 small {
      font-size: 60%;
      color: #e99b8f;
      line-height: 0
    }

    h1 {
      font-size: 2.125em
    }

    h2 {
      font-size: 1.6875em
    }

    h3,
    #toctitle,
    .sidebarblock>.content>.title {
      font-size: 1.375em
    }

    h4,
    h5 {
      font-size: 1.125em
    }

    h6 {
      font-size: 1em
    }

    hr {
      border: solid #dddddf;
      border-width: 1px 0 0;
      clear: both;
      margin: 1.25em 0 1.1875em;
      height: 0
    }

    em,
    i {
      font-style: italic;
      line-height: inherit
    }

    strong,
    b {
      font-weight: bold;
      line-height: inherit
    }

    small {
      font-size: 60%;
      line-height: inherit
    }

    code {
      font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
      font-weight: 400;
      color: rgba(0, 0, 0, .9)
    }

    ul,
    ol,
    dl {
      font-size: 1em;
      line-height: 1.6;
      margin-bottom: 1.25em;
      list-style-position: outside;
      font-family: inherit
    }

    ul,
    ol {
      margin-left: 1.5em
    }

    ul li ul,
    ul li ol {
      margin-left: 1.25em;
      margin-bottom: 0;
      font-size: 1em
    }

    ul.square li ul,
    ul.circle li ul,
    ul.disc li ul {
      list-style: inherit
    }

    ul.square {
      list-style-type: square
    }

    ul.circle {
      list-style-type: circle
    }

    ul.disc {
      list-style-type: disc
    }

    ol li ul,
    ol li ol {
      margin-left: 1.25em;
      margin-bottom: 0
    }

    dl dt {
      margin-bottom: .3125em;
      font-weight: bold
    }

    dl dd {
      margin-bottom: 1.25em
    }

    abbr,
    acronym {
      text-transform: uppercase;
      font-size: 90%;
      color: rgba(0, 0, 0, .8);
      border-bottom: 1px dotted #ddd;
      cursor: help
    }

    abbr {
      text-transform: none
    }

    blockquote {
      margin: 0 0 1.25em;
      padding: .5625em 1.25em 0 1.1875em;
      border-left: 1px solid #ddd
    }

    blockquote cite {
      display: block;
      font-size: .9375em;
      color: rgba(0, 0, 0, .6)
    }

    blockquote cite::before {
      content: "\2014 \0020"
    }

    blockquote cite a,
    blockquote cite a:visited {
      color: rgba(0, 0, 0, .6)
    }

    blockquote,
    blockquote p {
      line-height: 1.6;
      color: rgba(0, 0, 0, .85)
    }

    @media screen and (min-width:768px) {

      h1,
      h2,
      h3,
      #toctitle,
      .sidebarblock>.content>.title,
      h4,
      h5,
      h6 {
        line-height: 1.2
      }

      h1 {
        font-size: 2.75em
      }

      h2 {
        font-size: 2.3125em
      }

      h3,
      #toctitle,
      .sidebarblock>.content>.title {
        font-size: 1.6875em
      }

      h4 {
        font-size: 1.4375em
      }
    }

    table {
      background: #fff;
      margin-bottom: 1.25em;
      border: solid 1px #dedede
    }

    table thead,
    table tfoot {
      background: #f7f8f7
    }

    table thead tr th,
    table thead tr td,
    table tfoot tr th,
    table tfoot tr td {
      padding: .5em .625em .625em;
      font-size: inherit;
      color: rgba(0, 0, 0, .8);
      text-align: left
    }

    table tr th,
    table tr td {
      padding: .5625em .625em;
      font-size: inherit;
      color: rgba(0, 0, 0, .8)
    }

    table tr.even,
    table tr.alt {
      background: #f8f8f7
    }

    table thead tr th,
    table tfoot tr th,
    table tbody tr td,
    table tr td,
    table tfoot tr td {
      display: table-cell;
      line-height: 1.6
    }

    h1,
    h2,
    h3,
    #toctitle,
    .sidebarblock>.content>.title,
    h4,
    h5,
    h6 {
      line-height: 1.2;
      word-spacing: -.05em
    }

    h1 strong,
    h2 strong,
    h3 strong,
    #toctitle strong,
    .sidebarblock>.content>.title strong,
    h4 strong,
    h5 strong,
    h6 strong {
      font-weight: 400
    }

    .clearfix::before,
    .clearfix::after,
    .float-group::before,
    .float-group::after {
      content: " ";
      display: table
    }

    .clearfix::after,
    .float-group::after {
      clear: both
    }

    :not(pre):not([class^=L])>code {
      font-size: .9375em;
      font-style: normal !important;
      letter-spacing: 0;
      padding: .1em .5ex;
      word-spacing: -.15em;
      background: #f7f7f8;
      -webkit-border-radius: 4px;
      border-radius: 4px;
      line-height: 1.45;
      text-rendering: optimizeSpeed;
      word-wrap: break-word
    }

    :not(pre)>code.nobreak {
      word-wrap: normal
    }

    :not(pre)>code.nowrap {
      white-space: nowrap
    }

    pre {
      color: rgba(0, 0, 0, .9);
      font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
      line-height: 1.45;
      text-rendering: optimizeSpeed
    }

    pre code,
    pre pre {
      color: inherit;
      font-size: inherit;
      line-height: inherit
    }

    pre>code {
      display: block
    }

    pre.nowrap,
    pre.nowrap pre {
      white-space: pre;
      word-wrap: normal
    }

    em em {
      font-style: normal
    }

    strong strong {
      font-weight: 400
    }

    .keyseq {
      color: rgba(51, 51, 51, .8)
    }

    kbd {
      font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
      display: inline-block;
      color: rgba(0, 0, 0, .8);
      font-size: .65em;
      line-height: 1.45;
      background: #f7f7f7;
      border: 1px solid #ccc;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
      box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
      margin: 0 .15em;
      padding: .2em .5em;
      vertical-align: middle;
      position: relative;
      top: -.1em;
      white-space: nowrap
    }

    .keyseq kbd:first-child {
      margin-left: 0
    }

    .keyseq kbd:last-child {
      margin-right: 0
    }

    .menuseq,
    .menuref {
      color: #000
    }

    .menuseq b:not(.caret),
    .menuref {
      font-weight: inherit
    }

    .menuseq {
      word-spacing: -.02em
    }

    .menuseq b.caret {
      font-size: 1.25em;
      line-height: .8
    }

    .menuseq i.caret {
      font-weight: bold;
      text-align: center;
      width: .45em
    }

    b.button::before,
    b.button::after {
      position: relative;
      top: -1px;
      font-weight: 400
    }

    b.button::before {
      content: "[";
      padding: 0 3px 0 2px
    }

    b.button::after {
      content: "]";
      padding: 0 2px 0 3px
    }

    p a>code:hover {
      color: rgba(0, 0, 0, .9)
    }

    #header,
    #content,
    #footnotes,
    #footer {
      width: 100%;
      margin-left: auto;
      margin-right: auto;
      margin-top: 0;
      margin-bottom: 0;
      max-width: 62.5em;
      *zoom: 1;
      position: relative;
      padding-left: .9375em;
      padding-right: .9375em
    }

    #header::before,
    #header::after,
    #content::before,
    #content::after,
    #footnotes::before,
    #footnotes::after,
    #footer::before,
    #footer::after {
      content: " ";
      display: table
    }

    #header::after,
    #content::after,
    #footnotes::after,
    #footer::after {
      clear: both
    }

    #content {
      margin-top: 1.25em
    }

    #content::before {
      content: none
    }

    #header>h1:first-child {
      color: rgba(0, 0, 0, .85);
      margin-top: 2.25rem;
      margin-bottom: 0
    }

    #header>h1:first-child+#toc {
      margin-top: 8px;
      border-top: 1px solid #dddddf
    }

    #header>h1:only-child,
    body.toc2 #header>h1:nth-last-child(2) {
      border-bottom: 1px solid #dddddf;
      padding-bottom: 8px
    }

    #header .details {
      border-bottom: 1px solid #dddddf;
      line-height: 1.45;
      padding-top: .25em;
      padding-bottom: .25em;
      padding-left: .25em;
      color: rgba(0, 0, 0, .6);
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -ms-flex-flow: row wrap;
      -webkit-flex-flow: row wrap;
      flex-flow: row wrap
    }

    #header .details span:first-child {
      margin-left: -.125em
    }

    #header .details span.email a {
      color: rgba(0, 0, 0, .85)
    }

    #header .details br {
      display: none
    }

    #header .details br+span::before {
      content: "\00a0\2013\00a0"
    }

    #header .details br+span.author::before {
      content: "\00a0\22c5\00a0";
      color: rgba(0, 0, 0, .85)
    }

    #header .details br+span#revremark::before {
      content: "\00a0|\00a0"
    }

    #header #revnumber {
      text-transform: capitalize
    }

    #header #revnumber::after {
      content: "\00a0"
    }

    #content>h1:first-child:not([class]) {
      color: rgba(0, 0, 0, .85);
      border-bottom: 1px solid #dddddf;
      padding-bottom: 8px;
      margin-top: 0;
      padding-top: 1rem;
      margin-bottom: 1.25rem
    }

    #toc {
      border-bottom: 1px solid #e7e7e9;
      padding-bottom: .5em
    }

    #toc>ul {
      margin-left: .125em
    }

    #toc ul.sectlevel0>li>a {
      font-style: italic
    }

    #toc ul.sectlevel0 ul.sectlevel1 {
      margin: .5em 0
    }

    #toc ul {
      font-family: "Open Sans", "DejaVu Sans", sans-serif;
      list-style-type: none
    }

    #toc li {
      line-height: 1.3334;
      margin-top: .3334em
    }

    #toc a {
      text-decoration: none
    }

    #toc a:active {
      text-decoration: underline
    }

    #toctitle {
      color: #7a2518;
      font-size: 1.2em
    }

    @media screen and (min-width:768px) {
      #toctitle {
        font-size: 1.375em
      }

      body.toc2 {
        padding-left: 15em;
        padding-right: 0
      }

      #toc.toc2 {
        margin-top: 0 !important;
        background: #f8f8f7;
        position: fixed;
        width: 15em;
        left: 0;
        top: 0;
        border-right: 1px solid #e7e7e9;
        border-top-width: 0 !important;
        border-bottom-width: 0 !important;
        z-index: 1000;
        padding: 1.25em 1em;
        height: 100%;
        overflow: auto
      }

      #toc.toc2 #toctitle {
        margin-top: 0;
        margin-bottom: .8rem;
        font-size: 1.2em
      }

      #toc.toc2>ul {
        font-size: .9em;
        margin-bottom: 0
      }

      #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 1em
      }

      #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: .5em;
        margin-bottom: .5em
      }

      body.toc2.toc-right {
        padding-left: 0;
        padding-right: 15em
      }

      body.toc2.toc-right #toc.toc2 {
        border-right-width: 0;
        border-left: 1px solid #e7e7e9;
        left: auto;
        right: 0
      }
    }

    @media screen and (min-width:1280px) {
      body.toc2 {
        padding-left: 20em;
        padding-right: 0
      }

      #toc.toc2 {
        width: 20em
      }

      #toc.toc2 #toctitle {
        font-size: 1.375em
      }

      #toc.toc2>ul {
        font-size: .95em
      }

      #toc.toc2 ul ul {
        padding-left: 1.25em
      }

      body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em
      }
    }

    #content #toc {
      border-style: solid;
      border-width: 1px;
      border-color: #e0e0dc;
      margin-bottom: 1.25em;
      padding: 1.25em;
      background: #f8f8f7;
      -webkit-border-radius: 4px;
      border-radius: 4px
    }

    #content #toc>:first-child {
      margin-top: 0
    }

    #content #toc>:last-child {
      margin-bottom: 0
    }

    #footer {
      max-width: 100%;
      background: rgba(0, 0, 0, .8);
      padding: 1.25em
    }

    #footer-text {
      color: rgba(255, 255, 255, .8);
      line-height: 1.44
    }

    #content {
      margin-bottom: .625em
    }

    .sect1 {
      padding-bottom: .625em
    }

    @media screen and (min-width:768px) {
      #content {
        margin-bottom: 1.25em
      }

      .sect1 {
        padding-bottom: 1.25em
      }
    }

    .sect1:last-child {
      padding-bottom: 0
    }

    .sect1+.sect1 {
      border-top: 1px solid #e7e7e9
    }

    #content h1>a.anchor,
    h2>a.anchor,
    h3>a.anchor,
    #toctitle>a.anchor,
    .sidebarblock>.content>.title>a.anchor,
    h4>a.anchor,
    h5>a.anchor,
    h6>a.anchor {
      position: absolute;
      z-index: 1001;
      width: 1.5ex;
      margin-left: -1.5ex;
      display: block;
      text-decoration: none !important;
      visibility: hidden;
      text-align: center;
      font-weight: 400
    }

    #content h1>a.anchor::before,
    h2>a.anchor::before,
    h3>a.anchor::before,
    #toctitle>a.anchor::before,
    .sidebarblock>.content>.title>a.anchor::before,
    h4>a.anchor::before,
    h5>a.anchor::before,
    h6>a.anchor::before {
      content: "\00A7";
      font-size: .85em;
      display: block;
      padding-top: .1em
    }

    #content h1:hover>a.anchor,
    #content h1>a.anchor:hover,
    h2:hover>a.anchor,
    h2>a.anchor:hover,
    h3:hover>a.anchor,
    #toctitle:hover>a.anchor,
    .sidebarblock>.content>.title:hover>a.anchor,
    h3>a.anchor:hover,
    #toctitle>a.anchor:hover,
    .sidebarblock>.content>.title>a.anchor:hover,
    h4:hover>a.anchor,
    h4>a.anchor:hover,
    h5:hover>a.anchor,
    h5>a.anchor:hover,
    h6:hover>a.anchor,
    h6>a.anchor:hover {
      visibility: visible
    }

    #content h1>a.link,
    h2>a.link,
    h3>a.link,
    #toctitle>a.link,
    .sidebarblock>.content>.title>a.link,
    h4>a.link,
    h5>a.link,
    h6>a.link {
      color: #ba3925;
      text-decoration: none
    }

    #content h1>a.link:hover,
    h2>a.link:hover,
    h3>a.link:hover,
    #toctitle>a.link:hover,
    .sidebarblock>.content>.title>a.link:hover,
    h4>a.link:hover,
    h5>a.link:hover,
    h6>a.link:hover {
      color: #a53221
    }

    details,
    .audioblock,
    .imageblock,
    .literalblock,
    .listingblock,
    .stemblock,
    .videoblock {
      margin-bottom: 1.25em
    }

    details>summary:first-of-type {
      cursor: pointer;
      display: list-item;
      outline: none;
      margin-bottom: .75em
    }

    .admonitionblock td.content>.title,
    .audioblock>.title,
    .exampleblock>.title,
    .imageblock>.title,
    .listingblock>.title,
    .literalblock>.title,
    .stemblock>.title,
    .openblock>.title,
    .paragraph>.title,
    .quoteblock>.title,
    table.tableblock>.title,
    .verseblock>.title,
    .videoblock>.title,
    .dlist>.title,
    .olist>.title,
    .ulist>.title,
    .qlist>.title,
    .hdlist>.title {
      text-rendering: optimizeLegibility;
      text-align: left;
      font-family: "Noto Serif", "DejaVu Serif", serif;
      font-size: 1rem;
      font-style: italic
    }

    table.tableblock.fit-content>caption.title {
      white-space: nowrap;
      width: 0
    }

    .paragraph.lead>p,
    #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
      font-size: 1.21875em;
      line-height: 1.6;
      color: rgba(0, 0, 0, .85)
    }

    table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
      font-size: inherit
    }

    .admonitionblock>table {
      border-collapse: separate;
      border: 0;
      background: none;
      width: 100%
    }

    .admonitionblock>table td.icon {
      text-align: center;
      width: 80px
    }

    .admonitionblock>table td.icon img {
      max-width: none
    }

    .admonitionblock>table td.icon .title {
      font-weight: bold;
      font-family: "Open Sans", "DejaVu Sans", sans-serif;
      text-transform: uppercase
    }

    .admonitionblock>table td.content {
      padding-left: 1.125em;
      padding-right: 1.25em;
      border-left: 1px solid #dddddf;
      color: rgba(0, 0, 0, .6)
    }

    .admonitionblock>table td.content>:last-child>:last-child {
      margin-bottom: 0
    }

    .exampleblock>.content {
      border-style: solid;
      border-width: 1px;
      border-color: #e6e6e6;
      margin-bottom: 1.25em;
      padding: 1.25em;
      background: #fff;
      -webkit-border-radius: 4px;
      border-radius: 4px
    }

    .exampleblock>.content>:first-child {
      margin-top: 0
    }

    .exampleblock>.content>:last-child {
      margin-bottom: 0
    }

    .sidebarblock {
      border-style: solid;
      border-width: 1px;
      border-color: #dbdbd6;
      margin-bottom: 1.25em;
      padding: 1.25em;
      background: #f3f3f2;
      -webkit-border-radius: 4px;
      border-radius: 4px
    }

    .sidebarblock>:first-child {
      margin-top: 0
    }

    .sidebarblock>:last-child {
      margin-bottom: 0
    }

    .sidebarblock>.content>.title {
      color: #7a2518;
      margin-top: 0;
      text-align: center
    }

    .exampleblock>.content>:last-child>:last-child,
    .exampleblock>.content .olist>ol>li:last-child>:last-child,
    .exampleblock>.content .ulist>ul>li:last-child>:last-child,
    .exampleblock>.content .qlist>ol>li:last-child>:last-child,
    .sidebarblock>.content>:last-child>:last-child,
    .sidebarblock>.content .olist>ol>li:last-child>:last-child,
    .sidebarblock>.content .ulist>ul>li:last-child>:last-child,
    .sidebarblock>.content .qlist>ol>li:last-child>:last-child {
      margin-bottom: 0
    }

    .literalblock pre,
    .listingblock>.content>pre {
      -webkit-border-radius: 4px;
      border-radius: 4px;
      word-wrap: break-word;
      overflow-x: auto;
      padding: 1em;
      font-size: .8125em
    }

    @media screen and (min-width:768px) {

      .literalblock pre,
      .listingblock>.content>pre {
        font-size: .90625em
      }
    }

    @media screen and (min-width:1280px) {

      .literalblock pre,
      .listingblock>.content>pre {
        font-size: 1em
      }
    }

    .literalblock pre,
    .listingblock>.content>pre:not(.highlight),
    .listingblock>.content>pre[class="highlight"],
    .listingblock>.content>pre[class^="highlight "] {
      background: #f7f7f8
    }

    .literalblock.output pre {
      color: #f7f7f8;
      background: rgba(0, 0, 0, .9)
    }

    .listingblock>.content {
      position: relative
    }

    .listingblock code[data-lang]::before {
      display: none;
      content: attr(data-lang);
      position: absolute;
      font-size: .75em;
      top: .425rem;
      right: .5rem;
      line-height: 1;
      text-transform: uppercase;
      color: inherit;
      opacity: .5
    }

    .listingblock:hover code[data-lang]::before {
      display: block
    }

    .listingblock.terminal pre .command::before {
      content: attr(data-prompt);
      padding-right: .5em;
      color: inherit;
      opacity: .5
    }

    .listingblock.terminal pre .command:not([data-prompt])::before {
      content: "$"
    }

    .listingblock pre.highlightjs {
      padding: 0
    }

    .listingblock pre.highlightjs>code {
      padding: 1em;
      -webkit-border-radius: 4px;
      border-radius: 4px
    }

    .listingblock pre.prettyprint {
      border-width: 0
    }

    .prettyprint {
      background: #f7f7f8
    }

    pre.prettyprint .linenums {
      line-height: 1.45;
      margin-left: 2em
    }

    pre.prettyprint li {
      background: none;
      list-style-type: inherit;
      padding-left: 0
    }

    pre.prettyprint li code[data-lang]::before {
      opacity: 1
    }

    pre.prettyprint li:not(:first-child) code[data-lang]::before {
      display: none
    }

    table.linenotable {
      border-collapse: separate;
      border: 0;
      margin-bottom: 0;
      background: none
    }

    table.linenotable td[class] {
      color: inherit;
      vertical-align: top;
      padding: 0;
      line-height: inherit;
      white-space: normal
    }

    table.linenotable td.code {
      padding-left: .75em
    }

    table.linenotable td.linenos {
      border-right: 1px solid currentColor;
      opacity: .35;
      padding-right: .5em
    }

    pre.pygments .lineno {
      border-right: 1px solid currentColor;
      opacity: .35;
      display: inline-block;
      margin-right: .75em
    }

    pre.pygments .lineno::before {
      content: "";
      margin-right: -.125em
    }

    .quoteblock {
      margin: 0 1em 1.25em 1.5em;
      display: table
    }

    .quoteblock:not(.excerpt)>.title {
      margin-left: -1.5em;
      margin-bottom: .75em
    }

    .quoteblock blockquote,
    .quoteblock p {
      color: rgba(0, 0, 0, .85);
      font-size: 1.15rem;
      line-height: 1.75;
      word-spacing: .1em;
      letter-spacing: 0;
      font-style: italic;
      text-align: justify
    }

    .quoteblock blockquote {
      margin: 0;
      padding: 0;
      border: 0
    }

    .quoteblock blockquote::before {
      content: "\201c";
      float: left;
      font-size: 2.75em;
      font-weight: bold;
      line-height: .6em;
      margin-left: -.6em;
      color: #7a2518;
      text-shadow: 0 1px 2px rgba(0, 0, 0, .1)
    }

    .quoteblock blockquote>.paragraph:last-child p {
      margin-bottom: 0
    }

    .quoteblock .attribution {
      margin-top: .75em;
      margin-right: .5ex;
      text-align: right
    }

    .verseblock {
      margin: 0 1em 1.25em
    }

    .verseblock pre {
      font-family: "Open Sans", "DejaVu Sans", sans;
      font-size: 1.15rem;
      color: rgba(0, 0, 0, .85);
      font-weight: 300;
      text-rendering: optimizeLegibility
    }

    .verseblock pre strong {
      font-weight: 400
    }

    .verseblock .attribution {
      margin-top: 1.25rem;
      margin-left: .5ex
    }

    .quoteblock .attribution,
    .verseblock .attribution {
      font-size: .9375em;
      line-height: 1.45;
      font-style: italic
    }

    .quoteblock .attribution br,
    .verseblock .attribution br {
      display: none
    }

    .quoteblock .attribution cite,
    .verseblock .attribution cite {
      display: block;
      letter-spacing: -.025em;
      color: rgba(0, 0, 0, .6)
    }

    .quoteblock.abstract blockquote::before,
    .quoteblock.excerpt blockquote::before,
    .quoteblock .quoteblock blockquote::before {
      display: none
    }

    .quoteblock.abstract blockquote,
    .quoteblock.abstract p,
    .quoteblock.excerpt blockquote,
    .quoteblock.excerpt p,
    .quoteblock .quoteblock blockquote,
    .quoteblock .quoteblock p {
      line-height: 1.6;
      word-spacing: 0
    }

    .quoteblock.abstract {
      margin: 0 1em 1.25em;
      display: block
    }

    .quoteblock.abstract>.title {
      margin: 0 0 .375em;
      font-size: 1.15em;
      text-align: center
    }

    .quoteblock.excerpt>blockquote,
    .quoteblock .quoteblock {
      padding: 0 0 .25em 1em;
      border-left: .25em solid #dddddf
    }

    .quoteblock.excerpt,
    .quoteblock .quoteblock {
      margin-left: 0
    }

    .quoteblock.excerpt blockquote,
    .quoteblock.excerpt p,
    .quoteblock .quoteblock blockquote,
    .quoteblock .quoteblock p {
      color: inherit;
      font-size: 1.0625rem
    }

    .quoteblock.excerpt .attribution,
    .quoteblock .quoteblock .attribution {
      color: inherit;
      text-align: left;
      margin-right: 0
    }

    table.tableblock {
      max-width: 100%;
      border-collapse: separate
    }

    p.tableblock:last-child {
      margin-bottom: 0
    }

    td.tableblock>.content>:last-child {
      margin-bottom: -1.25em
    }

    td.tableblock>.content>:last-child.sidebarblock {
      margin-bottom: 0
    }

    table.tableblock,
    th.tableblock,
    td.tableblock {
      border: 0 solid #dedede
    }

    table.grid-all>thead>tr>.tableblock,
    table.grid-all>tbody>tr>.tableblock {
      border-width: 0 1px 1px 0
    }

    table.grid-all>tfoot>tr>.tableblock {
      border-width: 1px 1px 0 0
    }

    table.grid-cols>*>tr>.tableblock {
      border-width: 0 1px 0 0
    }

    table.grid-rows>thead>tr>.tableblock,
    table.grid-rows>tbody>tr>.tableblock {
      border-width: 0 0 1px
    }

    table.grid-rows>tfoot>tr>.tableblock {
      border-width: 1px 0 0
    }

    table.grid-all>*>tr>.tableblock:last-child,
    table.grid-cols>*>tr>.tableblock:last-child {
      border-right-width: 0
    }

    table.grid-all>tbody>tr:last-child>.tableblock,
    table.grid-all>thead:last-child>tr>.tableblock,
    table.grid-rows>tbody>tr:last-child>.tableblock,
    table.grid-rows>thead:last-child>tr>.tableblock {
      border-bottom-width: 0
    }

    table.frame-all {
      border-width: 1px
    }

    table.frame-sides {
      border-width: 0 1px
    }

    table.frame-topbot,
    table.frame-ends {
      border-width: 1px 0
    }

    table.stripes-all tr,
    table.stripes-odd tr:nth-of-type(odd),
    table.stripes-even tr:nth-of-type(even),
    table.stripes-hover tr:hover {
      background: #f8f8f7
    }

    th.halign-left,
    td.halign-left {
      text-align: left
    }

    th.halign-right,
    td.halign-right {
      text-align: right
    }

    th.halign-center,
    td.halign-center {
      text-align: center
    }

    th.valign-top,
    td.valign-top {
      vertical-align: top
    }

    th.valign-bottom,
    td.valign-bottom {
      vertical-align: bottom
    }

    th.valign-middle,
    td.valign-middle {
      vertical-align: middle
    }

    table thead th,
    table tfoot th {
      font-weight: bold
    }

    tbody tr th {
      display: table-cell;
      line-height: 1.6;
      background: #f7f8f7
    }

    tbody tr th,
    tbody tr th p,
    tfoot tr th,
    tfoot tr th p {
      color: rgba(0, 0, 0, .8);
      font-weight: bold
    }

    p.tableblock>code:only-child {
      background: none;
      padding: 0
    }

    p.tableblock {
      font-size: 1em
    }

    ol {
      margin-left: 1.75em
    }

    ul li ol {
      margin-left: 1.5em
    }

    dl dd {
      margin-left: 1.125em
    }

    dl dd:last-child,
    dl dd:last-child>:last-child {
      margin-bottom: 0
    }

    ol>li p,
    ul>li p,
    ul dd,
    ol dd,
    .olist .olist,
    .ulist .ulist,
    .ulist .olist,
    .olist .ulist {
      margin-bottom: .625em
    }

    ul.checklist,
    ul.none,
    ol.none,
    ul.no-bullet,
    ol.no-bullet,
    ol.unnumbered,
    ul.unstyled,
    ol.unstyled {
      list-style-type: none
    }

    ul.no-bullet,
    ol.no-bullet,
    ol.unnumbered {
      margin-left: .625em
    }

    ul.unstyled,
    ol.unstyled {
      margin-left: 0
    }

    ul.checklist {
      margin-left: .625em
    }

    ul.checklist li>p:first-child>.fa-square-o:first-child,
    ul.checklist li>p:first-child>.fa-check-square-o:first-child {
      width: 1.25em;
      font-size: .8em;
      position: relative;
      bottom: .125em
    }

    ul.checklist li>p:first-child>input[type="checkbox"]:first-child {
      margin-right: .25em
    }

    ul.inline {
      display: -ms-flexbox;
      display: -webkit-box;
      display: flex;
      -ms-flex-flow: row wrap;
      -webkit-flex-flow: row wrap;
      flex-flow: row wrap;
      list-style: none;
      margin: 0 0 .625em -1.25em
    }

    ul.inline>li {
      margin-left: 1.25em
    }

    .unstyled dl dt {
      font-weight: 400;
      font-style: normal
    }

    ol.arabic {
      list-style-type: decimal
    }

    ol.decimal {
      list-style-type: decimal-leading-zero
    }

    ol.loweralpha {
      list-style-type: lower-alpha
    }

    ol.upperalpha {
      list-style-type: upper-alpha
    }

    ol.lowerroman {
      list-style-type: lower-roman
    }

    ol.upperroman {
      list-style-type: upper-roman
    }

    ol.lowergreek {
      list-style-type: lower-greek
    }

    .hdlist>table,
    .colist>table {
      border: 0;
      background: none
    }

    .hdlist>table>tbody>tr,
    .colist>table>tbody>tr {
      background: none
    }

    td.hdlist1,
    td.hdlist2 {
      vertical-align: top;
      padding: 0 .625em
    }

    td.hdlist1 {
      font-weight: bold;
      padding-bottom: 1.25em
    }

    .literalblock+.colist,
    .listingblock+.colist {
      margin-top: -.5em
    }

    .colist td:not([class]):first-child {
      padding: .4em .75em 0;
      line-height: 1;
      vertical-align: top
    }

    .colist td:not([class]):first-child img {
      max-width: none
    }

    .colist td:not([class]):last-child {
      padding: .25em 0
    }

    .thumb,
    .th {
      line-height: 0;
      display: inline-block;
      border: solid 4px #fff;
      -webkit-box-shadow: 0 0 0 1px #ddd;
      box-shadow: 0 0 0 1px #ddd
    }

    .imageblock.left {
      margin: .25em .625em 1.25em 0
    }

    .imageblock.right {
      margin: .25em 0 1.25em .625em
    }

    .imageblock>.title {
      margin-bottom: 0
    }

    .imageblock.thumb,
    .imageblock.th {
      border-width: 6px
    }

    .imageblock.thumb>.title,
    .imageblock.th>.title {
      padding: 0 .125em
    }

    .image.left,
    .image.right {
      margin-top: .25em;
      margin-bottom: .25em;
      display: inline-block;
      line-height: 0
    }

    .image.left {
      margin-right: .625em
    }

    .image.right {
      margin-left: .625em
    }

    a.image {
      text-decoration: none;
      display: inline-block
    }

    a.image object {
      pointer-events: none
    }

    sup.footnote,
    sup.footnoteref {
      font-size: .875em;
      position: static;
      vertical-align: super
    }

    sup.footnote a,
    sup.footnoteref a {
      text-decoration: none
    }

    sup.footnote a:active,
    sup.footnoteref a:active {
      text-decoration: underline
    }

    #footnotes {
      padding-top: .75em;
      padding-bottom: .75em;
      margin-bottom: .625em
    }

    #footnotes hr {
      width: 20%;
      min-width: 6.25em;
      margin: -.25em 0 .75em;
      border-width: 1px 0 0
    }

    #footnotes .footnote {
      padding: 0 .375em 0 .225em;
      line-height: 1.3334;
      font-size: .875em;
      margin-left: 1.2em;
      margin-bottom: .2em
    }

    #footnotes .footnote a:first-of-type {
      font-weight: bold;
      text-decoration: none;
      margin-left: -1.05em
    }

    #footnotes .footnote:last-of-type {
      margin-bottom: 0
    }

    #content #footnotes {
      margin-top: -.625em;
      margin-bottom: 0;
      padding: .75em 0
    }

    .gist .file-data>table {
      border: 0;
      background: #fff;
      width: 100%;
      margin-bottom: 0
    }

    .gist .file-data>table td.line-data {
      width: 99%
    }

    div.unbreakable {
      page-break-inside: avoid
    }

    .big {
      font-size: larger
    }

    .small {
      font-size: smaller
    }

    .underline {
      text-decoration: underline
    }

    .overline {
      text-decoration: overline
    }

    .line-through {
      text-decoration: line-through
    }

    .aqua {
      color: #00bfbf
    }

    .aqua-background {
      background: #00fafa
    }

    .black {
      color: #000
    }

    .black-background {
      background: #000
    }

    .blue {
      color: #0000bf
    }

    .blue-background {
      background: #0000fa
    }

    .fuchsia {
      color: #bf00bf
    }

    .fuchsia-background {
      background: #fa00fa
    }

    .gray {
      color: #606060
    }

    .gray-background {
      background: #7d7d7d
    }

    .green {
      color: #006000
    }

    .green-background {
      background: #007d00
    }

    .lime {
      color: #00bf00
    }

    .lime-background {
      background: #00fa00
    }

    .maroon {
      color: #600000
    }

    .maroon-background {
      background: #7d0000
    }

    .navy {
      color: #000060
    }

    .navy-background {
      background: #00007d
    }

    .olive {
      color: #606000
    }

    .olive-background {
      background: #7d7d00
    }

    .purple {
      color: #600060
    }

    .purple-background {
      background: #7d007d
    }

    .red {
      color: #bf0000
    }

    .red-background {
      background: #fa0000
    }

    .silver {
      color: #909090
    }

    .silver-background {
      background: #bcbcbc
    }

    .teal {
      color: #006060
    }

    .teal-background {
      background: #007d7d
    }

    .white {
      color: #bfbfbf
    }

    .white-background {
      background: #fafafa
    }

    .yellow {
      color: #bfbf00
    }

    .yellow-background {
      background: #fafa00
    }

    span.icon>.fa {
      cursor: default
    }

    a span.icon>.fa {
      cursor: inherit
    }

    .admonitionblock td.icon [class^="fa icon-"] {
      font-size: 2.5em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, .5);
      cursor: default
    }

    .admonitionblock td.icon .icon-note::before {
      content: "\f05a";
      color: #19407c
    }

    .admonitionblock td.icon .icon-tip::before {
      content: "\f0eb";
      text-shadow: 1px 1px 2px rgba(155, 155, 0, .8);
      color: #111
    }

    .admonitionblock td.icon .icon-warning::before {
      content: "\f071";
      color: #bf6900
    }

    .admonitionblock td.icon .icon-caution::before {
      content: "\f06d";
      color: #bf3400
    }

    .admonitionblock td.icon .icon-important::before {
      content: "\f06a";
      color: #bf0000
    }

    .conum[data-value] {
      display: inline-block;
      color: #fff !important;
      background: rgba(0, 0, 0, .8);
      -webkit-border-radius: 100px;
      border-radius: 100px;
      text-align: center;
      font-size: .75em;
      width: 1.67em;
      height: 1.67em;
      line-height: 1.67em;
      font-family: "Open Sans", "DejaVu Sans", sans-serif;
      font-style: normal;
      font-weight: bold
    }

    .conum[data-value] * {
      color: #fff !important
    }

    .conum[data-value]+b {
      display: none
    }

    .conum[data-value]::after {
      content: attr(data-value)
    }

    pre .conum[data-value] {
      position: relative;
      top: -.125em
    }

    b.conum * {
      color: inherit !important
    }

    .conum:not([data-value]):empty {
      display: none
    }

    dt,
    th.tableblock,
    td.content,
    div.footnote {
      text-rendering: optimizeLegibility
    }

    h1,
    h2,
    p,
    td.content,
    span.alt {
      letter-spacing: -.01em
    }

    p strong,
    td.content strong,
    div.footnote strong {
      letter-spacing: -.005em
    }

    p,
    blockquote,
    dt,
    td.content,
    span.alt {
      font-size: 1.0625rem
    }

    p {
      margin-bottom: 1.25rem
    }

    .sidebarblock p,
    .sidebarblock dt,
    .sidebarblock td.content,
    p.tableblock {
      font-size: 1em
    }

    .exampleblock>.content {
      background: #fffef7;
      border-color: #e0e0dc;
      -webkit-box-shadow: 0 1px 4px #e0e0dc;
      box-shadow: 0 1px 4px #e0e0dc
    }

    .print-only {
      display: none !important
    }

    @page {
      margin: 1.25cm .75cm
    }

    @media print {
      * {
        -webkit-box-shadow: none !important;
        box-shadow: none !important;
        text-shadow: none !important
      }

      html {
        font-size: 80%
      }

      a {
        color: inherit !important;
        text-decoration: underline !important
      }

      a.bare,
      a[href^="#"],
      a[href^="mailto:"] {
        text-decoration: none !important
      }

      a[href^="http:"]:not(.bare)::after,
      a[href^="https:"]:not(.bare)::after {
        content: "(" attr(href) ")";
        display: inline-block;
        font-size: .875em;
        padding-left: .25em
      }

      abbr[title]::after {
        content: " (" attr(title) ")"
      }

      pre,
      blockquote,
      tr,
      img,
      object,
      svg {
        page-break-inside: avoid
      }

      thead {
        display: table-header-group
      }

      svg {
        max-width: 100%
      }

      p,
      blockquote,
      dt,
      td.content {
        font-size: 1em;
        orphans: 3;
        widows: 3
      }

      h2,
      h3,
      #toctitle,
      .sidebarblock>.content>.title {
        page-break-after: avoid
      }

      #toc,
      .sidebarblock,
      .exampleblock>.content {
        background: none !important
      }

      #toc {
        border-bottom: 1px solid #dddddf !important;
        padding-bottom: 0 !important
      }

      body.book #header {
        text-align: center
      }

      body.book #header>h1:first-child {
        border: 0 !important;
        margin: 2.5em 0 1em
      }

      body.book #header .details {
        border: 0 !important;
        display: block;
        padding: 0 !important
      }

      body.book #header .details span:first-child {
        margin-left: 0 !important
      }

      body.book #header .details br {
        display: block
      }

      body.book #header .details br+span::before {
        content: none !important
      }

      body.book #toc {
        border: 0 !important;
        text-align: left !important;
        padding: 0 !important;
        margin: 0 !important
      }

      body.book #toc,
      body.book #preamble,
      body.book h1.sect0,
      body.book .sect1>h2 {
        page-break-before: always
      }

      .listingblock code[data-lang]::before {
        display: block
      }

      #footer {
        padding: 0 .9375em
      }

      .hide-on-print {
        display: none !important
      }

      .print-only {
        display: block !important
      }

      .hide-for-print {
        display: none !important
      }

      .show-for-print {
        display: inherit !important
      }
    }

    @media print,
    amzn-kf8 {
      #header>h1:first-child {
        margin-top: 1.25rem
      }

      .sect1 {
        padding: 0 !important
      }

      .sect1+.sect1 {
        border: 0
      }

      #footer {
        background: none
      }

      #footer-text {
        color: rgba(0, 0, 0, .6);
        font-size: .9em
      }
    }

    @media amzn-kf8 {

      #header,
      #content,
      #footnotes,
      #footer {
        padding: 0
      }
    }
  </style>
</head>

<body class="book toc2 toc-left">
  <div id="header">
    <h1>Faim Finite Element Analysis Manual</h1>
    <div class="details">
      <span id="author" class="author">Eric Nodwell and Steven K. Boyd</span><br>
    </div>
    <div id="toc" class="toc2">
      <div id="toctitle">Table of Contents</div>
      <ul class="sectlevel1">
        <li><a href="#introduction">1. Introduction</a>
          <ul class="sectlevel2">
            <li><a href="#_overview">1.1. Overview</a></li>
            <li><a href="#_how_to_read_this_manual">1.2. How to read this manual</a></li>
            <li><a href="#what_is_new">1.3. What is new in version 10</a></li>
            <li><a href="#installation">1.4. Installation</a></li>
            <li><a href="#workflow">1.5. Work flow for finite element analysis</a></li>
            <li><a href="#note_about_units">1.6. Units in Faim</a></li>
          </ul>
        </li>
        <li><a href="#using_n88modelgenerator">2. Preparing Finite Element Models With n88modelgenerator</a>
          <ul class="sectlevel2">
            <li><a href="#running_n88modelgenerator">2.1. Running n88modelgenerator</a></li>
            <li><a href="#test_orientation">2.2. Test orientation</a></li>
            <li><a href="#standard_tests">2.3. Standard tests</a></li>
            <li><a href="#uneven_surfaces">2.4. Uneven surfaces</a></li>
            <li><a href="#material_specification">2.5. Material specification</a></li>
          </ul>
        </li>
        <li><a href="#vtkbone">3. Preparing Finite Element Models with vtkbone</a>
          <ul class="sectlevel2">
            <li><a href="#api_documentation">3.1. vtkbone API documentation</a></li>
            <li><a href="#_array_indexing_in_vtkbone">3.2. Array indexing in vtkbone</a></li>
            <li><a href="#_typical_workflow_for_vtkbone">3.3. Typical workflow for vtkbone</a></li>
            <li><a href="#vtkboneFiniteElementModel">3.4. The vtkboneFiniteElementModel object</a></li>
            <li><a href="#_reading_a_segmented_image">3.5. Reading a segmented image</a></li>
            <li><a href="#_reading_an_unsegmented_image_and_segmenting_it">3.6. Reading an unsegmented image and
                segmenting it</a></li>
            <li><a href="#ensuring_connectivity">3.7. Ensuring connectivity</a></li>
            <li><a href="#_generating_a_mesh">3.8. Generating a mesh</a></li>
            <li><a href="#_defining_materials">3.9. Defining materials</a></li>
            <li><a href="#_constructing_a_material_table">3.10. Constructing a material table</a></li>
            <li><a href="#_creating_a_finite_element_model">3.11. Creating a finite element model</a></li>
            <li><a href="#creating_sets">3.12. Creating node and element sets</a></li>
            <li><a href="#adding_boundary_conditions">3.13. Adding boundary conditions</a></li>
            <li><a href="#adding_applied_loads">3.14. Adding applied loads</a></li>
            <li><a href="#adding_a_convergence_set">3.15. Optional: Adding a convergence set</a></li>
            <li><a href="#_ensuring_your_model_is_well_defined">3.16. Ensuring your model is well-defined</a></li>
            <li><a href="#setting_post_processing_parameters">3.17. Setting post-processing parameters</a></li>
            <li><a href="#filters_for_standard_tests">3.18. Filters for creating standard tests</a></li>
            <li><a href="#_modifying_a_finite_element_model">3.19. Modifying a finite element model</a></li>
            <li><a href="#_updating_the_history_and_the_log">3.20. Updating the history and the log</a></li>
            <li><a href="#_writing_a_model_file_for_input_to_the_solver">3.21. Writing a model file for input to the
                solver</a></li>
            <li><a href="#_visualizing_intermediate_results">3.22. Visualizing intermediate results</a></li>
            <li><a href="#_error_handling">3.23. Error handling</a></li>
          </ul>
        </li>
        <li><a href="#solving_linear_problems">4. Solving Linear Problems</a>
          <ul class="sectlevel2">
            <li><a href="#using_n88solver_slt">4.1. Obtaining solutions to linear problems using n88solver_slt</a></li>
            <li><a href="#_convergence">4.2. Convergence</a></li>
            <li><a href="#evaluating_solution_quality">4.3. Evaluating solution quality</a></li>
          </ul>
        </li>
        <li><a href="#solving_nonlinear_problems">5. Solving Nonlinear Problems</a>
          <ul class="sectlevel2">
            <li><a href="#using_n88solver_spt">5.1. Obtaining solutions to nonlinear problems with n88solver_spt</a>
            </li>
            <li><a href="#elastoplastic_convergence">5.2. Convergence</a></li>
            <li><a href="#nonlinear_progressive_loads">5.3. Obtaining accurate nonlinear solutions by progressively
                applying loads</a></li>
            <li><a href="#evaluating_nonlinear_solution_quality">5.4. Evaluating nonlinear solution quality</a></li>
          </ul>
        </li>
        <li><a href="#postprocessing">6. Post-Processing and Analysis</a>
          <ul class="sectlevel2">
            <li><a href="#using_n88derivedfields">6.1. Calculating additional solution fields with n88derivedfields</a>
            </li>
            <li><a href="#extracting_fields">6.2. Exporting solution fields from the model file</a></li>
            <li><a href="#using_n88postfaim">6.3. Obtaining standard post-processing values with n88postfaim</a></li>
            <li><a href="#tabulate_analysis">6.4. Tabulating results from analysis files</a></li>
          </ul>
        </li>
        <li><a href="#tutorials">7. Tutorials</a>
          <ul class="sectlevel2">
            <li><a href="#cube_tutorial">7.1. Introductory tutorial: Compressing a solid cube</a></li>
            <li><a href="#radius_slice_tutorial">7.2. Tutorial: Compression test of a radius bone slice</a></li>
            <li><a href="#radius_bending_tutorial">7.3. Tutorial: Bending test of a radius bone with an uneven
                surface</a></li>
            <li><a href="#radius_bending_elastoplastic_tutorial">7.4. Tutorial: Radius bending with elasto-plastic
                material properties</a></li>
            <li><a href="#cube_with_vtkbone_tutorial">7.5. Tutorial: Compressing a cube revisited using vtkbone</a></li>
            <li><a href="#cantilever_tutorial">7.6. Tutorial: Deflection of a cantilevered beam; adding custom boundary
                conditions and loads</a></li>
            <li><a href="#cantilever_elastoplastic_tutorial">7.7. Tutorial: A cantilevered beam with elastoplastic
                material properties</a></li>
            <li><a href="#screw_pullout_tutorial">7.8. Advanced custom model: A screw pull-out test</a></li>
            <li><a href="#longitudinal_fe_with_vtkbone_tutorial">7.9. Tutorial: Radius compression with transformed
                boundary conditions for longitudinal bone strength estimates</a></li>
            <li><a href="#additional_examples">7.10. Additional examples</a></li>
          </ul>
        </li>
        <li><a href="#special_topics">8. Special Topics</a>
          <ul class="sectlevel2">
            <li><a href="#material_arrays">8.1. Efficient Handling of Large Numbers of Material Definitions</a></li>
            <li><a href="#direct_mechanics">8.2. Direct Mechanics</a></li>
            <li><a href="#n88postfaim_pistoia_failure_load">8.3. Pistoia Failure Load Estimate</a></li>
          </ul>
        </li>
        <li><a href="#_command_reference">9. Command Reference</a>
          <ul class="sectlevel2">
            <li><a href="#faim">9.1. faim</a></li>
            <li><a href="#n88coarsen">9.2. n88coarsen</a></li>
            <li><a href="#n88copymodel">9.3. n88copymodel</a></li>
            <li><a href="#n88compress">9.4. n88compress</a></li>
            <li><a href="#n88derivedfields">9.5. n88derivedfields</a></li>
            <li><a href="#n88directmechanics">9.6. n88directmechanics</a></li>
            <li><a href="#n88evaluate">9.7. n88evaluate</a></li>
            <li><a href="#n88extractfields">9.8. n88extractfields</a></li>
            <li><a href="#n88extractsets">9.9. n88extractsets</a></li>
            <li><a href="#n88interpolatesolution">9.10. n88interpolatesolution</a></li>
            <li><a href="#n88modelgenerator">9.11. n88modelgenerator</a></li>
            <li><a href="#n88modelinfo">9.12. n88modelinfo</a></li>
            <li><a href="#n88pistoia">9.13. n88pistoia</a></li>
            <li><a href="#n88postfaim">9.14. n88postfaim</a></li>
            <li><a href="#n88solver">9.15. n88solver (_slt, _sla and _spt)</a></li>
            <li><a href="#n88tabulate">9.16. n88tabulate</a></li>
          </ul>
        </li>
        <li><a href="#upgrading_from_previous_versions">Appendix A: Upgrading from previous versions</a>
          <ul class="sectlevel2">
            <li><a href="#upgrading_from_version_7">A.1. Upgrading from Faim version 7</a></li>
            <li><a href="#upgrading_from_version_6">A.2. Upgrading from Faim version 6</a></li>
            <li><a href="#upgrading_from_version_5">A.3. Upgrading from Faim version 5</a></li>
          </ul>
        </li>
        <li><a href="#n88model_file_format">Appendix B: n88model File Format</a>
          <ul class="sectlevel2">
            <li><a href="#_converting_a_n88model_file_to_and_from_a_text_file">B.1. Converting a n88model file to and
                from a text file</a></li>
            <li><a href="#_example_n88model_file_in_cdl_text_format">B.2. Example n88model file in CDL text format</a>
            </li>
            <li><a href="#_specification">B.3. Specification</a></li>
            <li><a href="#_writing_code_to_read_and_write_n88model_files">B.4. Writing code to read and write n88model
                files</a></li>
          </ul>
        </li>
        <li><a href="#scripting">Appendix C: Automating the Processing of Multiple Models With Scripts</a>
          <ul class="sectlevel2">
            <li><a href="#_a_script_to_generate_a_mesh_and_solve_it">C.1. A script to generate a mesh and solve it</a>
            </li>
            <li><a href="#_scripting_several_models">C.2. Scripting several models</a></li>
            <li><a href="#_unattended_execution_of_scripts">C.3. Unattended execution of scripts</a></li>
          </ul>
        </li>
        <li><a href="#bibliography">Bibliography</a></li>
        <li><a href="#_index">Index</a></li>
        <li><a href="#_colophon">Colophon</a></li>
      </ul>
    </div>
  </div>
  <div id="content">
    <div id="preamble">
      <div class="sectionbody">
        <div class="paragraph">
          <p></p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="introduction">1. Introduction</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_overview">1.1. Overview</h3>
          <div class="paragraph">
            <p>Faim is a finite element solver optimized for solid mechanics simulations of
              bone, including strength and stiffness determinations, directly from
              three-dimensional medical image data such as micro-CT. Faim uses the mesh-free
              method, which is a highly memory efficient method of finite element analysis.
              This makes it possible to solve finite element
              models with very large numbers of degrees of freedom derived directly from
              high resolution scans.</p>
          </div>
          <div class="paragraph">
            <p>The Faim Finite Element solver has an established record of being used in
              scientific studies. See the <a href="#bibliography">bibliography</a> for selected studies.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_how_to_read_this_manual">1.2. How to read this manual</h3>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>If you need to install Faim, refer to <a href="#installation">Installation</a> in this chapter.</p>
              </li>
              <li>
                <p>Experienced users may want to read <a href="#what_is_new">What is new in version 10</a>, and then go
                  directly
                  to the sections indicated there.</p>
              </li>
              <li>
                <p>For new users, start by reading the section <a href="#workflow">Work flow for finite element
                    analysis</a>.
                  This will give you an overview of finite element analysis and the Numerics88 software tools.</p>
              </li>
              <li>
                <p>Next, we recommend that you
                  jump first to <a href="#cube_tutorial">An introductory tutorial: compressing a solid cube</a>. It
                  will take you through the typical steps of generating a model, verifying
                  it, solving it, and analyzing the results. This is a good introduction to
                  how everything fits together, and will help to put things into context.</p>
              </li>
              <li>
                <p>The intervening chapters (preceeding the Tutorials chapter) should be used as
                  reference material. You probably don&#8217;t want to read them
                  from beginning to end in one sitting with the intention of retaining
                  everything; however, you should at least skim through them
                  to be aware of the options, limitations and potential pitfalls.</p>
              </li>
              <li>
                <p>If you are a user who is familiar with <code>n88modelgenerator</code> and who is interested
                  in creating your own custom models, start with the tutorial,
                  <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>.
                  And then move on to the more advanced tutorials dealing with <code>vtkbone</code>.
                </p>
              </li>
            </ol>
          </div>
        </div>
        <div class="sect2">
          <h3 id="what_is_new">1.3. What is new in version 10</h3>
          <div class="paragraph">
            <p>Version 10 introduces the following new features:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Updated code segments for compatibility with VTK 9.3 and Python 3.93.12.</p>
              </li>
              <li>
                <p>Added support for <code>vtkbone 2.0</code> (previously 1.1) and <code>n88tools 10.0</code> (previously 9.0).</p>
              </li>
            </ol>
          </div>
        </div>
        <div class="sect2">
          <h3 id="installation">1.4. Installation</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>In version 10, the installation of Faim is more modular than in previous versions.</p>
          </div>
          <div class="sect3">
            <h4 id="_install_the_solvers_and_n88modelgenerator">1.4.1. Install the solvers and n88modelgenerator</h4>
            <div class="paragraph">
              <p>The solvers and n88modelgenerator are the non-open sourced components of Faim and require a license
                file to run. They are bundled together into installers that can be downloaded from <a
                  href="https://numerics88.com/n88/downloads/" class="bare">https://numerics88.com/n88/downloads/</a> .</p>
            </div>
            <div class="paragraph">
              <div class="title">Linux</div>
              <p>The Linux installer will be named something like <code>faim-10.0-linux.sh</code>. It can be installed
                with the following command for a single user:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>bash faim-10.0-linux.sh</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>For a system-wide installation, add <code>sudo</code>:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>sudo bash faim-10.0-linux.sh</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>If you want to specify a particular install location, use the <code>--prefix</code> flag, for example
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>bash faim-10.0-linux.sh --prefix=$HOME/Numerics88</pre>
              </div>
            </div>
            <div class="paragraph">
              <div class="title">Windows</div>
              <p>The Windows installer will be named something like <code>faim-10.0-windows.exe</code>. Simply run
                it to install.</p>
            </div>
            <div class="paragraph">
              <div class="title">macOS</div>
              <p>The Mac installer is a disk image with a name like <code>faim-10.0-macos.dmg</code>. Double-click
                to mount it, and then drag the Faim icon to the Applications folder, or to any other
                convenient location.</p>
            </div>
            <div class="paragraph">
              <p>For all operating systems, it is possible to install Faim system-wide using
                an administrator account or for a single user, for which
                administrator rights are not needed. It is also possible to install it multiple
                times on a single machine, so that each user has their own installation.
                The installation directory can also be freely renamed and moved around.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="how_to_run">1.4.2. How to run the solvers</h4>
            <div class="paragraph">
              <p>

              </p>
            </div>
            <div class="paragraph">
              <p>To run the solvers and n88modelgenerator, you may use any of the following methods:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Run them with the complete path. For example</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>/path/to/faim/installation/n88modelgenerator</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>or, on Windows</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>"c:\Program Files\Faim 10.0\n88modelgenerator"</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Permanently add the directory where they are installed to your PATH variable. The exact
                    method depends on your operating system.</p>
                </li>
                <li>
                  <p>Run the script <code>setenv</code> in a Terminal (or Command Prompt on Windows) to set the PATH
                    just
                    for that Terminal. On Linux and macOS, this is done as follows</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>source /path/to/faim/installation/setenv</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>On Windows, if you are using a Command Prompt, then you can run</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>"c:\Program Files\Faim 10.0\setenv.bat"</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>while for Windows PowerShell, the equivalent is</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>. "c:\Program Files\Faim 10.0\setenv.ps1"</pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    In version 10, the solvers and n88modelgenerator are statically linked.
                    Setting <code>LD_LIBRARY_PATH</code> (Linux) or <code>DYLD_LIBRARY_PATH</code> (macOS) is no longer
                    required.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="license_file">1.4.3. Install a license file</h4>
            <div class="paragraph">
              <p>To receive a license file, you must run one of the Faim programs with the --license_check
                option, and send the resulting UUID to <a href="mailto:skboyd@ucalgary.ca">skboyd@ucalgary.ca</a> . For
                example,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>&gt; n88modelgenerator --license_check
n88modelgenerator Version 10.0
Copyright (c) 2010-2025, Numerics88 Solutions Ltd.
Host UUID is DFD0727B-89AA-4808-B03F-E73E80ABFE64</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>When you receive a license file, which is a short text file, you can copy it to one of several
                possible locations where the software can find it. These locations are:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>a subdirectory <code>licenses</code> of the installation directory, or</p>
                </li>
                <li>
                  <p>the location specified by the environment variable <code>NUMERICS88_LICENSE_DIR</code>, if set,</p>
                </li>
                <li>
                  <p>for an individual user, a directory <code>Numerics88/licenses</code>
                    (<code>Numerics88\licenses</code> on Windows)
                    in their home directory, or</p>
                </li>
                <li>
                  <p>on Linux, <code>/etc/numerics88/licenses</code>, or</p>
                </li>
                <li>
                  <p>on macOS, <code>/Library/Application Support/Numerics88/licenses</code>, or
                    <code>$HOME/Library/Application Support/Numerics88/licenses</code>, or
                  </p>
                </li>
                <li>
                  <p>on macOS, <code>/Users/Shared/Numerics88/licenses</code>.</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>You may have multiple license files installed at once.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="install_n88tools">1.4.4. Install n88tools and vtkbone</h4>
            <div class="paragraph">
              <p>The solvers and n88modelgenerator are most conveniently used together with
                a collection a command-line utilities called <code>n88tools</code>. <code>n88tools</code>
                is implemented in Python, and depends on the library <code>vtkbone</code>. Additionally,
                <code>vtkbone</code> can be used to create custom model generation and processing scripts
                in Python, as will be discussed in a subsequent chapter.
              </p>
            </div>
            <div class="paragraph">
              <p><code>n88tools</code> and <code>vtkbone</code> are open-source. If you wish, you can download the
                source code from <a href="https://github.com/Numerics88/"
                  class="bare">https://github.com/Numerics88/</a> and compile them yourself,
                using whatever installation of Python is most convenient for you.
                Most users however, will not want to go through the hassle of compiling them.
                The quickest way to install them is via Anaconda Python, which is supported
                on Linux, Windows, and macOS. An advantage of using Anaconda Python is
                that the very large repository of mathematical and scientific Python
                packages available in Anaconda Python can be used together with Faim.
                To install <code>n88tools</code> and <code>vtkbone</code> in Anaconda Python, follow these steps:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Install Anaconda Python from <a href="https://www.anaconda.com/distribution/"
                      class="bare">https://www.anaconda.com/distribution/</a> . It is also
                    possible to install Miniconda (<a href="http://conda.pydata.org/miniconda.html"
                      class="bare">http://conda.pydata.org/miniconda.html</a>).
                    Miniconda is identical to Anaconda, except that instead of starting with
                    a very large set of installed python packages, it starts with a minimal
                    set. You can of course add or subtract packages to suit your needs.
                    Anaconda Python can be installed either system-wide, or just for an individual
                    user. Faim works with either arrangement.</p>
                </li>
                <li>
                  <p>Create an Anaconda environment in which to run Faim. To learn about Anaconda
                    environments, we recommend that you take the conda test drive at
                    <a href="http://conda.pydata.org/docs/test-drive.html"
                      class="bare">http://conda.pydata.org/docs/test-drive.html</a> . Creating an Anaconda environment
                    for Faim is optional; you could alternatively install <code>n88tools</code>
                    and <code>vtkbone</code> directly in the root environment of Anaconda. However, using
                    a dedicated enivornment greatly helps with avoiding possible conflicts, where
                    for example <code>vtkbone</code> may want a specific version of a dependency, while some
                    other Python package that you want to use requires a different version of the
                    same dependency. In addition, you can create separate environments for
                    different versions of <code>n88tools</code> and <code>vtkbone</code>, and easily switch between
                    them.
                    To create an Anaconda environment named <code>faim-10.0</code> and install <code>n88tools</code>
                    version 10.0 and <code>vtkbone</code> all in one step, run the following command:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>conda create --name faim-10.0 --channel numerics88 --channel conda-forge python=3.11 n88tools numpy scipy</pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>To use <code>n88tools</code>, you simply activate the Anaconda environment. On Linux and macOS,
                this is done with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>conda activate faim-10.0</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>On Windows, the command is</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>activate faim-10.0</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>You will have to activate the environment in each Terminal (or Command Prompt) in which
                you want to use Faim.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="paraview_plugins">1.4.5. Install the Numerics88 plugins for ParaView</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>ParaView can be used for interactive rendering of Faim finite elements models.
                For this purpose, Numerics88 provides plugins for ParaView. These allow
                ParaView to open <code>n88model</code> files (as well as Scanco AIM files). The plugins
                can be downloaded from <a href="http://numerics88.com/n88/downloads/"
                  class="bare">http://numerics88.com/n88/downloads/</a> . You can unzip
                the plugins into any convenient directory, and you can move and rename
                the plugin directory as you like.</p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    The ParaView plugins are specific to a particular version of
                    ParaView and can not be loaded into a different version of ParaView.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>To load the plugins, open ParaView, and select the menu item <span class="menuseq"><b
                    class="menu">Tools</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Manage
                    Plugins</b></span>.
                The Plugin Manager will appear, as shown in <a href="#paraview_plugin_manager">Figure 1</a>.</p>
            </div>
            <div id="paraview_plugin_manager" class="imageblock">
              <div class="content">
                <img src="images/paraview_plugin_manager.png" alt="paraview plugin manager">
              </div>
              <div class="title">Figure 1. ParaView&#8217;s Plugin Manager</div>
            </div>
            <div class="paragraph">
              <p>Click <b class="button">Load New&#8230;&#8203;</b> and navigate to the location
                of the plugins. Select one of the
                plugins, and then click <b class="button">OK</b>. You will need to repeat this for each of the
                plugins, in particular for</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p><code>libAIMReader</code> ,</p>
                </li>
                <li>
                  <p><code>libImageGaussianSmooth</code> , and</p>
                </li>
                <li>
                  <p><code>libN88ModelReader</code> .</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>They are now loaded, and you should be able to read to corresponding file
                formats. You may want to select <code>Auto Load</code> for each plugin so that you don&#8217;t need to
                load them every time you open Paraview. To do this, click the drop-down arrow beside the plugin in the
                Plugin Manager, and make sure that <code>Auto Load</code> is selected. This is
                shown in <a href="#plugin_manager_auto_load">Figure 2</a>.</p>
            </div>
            <div id="plugin_manager_auto_load" class="imageblock">
              <div class="content">
                <img src="images/plugin_manager_auto_load.png" alt="plugin manager auto load">
              </div>
              <div class="title">Figure 2. Selecting Auto Load in ParaView&#8217;s Plugin Manager</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_additional_downloads">1.4.6. Additional downloads</h4>
            <div class="paragraph">
              <p>A PDF version of this manual can be downloaded from <a href="http://numerics88.com/n88/documentation/"
                  class="bare">http://numerics88.com/n88/documentation/</a> .</p>
            </div>
            <div class="paragraph">
              <p>Example data files, together with scripts for the tutorials in this manual, can be downloaded
                from <a href="http://numerics88.com/n88/downloads/" class="bare">http://numerics88.com/n88/downloads/</a> .</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="workflow">1.5. Work flow for finite element analysis</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>There are several steps involved in applying finite element analysis to 3D
              medical image data. These steps are diagrammed in <a href="#faim_work_flow">Figure 3</a>.
              Generally they can be categorized as pre-processing,
              solving, and post-processing. Faim integrates these steps to simplify the work flow
              as much as possible, while
              retaining flexibility and customizability in preparing, solving and analyzing
              finite element problems derived from micro-CT data.</p>
          </div>
          <div id="faim_work_flow" class="imageblock">
            <div class="content">
              <img src="images/faim_work_flow.png" alt="faim work flow">
            </div>
            <div class="title">Figure 3. Work flow for FE analysis of micro-CT data.</div>
          </div>
          <div class="sect3">
            <h4 id="_segmentation">1.5.1. Segmentation</h4>
            <div class="paragraph">
              <p>The first step is to segment your 3D medical image data. Although in principle
                any type of 3D image data can be analyzed, we focus on the use of
                micro-CT images of bone here. During segmentation, bone and other relevant
                structures in the CT image are labelled and identified. Segmentation is a very
                broad and complex field. Because of this, Numerics88 software does not attempt
                to provide all solutions. Instead, we recommend that you use the segmentation
                tool provided by the manufacturer of your medical image equipment. This has
                the advantage that it will be well-integrated into the scanning workflow. In
                the case of Scanco systems, the tool is <em>Image Processing Language (IPL)</em>; for Skyscan systems,
                <em>CT-analyzer</em> provides segmentation
                functionality.
              </p>
            </div>
            <div class="paragraph">
              <p>In cases where your segmentation problem is unusually tricky and beyond the
                abilities of the manufacturer&#8217;s tools, there are many third party solutions
                available.</p>
            </div>
            <div class="paragraph">
              <p>Whichever tool you use to perform the segmentation, the result should be a 3D
                image file with integer values. These integer values are referred to as
                "Material IDs", because they will subsequently be associated with abstract
                mathematical material models. Material ID zero indicates background material
                (often air, but sometimes also other material, such as marrow in bone) that can
                be assumed to have negligible stiffness. Voxels with material ID zero will not be
                converted to elements in the FE model. Other values can be associated freely
                with particular materials or material properties as required.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_model_generation">1.5.2. Model generation</h4>
            <div class="paragraph">
              <p>Model generation is the process of converting a segmented image to a
                geometrical representation suitable for finite element analysis, complete with
                suitable constraints such as displacement boundary conditions and
                applied loads.</p>
            </div>
            <div class="paragraph">
              <p>A number of steps are required for complete model generation.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">Meshing</dt>
                <dd>
                  <p>Meshing is the process of creating a geometric representation of the model
                    as a collection of finite elements. For micro-CT data, we typically convert
                    each voxel in the input image to a hexahedral (box-shaped)
                    element in the FE model. Each of the corners of the voxel becomes a node
                    in the FE model. Voxels labelled as background (<em>e.g.</em> 0) are ignored.</p>
                </dd>
              </dl>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    There may be scenarios in which it is desirable to have FE models that
                    have elements smaller or larger than the voxels of the available image. Larger
                    elements lead to smaller FE models (<em>i.e.</em> fewer degrees of freedom) which may
                    solve faster, at the expense of accuracy. Smaller elements allow the forces
                    and displacements to vary more smoothly (that is, with higher resolution) in
                    the FE model, at the cost of increased solution time and memory requirements.
                    To alter the FE model from the original 3D image, one typically resamples the
                    original image to the desired resolution employing some sort of
                    interpolation.
                  </td>
                </tr>
              </table>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">Material Assignment</dt>
                <dd>
                  <p>Material assignment is the process of mapping material IDs to
                    mathematical models for material properties. For example, an isotropic
                    material is specified by its Young&#8217;s modulus (E) and Poisson&#8217;s ratio (&#957;).</p>
                </dd>
                <dt class="hdlist1">Assigning Boundary Conditions and Applied Loads</dt>
                <dd>
                  <p>Boundary conditions and applied loads implement a specific mechanical test.
                    The tool used will
                    typically translate a desired physical action, such as a force or a
                    displacement applied to a specific surface, into a set of constraints
                    on a set of nodes or elements.</p>
                </dd>
              </dl>
            </div>
            <div class="paragraph">
              <p>Faim provides two tools for model generation:</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1"><a href="#n88modelgenerator">n88modelgenerator</a></dt>
                <dd>
                  <p><code>n88modelgenerator</code> is a program that can generate a number of standard
                    tests (e.g. axial compression, confined compression, etc&#8230;&#8203;).
                    <code>n88modelgenerator</code> has a number of
                    options that allow for flexibility in tweaking these standard
                    models. <code>n88modelgenerator</code> is the easiest method of generating models.
                  </p>
                </dd>
                <dt class="hdlist1"><a href="#vtkbone">vtkbone</a></dt>
                <dd>
                  <p><code>vtkbone</code> is a collection of custom <a href="http://vtk.org">VTK</a> objects
                    that you can use for creating models, and is a more advanced alternative to using
                    <code>n88modelgenerator</code>. In order to use them, you need
                    to write a program or script (typically in Python). Some learning
                    curve is therefore involved, as well as the time to write, debug and test
                    your programs. The advantage is nearly infinite customizability. VTK
                    objects, including <code>vtkbone</code> objects, are designed to be easily chained
                    together into execution pipelines. In this documention, we will give
                    many examples of using <code>vtkbone</code> in Python scripts.
                  </p>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_finite_element_solver">1.5.3. Finite element solver</h4>
            <div class="paragraph">
              <p>The finite element solver takes the input model and calculates a solution of the displacements and
                forces on all the
                nodes, subject to the specified constraints.</p>
            </div>
            <div class="paragraph">
              <p>As finite element models derived from micro-CT can be very large, the memory
                efficiency and speed of the solver are important. Faim uses a mesh-free
                preconditioned conjugate gradient iterative solver. This type of solver is
                highly memory efficient.</p>
            </div>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Faim is currently limited to small-strain solutions of models with
                    linear and elastoplastic material definitions. This is adequate for most bone
                    biomechanics modelling purposes, as bone undergoes very little strain before
                    failure. However, if you need to accurately model large deformations, the Faim
                    solver is not an appropriate tool.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_post_processing_and_visualization">1.5.4. Post-processing and visualization</h4>
            <div class="paragraph">
              <p>Post-processing and visualization can take many different forms, depending on
                the goals of your analysis. For example, you may want to identify locations of
                stress variations, in which case, a visualization tool is likely the
                best approach. Or, you may want to obtain a basic output such as an overall
                stiffness. A number of common post-processing operations are performed by Faim.</p>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>Visualization is important even in cases where ultimately you want one or more
                quantitative values. Visualization provides a conceptual overview of the
                solution, and may allow one to quickly identify incorrect or invalid results
                due to some deficiency in the input model. Many visualization software
                packages exist. If you don&#8217;t have an existing favourite package, we recommend
                the use of <a href="http://paraview.org">ParaView</a>, which is an open-source solution
                from <a href="http://kitware.com">Kitware</a>. The Faim distribution includes plug-ins for
                ParaView which allow ParaView to directly open Faim file types.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="note_about_units">1.6. Units in Faim</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>Faim is intrinsically unitless; you may use any system of units that are
              self-consistent.</p>
          </div>
          <div class="paragraph">
            <p>Nearly all micro-CT systems use length units of millimetres (mm). With forces
              in Newtons (N), the consistent units for pressure are then megapascals (MPa),
              as 1N/(1mm)<sup>2</sup> = 1MPa. Young&#8217;s modulus is an example of a quantity that has
              units of pressure. In the examples, we will consistently use these units
              (mm, N, MPa).</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="using_n88modelgenerator">2. Preparing Finite Element Models With n88modelgenerator</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p></p>
        </div>
        <div class="sect2">
          <h3 id="running_n88modelgenerator">2.1. Running n88modelgenerator</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p><a href="#n88modelgenerator">n88modelgenerator</a> is a tool to create a number of different standard
              mechanical test simulations directly from segmented 3D images. This tool
              is designed to be simple to use and in many cases, requires
              no more than specifying a test type and an input file, like this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88modelgenerator --test=axial mydata.aim</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>This will generate a file <code>mydata.n88model</code> that is suitable as input to the
              Faim solver.</p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  For an introduction to <a href="#n88modelgenerator">n88modelgenerator</a>, we recommend that you start
                  first with <a href="#cube_tutorial">An introductory tutorial: compressing a solid cube</a>. Getting
                  your hands dirty as it were with the program is often the best way to learn.
                  Once you have some familiarity with the program, the following documentation
                  will make much more sense.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The models produced by <a href="#n88modelgenerator">n88modelgenerator</a> can be
              modified and tuned by specifying a number of optional
              parameters. For example, here <a href="#n88modelgenerator">n88modelgenerator</a> is run to create
              an <a href="#axial_test">axial test</a> with a specified compressive strain and Young&#8217;s modulus:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88modelgenerator --test=axial --normal_strain=-0.01 --youngs_modulus=6829 test25a.aim</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Parameters can be specified either on the command line, or in a configuration
              file. Command line arguments must be preceded with a double dash (<code>--</code>). The argument
              value can be separated from the argument name with either an equals sign (<code>=</code>)
              or a space. A complete list of all possible arguments is given in
              the <a href="#n88modelgenerator">Command Reference chapter</a>.
              You can also run n88modelgenerator with the <code>--help</code> option to get a complete
              list of possible parameters.
              All parameters except the input file name are
              optional; a default value will be used for unspecified parameters.
              To use a configuration file, run <a href="#n88modelgenerator">n88modelgenerator</a> as follows.</p>
          </div>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88modelgenerator --config=mytest.conf test25a.aim</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Here we are specifying the name of the input file on the command line.
              This is convenient if we want to use the same configuration file for
              multiple input files. It is also possible to specify the name of the
              input file in the configuration file, using the option
              <a href="#n88modelgenerator_input_file">input_file</a>. The output file name is left
              unspecified, so a default value will be used (<code>test25a_axial.n88model</code> in
              this case), but it can also be specified either on the command line or
              in the configuration file if desired.
            </p>
          </div>
          <div class="paragraph">
            <p>The configuration file format is one line per option: the
              parameter name (without leading dashes), followed by the equals character (<code>=</code>),
              followed by the parameter value.
              Lines beginning with <code>#</code> are ignored.
              The following configuration file is exactly equivalent to the example
              above using command line parameters.</p>
          </div>
          <div class="listingblock">
            <div class="title">Example configuration file for n88modelgenerator</div>
            <div class="content">
              <pre># This is the example configuration file "mytest.conf"
test                      = axial
normal_strain             = -0.01
youngs_modulus            = 6829</pre>
            </div>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  If a parameter is specified on both the command line and in a
                  configuration file, the command line value takes precedence.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p><a href="#n88modelgenerator">n88modelgenerator</a> can accept several different input
              file formats. Refer to the <a href="#n88modelgenerator">Command Reference chapter</a> for details.</p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>If you have an input image in a different format, there are many
                      possible solutions. One is to convert the file format, possibly with
                      ParaView, which can read a large number of formats. VTK can also be
                      used to convert many image files. For example, the following python script
                      will convert a MetaImage format file to a VTK <code>.vti</code> file.</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>import vtk
reader = vtk.vtkMetaImageReader()
reader.SetFileName ("test.mhd")
writer = vtk.vtkXMLImageDataWriter()
writer.SetFileName ("test.vti")
writer.SetInputConnection (reader.GetOutputPort())
writer.Update()</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>For more information on scripting, refer to <a href="#vtkbone">Preparing Finite Element Models
                        With vtkbone</a>.</p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="test_orientation">2.2. Test orientation</h3>
          <div class="paragraph">
            <p>







            </p>
          </div>
          <div class="paragraph">
            <p>To allow for flexibility in defining the orientation of applied tests, two
              coordinate frames are defined:</p>
          </div>
          <div class="dlist">
            <dl>
              <dt class="hdlist1">Data Frame</dt>
              <dd>
                <p>The Data Frame is the coordinate frame of the data. The input and output
                  data use the same coordinate system.</p>
              </dd>
              <dt class="hdlist1">Test Frame</dt>
              <dd>
                <p>The Test Frame is the coordinate frame in which the test boundary conditions
                  are applied. Tests are defined with a constant orientation in the Test
                  Frame.</p>
              </dd>
            </dl>
          </div>
          <div class="paragraph">
            <p>The relationship between the Test Frame and the Data Frame is set by the value
              of the parameter <a href="#n88modelgenerator_test_axis">test_axis</a> according to the following
              figure. In the figure, the red-colored axis is the test axis. What this
              implies exactly depends on the kind of test that is being applied. For
              example, for a compression test, the direction of compression is along the test
              axis. The test axis is always the <em>z</em> axis in the Test Frame, and always equal
              to value of the parameter <a href="#n88modelgenerator_test_axis">test_axis</a> in the Data Frame. The
              default value for <code>test_axis</code> is <em>z</em> ; for this case the Test Frame and the
              Data Frame coincide, as shown.</p>
          </div>
          <div id="coord_frames" class="imageblock">
            <div class="content">
              <img src="images/coord_frames.png" alt="coord frames">
            </div>
            <div class="title">Figure 4. Coordinate frames Test Frame and Data Frame as set by the option test_axis.
            </div>
          </div>
          <div class="paragraph">
            <p>In the test descriptions, references to &#8220;Top&#8221; refer to the maximum <em>z</em> surface
              in the Test Frame; References to &#8220;Bottom&#8221; refer to the minimum <em>z</em> surface in
              the Test Frame. Likewise &#8220;Sides&#8221; refers to the surfaces normal to the <em>x</em> and
              <em>y</em> axes in the
              Test Frame.
            </p>
          </div>
          <div class="paragraph">
            <p>The Test Frame is used only for the specification of tests (<em>i.e.</em> a specific configuration of
              boundary
              conditions and applied loads) within <a href="#n88modelgenerator">n88modelgenerator</a> and
              <code>vtkbone</code>. When the
              model is written to disk as an <code>n88model</code> file, it is encoded
              with reference to the original Data Frame. As a consequence
              post-processing and visualization are in the original Data Frame.
            </p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  In terms of rotations, for a setting of test axis = <em>x</em>, the
                  transformation from the Test Frame to the Data Frame is a rotation of -90
                  about the <em>x</em> axis, followed by a -90 rotation about the <em>z'</em> axis. For a
                  setting of test axis = <em>y</em>, the transformation from the Test Frame to the Data
                  Frame is a rotation of 90 about the y axis, followed by a 90 rotation about
                  the <em>z'</em> axis. These transformation sequences are of course not unique. For
                  most applications, it is not necessary to know these transformations; it
                  should be sufficient to refer to <a href="#coord_frames">Figure 4</a>.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="standard_tests">2.3. Standard tests</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="admonitionblock important">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/important.png" alt="Important">
                </td>
                <td class="content">
                  Axis directions in the following test descriptions are in the Test Frame.
                  All the standard tests can be applied along any axis of the data by specifying
                  <a href="#n88modelgenerator_test_axis">test_axis</a>, as described in the previous section.
                </td>
              </tr>
            </table>
          </div>
          <div class="sect3">
            <h4 id="uniaxial_test">2.3.1. Uniaxial test</h4>
            <div class="paragraph">
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>A uniaxial test is a compression (or tension) test with a fixed displacement
                or force applied along the z axis. Two boundary conditions are applied:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Nodes on the bottom surface are fixed in the <em>z</em> direction, but free in the <em>x</em> and
                    <em>y</em> directions.
                  </p>
                </li>
                <li>
                  <p>Nodes on the top surface are subject to a fixed displacement in the
                    <em>z</em> direction. No constraints are applied to the <em>x</em> and <em>y</em> directions.
                  </p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>A uniaxial test is shown in <a href="#compression_tests_figure">Figure 5</a>, along with other
                types of compression tests. The coordinate system shown in the figure
                is the Test Frame. A uniaxial test is distinguished from an axial test (described below) by the fact
                that nodes on
                the top and bottom surfaces are unconstrained laterally. This corresponds to zero contact friction.</p>
            </div>
            <div class="paragraph">
              <p>The amount of displacement applied to the top surface can be specified
                by either the <a href="#n88modelgenerator_normal_strain">normal_strain</a> or
                <a href="#n88modelgenerator_displacement">displacement</a> parameters.
              </p>
            </div>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    Uniaxial models are under-constrained since, as defined, arbitrary lateral
                    motion, and arbitrary rotation about the <em>z</em> axis of the entire model are
                    permitted. This results in a singular system of equations.
                    A "pin" may be added to prevent these motions. See <a href="#n88modelgenerator_pin">pin
                      parameter</a>.
                    However, Faim will find a (non-unique) solution even without a pin, and in
                    fact typically does so faster in the absence of a pin. A pin should always
                    be added if you want to use an algebraic solver, or if you intend to compare
                    the absolute positions of multiple solved models. Alternatively, you can register
                    the solved models before comparing absolute positions.
                  </td>
                </tr>
              </table>
            </div>
            <div id="compression_tests_figure" class="imageblock">
              <div class="content">
                <img src="images/compression_tests.png" alt="compression tests">
              </div>
              <div class="title">Figure 5. Compression tests.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="axial_test">2.3.2. Axial test</h4>
            <div class="paragraph">
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>An axial test is similar to a uniaxial test, with the additional constraint
                that nodes on the top and bottom surfaces are also laterally fixed
                (<em>i.e.</em> no movement of these nodes is permitted in the x-y directions). This
                corresponds to 100% contact friction.</p>
            </div>
            <div class="paragraph">
              <p>An axial test is shown in <a href="#compression_tests_figure">Figure 5</a>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="confined_test">2.3.3. Confined test</h4>
            <div class="paragraph">
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>A confined test is similar to an axial test, with the addition that nodes on
                the side surfaces of the image volume are constrained laterally (i.e. no
                movement of these nodes is permitted in the x-y directions).</p>
            </div>
            <div class="paragraph">
              <p>A confined test is shown in <a href="#compression_tests_figure">Figure 5</a>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="symshear_test">2.3.4. Symmetric shear test (symshear)</h4>
            <div class="paragraph">
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>In a symmetric shear test, the side surfaces are angularly displaced to
                correspond to a given shear strain. This is shown in <a href="#symshear_test_figure">Figure 6</a>. The
                only parameter of relevance to a symmetric shear
                test is <a href="#n88modelgenerator_shear_strain">shear_strain</a>.</p>
            </div>
            <div id="symshear_test_figure" class="imageblock">
              <div class="content">
                <img src="images/symshear_test.png" alt="symshear test">
              </div>
              <div class="title">Figure 6. symshear test. The side faces (shaded) are displaced as shown.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="dshear_test">2.3.5. Directional shear test (dshear)</h4>
            <div class="paragraph">
              <p>



              </p>
            </div>
            <div class="paragraph">
              <p>In a directional shear test, the top surface is displaced laterally, as shown in
                <a href="#dshear_test_figure">Figure 7</a>. The direction and degree of displacement are
                set by the parameter <a href="#n88modelgenerator_shear_vector">shear_vector</a>,
                which gives the <em>x</em>,<em>y</em> shear displacement in the Test Frame.
                Typically <code>shear_vector</code> is unitless, and the actual displacement
                is the shear vector scaled by the vertical height of the model (<em>i.e.</em>
                the image extent in the z direction in the Test Frame).
                If however <a href="#n88modelgenerator_scale_shear_to_height">scale_shear_to_height</a>
                is set to <code>off</code>, then <code>shear_vector</code> is taken to have absolute units of
                length.
              </p>
            </div>
            <div id="dshear_test_figure" class="imageblock">
              <div class="content">
                <img src="images/dshear_test.png" alt="dshear test">
              </div>
              <div class="title">Figure 7. dshear test. The upper shaded area represents the rigidly translated boundary
                surface defined by the shear vector (blue).</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="bending_test">2.3.6. Bending test</h4>
            <div class="paragraph">
              <p>



              </p>
            </div>
            <div class="paragraph">
              <p>In a bending test, the top and bottom surfaces are rotated in opposite
                directions, as shown in <a href="#bending_test_figure">Figure 8</a>. The rotation axes are defined by
                a neutral axis, given by a point in the <em>x</em>,<em>y</em> plane (shown as <code>C</code>) and an
                angle in the <em>x</em>,<em>y</em> plane. (The coordinate system shown in
                the figure is the Test Frame.) The neutral axis, projected onto the top and
                bottom surfaces, is indicated in
                blue in <a href="#bending_test_figure">Figure 8</a>.
                The point and angle defining the neutral axis can be set in
                n88modelgenerator with the parameters
                <a href="#n88modelgenerator_central_axis">central_axis</a> and
                <a href="#n88modelgenerator_neutral_axis_angle">neutral_axis_angle</a> respectively.
                The central axis (point <code>C</code>) can be specified as a numerical <em>x</em>,<em>y</em> pair, or
                as the
                center of mass or the center of the data bounds; center of mass is the default setting.
                The default angle of the neutral axis is 90, parallel to the <em>y</em>-axis.
                The amount of rotation can be specified with the parameter <a
                  href="#n88modelgenerator_bending_angle">bending_angle</a>. The top and the bottom
                surfaces are each rotated by half of this value. Positive rotation is defined as in <a
                  href="#bending_test_figure">Figure 8</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>In a bending test, the top and bottom surfaces are laterally constrained; no x,y motion of the nodes on
                these surfaces is permitted.</p>
            </div>
            <div id="bending_test_figure" class="imageblock">
              <div class="content">
                <img src="images/bending_test.png" alt="bending test">
              </div>
              <div class="title">Figure 8. Bending test. The shaded areas represent the rigidly rotated boundary
                surfaces about the neutral axes (in blue). The neutral axes are defined by the central axis (C-C') and
                an angle in the x-y plane.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="torsion_test">2.3.7. Torsion test</h4>
            <div class="paragraph">
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>In a torsion test, the top surface is rotated about the center axis, as shown
                in <a href="#torsion_test_figure">Figure 9</a>. The angle of rotation is given by
                <a href="#n88modelgenerator_twist_angle">twist_angle</a>. In the figure positive
                rotation is shown. The central axis lies parallel to the <em>z</em> axis in the test
                frame; its position can be specified with the parameter
                <a href="#n88modelgenerator_central_axis">central_axis</a>. The default position of
                the central axis is passing through the center of mass.
              </p>
            </div>
            <div id="torsion_test_figure" class="imageblock">
              <div class="content">
                <img src="images/torsion_test.png" alt="torsion test">
              </div>
              <div class="title">Figure 9. torsion test. The upper shaded area represents the rotated boundary surface
                about the central axis (C-C').</div>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="uneven_surfaces">2.4. Uneven surfaces</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>The grey planes in <a href="#compression_tests_figure">Figure 5</a> represent the
              top and bottom boundary surfaces of the image volume. The
              actual surface to which boundary conditions are applied is by default that
              part of your object which passes through these boundaries.
              If your object does not intersect with the top and bottom
              boundaries of the image volume, then no boundary conditions can be applied
              using this method.</p>
          </div>
          <div class="paragraph">
            <p>An alternative is to make use of the parameters <a href="#n88modelgenerator_top_surface">top_surface</a>
              and
              <a href="#n88modelgenerator_bottom_surface">bottom_surface</a>. The
              &#8220;uneven surface&#8221; near a boundary is defined as the
              surface visible from that boundary (viewed from an infinite distance).
              Visibility is evaluated using ray tracing. Thus for a porous material
              such as bone the &#8220;uneven surface&#8221; consists of nodes on the top
              visible surface, not including nodes on surfaces down inside the pores.
            </p>
          </div>
          <div class="paragraph">
            <p>The <code>visible</code> setting can be used for any type of test except <a
                href="#symshear_test">symshear</a>. For example, if used with a
              <a href="#bending_test">bending test</a>, the boundary conditions are no longer exactly tilted planes as
              shown
              in figure <a href="#bending_test_figure">Figure 8</a>; the displacement of each node on the visible
              surfaces is still
              calculated as described from its <em>x</em>,<em>y</em> coordinates, but the displaced nodes
              no longer lie all on a plane (because the initial positions are not on a plane.)
            </p>
          </div>
          <div class="paragraph">
            <p>Because the visibility test may find some surfaces far from the boundary
              in question, it should usually be used together with the parameters
              <a href="#n88modelgenerator_bottom_surface_maximum_depth">bottom_surface_maximum_depth</a>
              and/or
              <a href="#n88modelgenerator_top_surface_maximum_depth">top_surface_maximum_depth</a>.
              These provide a limit, as a distance from the boundary, for the search for the
              uneven surface.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="material_specification">2.5. Material specification</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>Material specification consists of two parts:</p>
          </div>
          <div class="dlist">
            <dl>
              <dt class="hdlist1">Material Definition creation</dt>
              <dd>
                <p>One or more material definitions are created. A material definition is a
                  mathematical description of material mechanical properties. It has a
                  definite type (<em>e.g.</em> linear isotropic or linear orthotropic) and specific numerical
                  values relevant to that type (<em>e.g.</em> a linear isotropic material definition will have
                  particular values of Young&#8217;s modulus and Poisson&#8217;s ratio).</p>
              </dd>
              <dt class="hdlist1">Material Table generation</dt>
              <dd>
                <p>The material table maps material IDs, as assigned during segmentation, to
                  material definitions. It is possible to combine different types of materials
                  (<em>e.g.</em> isotropic and orthotropic) in the same material table. A single
                  material definition can be assigned to multiple material IDs.</p>
              </dd>
            </dl>
          </div>
          <div class="paragraph">
            <p>In Numerics88, material definitions are indexed by name. This is not usually
              evident in
              <code>n88modelgenerator</code>, as for basic usage, the names are generated automatically,
              and are not needed by the user. However for advanced material specification,
              this becomes important, as we will see below when material definition
              files are discussed.
            </p>
          </div>
          <div class="sect3">
            <h4 id="elastic_material_properties">2.5.1. Elastic material properties</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>Linear elastic materials obey Hooke&#8217;s Law,</p>
            </div>
            <div class="paragraph">
              <p>





              </p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \begin{bmatrix} \varepsilon_{xx} \\ \varepsilon_{yy} \\ \varepsilon_{zz} \\ \gamma_{yz} \\ \gamma_{zx}
                \\ \gamma_{xy} \end{bmatrix} = \mathbf{S} \begin{bmatrix} \sigma_{xx} \\ \sigma_{yy} \\ \sigma_{zz} \\
                \sigma_{yz} \\ \sigma_{zx} \\ \sigma_{xy}\end{bmatrix}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>where &#949;<sub>xx</sub>,&#949;<sub>yy</sub>,&#949;<sub>zz</sub> are the
                <em>engineering normal strains</em>
                along the axis directions,
                &#947;<sub>yz</sub>,&#947;<sub>zx</sub>,&#947;<sub>xy</sub>
                are the <em>engineering shear strains</em>, and &#963;<sub>ij</sub> are the corresponding
                stresses. <strong>S</strong> is the compliance matrix. The inverse of <strong>S</strong> gives
                <strong>&#963;</strong>
                in terms of <strong>&#949;</strong>, and is the stress-strain
                matrix <strong>C</strong>, also sometimes called the stiffness matrix.
              </p>
            </div>
            <div id="isotropic_material" class="paragraph">
              <div class="title">Isotropic materials</div>
              <p>


              </p>
            </div>
            <div class="paragraph">
              <p>An isotropic material has the same mechanical properties in every direction.
                Elastic isotropic materials are characterized by only two independent parameters:
                Young&#8217;s modulus (<em>E</em>) and Poisson&#8217;s ratio (<em>&#957;</em>). The compliance matrix is
              </p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \mathbf{S} = \frac{1}{E} \begin{bmatrix} 1 &amp; -\nu &amp; -\nu &amp; 0 &amp; 0 &amp; 0 \\ -\nu &amp; 1
                &amp; -\nu &amp; 0 &amp; 0 &amp; 0 \\ -\nu &amp; -\nu &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp;
                0 &amp; 2(1-\nu) &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 2(1-\nu) &amp; 0 \\ 0 &amp; 0 &amp;
                0 &amp; 0 &amp; 0 &amp; 2(1-\nu) \end{bmatrix}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>For <a href="#n88modelgenerator">n88modelgenerator</a>
                the isotropic elastic parameters are set with
                <a href="#n88modelgenerator_youngs_modulus">youngs_modulus</a> and
                <a href="#n88modelgenerator_poissons_ratio">poissons_ratio</a>.
                The default values are 6829 MPa and 0.3, as reported by <a href="#macneil2008">MacNeil and Boyd
                  (2008)</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>An isotropic material definition is the default, and will be assumed if
                no other material type is specified.</p>
            </div>
            <div id="orthotropic_material" class="paragraph">
              <div class="title">Orthotropic materials</div>
              <p>

              </p>
            </div>
            <div class="paragraph">
              <p>Orthotropic elastic materials have two or three mutually orthogonal twofold
                axes of symmetry. The compliance matrix is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \mathbf{S} = \begin{bmatrix} 1/E_x &amp; -\nu_{yx}/E_y &amp; -\nu_{zx}/E_z &amp; 0 &amp; 0 &amp; 0 \\
                -\nu_{xy}/E_x &amp; 1/E_y &amp; -\nu_{zy}/E_z &amp; 0 &amp; 0 &amp; 0 \\ -\nu_{xz}/E_x &amp;
                -\nu_{yz}/E_y &amp; 1/E_z &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1/G_{yz} &amp; 0 &amp; 0 \\
                0 &amp; 0 &amp; 0 &amp; 0 &amp; 1/G_{zx} &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1/G_{xy}
                \end{bmatrix}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>where</p>
            </div>
            <div class="hdlist">
              <table>
                <tr>
                  <td class="hdlist1">
                    <em>E<sub>i</sub></em>
                  </td>
                  <td class="hdlist2">
                    <p>is the Young&#8217;s modulus along axis <em>i</em> ,</p>
                  </td>
                </tr>
                <tr>
                  <td class="hdlist1">
                    <em>&#957;<sub>ij</sub></em>
                  </td>
                  <td class="hdlist2">
                    <p>is the Poisson&#8217;s ratio that corresponds to a contraction in direction <em>j</em> when an
                      extension is applied in direction <em>i</em> ,</p>
                  </td>
                </tr>
                <tr>
                  <td class="hdlist1">
                    <em>G<sub>ij</sub></em>
                  </td>
                  <td class="hdlist2">
                    <p>is the shear modulus in direction <em>j</em> on the plane whose normal is in direction <em>i</em>
                      . It is also called the modulus of rigidity.</p>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Note that the <em>&#957;<sub>ij</sub></em> are not all independent. The compliance matrix
                must be symmetric, hence</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \begin{aligned} -\nu_{yx}/E_y &amp;= -\nu_{xy}/E_x ~ , \\ -\nu_{zy}/E_z &amp;= -\nu_{yz}/E_y ~ , \\
                -\nu_{xz}/E_x &amp;= -\nu_{zx}/E_z ~ . \end{aligned}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>Therefore only 9 independent parameters are required to fully specify an
                orthotropic material.</p>
            </div>
            <div class="paragraph">
              <p>For <a href="#n88modelgenerator">n88modelgenerator</a> the orthotropic elastic parameters are set
                with <a href="#n88modelgenerator_orthotropic_parameters">orthotropic_parameters</a>. Whenever this
                parameter is specified, an orthotropic material definition will be used.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    An orthotropic material defined with a compliance matrix as given above
                    necessarily has its axes of symmetry aligned with the coordinate axes. In contrast, an
                    orthotropic material which is rotated relative to the coordinate axes has a more
                    general form of compliance matrix. In Numerics88 software, such a non-aligned orthotropic
                    material must be specified as an anisotropic material. A rotation matrix relates
                    elements of the anisotropic compliance matrix to the orthotropic compliance matrix. If
                    you want the mathematical details, please contact us!
                  </td>
                </tr>
              </table>
            </div>
            <div id="anisotropic_material" class="paragraph">
              <div class="title">Anisotropic material</div>
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>The most general form of an elastic material is anisotropic, for which
                we allow the stress-strain matrix, or the compliance matrix, to have arbitrary values.
                The stress-strain matrix is symmetric, therefore an anisotropic material requires
                21 parameters to define.
                To define an anisotropic material with <code>n88modelgenerator</code>, it
                is necessary to use a
                <a href="#material_definitions_file">material definitions file</a>. See below.
              </p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="plasticity">2.5.2. Plasticity</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Elastoplastic material behaviour is an idealisation of a particular kind of nonlinear
                stress-strain relationship in which we divide the stress-strain relationship into two
                clearly distinguished regions: (1) an elastic region, which is identical to the
                linear elastic material behaviour described above, and, (2) a purely plastic region. For a
                material subject to a uniaxial deformation, this is sketched in
                <a href="#elastoplastic_1d_figure">Figure 10</a>. In <a href="#elastoplastic_1d_figure">Figure 10</a>A,
                we see the initial
                elastic region, which in this sketch is tensile, with slope equal to the Young&#8217;s
                modulus. This region continues until the stress reaches the yield strength, <em>Y</em>. For
                further increases in strain beyond this point, the stress ceases to increase, and
                remains constant at the yield strength. The incremental strain in this region is
                referred to as the plastic strain. Although we must perform work to produce a plastic
                strain, the plastic strain is irreversible, as can be seen in
                <a href="#elastoplastic_1d_figure">Figure 10</a>B. In B, after applying a large plastic strain, the
                strain
                is gradually reduced. The plastic strain component is unchanged during the relaxation;
                instead, it is the elastic component of the strain that is reduced. As the stress
                depends entirely on the elastic component of the strain, the stress also immediately
                begins to decrease. Hence, we do not travel back along the &#8220;outward&#8221; path, but
                instead return along a shifted version of the linear elastic region: the material
                exhibits <em>hysteresis</em>. Although the initial point and the final point of
                <a href="#elastoplastic_1d_figure">Figure 10</a>B are both characterised by zero strain, the state is
                quite
                different, as the latter state has a large plastic strain. If we continue to reduce the
                strain, as in <a href="#elastoplastic_1d_figure">Figure 10</a>C, the stress becomes negative - a
                compressive
                stress - until, once again, we reach the yield strength limit. Note that the yield
                strength in tension and the yield strength in compression are not necessarily equal.
              </p>
            </div>
            <div id="elastoplastic_1d_figure" class="imageblock">
              <div class="content">
                <img src="images/elastoplastic_1d.png" alt="elastoplastic 1d">
              </div>
              <div class="title">Figure 10. Elastoplastic behaviour in one dimension.</div>
            </div>
            <div class="paragraph">
              <p>In three dimensions, an elastoplastic material is characterised by a yield surface, which is the
                boundary of the elastic region. The yield surface is defined in stress space (or equivalently in strain
                space).
                For isotropic materials, the yield surface is most easily defined in the space of the
                three principal stresses. Stresses lying inside the yield surface are associated with
                an elastic state. When the stress reaches the yield surface, the material yields, and
                further increases in strain result in the stress state moving along the yield surface.
                Many different shapes of yield surface are possible, and are characteristic of
                different kinds of materials. Yield surfaces are conveniently defined mathematically by a yield function
                <em>f</em>, such that the yield surface is the locus of points for which <em>f</em> = 0. A complete
                explanation of elastoplastic behaviour in
                three dimensions is not given here. We recommend that you consult a good mechanics of
                materials textbook.
              </p>
            </div>
            <div class="paragraph">
              <p>To specify an elastoplastic material, it is necessary both to specify its elastic
                properties, and its plasticity. Currently Faim only allows plasticity to be defined with
                isotropic elastic properties. A typical specification of an elastoplastic model using
                <code>n88modelgenerator</code> will look something like this
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --youngs_modulus=6829 --poissons_ratio=0.3 --plasticity=vonmises,50 mydata.aim</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The currently supported plastic yield criteria are described below.</p>
            </div>
            <div id="von_mises_material" class="paragraph">
              <div class="title">von Mises yield criterion</div>
              <p>

              </p>
            </div>
            <div class="paragraph">
              <p>The von Mises yield criterion states that yielding begins when the distortional strain-energy density
                attains a certain limit. It is therefore also called the
                <em>distortional energy density</em> criterion. The distortional strain-energy density
                is the difference between the total strain energy density and the strain energy
                density arising only from the part of the strain resulting in a volume change.
                Hence, the distortional strain-energy density is associated with that part of the
                strain that results in no volume change: or, in other words, the part of the strain
                that causes a change in shape.
              </p>
            </div>
            <div class="paragraph">
              <p>The yield function for a von Mises material, in terms of the three components of the
                principal stress, is given by</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                f = \frac{1}{6} \left [ ( \sigma_1 - \sigma_2 )^2 + ( \sigma_2 - \sigma_3 )^2 + ( \sigma_3 - \sigma_1
                )^2 \right ] - \frac{1}{3} Y^2
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>The parameter <em>Y</em> is the yield strength in uniaxial tension (or compression).</p>
            </div>
            <div class="paragraph">
              <p>To specify a von Mises material in <code>n88modelgenerator</code>, use the parameter
                <a href="#n88modelgenerator_plasticity">plasticity</a>. For example,
                <code>--plasticity=vonmises,68</code> will define a von Mises material with <em>Y</em> = 68.
                The units of <em>Y</em> are the same as stress, so typically MPa.
              </p>
            </div>
            <div id="mohr_coulomb_material" class="paragraph">
              <div class="title">Mohr-Coulomb yield criterion</div>
              <p>

              </p>
            </div>
            <div class="paragraph">
              <p>The Mohr-Coulomb yield criterion is a refinement of the Tresca yield condition, which
                states that yielding begins when the shear stress at a point exceeds some limit. To
                this, the Mohr-Coulomb criterion adds a dependence on the hydrostatic stress, such that
                the shear stress limit is dependent on the hydrostatic stress, in particular that the
                shear stress limit increases with hydrostatic stress. The Mohr-Coulomb yield criterion
                is characterised by two values: the cohesion <em>c</em> and the angle of internal friction
                <em>&#966;</em>. For principal stresses in the order &#963;<sub>1</sub> &gt; &#963;<sub>2</sub> &gt;
                &#963;<sub>3</sub>, the Mohr-Coulomb yield function is
              </p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                f = \sigma_1 - \sigma_3 + ( \sigma_1 + \sigma_3 ) \, \mathrm{sin} \, \phi - 2 \, c \: \mathrm{cos} \,
                \phi
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>Under uniaxial tension, the yield strength is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                Y_T = \frac { 2 \, c \: \mathrm{cos}} {1 + \mathrm{sin} \, \phi}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>while under uniaxial compression, the yield strength is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                Y_C = \frac { 2 \, c \: \mathrm{cos}} {1 - \mathrm{sin} \, \phi}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>Mohr-Coulomb materials are specified to <code>n88modelgenerator</code> using these two
                yield strengths. See <a href="#n88modelgenerator_plasticity">plasticity</a>. For example,
                <code>--plasticity=mohrcoulomb,40,80</code> will define a Mohr-Coulomb material with
                <em>Y<sub>T</sub></em> = 40
                and <em>Y<sub>C</sub></em> = 80. The units of <em>Y<sub>T</sub></em> and <em>Y<sub>C</sub></em> are the
                same as stress, so typically MPa.
              </p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_material_table_generation">2.5.3. Material table generation</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>The parameter <a href="#n88modelgenerator_material_table">material_table</a> allows
                one of two standard types of material table may be
                chosen: a simple table, consisting of a single material definition, or a Homminga
                material table, which relates density to stiffness.</p>
            </div>
            <div class="paragraph">
              <p>If you require a material table different than either of the standard ones
                offered, you can use a
                <a href="#material_definitions_file">material definitions file</a>. See below for details.
              </p>
            </div>
            <div id="homogeneous_material_table" class="paragraph">
              <div class="title">Homogeneous material table</div>
              <p></p>
            </div>
            <div class="paragraph">
              <p>The simplest material table consists of a single material definition. Thus
                it corresponds to homogeneous material properties: all elements are assigned
                the same material properties.</p>
            </div>
            <div class="paragraph">
              <p>Note that although only a single material definition is created, it is nevertheless
                still possible for the material table to have multiple entries corresponding to
                multiple material IDs. In this case every material ID in the table maps of course to
                the same single material definition. <code>n88modelgenerator</code> automates this: it examines
                the segmented input image, and generates one entry in the material table for every
                unique material ID (<em>i.e.</em> image value) present in the segmented image. Clearly, as a
                matter of efficiency and simplicity, if you intend to use an image for analysis with
                homogenous material properties, it is preferable to segment the image object to a
                single material ID. It is not however, necessary to do so.</p>
            </div>
            <div id="homminga_material_table" class="paragraph">
              <div class="title">Homminga material table</div>
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p><a href="#homminga2001">Homminga (2011)</a> introduced a model that attempts to account
                for varying bone strength with density. In this model, the
                modulii vary according to the equation</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                E = E_{max} (\rho/\rho_{max})^{1.7}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>Where &#961; is the CT image density. For the orthotropic case, the shear
                modulii follow the same scaling, and for the anisotropic case, the stress-strain
                matrix follows this scaling.</p>
            </div>
            <div class="paragraph">
              <p>To use this type of material table, the data must be segmented such that the
                material ID of each voxel is proportional to its CT image density. As material
                IDs are discrete, the CT image density is therefore binned. Hence</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                E = E_{max} (ID/ID_{max})^{1.7}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p><em>ID<sub>max</sub></em> is set with the parameter <a
                  href="#n88modelgenerator_homminga_maximum_material_id">homminga_maximum_material_id</a>, and the
                exponent is set with the parameter
                <a href="#n88modelgenerator_homminga_modulus_exponent">homminga_modulus_exponent</a>.
              </p>
            </div>
            <div class="paragraph">
              <p><em>E<sub>max</sub></em> will depend on the specified material. For an isotropic material, it will be
                given by <a href="#n88modelgenerator_youngs_modulus">youngs_modulus</a>.
                However orthotropic or anisotropic materials may also be scaled: the entire stress-strain
                matrix scales according to the above-stated law.</p>
            </div>
            <div class="admonitionblock warning">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/warning.png" alt="Warning">
                  </td>
                  <td class="content">
                    In contrast to the homogenous material table, a Homminga material table is not
                    guaranteed <em>a priori</em> to have an entry for every material ID present in the input
                    segmented image. If your segmented image has material IDs larger than the specified
                    <em>ID<sub>max</sub></em> , <code>n88modelgenerator</code> will produce an error.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="material_definitions_file">2.5.4. Material definitions file</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>The method presented up to this point for defining materials in
                <code>n88modelgenerator</code>, while relatively easy, suffers from some limitations.
                In particular, only a single material can be specified using the
                options discussed so far. Furthermore, an anisotropic material can not
                be specified at all using the command line parameters. <code>n88modelgenerator</code>
                therefore provides an alternate method of defining materials, which is via
                a material definitions file. A material definitions file can be used to
                define any material known to <code>Faim</code>, any number of materials, and
                any material table. A material definitions file can be specified with
                the argument <a href="#n88modelgenerator_material_definitions">material_definitions</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>The material definitions file format is straight-forward, as you can see from
                this example.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>MaterialDefinitions:
    CorticalBone:
        Type: LinearIsotropic
        E: 6829
        nu: 0.3
    TrabecularBone:
        Type: LinearIsotropic
        E: 7000
        nu: 0.29
MaterialTable:
    100: TrabecularBone
    127: CorticalBone</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Here we have a material definitions file containing two materials,
                both of which are linear elastic materials, but with different
                numerical values. Besides defining the materials, we have to specify
                the material table, which maps materials IDs (ie. the values present in
                the input image) to the materials we have defined.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    The indenting in material definitions file is important, as
                    it indicates how objects are grouped. Indenting must be done with
                    spaces, and not with tabs. Technically, the material
                    definitions file is in <a href="http://www.yaml.org/">YAML</a> format.
                    Thus any valid YAML syntax can be
                    used. In particular, it is possible to use curly brackets instead
                    of indenting to indicate nesting, should you so wish.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Here is another example material definitions file, which defines an
                anisotropic material.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>MaterialDefinitions:
    ExampleAnisoMat:
        Type: LinearAnisotropic
        StressStrainMatrix: [
 1571.653,   540.033,   513.822,     7.53 ,  -121.22 ,   -57.959,
  540.033,  2029.046,   469.974,    78.591,   -53.69 ,   -50.673,
  513.822,   469.974,  1803.998,    20.377,   -57.014,   -15.761,
    7.53 ,    78.591,    20.377,   734.405,   -23.127,   -36.557,
 -121.22 ,   -53.69 ,   -57.014,   -23.127,   627.396,    13.969,
  -57.959,   -50.673,   -15.761,   -36.557,    13.969,   745.749]

MaterialTable:
    1: ExampleAnisoMat</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The possible materials, and the values that must be specified for
                each, are listed in the following table.</p>
            </div>
            <table class="tableblock frame-topbot grid-all stretch">
              <caption class="title">Table 1. Materials as specified in a material definitions file</caption>
              <colgroup>
                <col style="width: 28%;">
                <col style="width: 28%;">
                <col style="width: 44%;">
              </colgroup>
              <thead>
                <tr>
                  <th class="tableblock halign-left valign-top">Type</th>
                  <th class="tableblock halign-left valign-top">Variable</th>
                  <th class="tableblock halign-left valign-top">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="tableblock halign-left valign-top" rowspan="2">
                    <p class="tableblock"><strong>LinearIsotropic</strong></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>E:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Young&#8217;s modulus</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>nu:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Poisson&#8217;s ratio</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top" rowspan="3">
                    <p class="tableblock"><strong>LinearOrthotropic</strong></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>E:</code> [<em>value</em>,<em>value</em>,<em>value</em>]</p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Young&#8217;s modulii as [E<sub>xx</sub>,E<sub>yy</sub>,E<sub>zz</sub>]</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>nu:</code> [<em>value</em>,<em>value</em>,<em>value</em>]</p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Poisson&#8217;s ratios as
                      [&#957;<sub>yz</sub>,&#957;<sub>zx</sub>,&#957;<sub>xy</sub>]</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>G:</code> [<em>value</em>,<em>value</em>,<em>value</em>]</p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Shear modulii as [G<sub>yz</sub>,G<sub>zx</sub>,G<sub>xy</sub>]</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><strong>LinearAnisotropic</strong></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>StressStrainMatrix:</code>
                      [<em>value1</em>,<em>value2</em>,&#8230;&#8203;,<em>value36</em>]</p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">The 36 elements of the stress-strain matrix. Since the stress-strain matrix is
                      symmetric, there are only 21
                      unique values, but all 36 must be given. They must be specified in the order K<sub>11</sub> ,
                      K<sub>12</sub> , K<sub>13</sub>, . . . K<sub>66</sub> , but since the
                      matrix is symmetric, this is equivalent to K<sub>11</sub> , K<sub>21</sub> , K<sub>31</sub>, . . .
                      K<sub>66</sub>.</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top" rowspan="3">
                    <p class="tableblock"><strong>VonMisesIsotropic</strong></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>E:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Young&#8217;s modulus</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>nu:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Poisson&#8217;s ratio</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>Y:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Yield strength</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top" rowspan="4">
                    <p class="tableblock"><strong>MohrCoulombIsotropic</strong></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>E:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Young&#8217;s modulus</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>nu:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Poisson&#8217;s ratio</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>c:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Mohr Coulomb <em>c</em> parameter (cohesion).</p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock"><code>phi:</code> <em>value</em></p>
                  </td>
                  <td class="tableblock halign-left valign-top">
                    <p class="tableblock">Mohr Coulomb &#966; parameter (friction angle).</p>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Materials are stored in the <code>n88model</code> file using exactly the same
                    structure and variable names. See the
                    <a href="#MaterialDefinitions_group">MaterialDefinitions group</a> of
                    the <code>n88model</code> file specification.
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="vtkbone">3. Preparing Finite Element Models with vtkbone</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p></p>
        </div>
        <div class="paragraph">
          <p>You only need to read this chapter if you are interested in
            writing scripts to create your own custom model types. For many users,
            <code>n88modelgenerator</code>, as described in the previous chapter, will be sufficient.
          </p>
        </div>
        <div class="paragraph">
          <p></p>
        </div>
        <div class="paragraph">
          <p>Although <a href="#n88modelgenerator">n88modelgenerator</a> can generate
            many useful models for FE analysis, at times additional flexibility is
            required. In order to provide as much flexibility to
            the user as possible, we provide the option for users to perform custom
            model generation. This functionality is provided by <code>vtkbone</code> toolkit,
            which is built on
            <a href="http://vtk.org">VTK</a> . VTK is "<em>an open-source, freely available software system
              for 3D computer graphics, image processing and visualization</em>", produced
            by <a href="http://www.kitware.com">Kitware</a>. VTK provides a great deal of functionality
            to manipulate and visualize data that is useful for finite
            element model generation and analysis. <code>vtkbone</code> is a collection of custom VTK
            classes that extend VTK to add finite element pre-processing functionality.
            The <code>vtkbone</code> library objects combined with generic VTK objects can be
            quickly assembled into pipelines to produce nearly infinite customizability
            for finite element model generation and post-processing analysis.
          </p>
        </div>
        <div class="paragraph">
          <p>Basing <code>vtkbone</code> on VTK provides the following advantages.</p>
        </div>
        <div class="dlist">
          <dl>
            <dt class="hdlist1">Large existing library of objects and filters</dt>
            <dd>
              <p>VTK is a large and well established system, with many useful algorithms
                already packaged as VTK objects.</p>
            </dd>
            <dt class="hdlist1">Built-in visualization</dt>
            <dd>
              <p>VTK was designed for rendering medical data. With it sophisticated
                visualizations
                are readily obtained. The visualization application ParaView is built with
                VTK and provides excellent complex data visualization.
                <code>vtkbone</code> functionality is easily incorporated into ParaView.
              </p>
            </dd>
            <dt class="hdlist1">Standardization</dt>
            <dd>
              <p>The time and effort the user invests in learning <code>vtkbone</code> provides familiarity
                with the widely-used VTK system, and is not limited in application to
                Numerics88 software.</p>
            </dd>
            <dt class="hdlist1">Extensibility</dt>
            <dd>
              <p>The advanced user is able to write their own VTK classes where required.</p>
            </dd>
            <dt class="hdlist1">Multiple Language Support</dt>
            <dd>
              <p>VTK itself consists of C++ classes, but provides wrapping functionality
                to generate an interface layer to other languages. <code>vtkbone</code> uses this
                wrapping functionality to provide a Python interface.</p>
            </dd>
          </dl>
        </div>
        <div class="paragraph">
          <p>The best way to learn to use <code>vtkbone</code> is to follow the tutorials
            in <a href="#tutorials">Tutorials</a>.</p>
        </div>
        <div class="paragraph">
          <p>
          </p>
        </div>
        <div class="paragraph">
          <p>We recommend that you use Python for assembling programs with <code>vtkbone</code>.
            There are several advantages of using Python, including simplicity of
            syntax and automatic memory management. In our experience,
            writing programs using <code>vtkbone</code> in Python is far less time consuming, and
            results in programs that are much easier to debug than writing the same
            programs in C++ . This is particularly true for users without
            significant programming experience.</p>
        </div>
        <div class="admonitionblock tip">
          <table>
            <tr>
              <td class="icon">
                <img src="./images/icons/tip.png" alt="Tip">
              </td>
              <td class="content">
                Many of the tools provided with Faim are implemented as Python scripts.
                Some use <code>vtkbone</code>, and some manipulate the <code>n88model</code> file directly through
                the
                <a href="http://unidata.github.io/netcdf4-python/">python netCDF4 module</a>, which is
                installed automatically when you install <code>n88tools</code>. Examining
                how these scripts work can be a good way to learn how to write your own custom
                python scripts for manipulating Faim models.
              </td>
            </tr>
          </table>
        </div>
        <div class="sect2">
          <h3 id="api_documentation">3.1. vtkbone API documentation</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>The complete Application Programming Interface (API) reference documentation
              for <code>vtkbone</code> is available at <a href="http://numerics88.com/n88/documentation/vtkbone/1.0/"
                class="bare">http://numerics88.com/n88/documentation/vtkbone/1.0/</a> .
              Class names in this document are linked to the <code>vtkbone</code> API documentation, so
              that if you click on a class name, it should open
              the documentation for that class. You should refer to the <code>vtkbone</code> API reference
              documentation whenever using a <code>vtkbone</code> class, as the descriptions below are
              introductory, and do not exhaustively cover all the functionality.</p>
          </div>
          <div class="paragraph">
            <p>API documentation for VTK can be found at <a href="http://www.vtk.org/doc/release/6.3/html/"
                class="bare">http://www.vtk.org/doc/release/6.3/html/</a> .
              Or you can get the latest version at <a href="https://vtk.org.download/"
                class="bare">https://vtk.org.download/</a> .</p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  If you are using Python instead of C<code> (and for most purposes, we
recommend that you do), then you will have to infer the Python interface
from the C</code> interface. This is generally simple: class and method
                  names are the same, as are all positional argument names. Since Python is a
                  weakly-typed language, you do not need to be concerned generally with
                  the declared type of the arguments. A small number of C++ methods in
                  <code>vtkbone</code> do not have a Python equivalent, but this is rare.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_array_indexing_in_vtkbone">3.2. Array indexing in vtkbone</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>Arrays in <code>vtkbone</code>, as in VTK, C and Python, are zero-indexed. That is, the
              first element is element 0. This applies also to node numbers and element numbers.
              (It does not however apply to material IDs, because the material ID is not an
              array index; it is a key into a table look-up.) Be careful if reading an <code>n88model</code> file
              directly, because node numbers and element numbers are stored
              1-indexed (see the <a href="#n88model_file_format">file specification</a>). The translation is done
              automatically
              if you use the <code>vtkbone</code> objects <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelReader.html">vtkboneN88ModelReader</a>
              and
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelWriter.html">vtkboneN88ModelWriter</a>
              .
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_typical_workflow_for_vtkbone">3.3. Typical workflow for vtkbone</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p><a href="#vtkbone_work_flow">Figure 11</a> shows a typical work flow for creating a
              finite element model using <code>vtkbone</code>. VTK generally consists of two
              types of objects (or &#8220;classes&#8221;): objects that contain data, and objects that
              process data. The latter are called &#8220;filters&#8221;. Filters can be chained
              together to create a processing pipeline. In the figure, filters are
              listed in the boxes with dark black lines and rounded corners; data
              objects are listed in gray rectangles. The boxes with dark black lines and
              rounded corners represent actions, and may list one or more VTK or
              <code>vtkbone</code> objects that are suitable for performing the action.
            </p>
          </div>
          <div id="vtkbone_work_flow" class="imageblock">
            <div class="content">
              <img src="images/vtkbone_overview.png" alt="vtkbone overview">
            </div>
            <div class="title">Figure 11. Typical work flow for vtkbone.</div>
          </div>
          <div class="paragraph">
            <p>The typical way to use a VTK filter object is to create it, set
              parameters, set the input (if relevant), call <code>Update()</code>, and then get the
              output. For example, for a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAIMReader.html">vtkboneAIMReader</a>
              object, which has an
              output but no input, we might do this in Python</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>reader = vtkbone.vtkboneAIMReader()
reader.SetFileName ("MYFILE.AIM")
reader.Update()
image = reader.GetOutput()</pre>
            </div>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>There is an alternate way to use VTK filter objects, and that is to
                      chain them together in a pipeline. In this case, calling Update
                      on the last item in the pipeline will cause an update of all the
                      items in the pipeline, if required. To connect filters in a
                      processing pipeline, use <code>SetInputConnection</code> and <code>GetOutputPort</code>
                      instead of <code>SetInputData</code> and <code>GetOutput</code>. As an example, we can connect
                      a <a
                        href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAIMReader.html">vtkboneAIMReader</a>
                      to a <a
                        href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
                      like this</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>reader = vtkbone.vtkboneAIMReader()
reader.SetFileName ("MYFILE.AIM")
mesher = vtkbone.vtkboneImageToMesh()
mesher.SetInputConnection (reader.GetOutputPort())
mesher.Update() <img src="./images/icons/callouts/1.png" alt="1"></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>This automatically calls Update on the reader.
                      Generally, unless you have some application where the pipeline approach
                      is advantageous, we recommend the simpler method of using <code>SetInputData</code> and
                      <code>GetOutput</code> and explicitly passing the data object between filters.
                    </p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="vtkboneFiniteElementModel">3.4. The vtkboneFiniteElementModel object</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>The central class that <code>vtkbone</code> adds to VTK is a new type of data class, called
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              . The conceptual structure of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              is shown in <a href="#vtkboneFiniteElementModel_structure">Figure 12</a>.
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              is a subclass of
              the VTK class <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a> ,
              which represents a data set as consisting of an
              assortment of geometric shapes. In VTK terminology, these individual shapes
              are &#8220;Cells&#8221;. They map naturally to the concept of Elements in finite element
              analysis. The vertices of the cells, in VTK terminology, are &#8220;Points&#8221;. These
              are equivalent to Nodes in finite element analysis. <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a> ,
              like other VTK
              objects, is capable of storing specific types of additional information, such
              as one or more scalar or vector values associated with each Cell or Point.
              This aspect is used for storing, for example, material IDs, which are mapped
              to the scalar values of the Cells. To
              <a href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a> ,
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              adds some additional
              information related to requirements for finite element analysis such as material properties and
              constraints (<em>i.e.</em> displacement boundary conditions and applied loads), as well as
              sets of Points and/or Cells, which are useful for defining constraints and
              in post-processing. Sets and constraints are indexed by an assigned name, which is convenient
              for accessing and modifying them.
            </p>
          </div>
          <div id="vtkboneFiniteElementModel_structure" class="imageblock">
            <div class="content">
              <img src="images/vtkboneFiniteElementModel_structure.png" alt="vtkboneFiniteElementModel structure">
            </div>
            <div class="title">Figure 12. Structure of vtkboneFiniteElementModel.</div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_reading_a_segmented_image">3.5. Reading a segmented image</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>We typically read in data as a segmented 3D volumetric image from
              micro-CT. The image values (<em>i.e.</em> the pixel or voxel values) need to
              correspond to the segmented material IDs. The selection of a file reading
              object will be appropriate to the input file format. The output of the
              file reader filter will be a <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> object.</p>
          </div>
          <div class="paragraph">
            <p>We have already given the example of using a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAIMReader.html">vtkboneAIMReader</a>
              to
              read a Scanco AIM file, which was</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>reader = vtkbone.vtkboneAIMReader()
reader.SetFileName ("MYFILE.AIM")
reader.Update()
image = reader.GetOutput()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="admonitionblock important">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/important.png" alt="Important">
                </td>
                <td class="content">
                  One slightly obscure technical issue which may arise is: are the data
                  of a <a href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a>
                  associated with the Points or the Cells? Either is possible in
                  <code>VTK</code>. The scalar image data (scalar because there is one value per location)
                  must be explicitly associated either with the Cells or with the Points.
                  (In fact it&#8217;s possible to have different scalar data on the Cells and the
                  Points.) Thinking about it as an FE problem, it is natural to associate
                  the image data with Cells, where each image voxel becomes an FE element. Thus,
                  we like to think of each value in the image as being at the center of
                  a Cell in the VTK scheme. VTK however has generally standardized
                  on the convention of image data being on the Points. There are some important
                  consequences. For example, a <a
                    href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> that has
                  dimensions of
                  (M,N,P) has (M,N,P) Points, but only (M-1,N-1,P-1) Cells. Or conversely, if you
                  have data with dimensions of (R,S,T), and you
                  want to put the data on the Cells, then you actually require a <a
                    href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a>
                  with dimensions of (R+1,S+1,T+1). Also, if the origin is important, one
                  needs to keep in mind that the origin is the location of the zero-indexed
                  Point. In terms of the Cells, this is the &#8220;lower-left&#8221; corner of the
                  zero-indexed Cell, not the center of that Cell. <code>vtkbone</code> objects that
                  require images as input will accept input with data either on the points
                  or on the Cells. However, many <code>VTK</code> objects that process
                  images work correctly only with input data on the Points. By contrast, if you
                  want to render the data and color according to the scalar image, the rendering
                  is quite different depending on whether the scalar data is on the Points or the Cells.
                  Generally, you get the expected result in this case by putting the data on the
                  Cells. This discussion is important because it illustrates that there is no
                  one universally correct answer to whether image data belongs on
                  the Points or on the Cells. <code>vtkbone</code> image readers, such as
                  <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAIMReader.html">vtkboneAIMReader</a>
                  have an option DataOnCells to control the desired
                  behaviour. <code>VTK</code> image readers always put image data on the Points, so if
                  you need the data on the Cells, you must to copy the output to a new <a
                    href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> .
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>Examples of reading data with vtkbone are given in the tutorials
              <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_reading_an_unsegmented_image_and_segmenting_it">3.6. Reading an unsegmented image and segmenting it
          </h3>
          <div class="paragraph">
            <p>If you have an unsegmented image such as a raw micro-CT image that
              has scalar values still in terms of density, it is possible to process the image with
              VTK. Segmentation is a complex subject, which we are unable to cover
              here. For an
              example of a simple segmentation, where only a density threshold
              and connectivity are considered, consult the example in the directory
              <code>examples/segment_dicom</code>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="ensuring_connectivity">3.7. Ensuring connectivity</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>A well-defined problem for finite element analysis requires that all parts
              of the object in the image be connected as a single object.</p>
          </div>
          <div class="paragraph">
            <p>Disconnected parts in the input create an ill-defined problem, with
              an infinite number of solutions. These arise, for example, when there
              is noise in the image data. Some solvers cannot solve this kind of problem
              at all (the global stiffness matrix is singular). <code>n88solver</code> will typically
              find a solution. However, the convergence might be very slow as it attempts
              to find the non-existent optimum position for the disconnected
              part.</p>
          </div>
          <div class="paragraph">
            <p>To avoid this problem, the input image can be processed with the filter
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classImageConnectivityFilter.html">ImageConnectivityFilter</a>
              . This filter has many options and
              different modes of operation, but in most cases the default mode is
              sufficient. In the default behaviour:
            </p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Zero-valued voxels are considered &#8220;empty space&#8221;, and no connection is
                  possible though them.</p>
              </li>
              <li>
                <p>Voxels are considered connected if they share a face. Sharing only a corner
                  or an edge is not sufficient.</p>
              </li>
              <li>
                <p>Only the largest connected object in the input image is passed to the
                  output image. Smaller objects that have no continuous path of connection
                  to the largest connected object are zeroed-out.</p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>Because of the first point, it is clearly necessary to segment the image
              before applying <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classImageConnectivityFilter.html">ImageConnectivityFilter</a>
              , because empty space must be
              labelled with the value 0.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>connectivity_filter = vtkbone.vtkboneImageConnectivityFilter()
connectivity_filter.SetInput (image)
connectivity_filter.Update()
image = connectivity_filter.GetOutput() <img src="./images/icons/callouts/1.png" alt="1"></pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>Notice that we use the variable name <code>image</code> for both the input
                  and the output. This causes no problems in Python, although by doing this we can no longer
                  use this to refer to the input image as the second call to <code>image</code> reassigns
                  the variable the value of <code>connectivity_filter.GetOutput()</code>. If it were necessary to refer
                  to the input image, then we should use different names for the input and output.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>If your input image is processed and segmented with another software
              package, it is still a good idea to verify the connectivity of the input
              image. If your input image is carefully prepared, and you don&#8217;t want to
              inadvertently modify it, you can check for connectivity without modifying it like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>connectivity_mapper = vtkbone.vtkboneImageConnectivityMap()
connectivity_mapper.SetInput (image)
connectivity_mapper.Update()
if connectivity_mapper.GetNumberOfRegions() != 1:
    print "WARNING: Input image does not consist of a single connected object."</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Examples of ensuring connectivity are given in the tutorials
              <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_generating_a_mesh">3.8. Generating a mesh</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>Once we have a segmented and connected image, we convert the image to a mesh of elements, represented by
              a <a href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
              object. The base class <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
              supports many
              types of Cells, but currently <code>vtkbone</code> supports only <code>VTK_HEXAHEDRON</code> and
              <code>VTK_VOXEL</code>. The topology of <code>VTK_VOXEL</code> is shown in <a
                href="#vtk_voxel_topology">Figure 13</a>.
            </p>
          </div>
          <div id="vtk_voxel_topology" class="imageblock">
            <div class="content">
              <img src="images/vtk_voxel_topology.png" alt="vtk voxel topology">
            </div>
            <div class="title">Figure 13. Topology of VTK_VOXEL. Local numbering of the nodes (Points) of the element
              (Cell) is shown (0-indexed).</div>
          </div>
          <div class="paragraph">
            <p>Generating a mesh in <code>vtkbone</code> is straightforward; simply pass the input image
              to a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
              filter. It takes no options; the important choices
              were made already during the segmentation stage. In Python this looks
              like this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>mesher = vtkbone.vtkboneImageToMesh()
mesher.SetInput (image)
mesher.Update()
mesh = mesher.GetOutput()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>vtkboneImageToMesh creates one Cell (<em>i.e.</em> element) of type <code>VTK_VOXEL</code> for every
              voxel in the input image that has non-zero scalar value. The scalar values of
              the image become the scalar values of the output Cells. It also creates Points
              at the vertices (corners) of the Cells. There are no duplicate Points:
              neighbouring Cells will reference the same Point on shared vertices.</p>
          </div>
          <div class="admonitionblock important">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/important.png" alt="Important">
                </td>
                <td class="content">
                  Cells and Points in <code>VTK</code> are ordered; they can be indexed by
                  consecutive Cell or Point number. This ordering is not inconsequential.
                  In Faim, the solver efficiency is optimal with certain orderings, and in fact
                  there are orderings for which the solver fails with an error message.
                  The ordering output by <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
                  is
                  &#8220;x fastest, z slowest&#8221;. It is recommended to always preserve this ordering.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_defining_materials">3.9. Defining materials</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>Material definitions are generated by creating a instance of a class of the
              corresponding material type, and then calling the appropriate methods to set
              the material parameters. Every material must have a unique name. <code>vtkbone</code> will
              assign default unique names when defining a new material object, but
              the names will be more meaningful if you assign them yourself.</p>
          </div>
          <div class="paragraph">
            <p><code>vtkbone</code> version 2.0 supports the following material classes:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneLinearIsotropicMaterial.html">vtkboneLinearIsotropicMaterial</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkn88LinearOrthotropicMaterial.html">vtkn88LinearOrthotropicMaterial</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkn88LinearAnisotropicMaterial.html">vtkn88LinearAnisotropicMaterial</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneVonMisesIsotropicMaterial.html">vtkboneVonMisesIsotropicMaterial</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMohrCoulombIsotropicMaterial.html">vtkboneMohrCoulombIsotropicMaterial</a>
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Plus special material classes that are in fact <em>material arrays</em>, which
              are discussed below.</p>
          </div>
          <div class="paragraph">
            <p>Here is an example of creating a simple linear isotropic material:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>linear_material = vtkbone.vtkboneLinearIsotropicMaterial()
linear_material.SetYoungsModulus (800) <img src="./images/icons/callouts/1.png" alt="1">
linear_material.SetPoissonsRatio (0.33)
linear_material.SetName ("Linear 800")</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>As discussed in <a href="#note_about_units">A note about units</a>, the units
                  of Young&#8217;s modulus depend on the input length units. If the length
                  units are mm and force units in N, then Young&#8217;s modulus has units of MPa.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>This is the construction of a Mohr-Coulomb elastoplastic material:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>ep_material = vtkbone.vtkboneMohrCoulombIsotropicMaterial()
ep_material.SetYoungsModulus (800)
ep_material.SetPoissonsRatio (0.33)
ep_material.SetYieldStrengths (20, 40) <img src="./images/icons/callouts/1.png" alt="1">
ep_material.SetName ("Mohr Coulomb material 1")</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>For Mohr-Coulomb, this pair of numbers is the yield strength in
                  tension and the yield strength in compression. The units of yield strength
                  are the same as stress, so typically MPa.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>In addition to the standard material classes, there are material
              array classes. Simply put, these define not a single material,
              but a sequence of similar materials with variable parameters.
              For a discussion of the circumstances in which this could be
              useful, see
              <a href="#material_arrays">Efficient Handling of Large Numbers of Material Definitions</a>.
              The material array classes do inherit
              themselves from <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterial.html">vtkboneMaterial</a>
              (rather than being a collection of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterial.html">vtkboneMaterial</a>
              objects). They can therefore be used nearly anywhere that a regular
              material can be; in particular, they can be inserted as entries
              into a material table. The material array classes are
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneLinearIsotropicMaterialArray.html">vtkboneLinearIsotropicMaterialArray</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkn88LinearOrthotropicMaterialArray.html">vtkn88LinearOrthotropicMaterialArray</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkn88LinearAnisotropicMaterialArray.html">vtkn88LinearAnisotropicMaterialArray</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneVonMisesIsotropicMaterialArray.html">vtkboneVonMisesIsotropicMaterialArray</a>
                </p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMohrCoulombIsotropicMaterialArray.html">vtkboneMohrCoulombIsotropicMaterialArray</a>
                </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_constructing_a_material_table">3.10. Constructing a material table</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>Once you have created your material definitions, you need to combine them
              into a material table, which maps material IDs to the material definitions.</p>
          </div>
          <div class="paragraph">
            <p>For example, if we want a homogenous material, and the input image
              has only the scalar value 127 for bone (and 0 for background),
              then we can make a material table like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>materialTable = vtkbone.vtkboneMaterialTable()
materialTable.AddMaterial (127, linear_material) <img src="./images/icons/callouts/1.png" alt="1"></pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>We created the material <code>linear_material</code> above.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>We must assign a material for every segmentation value present in the input.
              The same material can be assigned to multiple material IDs.
              For example, suppose the input image has segmentation values 100-103, and
              we have created two different materials, <code>materialA</code> and <code>materialB</code>,
              then we could create a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterialTable.html">vtkboneMaterialTable</a>
              like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>materialTable = vtkbone.vtkboneMaterialTable()
materialTable.AddMaterial (100, materialA)
materialTable.AddMaterial (101, materialB)
materialTable.AddMaterial (102, materialB)
materialTable.AddMaterial (103, materialB)</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>There are a couple of helper classes that simplify the creation of
              material tables for common cases. For a model with a homogenous
              material, we can use <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneGenerateHomogeneousMaterialTable.html">vtkboneGenerateHomogeneousMaterialTable</a>
              .
              This class assigns a specified <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterial.html">vtkboneMaterial</a> to
              all the scalar values
              present in the input mesh. The size of the resulting material table
              depends on the number of distinct input values. For example,</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>mtGenerator = vtkbone.vtkboneGenerateHomogeneousMaterialTable()
mtGenerator.SetMaterial (material1)
mtGenerator.SetMaterialIdList (mesh.GetCellData().GetScalars())
mtGenerator.Update()
materialTable = mtGenerator.GetOutput()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>We could alternatively set SetMaterialIdList with the scalars from the image,
              rather than those of the mesh; the results will be the same.</p>
          </div>
          <div class="paragraph">
            <p>Another useful helper class is <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneGenerateHommingaMaterialTable.html">vtkboneGenerateHommingaMaterialTable</a>
              .
              Refer to the <a href="#homminga_material_table">the section on the Homminga material model</a>
              in the chapter on preparing models with <a href="#n88modelgenerator">n88modelgenerator</a>.</p>
          </div>
          <div class="paragraph">
            <p>Examples of defining materials and creating a material table are
              given in the tutorials
              <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>,
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_creating_a_finite_element_model">3.11. Creating a finite element model</h3>
          <div class="paragraph">
            <p>At this stage, we combine the geometric mesh with the material table to create
              a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              object. The most elementary
              way to do this is with a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModelGenerator.html">vtkboneFiniteElementModelGenerator</a>
              ,
              which can be used like this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>modelGenerator = vtkbone.vtkboneFiniteElementModelGenerator()
modelGenerator.SetInput (0, mesh)
modelGenerator.SetInput (1, materialTable)
modelGenerator.Update()
model = modelGenerator.GetOutput()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>After combining the mesh with the material table, all that is now required to
              make a complete finite element model is to add boundary conditions and/or
              applied loads, and to specify node and element sets for the post-processing.
              For standard tests,
              there are <code>vtkbone</code> filters to generate complete models, and these are
              described below in <a href="#filters_for_standard_tests">Filters for creating standard tests</a>.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="creating_sets">3.12. Creating node and element sets</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>Before we can create boundary conditions or applied loads, we need to
              define node and/or element sets that specify all the nodes (or elements)
              to which we want to apply the boundary condition (displacement or applied load).
              Node and element sets are also used during post-processing. This will
              be discussed later in <a href="#setting_post_processing_parameters">Setting post processing
                parameters</a>.</p>
          </div>
          <div class="paragraph">
            <p>Any number of node and element sets may be defined. They must be named,
              and they are accessed by name. The node and element sets are simply lists
              of node or element numbers,
              and are stored as <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkIdTypeArray.html">vtkIdTypeArray</a> . There are
              many ways to create node and
              element sets. A very simple way is to simply enumerate the node numbers
              (or element numbers). For example, if we wanted to create a node
              set of the nodes 8,9,10,11 , this would be the code:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>nodes = array ([8,9,10,11])
nodes_vtk = numpy_to_vtk (nodes, deep=1, array_type=vtk.VTK_ID_TYPE) <img src="./images/icons/callouts/1.png" alt="1">
nodes_vtk.SetName ("example_node_set")
model.AddNodeSet (nodes_vtk)</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>In Python, the most flexible way to handle array data is with
                  numpy arrays, however the data must be passed to VTK objects as
                  <a href="http://www.vtk.org/doc/release/6.3/html/classvtkDataArray.html">vtkDataArray</a> .
                  <code>numpy_to_vtk</code> does the conversion.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p><code>VTK</code> offers many ways to select Points and Cells, for example by geometric criteria.
              As an example of this, refer to the <a
                href="#selecting_cells_within_a_cylinder">screw_pullout_tutorial</a> where a node set
              is selected from nodes located on a particular rough surface, and subject to additional
              criterion <em>r<sub>1</sub></em> &lt; <em>r</em> &lt; <em>r<sub>2</sub></em> , where <em>r</em> is the
              radius from a screw axis.</p>
          </div>
          <div class="paragraph">
            <p><code>vtkbone</code> also offers some utility functions for identifying node and elements
              sets. These can be found in <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneSelectionUtilities.html">vtkboneSelectionUtilities</a>
              .</p>
          </div>
          <div class="paragraph">
            <p>Frequently, we require sets corresponding to the faces of the model
              (<em>i.e.</em> the boundaries of the image). In this case, we may use the
              class <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              . <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              is a subclass of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModelGenerator.html">vtkboneFiniteElementModelGenerator</a>
              , with
              the extra functionality of creating pre-defined sets.
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              implements the concept of a Test Frame
              and a Data Frame. Refer to <a href="#test_orientation">test orientation</a> in
              the chapter on <a href="#n88modelgenerator">n88modelgenerator</a>. <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              creates the node and element sets given in the following table. Note
              that in each case there is both a node and element set, with the
              same name.
            </p>
          </div>
          <table id="sets_generated_by_vtkboneApplyTestBase" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 2. Node and element sets generated by vtkboneApplyTestBase</caption>
            <colgroup>
              <col style="width: 33.3333%;">
              <col style="width: 66.6667%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Set name</th>
                <th class="tableblock halign-left valign-top">Consists of</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_z0</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the bottom surface (<em>z</em>=<em>z<sub>min</sub></em>) in
                    the Test Frame.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_z1</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the top surface (<em>z</em>=<em>z<sub>max</sub></em>) in the
                    Test Frame.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_x0</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the <em>x</em>=<em>x<sub>min</sub></em> surface in Test Frame.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_x1</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the <em>x</em>=<em>x<sub>max</sub></em> surface in Test Frame.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_y0</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the <em>y</em>=<em>y<sub>min</sub></em> surface in Test Frame.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">face_y1</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">nodes/elements on the <em>y</em>=<em>y<sub>max</sub></em> surface in Test Frame.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>The sets &#8220;face_z0&#8221; and &#8220;face_z1&#8221; are of particular importance, as the standard
              tests are applied along the <em>z</em> axis in the Test Frame.</p>
          </div>
          <div class="paragraph">
            <p><a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              has options <code>UnevenTopSurface()</code>
              and <code>UnevenBottomSurface()</code> by which we can choose to have &#8220;face_z0&#8221; and/or
              &#8220;face_z1&#8221;
              as the set of nodes/elements on an uneven surface, instead of the boundary of the
              model. This is especially useful when the object in the image does not
              intersect the top/bottom boundaries
              of the image. See further discussion on <a href="#uneven_surfaces">uneven surfaces</a> in
              the chapter on <a href="#n88modelgenerator">n88modelgenerator</a>. The two sets &#8220;face_z0&#8221; and
              &#8220;face_z1&#8221; can also be limited to
              a specific material, as defined by material ID.</p>
          </div>
          <div class="paragraph">
            <p><a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              is used identically to
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModelGenerator.html">vtkboneFiniteElementModelGenerator</a>
              , except that additional optional
              settings may be set if desired. For example, here we define a model
              with a test axis in the <em>y</em> direction, and specify that we want the
              set &#8220;face_z1&#8221; to be the uneven surface in the image, where we are limiting
              the search for the uneven surface to a maximum distance of 0.5 from the image
              boundary.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>modelGenerator = vtkbone.vtkboneApplyTestBase()
modelGenerator.SetInput (0, mesh)
modelGenerator.SetInput (1, materialTable)
modelGenerator.SetTestAxis (vtkbone.vtkboneApplyTestBase.TEST_AXIS_Y)
modelGenerator.UnevenTopSurfaceOn()
modelGenerator.UseTopSurfaceMaximumDepthOn()
modelGenerator.SetTopSurfaceMaximumDepth (0.5)
modelGenerator.Update()
model = modelGenerator.GetOutput()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>An example of using the standard node and element sets from
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              is given in
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>. The tutorial
              <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a> demonstrates a
              sophisticated selection of custom node sets.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="adding_boundary_conditions">3.13. Adding boundary conditions</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>Once we have created the node sets, creating a boundary condition applied
              to the nodes of a particular node set is straightforward and can be done
              with the method <code>ApplyBoundaryCondition()</code> of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              . For example,
              to fix the bottom nodes and apply a displacement of 0.1 to the top nodes,
              we could do this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>model.ApplyBoundaryCondition (
        "face_z0",
        vtkbone.vtkboneConstraint.SENSE_Z, <img src="./images/icons/callouts/1.png" alt="1">
        0,
        "bottom_fixed") <img src="./images/icons/callouts/2.png" alt="2">
model.ApplyBoundaryCondition (
        "face_z1",
        vtkbone.vtkboneConstraint.SENSE_Z,
        -0.1, <img src="./images/icons/callouts/3.png" alt="3">
        "bottom_fixed")</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td><code>vtkbone.vtkboneConstraint.SENSE_Z</code> has the value 2 (see <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraint.html">vtkboneConstraint</a>
                  ). It is possible
                  just to use that value 2 here, but <code>SENSE_Z</code> is more informative.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                <td>This is the user-defined name assigned to the boundary condition. Every constraint must have a
                  unique name.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                <td>Negative if we want compression.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The &#8220;sense&#8221; is the axis direction along which the displacement is applied.
              The other axis directions remain free unless you also specify a value for
              them. It is quite possible, and common, to call <code>ApplyBoundaryCondition()</code>
              three times on the same node set, once for each sense.</p>
          </div>
          <div class="paragraph">
            <p><code>ApplyBoundaryCondition()</code> can take different types of arguments, for example
              arrays of senses, displacements and node numbers. Refer to the API documentation
              for <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              . There is also a convenience method
              <code>FixNodes()</code>, which is a quick way to set all senses to a zero displacement.
            </p>
          </div>
          <div class="paragraph">
            <p>Boundary conditions are implemented within <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              as a specific type of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraint.html">vtkboneConstraint</a>
              . All the constraints
              associated with a <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              are contained in a
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraintCollection.html">vtkboneConstraintCollection</a>
              . It is possible to
              modify either <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraintCollection.html">vtkboneConstraintCollection</a>
              or a particular
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraint.html">vtkboneConstraint</a>
              manually. For example, we could create a
              boundary condition on two nodes in the following manner. This is
              somewhat laborious and usually unnecessary, but it can be adapted to create
              unusual boundary conditions.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>node_ids = array([3,5])
node_ids_vtk = numpy_to_vtk (node_ids, deep=1, array_type=vtk.VTK_ID_TYPE)
senses = array ([0,2])     # x-axis, z-axis
senses_vtk = numpy_to_vtk (senses, deep=1, array_type=vtk.VTK_ID_TYPE)
senses_vtk.SetName ("SENSE")
values = array([0.1,0.1])
values_vtk = numpy_to_vtk (values, deep=1, array_type=vtk.VTK_ID_TYPE)
values_vtk.SetName ("VALUE")
constraint = vtkbone.vtkboneConstraint()
constraint.SetName ("a_custom_boundary_condition")
constraint.SetIndices (node_ids)
constraint.SetConstraintType (vtkbone.vtkboneConstraint::DISPLACEMENT)
constraint.SetConstraintAppliedTo (vtkbone.vtkboneConstraint::NODES)
constraint.GetAttributes().AddArray (senses)
constraint.GetAttributes().AddArray (values)
model.GetConstraints().AddItem (constraint)</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Examples of applying boundary conditions are given in the tutorials
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="adding_applied_loads">3.14. Adding applied loads</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>Creating an applied load is similar to creating a displacement boundary
              condition. They are both implemented as <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneConstraint.html">vtkboneConstraint</a>
              . However, while displacement
              boundary conditions are applied to nodes, applied loads are applied to elements; in fact they are applied
              to a particular
              face of an element (or to the body of an element).
              Therefore, the <code>ApplyLoad()</code> method of
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              takes the name of an element set, and
              has an additional input argument which specifies to which faces of the
              elements the load is applied. Here is an example of creating an
              applied load on the top surface of the model:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>model.ApplyLoad (
        "face_z1", <img src="./images/icons/callouts/1.png" alt="1">
        vtkbone.vtkboneConstraint.FACE_Z1_DISTRIBUTION,
        vtkbone.vtkboneConstraint.SENSE_Z, <img src="./images/icons/callouts/2.png" alt="2">
        6900, <img src="./images/icons/callouts/3.png" alt="3">
        "bottom_fixed")</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>Refers to the element set &#8220;face_z1&#8221;, not the corresponding node set,
                  which very often also exists with the same name.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                <td>In this example, the applied force is perpendicular to the
                  specified element face, but it is not required to be so.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                <td>This is the total load applied. The load is evenly distributed between all
                  of the element faces.</td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>To apply forces along non-axis directions, call <code>ApplyLoad()</code> multiple times
              with different senses.</p>
          </div>
          <div class="paragraph">
            <p>As with displacement boundary conditions, we can create an applied force manually, if
              we require more flexibility. It will look something like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>element_ids = array([3,5])
element_ids_vtk = numpy_to_vtk (element_ids, deep=1, array_type=vtk.VTK_ID_TYPE)
distributions = ones ((2,)) * vtkbone.vtkboneConstraint.FACE_Z1_DISTRIBUTION
distributions_vtk = numpy_to_vtk (distributions, deep=1, array_type=vtk.VTK_ID_TYPE)
distributions_vtk.SetName ("DISTRIBUTION")
senses = array ([0,2])     # x-axis, z-axis
senses_vtk = numpy_to_vtk (senses, deep=1, array_type=vtk.VTK_ID_TYPE)
senses_vtk.SetName ("SENSE")
total_load = 6900
values = total_load * ones(2, float) / 2
values_vtk = numpy_to_vtk (values, deep=1, array_type=vtk.VTK_ID_TYPE)
values_vtk.SetName ("VALUE")
constraint = vtkbone.vtkboneConstraint()
constraint.SetName ("a_custom_applied_load")
constraint.SetIndices (element_ids)
constraint.SetConstraintType (vtkbone.vtkboneConstraint::FORCE)
constraint.SetConstraintAppliedTo (vtkbone.vtkboneConstraint::ELEMENTS)
constraint.GetAttributes().AddArray (distributions)
constraint.GetAttributes().AddArray (senses)
constraint.GetAttributes().AddArray (values)
model.GetConstraints().AddItem (constraint)</pre>
            </div>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  You can apply loads to nodes instead of to elements if you desire.
                  You must create a constraint by hand to do this, as there is no convenience
                  method provided for this purpose. This is most sensible
                  when you desire to apply a point force (<em>i.e.</em> to a single node). Be careful
                  about applying forces to nodes because applying a constant force to each of a set of nodes
                  on a surface is <em>not</em> equivalent to applying a uniform pressure
                  to that surface. By contrast, applying
                  a constant force to a set of element faces is equivalent to a uniform pressure, which is why it
                  is usually more convenient to define loads on element faces.
                </td>
              </tr>
            </table>
          </div>
          <div class="admonitionblock important">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/important.png" alt="Important">
                </td>
                <td class="content">
                  Applied loads are additive. That is, if you create more than one
                  applied load on a particular element face, the loads will add.
                  Displacement boundary conditions by contrast are unique. If you create more
                  than one displacement boundary
                  condition applying to a particular node and sense, then only one of them
                  will be used by the solver, and the other will be discarded. Which of
                  multiple boundary conditions applying to the same degree of freedom is used
                  is indeterminate, so it is a logical
                  error to create multiple different boundary conditions applying to the same degree
                  of freedom. No warning or error message will be generated in the case
                  of multiple boundary conditions on the same degree of freedom. (It is
                  sometimes convenient to be able to do so in cases where the actual value
                  used turns out not to matter).
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>An example of adding an applied load is given in the tutorial
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="adding_a_convergence_set">3.15. Optional: Adding a convergence set</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>Adding a <em>convergence set</em> is optional, but it allows the solver to use the
              <em>convergence set</em> convergence measure, which is generally the best one for
              linear models. Best in this context means that the solver can reliably identify
              when a certain precision has been obtained, and thus stop iterating.
              Less tailored convergence measures, which don&#8217;t require the definition of
              a <em>convergence set</em>, must be more conservative, and thus run to more
              iterations to be certain of obtaining a given precision.
              See <a href="#convergence_measure">Convergence measure</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>Convergence sets are most conveniently defined with the method <code>ConvergenceSetFromConstraint</code>
              of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>.
              You simply pass it the most relevant
              boundary condition or applied force. &#8220;Most relevant&#8221; simply means the one
              you are most interested in.</p>
          </div>
          <div class="paragraph">
            <p>For example, the standard compression tests generate their convergence sets with</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>model.ConvergenceSetFromConstraint("top_displacement")</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Here <em>top_displacement</em> is the name of the boundary condition on the top surface.
              This results in a convergence set which is equivalent to the total force on the top surface.</p>
          </div>
          <div class="paragraph">
            <p>In <a href="#cantilever_tutorial">Tutorial: Deflection of a cantilevered beam; adding custom boundary
                conditions and loads</a>, an applied force is defined on the tip of a
              cantilever, and the convergence set is generated with</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>model.ConvergenceSetFromConstraint("end_force")</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>This results in a convergence set which is the average displacement of the tip
              of the cantilever.</p>
          </div>
          <div class="paragraph">
            <p>However defined, if <em>convergence set</em> is used as the convergence measure, then the
              solver watches that quantity to determine when it has ceased to change meaningfully,
              and thus, when iterating can be stopped.</p>
          </div>
          <div class="admonitionblock warning">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/warning.png" alt="Warning">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>You cannot define a convergence set that consists entirely of fixed nodes. That is,
                      entirely of boundary condition nodes that are set to zero displacement. This is because the
                      solver internally elimates these degrees of freedom, and is hence unable to
                      calculate the corresponding forces during iterations.</p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_ensuring_your_model_is_well_defined">3.16. Ensuring your model is well-defined</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>It is possible to create a model that is degenerate, or not well-defined.
              In other words, a model that has not a single solution, but many solutions
              (typically an infinite number). As a linear algebra problem, such a problem has a
              singular global stiffness matrix. For example, consider the standard
              uniaxial problem where a sample volume is compressed between two hard
              parallel plates. (See <a href="#uniaxial_test">uniaxial test</a> in the chapter on
              <a href="#n88modelgenerator">n88modelgenerator</a>). If we specify no contact friction, then although the
              sample compresses in a predictable way between the two plates, it is free to
              slide around as a whole (translate) anywhere between the plates. For the particular case
              of the uniaxial model, <a href="#n88modelgenerator">n88modelgenerator</a> provides the option to add
              a <a href="#n88modelgenerator_pin">pin</a>, which consists of the following additional constraints:
            </p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>fix the <em>x</em>,<em>y</em> senses of an arbitrary node, and</p>
              </li>
              <li>
                <p>fix one sense of another node (usually from the same element).</p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>The first constraint is sufficient to prevent translation, and the second constraint
              is required to prevent rotation.</p>
          </div>
          <div class="paragraph">
            <p>Models with only applied loads and no displacement boundary conditions are always
              ill-defined.</p>
          </div>
          <div class="paragraph">
            <p>Practically, <code>n88solver</code> will usually solve even ill-defined problems. In
              fact, for the type of ill-defined problem described here,
              it often does so faster than the equivalent well-defined problem (<em>i.e.</em>
              one with added &#8220;pin&#8221; constraints to make it non-singular). Many types
              of ill-defined problems can cause <code>n88solver</code> to converge much more slowly. For example,
              see the discussion on <a href="#ensuring_connectivity">Ensuring connectivity</a>.
              Not all solvers
              however can handle ill-defined problems, so this should be avoided when
              exporting models to other solvers. Also, if you would like overlay
              the renderings of two similar ill-defined problems or compare differences
              in any way, it is usually necessary to first register them to eliminate
              meaningless differences (such as overall translations or rotations in
              the example described).</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="setting_post_processing_parameters">3.17. Setting post-processing parameters</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>If you have followed every step, then you have a model that
              is completely defined for the solver. In fact you could save it to a file
              and solve it now. The post-processor <a href="#n88postfaim">n88postfaim</a> however requires
              a bit more information so that meaningful results can be extracted from the solved model. <a
                href="#n88postfaim">n88postfaim</a> calculates certain quantities
              with reference to node or element sets.
              For example, in a compression test the relevant sets correspond to
              the top and bottom faces, as we are interested principally in the
              forces on these faces. These sets already exist (&#8220;face_z0&#8221; and
              &#8220;face_z1&#8221;), as we previously used them to apply boundary conditions.
              We need to list the relevant node sets to be used by
              <a href="#n88postfaim">n88postfaim</a>. Of course, if you&#8217;re doing some custom post-processing that
              does not
              involve <a href="#n88postfaim">n88postfaim</a>, then this step is optional and can be skipped.
              Setting the post-processing node sets involves setting some &#8220;information&#8221;
              with a key (this may seem slightly obscure, but it is a standard VTK
              technique):
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>info = model.GetInformation()
pp_node_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()
pp_node_sets_key.Append (info, "face_z0")
pp_node_sets_key.Append (info, "face_z1")</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Any number of sets may be specified for post-processing.
              <a href="#n88postfaim">n88postfaim</a> requires the element sets as well as the node
              sets, and they must match exactly, meaning that the <em>n<sup>th</sup></em> post-processing element set
              must be exactly those elements which contain any of the nodes of the
              <em>n<sup>th</sup></em> post-processing node set. (The element set name is not required
              to be the same as the node set name).
            </p>
          </div>
          <div class="paragraph">
            <p>If you&#8217;ve used <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              to get pre-defined node
              and element sets, then you already have the corresponding element
              sets, and in fact they have the same names, so</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>info = model.GetInformation()
pp_node_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()
pp_node_sets_key.Append (info, "face_z0")
pp_node_sets_key.Append (info, "face_z1")
pp_elem_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_ELEMENT_SETS()
pp_element_sets_key.Append (info, "face_z0")
pp_element_sets_key.Append (info, "face_z1")</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>If you&#8217;ve created custom node sets, then you can obtain the corresponding
              element sets with the method <code>GetAssociatedElementsFromNodeSet()</code>, so
              for example (taken from the <a href="#screw_pullout_tutorial">screw pull-out tutorial</a>),</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>info = model.GetInformation()
pp_node_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()
pp_elem_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_ELEMENT_SETS()
for setname in ["bone_top_visible", "screw_top"]:
    pp_node_sets_key.Append (info, setname)
    elementSet = model.GetAssociatedElementsFromNodeSet (setname)
    model.AddElementSet (elementSet)
    pp_elem_sets_key.Append (info, setname)</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Examples of setting post-processing parameters are given in the tutorials
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="filters_for_standard_tests">3.18. Filters for creating standard tests</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>For each of the standard tests, namely the ones that <a href="#n88modelgenerator">n88modelgenerator</a>
              can generate, there is a filter to generate the test, complete with
              all displacement boundary conditions, applied forces, and relevant post-processing sets.
              Of course, it is easier to just simply use <a href="#n88modelgenerator">n88modelgenerator</a> for these
              cases rather than
              write a script. However, these filters provide more options than are
              exposed by <a href="#n88modelgenerator">n88modelgenerator</a>, and a script will allow you to access these
              options. Furthermore, sometimes a standard model is nearly, but not quite,
              what you want. In this case, the fastest way to proceed is to use a
              standard test generating filter, and then tweak the resulting model.</p>
          </div>
          <div class="paragraph">
            <p>All the standard test filters are subclasses of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              (see <a href="#creating_sets">Creating node and element sets</a>), so that they
              support variable orientation as defined by the Data Frame and the Test Frame,
              as well as having the standard sets defined (&#8220;face_z0&#8221;, etc&#8230;&#8203;)</p>
          </div>
          <div class="paragraph">
            <p>The following table lists the standard model filters.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 3. vtkbone filter classes that generate standard models</caption>
            <colgroup>
              <col style="width: 50%;">
              <col style="width: 50%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">vtkbone filter</th>
                <th class="tableblock halign-left valign-top">n88modelgenerator test types</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a href="#uniaxial_test">uniaxial</a>, <a href="#axial_test">axial</a> and
                    <a href="#confined_test">confined</a>
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplySymmetricShearTest.html">vtkboneApplySymmetricShearTest</a>
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a href="#symshear_test">symshear</a></p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyDirectionalShearTest.html">vtkboneApplyDirectionalShearTest</a>
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a href="#dshear_test">dshear</a></p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyBendingTest.html">vtkboneApplyBendingTest</a>
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a href="#bending_test">bending</a></p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTorsionTest.html">vtkboneApplyTorsionTest</a>
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a href="#torsion_test">torsion</a></p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>For details on the options supported by these filters, refer to the API
              documentation.</p>
          </div>
          <div class="paragraph">
            <p>An example of using a standard test filter is given in the tutorial
              <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_modifying_a_finite_element_model">3.19. Modifying a finite element model</h3>
          <div class="paragraph">
            <p>Often a standard model type will be very close to the desired test configuration,
              but some modifications are needed. Every part of <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              can be modified, or even deleted, after creation.
              There are in general too many possibilities to enumerate here.</p>
          </div>
          <div class="paragraph">
            <p>If a model is already written as an <code>n88model</code> file, it can be read with
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelReader.html">vtkboneN88ModelReader</a>
              , modified, and rewritten.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_updating_the_history_and_the_log">3.20. Updating the history and the log</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>It is good practice (but not strictly necessary) to add relevant
              details to the History and Log fields of a model before writing
              it out. This will assist greatly in the future if it is required to
              trace back the origins and history of a given
              <code>n88model</code> file.
            </p>
          </div>
          <div class="paragraph">
            <p>The history and comments of an <code>n88model</code> file can be viewed
              with the command</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88modelinfo --history --comments myfile.n88model</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>You can leave out the <code>--history</code> and <code>--comments</code> arguments, although
              then you will get a lot more information about the model, possibly more
              than you want.</p>
          </div>
          <div class="paragraph">
            <p>The History field should have one line per executable that modifies the
              model file. This line should start with a time/date stamp and briefly state
              the program (and perhaps the user) which modified or created the file.
              History can be added with the method <code>AppendHistory()</code>; the date/time
              stamp will be automatically added. For example</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>model.AppendHistory("Created with screwpullout.py version 6.0")</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The Log field is intended to record any other information that would
              be useful to be able to recover at a later time. Every addition can be any number of lines long. You
              should
              record any parameters or settings that are relevant here. As for
              <code>AppendHistory()</code>, <code>AppendLog()</code> will add a date/time stamp (although
              on its own line). It will also ensure that every addition to the Log
              is separated by a black line from other additions to Log, for ease in
              reading it. For example
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>settingsText = ["Configuration:",
    "input file                     = %s" % input_image_file,
    "output file                    = %s" % output_faim_file,
    "bone material id               = %s" % bone_material_id,
    "bone material Young's modulus  = %s" % bone_material_modulus,
    "bone material Poisson's ratio  = %s" % bone_material_poissons_ratio,
    "screw material id              = %s" % screw_material_id,
    "screw material Young's modulus = %s" % screw_material_modulus,
    "screw material Poisson's ratio = %s" % screw_material_poissons_ratio,
    "screw displacement             = %s" % screw_displacement,
    "inner ring radius              = %s" % inner_ring_radius,
    "bone constraint max depth      = %s" % bone_constraint_max_depth]

model.AppendLog ("\n".join(settingsText)) <img src="./images/icons/callouts/1.png" alt="1"></pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>This might look pretty weird if you&#8217;re not a Python guru. <code>settingsText</code>
                  is a Python list of strings (each of one line). <code>"\n".join(settingsText)</code>
                  joins them all into one long string, separated by line returns.</td>
              </tr>
            </table>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  A particularly clever trick if your script uses a configuration file
                  to set values, one which is used by <a href="#n88modelgenerator">n88modelgenerator</a>, and also
                  used in the above example (which is from the
                  <a href="#screw_pullout_tutorial">screw pull-out tutorial</a>), is to write the settings
                  into the Comment field in exactly the same format that they
                  appear in the configuration file. Then, if ever the data need to be
                  exactly re-created for some reason, the settings can be copied from the
                  Log and pasted directly into a new configuration file. The script can
                  then be rerun with that configuration file without any further editing.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>Examples of adding information to the history and to the log are given
              in the tutorials
              <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a>,
              <a href="#cantilever_tutorial">Deflection of a cantilevered beam: adding custom boundary conditions and
                loads</a>
              and <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_writing_a_model_file_for_input_to_the_solver">3.21. Writing a model file for input to the solver</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>When your <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
              is the way you like it, writing
              a file is straightforward:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInput (model)
writer.SetFileName ("a_snazzy_model.n88model")
writer.Update()</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Other formats can also be written using the appropriate writer including,</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFaimVersion5InputWriter.html">vtkboneFaimVersion5InputWriter</a>
                  , and</p>
              </li>
              <li>
                <p><a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAbaqusInputWriter.html">vtkboneAbaqusInputWriter</a>
                  .</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_visualizing_intermediate_results">3.22. Visualizing intermediate results</h3>
          <div class="paragraph">
            <p>When developing a complicated model, it is often a good idea to write out
              intermediate results that can be visualized. This can be done either by
              writing out intermediate geometries and node sets using standard VTK
              file format writers, such as <a
                href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLUnstructuredGridWriter.html">vtkXMLUnstructuredGridWriter</a>
              and
              <a href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLPolyDataWriter.html">vtkXMLPolyDataWriter</a>
              , or by writing the model with
              <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelWriter.html">vtkboneN88ModelWriter</a>
              as early as possible as you build up your script,
              before the model is complete. Even incomplete models can be visualized.
              The tool <a href="#n88extractsets">n88extractsets</a> is handy to extract and visualize
              node and element sets, as well as boundary conditions and applied loads.
            </p>
          </div>
          <div class="paragraph">
            <p>For an example of visualizing intermediate results as the model is
              built up, see
              <a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_error_handling">3.23. Error handling</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>VTK classes do not throw exceptions or halt execution when an error occurs.
              If
              catching error conditions is important to you, you need to provide a VTK
              observer class. For more information, refer to
              <a href="http://www.vtk.org/Wiki/VTK/Tutorials/Callbacks"
                class="bare">http://www.vtk.org/Wiki/VTK/Tutorials/Callbacks</a> . However, if you don&#8217;t
              provide an error observer (and most often, you won&#8217;t want to be bothered to),
              you will still be informed about error conditions by a message printed to
              standard out (i.e. to the console). For scripting purposes, this is generally
              adequate.
            </p>
          </div>
          <div class="paragraph">
            <p>If you do want to trap the error, here is an example in Python.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>class ErrorObserver:
   def __init__(self):
       self.__ErrorOccurred = False
       self.__ErrorMessage = None
       self.CallDataType = 'string0'
   def __call__(self, obj, event, message):
       self.__ErrorOccurred = True
       self.__ErrorMessage = message
   def ErrorOccurred(self):
       occ = self.__ErrorOccurred
       self.__ErrorOccurred = False
       return occ
   def ErrorMessage(self):
       return self.__ErrorMessage

errorObserver = ErrorObserver()

reader = vtkbone.vtkboneN88ModelReader()
reader.AddObserver ("ErrorEvent", errorObserver)
reader.SetFileName (filename)
reader.Update()

if errorObserver.ErrorOccurred():
    print "ERROR reading file: ", errorObserver.ErrorMessage()
    sys.exit (-1)</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>vtkbone provides a very simple error observer class, <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneErrorWarningObserver.html">vtkboneErrorWarningObserver</a>
              . Its use however is limited to
              C++ code; use the above example for Python.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="solving_linear_problems">4. Solving Linear Problems</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p></p>
        </div>
        <div class="sect2">
          <h3 id="using_n88solver_slt">4.1. Obtaining solutions to linear problems using n88solver_slt</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>For a model with only linear elastic materials, the solver can be run as follows</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88solver_slt myfile.n88model</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>In special cases, you may want to use <code>n88solver_sla</code> instead of <code>n88solver_slt</code>:
              See <a href="#material_arrays">Efficient Handling of Large Numbers of Material Definitions</a>.
              Everything in this section applies equally well to that solver.</p>
          </div>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>The solution as expressed as displacements - from the original position - at node.
              The displacements are written into the input file; no additional output
              file is created. If the <code>n88model</code> file contains an existing solution, it
              will be overwritten. Furthermore, if there is an existing solution, it will be used as a
              starting point for the solver for further iterations. This behaviour is not always desired
              and can be suppressed; see <a href="#n88solver_restart">restart</a> for details.</p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>To check whether an <code>n88model</code> file has already been solved, the
                      following command is useful</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>n88modelinfo --history --solutions myfile.n88model</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>See <a href="#n88modelinfo">n88modelinfo</a> for more details.</p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The complete list of arguments to <a href="#n88solver">n88solver</a> is given in the
              <a href="#n88solver">Command Reference chapter</a>.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_convergence">4.2. Convergence</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p><a href="#n88solver">n88solver_slt</a> is a pre-conditioned conjugate gradient solver which improves
              the solution through an iterative process. Therefore it is necessary to define a
              convergence criterion that defines when the solution is good enough, and the iterating can
              stop.</p>
          </div>
          <div id="convergence_measure" class="paragraph">
            <div class="title">Convergence measure</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p><a href="#n88solver">n88solver_slt</a> provides the options to select from among different
              <em>convergence measures</em>. See <a href="#n88solver_convergence_measure">convergence_measure</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>The traditional convergence measure is the maximum change over all degrees of
              freedom. We call this method <em>maximum du</em>. Mathmatically, for
              the <em>i<sup>th</sup></em> iteration it is defined as</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              e_i = \frac{max_j |x_{i,j}-x_{i-1,j}|}{max_j |x_{i-1,j}|}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>where <em>x<sub>i,j</sub></em> is the displacement of the <em>j<sup>th</sup></em> degree of freedom at
              the
              <em>i<sup>th</sup></em> iteration. The maximum is taken over all degrees of freedom.
            </p>
          </div>
          <div class="paragraph">
            <p>The difficulty with this convergence measure is that it is not clear what
              numerical value of tolerance is optimal, as it is not obvious how it
              relates to quantities that a user would be directly interesting in.
              Although the convergence measure is unitless, there is in fact no consistent
              relationship between <em>e<sub>i</sub></em> and the relative precision of quantities
              such as displacement and force. Therefore the tolerance must be chosen
              conservatively based on experience.</p>
          </div>
          <div class="paragraph">
            <p>In version 8, we introduced a new convergence measure, which we
              call a <em>convergence set</em>. Essentially, this is a parameter, <em>c</em>, equivalent directly
              to a quantity of interest to the user. This parameter depends on the
              model. For example for a compression test with fixed strain or displacement,
              it would be equivalent to the reaction force on the top surface (more
              precisely the top boundary condition). On the other hand, if you define
              a compression test with a given force, in that case an appropriate parameter
              <em>c</em> would be the average displacement of the top surface. The solver
              continues iterations until the relative change in <em>c</em> from iteration to iteration
              falls below a specified threshold:
            </p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              e_i = \frac{|c_i-c_{i-1}|}{|c_{i-1}|}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>The choice of tolerance is now straight-forward: if you want to obtain a certain
              relative precision in your calculated reaction force for example, let us say
              one part in 10<sup>4</sup>,
              then you allow a bit of a safety margin and chose for example a tolerance
              of 10<sup>-5</sup>.</p>
          </div>
          <div class="paragraph">
            <p>Clearly the difficulty is now in defining the quantity <em>c</em>. Fortunately,
              the standard faim model generator tools, including <code>n88modelgenerator</code>
              and <code>vtkbone</code> will define a suitable one for you. For the standard
              tests, it is the complement of the most important moving boundary condition,
              or most important applied force, as appropriate. By the <em>complement</em>, we mean
              that <em>c</em> is calculated as a force in the case of a boundary condition; conversely it is calculated
              as an average displacement in the case of an applied
              force. The definition of <em>c</em> therefore consists of defining a <em>convergence
                set</em>, which is some collection of degrees of freedom, together with some specification
              of what is to be calculated over this collection of degrees of freedom.
              It is exactly analogus to a constraint, which is internally how
              boundary conditions and applied forces are stored in <code>n88model</code> files;
              a <em>convergence set</em> is stored in a similar manner in an <code>n88model</code> file.
              See <a href="#n88model_file_format">n88model File Format</a>. Clearly, in the case that
              no convergence set is defined in the <code>n88model</code> file, the <code>convergence set</code>
              method for determining convergence cannot be used. In this case, the solver
              will fall back to the traditional <em>maximum du</em> method.</p>
          </div>
          <div class="paragraph">
            <p>Regardless of the convergence measure chosen, the convergence measure does not decay
              smoothly, but can be jumpy or noisy. Therefore, a convergence window is introduced,
              so that iterations are not terminated prematurely by a randomly low
              convergence measure value.
              To be considered converged, the convergence measure <em>e<sub>i</sub></em> must remain
              below the threshold for at least the specified number of consecutive iterations.
              For the <em>maximum du</em> method, we have found by experience that a convergence window
              of 3 is typically sufficient. For the <em>convergence set</em> method, because it
              looks at only a part of the whole model, we have found that the convergence window
              must be increased
              as the number of degrees of freedom increases. Based on empirical analysis
              of many models, we suggest the following formula for the convergence window</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              w = 0.16 \sqrt{n}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>where <em>n</em> is the number of nodes in the model. This formula is in fact what the
              solver will use if you don&#8217;t explicitly chose another value with the
              parameter <a href="#n88solver_convergence_window">convergence_window</a>.</p>
          </div>
          <div class="paragraph">
            <div class="title">Maximum iterations</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p>In addition to the convergence criterion described above, a <em>maximum number of
                iterations</em> can be set. This is useful for stopping the iterating if the
              thresholds have been set too
              low (<em>i.e.</em> too strictly). Sometimes we may want to stop and perform a more sophisticated
              analysis of the quality of the solution before deciding if we want to
              proceed with further iterations.</p>
          </div>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>Note that no matter how the solver terminated, we can re-launch it, possibly
              with different convergence criteria. By default, the solver will use an
              existing solution as the starting point and continue to refine it from
              where it left off. Note however, that not all the numerical parameters of
              the conjugate gradient method are stored in the <code>n88model</code> file. Therefore, stopping
              and re-starting the solver does not result in precisely the same progression
              of iterations as compared with simply letting the solver run uninterupted. Some
              additional iterations are required to reconstruct the conjugate gradient
              information.</p>
          </div>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>If you want to make a close investigation of the convergence of your model
              as the solver iterates, you can make use of the <a href="#n88solver_iterations_file">iterations_file</a>
              option to output all iteration data to
              a file. It can be informative
              to plot these data on a log-log graph (convergence measure <em>e<sub>i</sub></em> versus
              iteration number <em>i</em>).</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="evaluating_solution_quality">4.3. Evaluating solution quality</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>For a linear problem, the solver is solving a system equivalent to</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \mathbf{K} \mathbf{x} = \mathbf{f}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>where <strong>x</strong> are the displacements, <strong>f</strong> are the forces (including all the
              internal
              forces on each node), and <strong>K</strong> is a global
              stiffness matrix. The solver never actually constructs
              <strong>K</strong>; the memory requirements would be prohibitive, as <strong>K</strong> is a matrix
              of size <em>N<sup>2</sup></em>, where <em>N</em> is the number of degrees of freedom. The
              residuals are defined as
            </p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \mathbf{r} = \mathbf{K} \mathbf{x} - \mathbf{f}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>For the exact solution, the residual vector is identically zero. As we
              are obtaining a numerical solution rather than an exact solution,
              we cannot in practice obtain exactly zero-valued residuals. The remaining value of the
              residuals is a good measure of the accuracy of the solution, with smaller
              residuals indicating a closer match to the unobtainable perfect solution.</p>
          </div>
          <div class="paragraph">
            <p>To answer the question, &#8220;What is a good value for the residuals?&#8221;, observe
              that the residuals have units of force. We therefore need to compare with a
              characteristic force in the system.</p>
          </div>
          <div class="paragraph">
            <p>Numerics88 provides a tool, <a href="#n88evaluate">n88evaluate</a>, to evaluate a solution.
              It is run like this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88evaluate myfile.n88model</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The output related to the residuals looks like this</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>Analysis of forces (residuals):
    max err           : 3.00E-07
    rms err           : 3.15E-08
    max err/max force : 3.51E-06
    rms err/max force : 3.68E-07</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The second two numbers are the maximum and RMS residuals, scaled to the maximum nodal
              force in the solution. These values are a measure of the relative error.
              Note that this error is only the mathematical error of the solution to the
              stated system of equations. There are naturally other sources of error, such
              as that due to the measurement and discretisation of the physical
              object, and the error in determining the material properties of the
              object. When the solver is working normally, these other sources of error
              will be much larger than the remaining mathematical error in the
              solution obtained by the solver.</p>
          </div>
          <div class="paragraph">
            <p><code>n88evaluate</code> also performs a check that the boundary conditions are
              indeed satisfied:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>Analysis of solution displacements at boundary conditions:
    max err           : 0.00E+00
    rms err           : 0.00E+00</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>This is a trivial check: anything other than zero or very small values indicates
              a problem with solver.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="solving_nonlinear_problems">5. Solving Nonlinear Problems</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p></p>
        </div>
        <div class="sect2">
          <h3 id="using_n88solver_spt">5.1. Obtaining solutions to nonlinear problems with n88solver_spt</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>If you have defined plasticity for any materials used in your model, then you must
              use the solver <a href="#n88solver">n88solver_spt</a>, which is a solver suitable for small-strain
              elastoplastic models. This solver is invoked exactly as is <code>n88solver_slt</code>. It
              recognizes a couple of additional options related to the plastic convergence. To solve an elastoplastic
              model, the solver first obtains a linear elastic solution, and then performs a plastic
              iteration to update the plastic strain. This is repeated until the plastic convergence
              criterion is met. Thus linear solutions, consisting of many linear iterations, alternate
              with single plastic iteration steps.</p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>It is perfectly possible to run <code>n88solver_spt</code> on a model with only linear
                      elastic material definitions. <code>n88solver_spt</code> takes no longer to run on a linear
                      model than does <code>n88solver_slt</code>. However it does use more memory. Conversely,
                      it is also possible to run <code>n88solver_slt</code> on a model
                      containing elastoplastic material definitions. In this case, the plasticity is
                      simply ignored, and the linear solution will be obtained.</p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="elastoplastic_convergence">5.2. Convergence</h3>
          <div class="paragraph">
            <p>For elastoplastic problems, the default convergence measure remains the traditional
              <code>dumax</code> method, instead of the new <code>convergence set</code> method. See <a
                href="#convergence_measure">Convergence measure</a>.
              The reason for this is that, not infrequently the addition of plasticity has only a
              small effect on quantities like reaction force. In these cases, observing a quantity
              such as the total reaction force to determine convergence does not work well
              for the plastic iterations. Furthermore, when solving an elastoplastic problem,
              we are more likely to be interested in quantities pertaining to the entire volume,
              such as the number and location of yielded elements, rather than only quantities that are
              calculated over just a boundary condition, such as reaction force. Recall that the
              <code>dumax</code> convergence measure is calculated over all degrees of freedom, while
              the <code>convergence set</code> convergence measure is typically calculated over a chosen
              boundary condition.
            </p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>As was the case for linear files, you can generate a file with all the iteration data
                      using the option <a href="#n88solver_iterations_file">iterations_file</a>. For elastoplastic
                      solutions, this file can be quite large. Here is a command to extract just the last linear
                      iteration of every plastic iteration step, which often contains all the information
                      we are looking for (<em>i.e.</em> the full plastic evolution, as well as the linear tolerance
                      for each plastic iteration, and the number of linear iterations required at
                      each plastic step).</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>awk '$2!=previous {print line; previous=$2}
     $2==previous {line = $0; previous=$2}' iterations.txt</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>This command can be run in Linux and macOS, as well as in a Bash shell in Windows 10. In
                      case you don&#8217;t have <code>awk</code>, here is a Python script that does the same thing</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>lines = open("iterations.txt").readlines()
output = [p for (l,p) in zip(lines,[lines[0]] + lines[:-1]) if l.split()[1] != p.split()[1]]
for o in output: print o,</pre>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="nonlinear_progressive_loads">5.3. Obtaining accurate nonlinear solutions by progressively applying
            loads</h3>
          <div class="paragraph">
            <p>In contrast to a linear elastic model, there is in general no single unique solution for a
              given end-state of a system with elastoplastic characteristics. As discussed in
              <a href="#plasticity">the section plasticity</a> in the chapter <em>Preparing Finite Element Models with
                n88modelgenerator</em>, elastoplastic models exhibit irreversibility and hysteresis, and thus
              have a path dependence. In other words, a dependence not only on the final state, but on
              the history in obtaining the final state. For a real object, the history is the
              time-dependence of the state, presumably starting from some initial neutral state. Within
              the solver, it is not necessary (or possible) to account for a continuous time dependence
              of the state: nevertheless even if we solve for a single end state of an elastoplastic
              model, the solver necessarily traces a path in a mathematical space from some starting
              point to the final solution. Just as for the real physical situation, this path in
              mathematical space can affect the final solution.
              Therefore, the most strictly correct approach to solving nonlinear elastoplastic problems is to
              incrementally apply loads (or strains), starting with a solution at or near the elastic limit
              (<em>i.e.</em> near the onset of nonlinear behaviour), and obtaining a complete solution at each load
              increment, until the final state is obtained.
              This is obviously more complicated than a single all-at-once solution, and also more
              time-consuming. The question is, does this make any practical difference?
              Frequently, for loads applied monotonically in a single direction,
              the answer is no. Conversly, if your physical situation involves
              increasing and decreasing a load, or changing the direction of
              an applied load, then it is important to model this load history.
              A tutorial
              demonstrating the incremental application of a load to an elastoplastic problem
              is <a href="#cantilever_elastoplastic_tutorial">A cantilevered beam with elastoplastic material
                properties</a> .
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="evaluating_nonlinear_solution_quality">5.4. Evaluating nonlinear solution quality</h3>
          <div class="paragraph">
            <p>Evaluating the correctness of an elastoplastic solution is more subtle than
              evaluating the correctness of a linear elastic model, for the simple reason
              that, as mentioned in the previous section, there is no single unique solution
              to an elastoplastic problem.</p>
          </div>
          <div class="paragraph">
            <p>There are nevertheless some measures we can use. Internal forces must still balance,
              and we can examine the residuals, as in
              <a href="#evaluating_solution_quality">Evaluating solution quality</a> in the section on
              linear models.
            </p>
          </div>
          <div class="paragraph">
            <p>When examining the yield strain, there must be no unyielded elements for which a positive yield function
              is calculated. Here is the check of that in <a href="#n88evaluate">n88evaluate</a>:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>Analysis of yield function F:
    Unyielded elements with F&gt;0:
        count             : 0
        max F             : -
        rms F             : -
        max F/max stress  : -
        rms F/max stress  : -</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Actually in rare cases, a small number of unyielded elements might have very
              small positive values of yield function, but in this case, the values should
              be very small indeed.</p>
          </div>
          <div class="paragraph">
            <p>Secondly, one might expect all the yielded elements in the solution (<em>i.e.</em> those elements
              with a nonzero plastic strain) to lie on the yield surface (<em>F</em>=0). In fact, this is not
              necessarily the case. Even in an elastoplastic model carefully solved with incremental
              applied test strain, it may happen that some elements reach the yield stress (<em>i.e.</em> the
              yield surface) for some value of applied test strain, but then actually experience a
              substantially reduced stress at a higher applied test strain, due to the mechanical failure or yield
              of some other part of the model. Thus it is perfectly possible to have an end-state
              solution in which some elements are observed to have non-zero plastic strains but are in a stress state
              much
              less than the yield stress (<em>i.e.</em> well inside the yield surface). More common though is
              for yield elements to have a very small remnant positive yield function, which is
              somewhat analogous to the residual in the linear case.</p>
          </div>
          <div class="paragraph">
            <p>Values related to the yield function calculated for all yielded elements are reported by
              <a href="#n88evaluate">n88evaluate</a>, as shown in this example:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>Analysis of yield function F:
    Yielded elements:
        count             : 2058
        min F             : -1.85E+01
        max F             : 1.08E-04
        rms F             : 7.77E+00
        min F/max stress  : -2.12E-01
        max F/max stress  : 1.23E-06
        rms F/max stress  : 8.88E-02</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>In light of the above discussion, the important value is <code>max F/max stress</code>: it can
              be used as a measure of the relative error of the plastic component
              of the solution.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="postprocessing">6. Post-Processing and Analysis</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="using_n88derivedfields">6.1. Calculating additional solution fields with n88derivedfields</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div class="paragraph">
            <p>The fundamental solution from <a href="#n88solver">n88solver</a> are the displacements on each node.
              However,
              this is often not the only value of interest. Subsequently running
              <a href="#n88derivedfields">n88derivedfields</a> on the <code>n88model</code> file will generate
              additional
              fields and add them to the active solution in the file.
            </p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>To check which solution fields are present in a <code>n88model</code> file, run</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>n88modelinfo --solutions your_model.n88model</pre>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The following are the additional fields that will be added to the <code>n88model</code>
              file by <a href="#n88derivedfields">n88derivedfields</a>.</p>
          </div>
          <div id="n88derivedfields_reaction_force" class="paragraph">
            <div class="title">ReactionForce</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The reaction force at each node, in the 3 coordinate directions
              (<em>f<sub>x</sub></em>,<em>f<sub>y</sub></em>,<em>f<sub>z</sub></em>). For a linear problem the reaction
              force
              is given by</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \mathbf{f} = \mathbf{K} \mathbf{x}
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>This is of course the same equation that the solver has solved, except that
              now we use it with the solution values for <strong>x</strong> (the
              displacements) to determine forces. If the solution is accurate, then the
              forces will be nearly
              all zero, except on degrees of freedom where a boundary condition
              (displacement or applied force) applies. Those therefore are the interesting
              values.</p>
          </div>
          <div id="n88derivedfields_strain" class="paragraph">
            <div class="title">Strain</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The strain at each element, given by &#949;<sub>xx</sub>,
              &#949;<sub>yy</sub>, &#949;<sub>zz</sub>, &#947;<sub>yz</sub>, &#947;<sub>zx</sub>, &#947;<sub>xy</sub>,
              where &#949;<sub>ii</sub> is the <em>engineering normal strain</em>
              along the axis direction <em>i</em>, and the &#947;<sub>ij</sub>
              are the <em>engineering shear strains</em>.</p>
          </div>
          <div class="paragraph">
            <p>Note that the field <code>Strain</code> is always the total strain, so that for
              elasto-plastic models, the elastic strain can be obtained by
              subtracting <code>PlasticStrain</code> from <code>Strain</code>.</p>
          </div>
          <div id="n88derivedfields_plastic_strain" class="paragraph">
            <div class="title">PlasticStrain</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The plastic strain at each element. The plastic strain is the
              irreversible strain that arises from further deformation once the
              elastic limits as defined by the yield surface as been reached.
              <code>PlasticStrain</code> has the same 6 components as <code>Strain</code>.
            </p>
          </div>
          <div id="n88derivedfields_stress" class="paragraph">
            <div class="title">Stress</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The stress at each element, given by
              &#963;<sub>xx</sub>, &#963;<sub>yy</sub>, &#963;<sub>zz</sub>, &#963;<sub>yz</sub>, &#963;<sub>zx</sub>,
              &#963;<sub>xy</sub> .</p>
          </div>
          <div class="paragraph">
            <p>Note that the stress can be obtained directly from the strain (and vice versa)
              using the material properties. See
              <a href="#elastic_material_properties">Elastic material properties</a>.
            </p>
          </div>
          <div id="n88derivedfields_von_mises_stress" class="paragraph">
            <div class="title">VonMisesStress</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The von Mises stress is a scalar value that is frequently used as a
              yield criterion. It is also used as a heuristic measure of the
              &#8220;magnitude&#8221; of the stress at a point, for example for the purpose of
              coloring a rendering according to stress concentration.
              It is defined on each element by</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \sigma_\nu^2 = \frac{1}{2} \left ( (\sigma_{xx} - \sigma_{yy})^2 + (\sigma_{yy} - \sigma_{zz})^2 +
              (\sigma_{zz} - \sigma_{xx})^2 \right ) + 3 \left ( \sigma_{yz}^2 + \sigma_{zx}^2 + \sigma_{xy}^2 \right )
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>It can also be expressed more concisely as a norm of the devatoric stresses.
              For details refer to any Mechanics of Solids textbook.</p>
          </div>
          <div id="n88derivedfields_strain_energy_density" class="paragraph">
            <div class="title">StrainEnergyDensity</div>
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The strain energy density is given by</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              U = \frac{1}{2} \, \left ( \sigma_{xx} \varepsilon_{xx} + \sigma_{yy} \varepsilon_{yy} + \sigma_{zz}
              \varepsilon_{zz} + \sigma_{yz} \gamma_{yz} + \sigma_{zx} \gamma_{zx} + \sigma_{xy} \gamma_{xy} \right )
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>This expression continues to be valid even for nonlinear elastoplastic
              models, provided that the strain values are limited to the elastic strain
              component.</p>
          </div>
          <div class="paragraph">
            <p>In a finite element context, the strain energy density is a scalar value
              defined on each element.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="extracting_fields">6.2. Exporting solution fields from the model file</h3>
          <div class="paragraph">
            <p>If <a href="#n88postfaim">n88postfaim</a>, which is described in the next section,
              provides the values which are of interest to you, you will not need the
              numerical data of the solution fields. In other cases, where you want do some custom post-processing on
              the
              solution, it will be necessary to obtain the solution fields as array data.
              There are several options for obtaining the field data from an <code>n88model</code>
              file:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Use <a href="#n88extractfields">n88extractfields</a> to export fields to a text file.
                  This is
                  convenient because text files are easy to understand and easy to import.
                  The trade off is that text files are inefficient in terms of disk space
                  required, and relatively slow to write and read.</p>
              </li>
              <li>
                <p>Use the <code>vtkbone</code> object <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelReader.html">vtkboneN88ModelReader</a>
                  . This requires
                  writing some code in C++ or Python.</p>
              </li>
              <li>
                <p>Import the data into third party software that can read NetCDF4 or HDF5.</p>
              </li>
            </ol>
          </div>
        </div>
        <div class="sect2">
          <h3 id="using_n88postfaim">6.3. Obtaining standard post-processing values with n88postfaim</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p><code>n88postfaim</code> is a tool performs a number of standard analyses
              on a solved <code>n88model</code> file. It produces a text file output
              reporting summarized results in a table format.</p>
          </div>
          <div class="sect3">
            <h4 id="_running_n88postfaim">6.3.1. Running n88postfaim</h4>
            <div class="paragraph">
              <p><code>n88postfaim</code> requires that <a href="#n88derivedfields">n88derivedfields</a> has been
                run on the solved <code>n88model</code> file because it makes use of the derived fields.
                If any field is required for a particular table, but is not present in
                the <code>n88model</code> file, <code>n88postfaim</code> will simply silently skip that table.</p>
            </div>
            <div class="paragraph">
              <p>In the usual case, running <code>n88postfaim</code> is as simple as,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88postfaim -o analysis.txt radius_slice82_bending.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This will generate an output file <code>analysis.txt</code>. The output is a report of
                values that are commonly of interest in finite element calculations.</p>
            </div>
            <div class="paragraph">
              <p>The sections below will discuss a few important options that affect
                the output of <code>n88postfaim</code>. For a complete list of arguments supported by
                <code>n88postfaim</code>, see the <a href="#n88postfaim">Command Reference chapter</a>.
              </p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>The model <code>radius_slice82_bending.n88model</code>, which is used in
                        examples below, can be generated from the data file <code>radius_slice82.aim</code>,
                        with the following command:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>n88modelgenerator --test=bending radius_slice82.aim</pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>This data file is provided for the <a href="#radius_slice_tutorial">radius
                          compression tutorial</a>, but here we apply a bending test so that
                        angular analysis quantities such as torques are defined. This model
                        also has been segmented to have more than one material ID. In
                        particular, ID 127 is used to identify cortical bone and
                        ID 100 is used to identify cancellous bone.</p>
                    </div>
                    <div class="paragraph">
                      <p>This applies to all tables except <a href="#n88postfaim_plastic_strain">Plastic Strain</a>,
                        for which the flag <code>--plasticity=vonmises,40</code> was added to the
                        <code>n88modelgenerator</code>
                        arguments.
                      </p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="sect4">
              <h5 id="analysis_sets">Specifying post-processing node and element sets</h5>
              <div class="paragraph">
                <p>

                </p>
              </div>
              <div class="paragraph">
                <p>Some of the quantities that <code>n88postfaim</code> reports are calculated with
                  respect to defined node and/or element sets. For example, for a
                  compression test, the forces on the top and bottom surfaces are of interest.
                  If we define node and element sets corresponding to these surfaces,
                  then <code>n88postfaim</code> will, amongst other things, calculate these forces for us.
                  Post-processing node and element sets must be defined during
                  the model generation stage.
                  If you used <a href="#n88modelgenerator">n88modelgenerator</a>, some relevant node and
                  element sets have automatically been defined. For custom models generated
                  with <code>vtkbone</code> see
                  <a href="#creating_sets">Creating node and element sets</a>.
                </p>
              </div>
              <div class="paragraph">
                <p>The available sets in an <code>n88model</code> file can be discovered with
                  <a href="#n88modelinfo">n88modelinfo</a>. For example, the command
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>n88modelinfo --sets --element_sets radius_slice82_bending.n88model</pre>
                </div>
              </div>
              <div class="paragraph">
                <p>gives the following output:</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>NodeSets:
----------------------------------------------------------------------

  Name : face_z0
  Part : Part1
  NumberOfNodes : 40032

  Name : face_z1
  Part : Part1
  NumberOfNodes : 25991

  Name : face_x0
  Part : Part1
  NumberOfNodes : 15

  Name : face_x1
  Part : Part1
  NumberOfNodes : 14

  Name : face_y0
  Part : Part1
  NumberOfNodes : 27

  Name : face_y1
  Part : Part1
  NumberOfNodes : 17
----------------------------------------------------------------------

ElementSets:
----------------------------------------------------------------------

  Name : face_z0
  Part : Part1
  NumberOfElements : 28999

  Name : face_z1
  Part : Part1
  NumberOfElements : 21210

  Name : face_x0
  Part : Part1
  NumberOfElements : 8

  Name : face_x1
  Part : Part1
  NumberOfElements : 6

  Name : face_y0
  Part : Part1
  NumberOfElements : 12

  Name : face_y1
  Part : Part1
  NumberOfElements : 8
----------------------------------------------------------------------</pre>
                </div>
              </div>
              <div class="paragraph">
                <p>Given that the sets of interest have been generated and are present in
                  the <code>n88model</code> file, we must tell <code>n88postfaim</code>
                  which to actually use. Much of the time this is also done at the
                  model generation stage. For models generated with <code>vtkbone</code>, see
                  <a href="#setting_post_processing_parameters">Setting post-processing parameters</a>.
                  <a href="#n88modelgenerator">n88modelgenerator</a> also writes a list of
                  sets to use into the <code>n88model</code> file, but note that this list often
                  does not encompass all of the available sets.
                  For example, for any type of compression test, <a href="#n88modelgenerator">n88modelgenerator</a>
                  will only list the top and bottom surface sets to be used for post-processing,
                  although it generates node and element sets for all faces. In a <a href="#confined_test">confined
                    test</a> the forces on the side
                  faces are sometimes of interest, so this may be a case where the
                  list of post-processing sets as generated by
                  <a href="#n88modelgenerator">n88modelgenerator</a> is insufficient. <code>n88postfaim</code> has
                  command line options that allow us to override the list of post-processing sets from the
                  <code>n88model</code> file. Here an example:
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>n88postfaim --node_sets face_y0,face_y1 --element_sets face_y0,face_y1 -o analysis.txt radius_slice82_bending.n88model</pre>
                </div>
              </div>
              <div class="paragraph">
                <p>Note that for each node set, <code>n88postfaim</code> requires the corresponding element
                  set. For example,
                  for a set consisting of all the nodes on a surface, we also require the
                  set of all
                  elements on the surface. <code>n88modelgenerator</code> (and <code>vtkbone</code> objects
                  which generate sets automatically)
                  will generate sets such that the corresponding node and element sets have the
                  same names. If this is the case, that we have matching node and element sets,
                  then a simpler but equivalent version of the above example command is</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>n88postfaim --sets face_y0,face_y1 -o analysis.txt radius_slice82_bending.n88model</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="analysis_rotation_center">Specifying a rotation center</h5>
              <div class="paragraph">
                <p>


                </p>
              </div>
              <div class="paragraph">
                <p>Certain quantities, such as rotations and torques, are calculated relative
                  to a reference point, or center. This reference point can be specified in
                  a number of ways:</p>
              </div>
              <div class="olist arabic">
                <ol class="arabic">
                  <li>
                    <p>For <a href="#bending_test">bending</a> and <a href="#torsion_test">torsion</a> tests,
                      <a href="#n88modelgenerator">n88modelgenerator</a> will
                      write a default rotation center into the <code>n88model</code> file, which will be
                      located at the center of mass of the model.
                    </p>
                  </li>
                  <li>
                    <p><a href="#n88modelgenerator">n88modelgenerator</a> supports an argument
                      <a href="#n88modelgenerator_central_axis">central_axis</a> that allows the
                      reference point to be specified, as numerical coordinates or
                      as the center of mass or the center of bounds.
                      The reference value will be written to the
                      <code>n88model</code> file. If specified, it overrides the above default.
                    </p>
                  </li>
                  <li>
                    <p><code>n88postfaim</code> supports an argument <a
                        href="#n88postfaim_rotation_center">rotation_center</a>
                      that can be used to specify the reference point. If specified,
                      it overrides any value in the <code>n88model</code> file.</p>
                  </li>
                </ol>
              </div>
              <div class="paragraph">
                <p>If the rotation point is not specified in one of these ways, then the
                  corresponding analysis values and tables will not be calculated
                  or reported. This simplifies the analysis output for models for
                  which these values are typically not of interest
                  (<em>e.g.</em> an axial compression test).</p>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="analysis_file_def">6.3.2. Description of output tables</h4>
            <div class="paragraph">
              <p>Below are listed the tables provided in the output of <code>n88postfaim</code>.</p>
            </div>
            <div class="paragraph">
              <p>Note that not all values or tables are generated for every model. Angular
                values are generated only if a rotation center is defined (see the above section),
                while a break-down of values per material is only performed in the
                case that more than one material is defined.</p>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    <code>n88postfaim</code> knows nothing of the Test Frame coordinate system
                    (see <a href="#test_orientation">Test Orientation</a>). All coordinate
                    directions in the analysis file are in the original Data Frame coordinate
                    system. An exception is that the names of the sets, as assigned
                    by <code>n88modelgenerator</code> and listed in <a
                      href="#sets_generated_by_vtkboneApplyTestBase">Node and element sets generated by
                      vtkboneApplyTestBase</a>,
                    are obtained from their orientation in the Test Frame.
                  </td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    The table numbering is not fixed. Tables are simply numbered
                    sequentially at the time they are generated. You cannot rely on a certain
                    table number consistently identifying a given table.
                  </td>
                </tr>
              </table>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_model_input">Model Input</h5>
              <div class="paragraph">
                <p>This table lists general parameters of the model input.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 1: Model Input
----------------------------------------------------------------------------
Filename:                                    radius_slice82_bending.n88model
Element dim X:                                                         0.082
Element dim Y:                                                         0.082
Element dim Z:                                                         0.082
Number of elements:                                                  2667590
Number of nodes:                                                     3816642
Number of nodes per element:                                               8
Dimension of problem:                                                      3</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_materials">Materials</h5>
              <div class="paragraph">
                <p>
                </p>
              </div>
              <div class="paragraph">
                <p>The material definitions as assigned to each material ID are
                  listed. In addition, a very brief summary of the material definition
                  is provided, in particular the material type is shown, and a rough
                  indication of the stiffness is given by the parameter <em>E<sub>ii_max</sub></em>.
                  For an isotropic material, <em>E<sub>ii_max</sub></em> is the Youngs modulus <em>E</em>, while
                  for an orthotropic material it is the maximum of <em>E<sub>xx</sub></em>, <em>E<sub>yy</sub></em>, and
                  <em>E<sub>zz</sub></em> .
                  In addition, the total number of elements in the model having each
                  material ID are shown, giving a measure of the distribution of the materials.
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 2: Materials
----------------------------------------------------------------------------
Number of materials:                                                       2
----------------------------------------------------------------------------
   m     ID   Name                  Type                 E_ii_max   Elements
   1      100 NewMaterial1          LinearIsotropic        6829.0    1351375
   2      127 NewMaterial1          LinearIsotropic        6829.0    1316215</pre>
                </div>
              </div>
              <div class="paragraph">
                <p>Note that in this example, it happens that although we have two material IDs
                  (defined during segmentation),
                  they are both assigned to the same material definition.</p>
              </div>
              <div class="paragraph">
                <p>The output will be somewhat different for <a href="#material_arrays">material arrays</a>,
                  since material arrays correspond to a range of material IDs.
                  Here is an example:</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 2: Materials
----------------------------------------------------------------------------
Number of materials:                                                       1
----------------------------------------------------------------------------
   m     ID   Name                  Type                 E_ii_max   Elements
   1   1..127 NewMaterial1_homminga LinearIsotropic             -       7087</pre>
                </div>
              </div>
              <div class="paragraph">
                <p>Also, for any of the tables described below for which sub-tables
                  for each material ID are generated, it is to be noted that
                  all material IDs corresponding to a material array are grouped
                  into a single subtable. This prevents the amount of output
                  from becoming excessive.</p>
              </div>
              <div class="paragraph">
                <p>If you require more details about the materials defined,
                  we recommend that you use the
                  <a href="#n88modelinfo">n88modelinfo</a> command. For example
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>n88modelinfo --materials radius_slice82_bending.n88model</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_postprocessing_sets">Post-processing sets</h5>
              <div class="paragraph">
                <p>The sets used by <code>n88postfaim</code> are reported. See
                  <a href="#analysis_sets">Specifying post-processing node and element sets</a> .
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 3: Post-processing Sets
----------------------------------------------------------------------------
Number of sets:                                                            2
----------------------------------------------------------------------------
     n   Node set name              Nodes   Element set name        Elements
     1   face_z1                    25991   face_z1                    21210
     2   face_z0                    40032   face_z0                    28999</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_strain">Strain</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Statistics of the six strain components for each element,
                  namely the three engineering normal strains
                  <code>&#949;<sub>xx</sub></code>, <code>&#949;<sub>yy</sub></code>, <code>&#949;<sub>zz</sub></code>
                  and the three engineering shear strains
                  <code>&#947;<sub>yz</sub></code>, <code>&#947;<sub>zx</sub></code>, <code>&#947;<sub>xy</sub></code>
                </p>
              </div>
              <div class="paragraph">
                <p>For models with elastoplastic material definitions, the strain given here
                  is the total strain (<em>i.e.</em> the sum of the elastic and plastic strains).</p>
              </div>
              <div class="paragraph">
                <p>The strains are summarized in terms of statistical quantities, namely average, standard deviation,
                  minimum
                  and maximum, and skewness and kurtosis. The median strain, 5<sup>th</sup>,
                  25<sup>th</sup>, 75<sup>th</sup> and 95<sup>th</sup> percentile strains are reported. Finally, the
                  fraction of strains that are below zero (<em>i.e.</em> compressive strain) is
                  reported in addition to the median and average strain of the negative
                  (compressive) and positive (tensile) strain.</p>
              </div>
              <div class="paragraph">
                <p>The summary of strains is provided for all elements in the model as well as
                  being summarized for each specific material ID in the case of
                  more than one defined material. In this example model,
                  this provides a
                  means of considering differences in the summary of strains in the cortex
                  (<em>e.g.</em> material ID 127) separately from trabecular (<em>e.g.</em> material ID 100)
                  bone.</p>
              </div>
              <div class="paragraph">
                <p>Strain is dimensionless.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 4: Strain
----------------------------------------------------------------------------
m:                                                                       ALL
Material ID:                                                             ALL
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -3.190E-04 -1.595E-04  5.405E-04 -7.457E-06 -2.048E-03 -3.663E-05
std_dev     2.099E-03  1.544E-03  6.843E-03  2.937E-03  4.153E-03  1.403E-03
minimum    -2.150E-02 -1.771E-02 -6.982E-02 -5.306E-02 -7.585E-02 -3.298E-02
maximum     1.734E-02  2.012E-02  7.162E-02  4.388E-02  4.232E-02  2.821E-02
skewness   -7.522E-01 -1.510E-01  4.932E-01 -8.113E-01 -9.770E-01  6.881E-02
kurtosis    1.184E+00  2.076E+00  3.916E-01  7.286E+00  3.599E+00  7.669E+00
median     -3.340E-05 -8.509E-06 -1.603E-05  1.328E-04 -9.438E-04 -3.450E-05
perc05     -4.750E-03 -2.959E-03 -9.953E-03 -5.143E-03 -9.573E-03 -2.163E-03
perc25     -1.070E-03 -8.355E-04 -3.705E-03 -9.735E-04 -4.461E-03 -6.944E-04
perc75      7.472E-04  5.336E-04  3.638E-03  1.404E-03  3.828E-04  6.016E-04
perc95      2.837E-03  2.399E-03  1.409E-02  4.025E-03  3.254E-03  2.158E-03
----------------------------------------------------------------------------
m:                                                                         1
Material ID:                                                             100
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -3.326E-04 -2.304E-04  9.468E-04 -2.711E-04  8.815E-05 -1.733E-05
std_dev     1.403E-03  1.296E-03  4.307E-03  2.824E-03  2.967E-03  1.433E-03
minimum    -2.057E-02 -1.771E-02 -4.567E-02 -5.306E-02 -5.665E-02 -3.298E-02
maximum     1.734E-02  2.012E-02  6.647E-02  4.388E-02  4.232E-02  2.821E-02
skewness   -9.487E-01 -5.547E-01  8.212E-01 -8.143E-01 -8.987E-01 -5.569E-02
kurtosis    5.294E+00  4.647E+00  4.572E+00  1.121E+01  9.849E+00  1.051E+01
median     -9.529E-05 -5.413E-05  1.652E-04 -1.758E-05  7.115E-05 -7.972E-06
----------------------------------------------------------------------------
m:                                                                         2
Material ID:                                                             127
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -3.049E-04 -8.671E-05  1.232E-04  2.632E-04 -4.240E-03 -5.645E-05
std_dev     2.629E-03  1.760E-03  8.690E-03  3.025E-03  4.054E-03  1.372E-03
minimum    -2.150E-02 -1.667E-02 -6.982E-02 -3.880E-02 -7.585E-02 -1.501E-02
maximum     1.322E-02  1.588E-02  7.162E-02  3.375E-02  2.053E-02  2.617E-02
skewness   -6.398E-01 -3.604E-02  4.942E-01 -8.592E-01 -1.007E+00  2.105E-01
kurtosis   -2.316E-01  7.413E-01 -7.675E-01  4.422E+00  3.701E+00  4.171E+00
median      1.376E-04  9.347E-05 -2.057E-03  6.242E-04 -4.044E-03 -9.920E-05</pre>
                </div>
              </div>
              <div class="paragraph">
                <p><em>Skewness</em> is a measure of the asymmetry of the distribution of element stresses.
                  <em>Kurtosis</em> is a measure of the &#8220;peakedness&#8221; of the distribution of element
                  stresses.
                </p>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_plastic_strain">Plastic Strain</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>For models with elastoplastic material definitions, a table of plastic strain
                  statistics is produced. To obtain the elastic strain, subtract the plastic
                  strain from the total strain, given in the previous table.</p>
              </div>
              <div class="paragraph">
                <p>The presentation of the plastic strain the same format as for the total strain.</p>
              </div>
              <div class="paragraph">
                <p>Plastic strain is dimensionless.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>============================================================================
Table 5: Plastic Strain
----------------------------------------------------------------------------
m:                                                                       ALL
Material ID:                                                             ALL
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -3.774E-04 -1.827E-04  5.602E-04 -2.491E-05 -1.051E-03 -4.255E-05
std_dev     2.441E-03  1.858E-03  4.103E-03  2.424E-03  3.285E-03  9.990E-04
minimum    -6.403E-02 -6.146E-02 -9.844E-02 -1.862E-01 -1.647E-01 -1.062E-01
maximum     4.919E-02  4.925E-02  1.223E-01  1.418E-01  1.750E-01  7.206E-02
skewness   -1.856E+00 -7.680E-01  1.454E+00 -3.772E+00 -3.946E+00  2.007E+00
kurtosis    1.172E+01  1.926E+01  1.147E+01  2.736E+02  8.944E+01  2.992E+02
median      0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00
perc05     -5.234E-03 -3.476E-03 -5.073E-03 -2.307E-03 -6.641E-03 -1.150E-03
perc25      0.000E+00  0.000E+00  0.000E+00  0.000E+00 -9.717E-04 -5.828E-06
perc75      0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00
perc95      2.724E-03  2.380E-03  8.666E-03  2.226E-03  5.648E-04  9.484E-04
----------------------------------------------------------------------------
m:                                                                         1
Material ID:                                                             100
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -2.516E-04 -2.011E-04  4.528E-04 -1.325E-04 -3.686E-05  2.363E-06
std_dev     1.569E-03  1.441E-03  2.876E-03  2.513E-03  2.424E-03  9.711E-04
minimum    -6.084E-02 -6.146E-02 -9.844E-02 -1.862E-01 -1.647E-01 -1.062E-01
maximum     4.919E-02  4.925E-02  1.223E-01  1.418E-01  1.750E-01  6.961E-02
skewness   -4.158E+00 -3.443E+00  3.959E+00 -5.739E+00 -3.362E+00  5.373E-02
kurtosis    5.475E+01  5.797E+01  5.475E+01  4.191E+02  3.503E+02  4.686E+02
median      0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00  0.000E+00
----------------------------------------------------------------------------
m:                                                                         2
Material ID:                                                             127
............................................................................
           epsilon_xx epsilon_yy epsilon_zz   gamma_yz   gamma_zx   gamma_xy
average    -5.066E-04 -1.638E-04  6.704E-04  8.559E-05 -2.093E-03 -8.867E-05
std_dev     3.085E-03  2.205E-03  5.060E-03  2.324E-03  3.700E-03  1.025E-03
minimum    -6.403E-02 -4.663E-02 -7.185E-02 -1.076E-01 -1.294E-01 -2.535E-02
maximum     3.604E-02  4.230E-02  1.107E-01  8.670E-02  3.620E-02  7.206E-02
skewness   -1.209E+00  4.159E-02  7.811E-01 -1.199E+00 -4.140E+00  3.735E+00
kurtosis    4.603E+00  8.276E+00  3.481E+00  6.679E+01  4.224E+01  1.604E+02
median      0.000E+00  0.000E+00  0.000E+00  0.000E+00 -5.584E-04  0.000E+00
============================================================================</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_stress">Stress</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Statistics of the six stress components for each element, including the normal stresses
                  (<code>&#963;<sub>xx</sub></code>, <code>&#963;<sub>yy</sub></code>, <code>&#963;<sub>zz</sub></code>)
                  and shear
                  stresses (<code>&#963;<sub>yz</sub></code>, <code>&#963;<sub>zx</sub></code>,
                  <code>&#963;<sub>xy</sub></code>).
                </p>
              </div>
              <div class="paragraph">
                <p>The presentation of the stress follows the same format as
                  described for the <a href="#n88postfaim_strain">Strain table</a>.</p>
              </div>
              <div class="paragraph">
                <p>Units depend on inputs, but typically displacements are expressed in
                  millimeters (mm), forces in newtons (N), and stresses in MPa. See
                  <a href="#note_about_units">Note about units</a>.
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 6: Stress
----------------------------------------------------------------------------
m:                                                                       ALL
Material ID:                                                             ALL
............................................................................
             sigma_xx   sigma_yy   sigma_zz   sigma_yz   sigma_zx   sigma_xy
average    -8.027E-01 -5.936E-01  3.083E+00 -1.959E-02 -5.378E+00 -9.621E-02
std_dev     1.315E+01  1.070E+01  5.073E+01  7.714E+00  1.091E+01  3.686E+00
minimum    -2.380E+02 -2.004E+02 -5.796E+02 -1.394E+02 -1.992E+02 -8.662E+01
maximum     1.682E+02  1.632E+02  5.517E+02  1.153E+02  1.111E+02  7.410E+01
skewness   -5.570E-01  4.960E-01  4.539E-01 -8.113E-01 -9.770E-01  6.881E-02
kurtosis    5.054E+00  4.068E+00  4.404E-01  7.286E+00  3.599E+00  7.669E+00
median     -4.492E-01 -3.217E-01 -2.718E-01  3.489E-01 -2.479E+00 -9.062E-02
perc05     -2.244E+01 -1.716E+01 -7.487E+01 -1.351E+01 -2.514E+01 -5.681E+00
perc25     -7.064E+00 -5.724E+00 -2.868E+01 -2.557E+00 -1.172E+01 -1.824E+00
perc75      5.727E+00  2.874E+00  2.650E+01  3.687E+00  1.005E+00  1.580E+00
perc95      1.979E+01  1.944E+01  1.020E+02  1.057E+01  8.546E+00  5.668E+00
----------------------------------------------------------------------------
m:                                                                         1
Material ID:                                                             100
............................................................................
             sigma_xx   sigma_yy   sigma_zz   sigma_yz   sigma_zx   sigma_xy
average     6.726E-01  3.019E-01  6.486E+00 -7.120E-01  2.315E-01 -4.551E-02
std_dev     1.009E+01  7.009E+00  3.126E+01  7.418E+00  7.793E+00  3.764E+00
minimum    -1.424E+02 -1.625E+02 -3.346E+02 -1.394E+02 -1.488E+02 -8.662E+01
maximum     1.682E+02  1.632E+02  5.062E+02  1.153E+02  1.111E+02  7.410E+01
skewness    3.128E-03  4.413E-01  7.910E-01 -8.143E-01 -8.987E-01 -5.569E-02
kurtosis    8.270E+00  1.406E+01  4.799E+00  1.121E+01  9.849E+00  1.051E+01
median      8.653E-02 -4.944E-03  8.636E-01 -4.619E-02  1.869E-01 -2.094E-02
----------------------------------------------------------------------------
m:                                                                         2
Material ID:                                                             127
............................................................................
             sigma_xx   sigma_yy   sigma_zz   sigma_yz   sigma_zx   sigma_xy
average    -2.317E+00 -1.513E+00 -4.100E-01  6.914E-01 -1.114E+01 -1.483E-01
std_dev     1.554E+01  1.341E+01  6.472E+01  7.944E+00  1.065E+01  3.604E+00
minimum    -2.380E+02 -2.004E+02 -5.796E+02 -1.019E+02 -1.992E+02 -3.943E+01
maximum     1.506E+02  1.427E+02  5.517E+02  8.865E+01  5.392E+01  6.873E+01
skewness   -5.163E-01  5.951E-01  4.757E-01 -8.592E-01 -1.007E+00  2.105E-01
kurtosis    3.035E+00  1.604E+00 -7.415E-01  4.422E+00  3.701E+00  4.171E+00
median     -3.882E+00 -2.612E+00 -1.698E+01  1.640E+00 -1.062E+01 -2.606E-01</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_strain_energy_density">Strain Energy Density</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Statistics on the strain energy density are reported. See <a
                    href="#n88derivedfields_strain_energy_density">StrainEnergyDensity</a> in <a
                    href="#n88derivedfields">n88derivedfields</a>
                  for a definition of the strain energy density.</p>
              </div>
              <div class="paragraph">
                <p>For models with elastoplastic material definitions, the strain energy density
                  is the elastic strain energy density. (Plastic strain energy density is not
                  well defined: the work done producing a given a plastic strain is mostly
                  converted into heat energy and cannot be retreived again as mechanical work.)</p>
              </div>
              <div class="paragraph">
                <p>The presentation of the strain energy density follows the same format as
                  described for the <a href="#n88postfaim_strain">Strain table</a>.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 7: Strain Energy Density
----------------------------------------------------------------------------
m:                                                                       ALL
Material ID:                                                             ALL
............................................................................
average     2.091E-01
std_dev     3.039E-01
minimum     5.704E-15
maximum     2.186E+01
skewness    4.357E+00
kurtosis    9.588E+01
median      8.209E-02
perc05      4.649E-04
perc25      1.149E-02
perc75      2.918E-01
perc95      8.012E-01
----------------------------------------------------------------------------
m:                                                                         1
Material ID:                                                             100
............................................................................
average     9.484E-02
std_dev     2.108E-01
minimum     5.704E-15
maximum     1.662E+01
skewness    7.458E+00
kurtosis    1.533E+02
median      1.993E-02
----------------------------------------------------------------------------
m:                                                                         2
Material ID:                                                             127
............................................................................
average     3.264E-01
std_dev     3.382E-01
minimum     1.353E-12
maximum     2.186E+01
skewness    3.914E+00
kurtosis    9.946E+01
median      2.203E-01</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_von_mises_stress">Von Mises Stress</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Statistics on the von Mises stress are reported.
                  See <a href="#n88derivedfields_von_mises_stress">VonMisesStress</a> in <a
                    href="#n88derivedfields">n88derivedfields</a>
                  for a definition of the von Mises stress.</p>
              </div>
              <div class="paragraph">
                <p>The presentation of the von Mises stress follows the same format as
                  for the <a href="#n88postfaim_strain">Strain table</a>.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 8: Von Mises Stress
----------------------------------------------------------------------------
m:                                                                       ALL
Material ID:                                                             ALL
............................................................................
average     3.920E+01
std_dev     3.147E+01
minimum     9.139E-06
maximum     4.915E+02
skewness    8.934E-01
kurtosis    5.365E-01
median      3.204E+01
perc05      2.624E+00
perc25      1.251E+01
perc75      5.944E+01
perc95      9.817E+01
----------------------------------------------------------------------------
m:                                                                         1
Material ID:                                                             100
............................................................................
average     2.455E+01
std_dev     2.461E+01
minimum     9.139E-06
maximum     4.237E+02
skewness    1.832E+00
kurtosis    4.876E+00
median      1.643E+01
----------------------------------------------------------------------------
m:                                                                         2
Material ID:                                                             127
............................................................................
average     5.423E+01
std_dev     3.065E+01
minimum     1.460E-04
maximum     4.915E+02
skewness    4.575E-01
kurtosis    1.077E-01
median      5.081E+01</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_nodal_displacements">Nodal Displacements</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>The three components of displacements (<code>u<sub>x</sub></code>,
                  <code>u<sub>y</sub></code>, <code>u<sub>z</sub></code>) are reported. A sub-table is
                  generated for each post-processing node set. Statistics of
                  the displacements are reported over all the nodes of each
                  set.
                </p>
              </div>
              <div class="paragraph">
                <p>Units are self-consistent, but are typically millimeters (mm). See
                  <a href="#note_about_units">A note about units</a>.
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 9: Nodal Displacements
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   ux         uy         uz
average     0.000E+00  0.000E+00  8.493E-03
std_dev     0.000E+00  0.000E+00  3.727E-02
minimum     0.000E+00  0.000E+00 -6.689E-02
maximum     0.000E+00  0.000E+00  7.695E-02
median      0.000E+00  0.000E+00  7.534E-03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   ux         uy         uz
average     0.000E+00  0.000E+00  8.176E-03
std_dev     0.000E+00  0.000E+00  5.033E-02
minimum     0.000E+00  0.000E+00 -8.768E-02
maximum     0.000E+00  0.000E+00  1.392E-01
median      0.000E+00  0.000E+00  1.250E-02</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_nodal_forces">Nodal Forces</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>The three components of force (<code>F<sub>x</sub></code>, <code>F<sub>y</sub></code>,
                  <code>F<sub>z</sub></code>) are reported. A sub-table is
                  generated for each post-processing element set. The forces
                  are provided giving statistical values over all elements in the set.
                </p>
              </div>
              <div class="paragraph">
                <p>Units depend on inputs, but are typically Newtons (N). See
                  <a href="#note_about_units">A note about units</a>.
                </p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 10: Nodal Forces
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Fx         Fy         Fz
total      -8.767E+02 -3.222E+00  5.025E+02
average    -3.373E-02 -1.240E-04  1.933E-02
std_dev     7.261E-02  3.936E-02  3.336E-01
minimum    -8.420E-01 -3.484E-01 -2.614E+00
maximum     4.068E-01  6.302E-01  1.399E+00
median     -2.464E-02 -4.476E-04  4.233E-03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   Fx         Fy         Fz
total       8.773E+02  3.162E+00 -5.032E+02
average     2.191E-02  7.898E-05 -1.257E-02
std_dev     7.203E-02  5.302E-02  2.423E-01
minimum    -3.655E-01 -3.909E-01 -1.399E+00
maximum     4.889E-01  3.679E-01  1.196E+00
median      8.519E-04 -2.016E-03  3.913E-03</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_nodal_twist">Nodal Twist</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Similar to nodal displacements, statistics on the angular displacements
                  for each node set are provided.</p>
              </div>
              <div class="paragraph">
                <p>The angular displacements are defined as the projected angles between the
                  vector to the initial location of the node and the vector to the displaced
                  location of the node. The vectors are projected onto a plane perpendicular to
                  the specified axis. This is shown in <a href="#projected_angle">Figure 14</a>, which defines
                  <code>ROTx</code>. <code>p</code> is the initial position of the node, and <code>p'</code> is the
                  displaced
                  position of the node, as calculated by FE. These two vectors are projected
                  onto the <em>y-z</em> plane, and the angle between them in this plane is defined as
                  <code>ROTx</code>. <code>ROTy</code> and <code>ROTz</code> are similarly defined. Angular
                  displacements are
                  relative to the center of rotation; this is shown as <code>p<sub>0</sub></code> in
                  <a href="#projected_angle">Figure 14</a>. See <a href="#analysis_rotation_center">specifying a
                    rotation center</a>.
                </p>
              </div>
              <div id="projected_angle" class="imageblock">
                <div class="content">
                  <img src="images/projected_angle.png" alt="projected angle">
                </div>
                <div class="title">Figure 14. Definition of projected angle ROTx</div>
              </div>
              <div class="admonitionblock note">
                <table>
                  <tr>
                    <td class="icon">
                      <img src="./images/icons/note.png" alt="Note">
                    </td>
                    <td class="content">
                      <code>ROTx</code>, <code>ROTy</code>, <code>ROTz</code> do not form a set of Euler angles.
                    </td>
                  </tr>
                </table>
              </div>
              <div class="paragraph">
                <p>Nodes that are within an exclusion radius (default value 10<sup>-6</sup>) of the rotation center
                  are excluded from the calculation, as the angular displacement of a node at the
                  rotation center (initial or final position) is not defined.</p>
              </div>
              <div class="paragraph">
                <p>Units are radians (rad).</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 11: Nodal Twist
----------------------------------------------------------------------------
Twist measured relative to:                              66.049 54.985 4.510
Exclusion radius:                                                    1.0E-06
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                 ROTx       ROTy       ROTz
n               25991      25991      25991
average     5.978E-04 -3.252E-03  0.000E+00
std_dev     3.424E-03  2.180E-03  0.000E+00
minimum    -8.422E-03 -6.893E-03  0.000E+00
maximum     7.567E-03 -6.411E-07  0.000E+00
median      6.324E-04 -3.274E-03  0.000E+00
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                 ROTx       ROTy       ROTz
n               40032      40032      40032
average    -7.531E-04  4.147E-03  0.000E+00
std_dev     4.239E-03  2.363E-03  0.000E+00
minimum    -1.014E-02  6.411E-07  0.000E+00
maximum     9.126E-03  8.099E-03  0.000E+00
median     -3.388E-04  4.688E-03  0.000E+00</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_nodal_torques">Nodal Torques</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>Similar to nodal twist, statistics on the the nodal torques for each node set are reported.</p>
              </div>
              <div class="paragraph">
                <p>As with the nodal twist results, torques are calculated relative to a
                  reference point. See <a href="#analysis_rotation_center">specifying a rotation center</a>.</p>
              </div>
              <div class="paragraph">
                <p>Units depend on inputs, but are typically in newton-millimeters (Nmm).
                  See <a href="#note_about_units">Note about units</a>.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 12: Nodal Torques
----------------------------------------------------------------------------
Torque measured relative to:                             66.049 54.985 4.510
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Tx         Ty         Tz
total       1.094E+04 -3.683E+04 -1.796E+03
average     4.210E-01 -1.417E+00 -6.909E-02
std_dev     2.312E+00  1.847E+00  7.455E-01
minimum    -5.420E+00 -2.341E+01 -9.929E+00
maximum     3.204E+01  1.070E-01  5.532E+00
median      2.183E-02 -6.439E-01 -2.549E-03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   Tx         Ty         Tz
total      -1.094E+04  3.682E+04  1.796E+03
average    -2.733E-01  9.198E-01  4.486E-02
std_dev     1.487E+00  1.466E+00  5.923E-01
minimum    -1.111E+01 -3.944E+00 -3.920E+00
maximum     7.102E+00  1.176E+01  5.743E+00
median     -4.530E-03  3.083E-01 -2.374E-03</pre>
                </div>
              </div>
            </div>
            <div class="sect4">
              <h5 id="n88postfaim_load_sharing">Load Sharing</h5>
              <div class="paragraph">
                <p></p>
              </div>
              <div class="paragraph">
                <p>A calculation of the fraction of the load carried by each material ID is
                  provided, based on the nodal forces in each associated node set.</p>
              </div>
              <div class="paragraph">
                <p>The portion of total load on the node set
                  is reported for each material in terms of nodal forces (<em>F<sub>x</sub></em>,
                  <em>F<sub>y</sub></em>, <em>F<sub>z</sub></em>).
                  Nodal torques (<em>T<sub>x</sub></em>, <em>T<sub>y</sub></em>, <em>T<sub>z</sub></em>) are also
                  reported if a center of rotation
                  is defined. See <a href="#analysis_rotation_center">specifying a rotation center</a>.
                  The total
                  forces and torques are also reported, and it should be noted that are the same as
                  reported in <a href="#n88postfaim_nodal_forces">Nodal Forces</a> and <a
                    href="#n88postfaim_nodal_torques">Nodal Torques</a>
                </p>
              </div>
              <div class="paragraph">
                <p>The method used to determine the loads carried by each material requires
                  identifying the nodes belonging to each material. Since material definitions
                  are based on elements, some nodes are shared by more than one
                  material. In these cases, the
                  forces and torques associated with the node are proportionally assigned to
                  each material definition.</p>
              </div>
              <div class="listingblock">
                <div class="content">
                  <pre>Table 13: Load Sharing
----------------------------------------------------------------------------
Torque measured relative to:                          66.0487 54.9845 4.5100
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                  material          Fx          Fy          Fz
                       100 -2.2735E+02  2.2343E+01  1.5989E+02 <img src="./images/icons/callouts/1.png" alt="1">
                       127 -6.4936E+02 -2.5565E+01  3.4260E+02
                ----------  ----------  ----------  ----------
                     total -8.7671E+02 -3.2224E+00  5.0249E+02 <img src="./images/icons/callouts/2.png" alt="2">

                  material          Tx          Ty          Tz
                       100  1.3237E+03 -4.6310E+03 -5.3746E+02
                       127  9.6174E+03 -3.2197E+04 -1.2583E+03
                ----------  ----------  ----------  ----------
                     total  1.0941E+04 -3.6828E+04 -1.7958E+03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                  material          Fx          Fy          Fz
                       100 -8.0150E+01  1.3524E+02 -2.2235E+02
                       127  9.5741E+02 -1.3208E+02 -2.8086E+02
                ----------  ----------  ----------  ----------
                     total  8.7726E+02  3.1616E+00 -5.0321E+02

                  material          Tx          Ty          Tz
                       100 -4.4656E+03  1.5580E+04  1.3600E+02
                       127 -6.4737E+03  2.1242E+04  1.6599E+03
                ----------  ----------  ----------  ----------
                     total -1.0939E+04  3.6823E+04  1.7959E+03</pre>
                </div>
              </div>
              <div class="colist arabic">
                <table>
                  <tr>
                    <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                    <td>Represents the total force attributed to material definition 127 (cortical
                      bone in this model).</td>
                  </tr>
                  <tr>
                    <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                    <td>This result is the same as the total <code>F<sub>z</sub></code> in
                      <a href="#n88postfaim_nodal_forces">Nodal Forces</a>.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="tabulate_analysis">6.4. Tabulating results from analysis files</h3>
          <div class="paragraph">
            <p>The analysis file generated by <a href="#n88postfaim">n88postfaim</a> is intended to be human-readable.
              If you run several
              similar models, it is common to want to tabulate certain numerical results in
              spreadsheet format. It is possible, but tiresome, to open the analysis
              file for each solved model individually and manually search for the desired
              numbers.
              To make this process more efficient, we provide the tool
              <a href="#n88tabulate">n88tabulate</a>. See <a href="#n88tabulate">n88tabulate</a>. This tool extracts
              certain specified values from any number of analysis files and collates
              them into a tabular format suitable for importing into a spreadsheet.
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="tutorials">7. Tutorials</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>This chapter presents a number of tutorials to help you learn the
            Faim finite element tools.</p>
        </div>
        <div class="paragraph">
          <p>A zip file containing the data files used for the tutorials, as well as
            the tutorial scripts, can be downloaded from <a href="http://numerics88.com/n88/downloads/"
              class="bare">http://numerics88.com/n88/downloads/</a> .</p>
        </div>
        <div class="paragraph">
          <p>The first series of tutorials introduces
            the standard work flow for Faim, where standard models as generated by
            <a href="#n88modelgenerator">n88modelgenerator</a> are desired. These
            tutorials are:
          </p>
        </div>
        <div class="olist arabic">
          <ol class="arabic">
            <li>
              <p><a href="#cube_tutorial">An introductory tutorial: compressing a solid cube</a></p>
            </li>
            <li>
              <p><a href="#radius_slice_tutorial">Compression test of a radius bone slice</a></p>
            </li>
            <li>
              <p><a href="#radius_bending_tutorial">Bending test of a radius bone with an uneven surface</a></p>
            </li>
          </ol>
        </div>
        <div class="paragraph">
          <p>These are intended to be followed in order, as each one builds on the
            previous.</p>
        </div>
        <div class="paragraph">
          <p>Following these introductory tutorials is a series dealing with more advanced topics.</p>
        </div>
        <div class="paragraph">
          <p>There is a tutorial that introduces models with nonlinear elasto-plastic material properties.</p>
        </div>
        <div class="olist arabic">
          <ol class="arabic">
            <li>
              <p><a href="#radius_bending_elastoplastic_tutorial">Bending of a radius bone with elasto-plastic material
                  properties.</a></p>
            </li>
          </ol>
        </div>
        <div class="paragraph">
          <p>Then there are a series of tutorials which present the building of custom models using
            <code>vtkbone</code>. This series is intended only for those who find
            <a href="#n88modelgenerator">n88modelgenerator</a> insufficiently flexible for their needs. The tutorials
            in this series are:
          </p>
        </div>
        <div class="olist arabic">
          <ol class="arabic">
            <li>
              <p><a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using vtkbone</a></p>
            </li>
            <li>
              <p><a href="#cantilever_tutorial">Deflection of a cantilevered beam; adding custom boundary conditions and
                  loads</a></p>
            </li>
            <li>
              <p><a href="#cantilever_elastoplastic_tutorial">A cantilevered beam with elastoplastic material
                  properties</a></p>
            </li>
            <li>
              <p><a href="#screw_pullout_tutorial">Advanced custom model tutorial: a screw pull-out test</a></p>
            </li>
            <li>
              <p><a href="#longitudinal_fe_with_vtkbone_tutorial">Radius compression with transformed boundary
                  conditions for longitudinal bone strength estimates</a></p>
            </li>
          </ol>
        </div>
        <div class="paragraph">
          <p>Finally, some <a href="#additional_examples">additional examples</a> are provided
            with the distribution. These are not described in the manual, but demonstrate addition concepts or
            functionality.</p>
        </div>
        <div class="sect2">
          <h3 id="cube_tutorial">7.1. Introductory tutorial: Compressing a solid cube</h3>
          <div class="paragraph">
            <p>We start with a very simple example, where we compress a uniform
              homogenous cube. This tutorial will demonstrate:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>How to use the standard test generator <code>n88modelgenerator</code> to generate a
                  finite element model suitable for input to the solver.</p>
              </li>
              <li>
                <p>How to solve the model.</p>
              </li>
              <li>
                <p>How to use ParaView to visualize the model and the solution.</p>
              </li>
              <li>
                <p>How to identify key values in the analysis file.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>The data file is <code>cube6x6x6.vti</code>. It can be found in the <code>data</code> folder of
              the the tutorial zip file available for download from <a href="http://numerics88.com/n88/downloads/"
                class="bare">http://numerics88.com/n88/downloads/</a> .
              We recommend that you copy it to a temporary working
              directory for this tutorial.</p>
          </div>
          <div class="paragraph">
            <p>You can examine this data file, which we will be using as input, with
              ParaView. To do this, open ParaView
              and select the menu item <span class="menuseq"><b class="menu">File</b>&#160;<b class="caret">&#8250;</b>
                <b class="menuitem">Open</b></span>, and navigate to the location
              of <code>cube6x6x6.vti</code>. You will notice that after selecting the file and
              clicking <b class="button">OK</b>, nothing is displayed, although the file name now appears in
              the <em>Pipeline Browser</em>. This is typical for ParaView, and allows options
              relevant to the source to be modified before the data is actually loaded.
              In this case, there are no options we are concerned with, so we can go ahead and click
              <b class="button">Apply</b> (on the Properties tab of the Pipeline browser) to actually
              load the data. At first, only a wire-frame cube will be displayed, which
              shows the extents of the image data. To actually inspect the data, we
              are going to change the drop-down list on the toolbar that currently displays
              <em>Outline</em> to <em>Points</em>. This results in a display of a number of points
              in space, as shown in <a href="#cube6_points">Figure 15</a>.
            </p>
          </div>
          <div id="cube6_points" class="imageblock">
            <div class="content">
              <img src="images/cube6_points.png" alt="cube6 points">
            </div>
            <div class="title">Figure 15. Points view of 6x6x6 cube.</div>
          </div>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>If you&#8217;re alert, you&#8217;ll notice that in fact there are 7&#215;7&#215;7
              points. This is due to the fact that the actual data for this data file
              is associated with the <em>Cells</em>, to use VTK terminology, rather than the
              <em>Points</em>. The points shown are therefore in this case the corners of the cells. To make
              this clear, change the view again from <em>Points</em> to <em>Surface with Edges</em>.
              This will now look like <a href="#cube6_surface">Figure 16</a>. (Click and drag in the image
              window of ParaView to rotate the object - experiment with both the right
              and left mouse buttons, and also while holding down any of the Shift, Control and Alt keys). We are going
              to create
              a finite element model where every <em>Cell</em>, or small constituent cube
              from <a href="#cube6_surface">Figure 16</a> will become one element in the finite element model.
            </p>
          </div>
          <div id="cube6_surface" class="imageblock">
            <div class="content">
              <img src="images/cube6_surface.png" alt="cube6 surface">
            </div>
            <div class="title">Figure 16. Surface with edges view of 6x6x6 cube.</div>
          </div>
          <div class="paragraph">
            <p>For a simulated test, we are going to apply a compression test using <code>n88modelgenerator</code> to
              this data file. There are a
              number of different standard compression tests, as described in
              <a href="#standard_tests">Standard Tests</a>. Here we are going to use the <a href="#axial_test">axial</a>
              variation. In an axial compression
              test, the sides are unconstrained and the top and bottom surfaces constrained
              laterally, as if they experience a high contact friction with the
              imaginary surfaces applying the compression.
            </p>
          </div>
          <div class="sect3">
            <h4 id="_generating_the_model">7.1.1. Generating the model</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>The first step is to open a Terminal (on Windows a Command Prompt or PowerShell).
                Make sure both that the Faim is on the Path, as described in <a href="#how_to_run">How to run the
                  solvers</a>,
                and also that you have activated the Anaconda python environment for <code>n88tools</code>,
                as described in <a href="#install_n88tools">Install n88tools and vtkbone</a>.</p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    If you close the terminal part way through this tutorial, and
                    then pick it up again later by opening a new terminal, you will have to
                    re-set the environment variables and re-activate the conda environment.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Assuming that you have copied the data file <code>cube6x6x6.vti</code> to your current
                working directory, the command to generate the model is</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --test=axial cube6x6x6.vti</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Since we haven&#8217;t specified otherwise, <code>n88modelgenerator</code> will select all
                default parameters, including default material properties (homogeneous
                material with isotropic Young&#8217;s modulus of 6829 MPa and Poisson&#8217;s ratio 0.3),
                and a displacement,
                applied to the top surface in the <em>z</em> direction, numerically equivalent to
                an apparent level strain of -0.01 (the minus indicates compressive strain).
                Refer to <a href="#n88modelgenerator">the section on
                  n88modelgenerator</a> for details on setting parameters differently if you wish
                to do so.</p>
            </div>
            <div class="paragraph">
              <p>Here is the output when we run it:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator Version 10.0
Copyright (c) 2010-2025, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91

input_file   = cube6x6x6.vti
output_file  = cube6x6x6_axial.n88model
connectivity_filter           = on
test                          = axial
test_axis                     = z
normal_strain                 = -0.01
top_surface                   = intersection
bottom_surface                = intersection
material_table                = homogeneous
youngs_modulus                = 6829
poissons_ratio                = 0.3

   0.00 Reading input data.
   0.02 Read 343 points.
   0.02 Image bounds:
        0.0000 6.0000 0.0000 6.0000 0.0000 6.0000
   0.02 Applying connectivity filter.
   0.02 Masked out 0 unconnected voxels.
   0.02 Converting to hexahedral mesh.
   0.02 Generated 216 hexahedrons.
   0.02 Constructing material table.
   0.02 Material table has 1 entry.
   0.02 Constructing finite element model.
   0.02 Model bounds:
        0.0000 6.0000 0.0000 6.0000 0.0000 6.0000
   0.02 Generated the following constraints:
          bottom_fixed : 147 nodes
          top_fixed : 98 nodes
          top_displacement : 49 nodes
   0.02 Writing Numerics88 Model file cube6x6x6_axial.n88model .
   0.03 Done.</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We now have a file <code>cube6x6x6_axial.n88model</code> that can be used directly as
                input to the solver.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solving_the_model">7.1.2. Solving the model</h4>
            <div class="paragraph">
              <p>Having now defined the problem, we can solve it, and do some post-processing,
                all in one step with <a href="#faim">faim</a>.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim cube6x6x6_axial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The output is:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Model has 216 elements.
Model contains only linear material definitions.

Choosing n88solver_slt.
Running solver: n88solver_slt cube6x6x6_axial.n88model
n88solver_slt version 10.0
Copyright (c) 2010-2025, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91
Problem:
  active solution       = (none)
  active problem        = Problem1
  number of elements    = 216
  number of nodes       = 343
Solver engine:
  engine                = mt
  precision             = double
  threads               = 1
Convergence parameters:
  convergence measure   = set
  convergence tolerance = 1e-06
  convergence window    = 16
  maximum iterations    = 30000

    time (s)      iter        conv
         0.0        30     5.4E-07

Convergence measure tolerance reached.
Number of linear iterations = 30
Peak data allocation : 75.8 kiB

Running field calculator: n88derivedfields cube6x6x6_axial.n88model
n88derivedfields version 10.0
Copyright (c) 2010-2025, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91
Problem:
  active solution       = Solution1
  active problem        = Problem1
  number of elements    = 216
  number of nodes       = 343
Solver engine:
  precision             = single
Peak data allocation: 19.8 kiB

Running analysis tool: n88postfaim --output_file cube6x6x6_axial_analysis.txt cube6x6x6_axial.n88model</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_visualizing_the_results_with_paraview">7.1.3. Visualizing the results with ParaView</h4>
            <div class="paragraph">
              <p>First ensure that ParaView is set up with the plugins to read Numerics88
                files, as described in <a href="#paraview_plugins">Installing and using the Numerics88 plugins for
                  ParaView</a>. Assuming that the plugins are loaded correctly,
                <code>cube6x6x6_axial.n88model</code> can be opened directly with ParaView. When we
                first open this file, it looks very similar to the
                input data. However, if we go to the <em>Information</em> tab in the Pipeline
                Browser, we can see that there are now several Data Arrays, <em>Displacement</em>,
                <em>ReactionForce</em>, etc&#8230;&#8203; as shown in <a href="#cube6_arrays">Figure 17</a>. Notice that
                the
                icon next the the array name indicates whether the data is on <em>Points</em>
                or <em>Cells</em>, which is equivalent in finite element terminology to <em>Nodes</em> and
                <em>Elements</em>, respectively.
              </p>
            </div>
            <div id="cube6_arrays" class="imageblock">
              <div class="content">
                <img src="images/cube6_arrays.png" alt="cube6 arrays">
              </div>
              <div class="title">Figure 17. Solved 6x6x6 cube with Data Arrays.</div>
            </div>
            <div class="paragraph">
              <p>There are many ways to visualize the data. As a simple example, choose
                <em>Displacement</em> from the drop-down menu on the toolbar that currently
                shows <em>_MaterialID</em>. Also click the <b class="button">Toggle Color Legend Visibility</b>
                button on the toolbar (on the very left side). ParaView should now
                look like <a href="#cube6_displacement">Figure 18</a>. Notice that a new drop-down
                box appears that shows <em>Magnitude</em>. This occurs because the Displacements
                are a vector quantity. Experiment with changing this to
                <em>Z</em>, <em>X</em> and <em>Y</em>.
              </p>
            </div>
            <div id="cube6_displacement" class="imageblock">
              <div class="content">
                <img src="images/cube6_displacement.png" alt="cube6 displacement">
              </div>
              <div class="title">Figure 18. Solved 6x6x6 cube colored by Displacement.</div>
            </div>
            <div class="paragraph">
              <p>Although we now have the cube colored by Displacement, the object is shown
                in its undeformed unloaded shape. To visualize the deformations, we can use
                the <em>Warp By Vector</em> tool. There is an icon for this on the bottom
                Toolbar. Because we have imposed a small strain, -0.01, it will be hard to
                see. The <em>Warp By Vector</em> tool however allows us to apply a Scale Factor.
                We will set this to 10, so that the displacements are amplified by a factor
                of 10. The results are shown in <a href="#cube6_warped">Figure 19</a>, where the compression
                and outward bulging of the sides are clearly seen. In this figure, we
                have, in addition to applying the Warp By Vector tool, re-enabled
                the display of the original <code>cube6x6x6_axial.n88model</code>, which was
                automatically disabled by ParaView when we connected a filter object to it.
                We then set its display type to <em>Outline</em>, resulting in the white
                box outline in <a href="#cube6_warped">Figure 19</a>, which indicates the original undeformed
                box shape.</p>
            </div>
            <div id="cube6_warped" class="imageblock">
              <div class="content">
                <img src="images/cube6_warped.png" alt="cube6 warped">
              </div>
              <div class="title">Figure 19. Solved 6x6x6 cube shown with exaggerated displacement using the Warp By
                Vector tool.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_obtaining_numerical_values_from_the_analysis_file">7.1.4. Obtaining numerical values from the
              analysis file</h4>
            <div class="paragraph">
              <p>A typical result we want to obtain with a compression test is the object
                apparent stiffness. Numerically the stiffness is the net external force
                divided by the displacement. We can find the displacement and force on the top
                surface from the analysis file, <code>cube6x6x6_axial_analysis.txt</code>. This file is
                a text file, and can be opened with any text
                editor. Refer to <a href="#analysis_file_def">the section on post-processing with n88postfaim</a>
                for the complete explanation of the values available.</p>
            </div>
            <div class="paragraph">
              <p>The displacement is obtained from table <a href="#n88postfaim_nodal_displacements">Nodal
                  Displacements</a>. The
                displacements in this table are listed according to node set.</p>
            </div>
            <div class="paragraph">
              <p><code>n88modelgenerator</code> has defined some standard node sets (for a complete
                list see <a href="#creating_sets">Creating node and element sets</a> in the chapter
                on Preparing Models with <code>vtkbone</code>.) Here the node sets that are relevant
                are the two surfaces to which the boundary conditions are applied, namely
                the top and bottom surfaces, <em>face_z1</em> and <em>face_z0</em>, respectively.
                The analysis file has been generated using these two node sets.
                If we examine the Nodal Displacements table of
                <code>cube6x6x6x_axial_analysis.txt</code>, as shown in <a href="#analysis_uz">Figure 20</a>, we see
                that the top node set has a uniform displacement in the <em>z</em> direction of
                -0.06 mm. The relevant number is circled in red. Notice also that the
                minimum and maximum are the same so all nodes of this set are equally
                displaced, as we expect, since this is in fact a boundary
                condition. The other node set is the nodes of the bottom
                surface, and it has constant displacement of 0.
              </p>
            </div>
            <div id="analysis_uz" class="imageblock">
              <div class="content">
                <img src="images/cube6_analysis_uz_hr.png" alt="cube6 analysis uz hr">
              </div>
              <div class="title">Figure 20. uz components in Nodal Displacements table of the analysis file.</div>
            </div>
            <div id="analysis_fz" class="imageblock">
              <div class="content">
                <img src="images/cube6_analysis_fz_hr.png" alt="cube6 analysis fz hr">
              </div>
              <div class="title">Figure 21. Fz components in Nodal Forces table of the analysis file.</div>
            </div>
            <div class="paragraph">
              <p>Similarly to the table for displacements, table <a href="#n88postfaim_nodal_forces">Nodal Forces</a>
                shows forces, summed over the defined node sets. Here the relevant
                value is -2651 N, as shown in <a href="#analysis_fz">Figure 21</a>. The apparent stiffness of the
                cube is therefore</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \frac{-2651 \: N}{-0.06 \: mm} = 4.42 \! \times \! 10^5 N/mm
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>Is this value reasonable? We can estimate what we should get. Completely
                ignoring lateral expansion and Poisson&#8217;s ratio, we can do a quick estimate
                that the stiffness of a homogeneous cube should be approximately,</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                k = \frac{E A}{h}
                = \frac { [ 6829 \: N/mm^2 ] [ 6 \: mm ]^2 } { [ 6 mm ] }
                = 4.10 \! \times \! 10^5 N/mm
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>This is close to what we obtained from the finite element model. The
                difference arises from the fact that the finite element model takes account
                of the complicated lateral expansion (bulging of the sides) that occurs in
                an axial test, while our simple back-of-the-envelope calculation assumes uniaxial
                conditions (<em>i.e.</em>, no lateral constraint on the top and bottom boundary surfaces).</p>
            </div>
            <div class="paragraph">
              <p>This concludes the cube tutorial. You have learned how
                to generate standard models from image data using <code>n88modelgenerator</code>,
                how to solve the models, how to visualize the models using ParaView,
                and how to do some elementary post-processing analysis.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="radius_slice_tutorial">7.2. Tutorial: Compression test of a radius bone slice</h3>
          <div class="paragraph">
            <p>In the previous tutorial, we saw how to generate a finite element model from
              an image file using <a href="#n88modelgenerator">n88modelgenerator</a>, how
              to solve it, how to visualize the results, and how obtain some relevant
              numerical results. In this tutorial, we are going to generate and solve
              a similar compression test. Instead of
              a small contrived image, we will be using a real data file obtained
              from a microCT scan of a distal radius bone. We will also provide more detail
              about the steps along the way, and be introduced to some of the tools that
              aid in examining and verifying models.</p>
          </div>
          <div class="paragraph">
            <p>In detail, this tutorial will demonstrate:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>How to use <a href="#n88modelinfo">n88modelinfo</a> to obtain information about
                  <code>n88model</code> files, and in particular to trace back exactly how they were
                  generated and processed.
                </p>
              </li>
              <li>
                <p>How to examine the residuals to evaluate the accuracy of the solution.</p>
              </li>
              <li>
                <p>How to quantify the load sharing between the two types of bone, cortical
                  bone and trabecular bone.</p>
              </li>
              <li>
                <p>How to compress data files using <a href="#n88copymodel">n88copymodel</a> for
                  efficient storage.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>The data file is <code>radius_slice82.aim</code>, and it is obtained with the tutorial
              data available from <a href="http://numerics88.com/n88/downloads/"
                class="bare">http://numerics88.com/n88/downloads/</a> .
              This is a large image file of
              325&#215;437&#215;110 voxels in size. It was obtained with a scan
              resolution of 82 micrometers. The tutorial will be demonstrated using
              this data file. However, a reduced-resolution file, <code>radius_slice164.aim</code>, is
              also provided. The resolution has been reduced to an effective 164 micrometers,
              resulting in a much smaller data file with dimensions 163&#215;219&#215;55.
              If you are working on a computer with limited memory, or are just impatient, then you can follow along
              using the smaller file.</p>
          </div>
          <div class="paragraph">
            <p>Before proceeding, ensure that the Numerics88 plugins for ParaView are loaded as
              described in <a href="#paraview_plugins">Install the Numerics88 plugins for ParaView</a>.</p>
          </div>
          <div class="paragraph">
            <p>In the previous tutorial you might recall that the data file was a VTK
              image data file, and that it explicitly had the data on the <em>Cells</em>
              rather than on the <em>Points</em>. Most image file formats make no such
              distinction, but ParaView always uses one or the other, as it affects how the
              data are rendered. In fact if you
              experiment you will determine that certain filters will work in one case and
              not the other, or that other filters will work differently depending on
              whether the data are on the Points or the Cells. As an example, the
              <em>Contour</em> filter requires data on the Points, while the <em>Threshold</em> filter
              generally only gives the results you expect with the data on the Cells.
              You will see when opening an AIM file that in the Properties
              tab we have a couple of options, which are <em>Data on Cells</em> and <em>Pad</em>. This
              is shown in <a href="#radius_slice_open">Figure 22</a>. For this tutorial we want to select
              <em>Data on Cells</em>, which is the default.
            </p>
          </div>
          <div id="radius_slice_open" class="imageblock">
            <div class="content">
              <img src="images/radius_slice_open.png" alt="radius slice open">
            </div>
            <div class="title">Figure 22. Options when opening an AIM file.</div>
          </div>
          <div class="paragraph">
            <p>Once you&#8217;ve opened the file <code>radius_slice82.aim</code> (or <code>radius_slice164.aim</code>)
              and clicked <b class="button">Apply</b>, locate the icon for the Threshold filter on the toolbar.
              Change the Lower Threshold to 1 before clicking <b class="button">Apply</b>, as shown in
              <a href="#radius_slice_threshold">Figure 23</a>; Scalars should be set to <em>AIMData</em>.
            </p>
          </div>
          <div id="radius_slice_threshold" class="imageblock">
            <div class="content">
              <img src="images/radius_slice_threshold.png" alt="radius slice threshold">
            </div>
            <div class="title">Figure 23. The threshold filter.</div>
          </div>
          <div class="paragraph">
            <p>Now change the <em>Representation</em> drop-down box to <em>Surface</em> and the <em>Color by</em>
              drop-down box to <em>AIMData</em>. Also turn on the legend by clicking the
              <b class="button">Toggle Color Legend Visibility</b> button. After rotating the image
              (click and drag in the image window) to get a good viewing angle, this
              should look something like <a href="#radius_slice_image">Figure 24</a>. You can see that this
              data file has been segmented such that the cortical bone has material ID 127
              and the trabecular bone has material ID 100.
            </p>
          </div>
          <div id="radius_slice_image" class="imageblock">
            <div class="content">
              <img src="images/radius_slice_image.png" alt="radius slice image">
            </div>
            <div class="title">Figure 24. Input image for the radius slice tutorial.</div>
          </div>
          <div class="sect3">
            <h4 id="_generating_the_model_2">7.2.1. Generating the model</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>As before, we recommend copying the data file <code>radius_slice82.aim</code> into a
                temporary working directory. The command to generate the model is</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --test=uniaxial radius_slice82.aim</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The resulting model file will be named <code>radius_slice82_uniaxial.n88model</code>.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Don&#8217;t forget that before running <code>n88modelgenerator</code>, make sure that
                    Faim is on the Path, as described in <a href="#how_to_run">How to run the solvers</a>,
                    and also that you have activated the Anaconda python environment for <code>n88tools</code>,
                    as described in <a href="#install_n88tools">Install n88tools and vtkbone</a>.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Before we solve it, we are going to examine
                this model file using <a href="#n88modelinfo">n88modelinfo</a>.
                You will find that <a href="#n88modelinfo">n88modelinfo</a> is a very useful tool
                for getting information about the models, and for tracing back how they
                were created and solved. <a href="#n88modelinfo">n88modelinfo</a> can be run like this,</p>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p><a href="#n88modelinfo">n88modelinfo</a> can generate quite a bit of output. We will
                shortly see how to reduce this to just the information that we are
                interested in. For now though, let&#8217;s look at the complete output.
                Comments follow below the example output.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>History:
----------------------------------------------------------------------
2016-Sep-15 14:49:17 Model created by n88modelgenerator version 8.0
----------------------------------------------------------------------

Log:
----------------------------------------------------------------------
2016-Sep-15 14:49:17
n88modelgenerator Version 8.0
Copyright (c) 2010-2016, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91

input_file   = radius_slice82.aim
output_file  = radius_slice82_uniaxial.n88model
connectivity_filter           = on
test                          = uniaxial
test_axis                     = z
normal_strain                 = -0.01
pin                           = off
top_surface                   = intersection
bottom_surface                = intersection
material_table                = homogeneous
youngs_modulus                = 6829
poissons_ratio                = 0.3

   0.02 Reading input data.
   0.05 Read 15849468 points.
   0.05 Image bounds:
        49.6920 76.3420 38.7040 74.5380 0.0000 9.0200
   0.05 Applying connectivity filter.
   0.66 Masked out 0 unconnected voxels.
   0.66 Converting to hexahedral mesh.
   1.56 Generated 2667590 hexahedrons.
   1.56 Constructing material table.
   1.86 Material table has 2 entries.
   1.86 Constructing finite element model.
   5.17 Model bounds:
        50.1020 76.0960 39.1140 74.2100 0.0000 9.0200
   5.17 Generated the following constraints:
          bottom_fixed : 40032 nodes
          top_displacement : 25991 nodes

----------------------------------------------------------------------

Active Settings:
----------------------------------------------------------------------
  Active Solution : None
  Active Problem : Problem1
  Active Part : Part1
----------------------------------------------------------------------

Materials:
----------------------------------------------------------------------

  Name : NewMaterial1
  Type : LinearIsotropic
  E : 6829.0
  nu : 0.3
----------------------------------------------------------------------

Parts:
----------------------------------------------------------------------

  Name : Part1
  NumberOfNodes : 3816642
  Hexahedrons :
    NumberOfNodesPerElement : 8
    NumberOfElements : 2667590
----------------------------------------------------------------------

Constraints:
----------------------------------------------------------------------

  Name : bottom_fixed
  Part : Part1
  Type : NodeAxisDisplacement
  NumberOfValues : 40032

  Name : top_displacement
  Part : Part1
  Type : NodeAxisDisplacement
  NumberOfValues : 25991

  Name : convergence_set
  Part : Part1
  Type : NodeAxisForce
  NumberOfValues : 25991
----------------------------------------------------------------------

NodeSets:
----------------------------------------------------------------------

  Name : face_z0
  Part : Part1
  NumberOfNodes : 40032

  Name : face_z1
  Part : Part1
  NumberOfNodes : 25991

  Name : face_x0
  Part : Part1
  NumberOfNodes : 15

  Name : face_x1
  Part : Part1
  NumberOfNodes : 14

  Name : face_y0
  Part : Part1
  NumberOfNodes : 27

  Name : face_y1
  Part : Part1
  NumberOfNodes : 17
----------------------------------------------------------------------

ElementSets:
----------------------------------------------------------------------

  Name : face_z0
  Part : Part1
  NumberOfElements : 28999

  Name : face_z1
  Part : Part1
  NumberOfElements : 21210

  Name : face_x0
  Part : Part1
  NumberOfElements : 8

  Name : face_x1
  Part : Part1
  NumberOfElements : 6

  Name : face_y0
  Part : Part1
  NumberOfElements : 12

  Name : face_y1
  Part : Part1
  NumberOfElements : 8
----------------------------------------------------------------------

Problems:
----------------------------------------------------------------------

  Name : Problem1
  Part : Part1
  Constraints : bottom_fixed,top_displacement
  ConvergenceSet : convergence_set
  PostProcessingNodeSets : face_z1,face_z0
  PostProcessingElementSets : face_z1,face_z0
----------------------------------------------------------------------

Solutions:
----------------------------------------------------------------------
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Some things to note about the output of <a href="#n88modelinfo">n88modelinfo</a>:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>The <em>History</em> is a useful field to see what programs were run to generate
                    or modify the file, and when.</p>
                </li>
                <li>
                  <p>The <em>Log</em> field is similar to the History, except that it gives far more
                    detailed information. Of particular note is that <a href="#n88modelgenerator">n88modelgenerator</a>
                    reports its complete configuration, including all parameters values relevant
                    to the particular test type, even ones which haven&#8217;t been explicitly
                    set, but are default values.</p>
                </li>
                <li>
                  <p>This file hasn&#8217;t been solved yet, so there is nothing in <em>Solutions</em>.</p>
                </li>
                <li>
                  <p>The sets defined for post-processing are <em>face_z1</em> and <em>face_z0</em>,
                    which are the top and bottom surfaces, respectively. We will need this
                    information later to interpret the results in the analysis file.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Now, as mentioned, that is a lot of output. Often we are interested in
                just part of the output. In this case, we can specify the bits we want.
                For example, to get just the History and the Log, we could do this,</p>
            </div>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --history --log radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    To discover what the valid arguments to <a href="#n88modelinfo">n88modelinfo</a> are,
                    you can either refer to the manual (See <a href="#n88modelinfo">n88modelinfo</a>), or you can
                    run <code>n88modelinfo --help</code>.
                  </td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>If you want the output of <a href="#n88modelinfo">n88modelinfo</a> to be saved in a file,
                        then run it like this</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>n88modelinfo radius_slice82_uniaxial.n88model &gt; info.txt</pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>This will direct the output of <a href="#n88modelinfo">n88modelinfo</a> to
                        the file <code>info.txt</code>.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solving_the_model_2">7.2.2. Solving the model</h4>
            <div class="paragraph">
              <p>From the previous tutorial, we know that we can use <a href="#faim">faim</a> to solve
                the model and perform so post-processing on it. <a href="#faim">faim</a> itself actually
                just calls three other programs to carry out the actual work. Usually it&#8217;s
                easiest to call <a href="#faim">faim</a>, but in this tutorial we are going to call
                the individual processing programs ourselves, so we can understand what
                <a href="#faim">faim</a> is doing.
              </p>
            </div>
            <div class="paragraph">
              <p>The first step carried out by <a href="#faim">faim</a> is to solve the model with <a
                  href="#n88solver">n88solver_slt</a>, which we can do with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88solver_slt radius_slice82_uniaxial.n88model <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The specification <code>slt</code> for the solver means that this is the solver for <em>small
                      strain</em>, <em>linear problems</em>, using a <em>material table</em>.</td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>This model will take some time to solve. If you have licensed the GPU solvers,
                        and have suitable hardware, then you probably would like to jump right
                        into using the GPU hardware. To do this, specify the <a href="#n88solver_engine">engine</a>
                        and <a href="#n88solver_device">device</a>. For example, for a system with two
                        compute-capable Nvidia cards, including the one being used for the display,
                        the command would be:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>n88solver_slt --engine=nv --device=0,1 radius_slice82_uniaxial.n88model</pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>If you have a system where the compute GPUs are distinct from the
                        video card used for the display, such as is typical for Nvidia Tesla hardware,
                        then the correct <a href="#n88solver_device">device</a> option for two
                        compute-capable Nvidia cards is more likely to be <code>--device=1,2</code> .</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We can see how this has modified the <code>n88model</code> file by running
                <a href="#n88modelinfo">n88modelinfo</a> again. To avoid the lengthy complete output,
                here we use arguments that show only the sections
                that have in fact changed
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --history --log --solutions radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The output is:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>History:
----------------------------------------------------------------------
2016-Sep-15 14:49:17 Model created by n88modelgenerator version 8.0
2016-Sep-15 15:22:54 Solved by n88solver_slt 8.0
----------------------------------------------------------------------

Log:
----------------------------------------------------------------------
2016-Sep-15 14:49:17
n88modelgenerator Version 8.0
Copyright (c) 2010-2016, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91

input_file   = radius_slice82.aim
output_file  = radius_slice82_uniaxial.n88model
connectivity_filter           = on
test                          = uniaxial
test_axis                     = z
normal_strain                 = -0.01
pin                           = off
top_surface                   = intersection
bottom_surface                = intersection
material_table                = homogeneous
youngs_modulus                = 6829
poissons_ratio                = 0.3

   0.02 Reading input data.
   0.05 Read 15849468 points.
   0.05 Image bounds:
        49.6920 76.3420 38.7040 74.5380 0.0000 9.0200
   0.05 Applying connectivity filter.
   0.66 Masked out 0 unconnected voxels.
   0.66 Converting to hexahedral mesh.
   1.56 Generated 2667590 hexahedrons.
   1.56 Constructing material table.
   1.86 Material table has 2 entries.
   1.86 Constructing finite element model.
   5.17 Model bounds:
        50.1020 76.0960 39.1140 74.2100 0.0000 9.0200
   5.17 Generated the following constraints:
          bottom_fixed : 40032 nodes
          top_displacement : 25991 nodes

2016-Sep-15 15:22:54
n88solver_slt version 8.0
Copyright (c) 2010-2015, Numerics88 Solutions Ltd.
Licensed to Numerics88 Solutions Ltd.; lic. no. 91
Problem:
  active solution       = (none)
  active problem        = Problem1
  number of elements    = 2667590
  number of nodes       = 3816642
Solver engine:
  engine                = nv
  precision             = double
  devices               = 0
Convergence parameters:
  convergence measure   = set
  convergence tolerance = 1e-06
  convergence window    = 312
  maximum iterations    = 30000
Convergence measure tolerance reached.
Number of linear iterations = 2761
Peak data allocation (system, device): 872 MiB, 692 MiB
----------------------------------------------------------------------

Solutions:
----------------------------------------------------------------------

  Name : Solution1
  Problem : Problem1
  Variables defined on nodes:
    Displacement
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Note things are worth noting here. In the <em>Log</em> section, we now have a record
                of the complete configuration of the solver (in this case, it happens to be default
                values). And in the <em>Solutions</em> section, we now have a solution (&#8220;Solution1&#8221;)
                with a field defined on the nodes, namely <em>Displacements</em>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_evaluating_the_accuracy_of_the_solution">7.2.3. Evaluating the accuracy of the solution</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>Faim includes a tool that can be used to evaluate the accuracy of the
                obtained solutions. This is discussed in the section
                <a href="#evaluating_solution_quality">Evaluating solution quality</a>. It can
                be run like this:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88evaluate radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="admonitionblock warning">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/warning.png" alt="Warning">
                  </td>
                  <td class="content">
                    The <code>n88evaluate</code> tool in its current implementation requires
                    far more memory than the solver itself does. For this example, it will
                    use almost 60GB of memory, while the solver needed less than 2GB. Therefore,
                    currently, <strong>you should not attempt to run this part of the tutorial on a machine
                      with less than 64GB of RAM</strong> .
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>The output is,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Analysis of solution displacements at boundary conditions:
    max err           : 0.00E+00
    rms err           : 0.00E+00

Analysis of forces (residuals):
    max err           : 1.28E-05
    rms err           : 9.35E-07
    max err/max force : 9.26E-06
    rms err/max force : 6.79E-07</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The meaning of these results is discussed in the section
                <a href="#evaluating_solution_quality">Evaluating solution quality</a>;
                briefly we can take the number <code>rms err/max force</code> as a measure
                of the relative error. Here it is 7&#215;10<sup>-7</sup>, which is acceptably small.
              </p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_obtaining_additional_solution_fields_with_n88derivedfields">7.2.4. Obtaining additional solution
              fields with n88derivedfields</h4>
            <div class="paragraph">
              <p>So far our solution consists only of displacements. Many other values
                are of interest, for example strains and stresses. These are calculated
                with <a href="#n88derivedfields">n88derivedfields</a>. It can be run very simply
                as,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88derivedfields radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now let&#8217;s have a look at what&#8217;s in the model file, using again
                <a href="#n88modelinfo">n88modelinfo</a>,
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --history --solutions radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The output is:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>History:
----------------------------------------------------------------------
2016-Sep-15 14:49:17 Model created by n88modelgenerator version 8.0
2016-Sep-15 15:22:54 Solved by n88solver_slt 8.0
2016-Sep-15 15:27:58 Processed by n88derivedfields 8.0
----------------------------------------------------------------------

Solutions:
----------------------------------------------------------------------

  Name : Solution1
  Problem : Problem1
  Variables defined on nodes:
    Displacement
    ReactionForce
  Variables defined on elements:
    Strain
    Stress
    StrainEnergyDensity
    VonMisesStress
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We have a number of new solution fields (or variables). Some are defined on
                the nodes and some defined on the elements. For details on these
                fields, see <a href="#n88derivedfields">n88derivedfields</a>.</p>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    Even if you are not interested in the numerical values of the
                    fields added by <a href="#n88derivedfields">n88derivedfields</a>, they are required
                    by <a href="#n88postfaim">n88postfaim</a>. Running the latter requires first running
                    the former.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_using_n88postfaim_to_generate_the_analysis_file">7.2.5. Using n88postfaim to generate the analysis
              file</h4>
            <div class="paragraph">
              <p>The final step performed by <a href="#faim">faim</a> is to call <a href="#n88postfaim">n88postfaim</a>,
                which does post-processing analysis. In the previous
                tutorial we saw that an analysis file was generated, which is a text
                file with a number of tables summarizing the numerical results.
                It is <a href="#n88postfaim">n88postfaim</a> that generates this text file. To run
                it on an <code>n88model</code> file that contains all the solution fields is
                once again straightforward in most cases,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88postfaim -o analysis.txt radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Note that unlike the previous commands, for <a href="#n88postfaim">n88postfaim</a>
                we actually have to specify an output file with <code>-o analysis.txt</code>.
                (If we don&#8217;t, then the output will just be printed to the terminal.)
                The <a href="#faim">faim</a> command, which combines <code>n88solver_slt</code>,
                <code>n88derivedfields</code>,
                and <code>n88postfaim</code>, would have automatically generated the filename
                <code>radius_slice82_uniaxial_analysis.txt</code> in this case, but that is
                getting a little bit lengthy, so we&#8217;ll just use <code>analysis.txt</code> here.
              </p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_determining_load_sharing_distribution_with_n88postfaim">7.2.6. Determining load sharing
              distribution with n88postfaim</h4>
            <div class="paragraph">
              <p>We already saw some of the values in the analysis file in the previous
                tutorial. For this tutorial, we are going to have a look at table
                <a href="#n88postfaim_load_sharing">Load Sharing</a>, as shown in
                <a href="#radius_slice_load_sharing">Figure 25</a>. We see that this table breaks up the
                total load on each node set according to material ID. In this case,
                we have material ID 127 being cortical bone, and material ID 100 being
                trabecular bone. Recall that the material properties are not different; it is
                merely a different labelling. Here we will see the reason for doing this.
                Recall also that the sets defined for post-processing are the
                top and the bottom surfaces. (If you&#8217;re not sure of this then the command
                <code>n88modelinfo --problems radius_slice82_uniaxial.n88model</code> will show you.)
                Because of the alignment in the CT scanner, in this case the top surface
                is proximal, and the bottom surface is distal.
                Referring to the values circled in red in <a href="#radius_slice_load_sharing">Figure 25</a>, we
                conclude that on the proximal surface of this radius bone slice, the
                proportion of the load carried by
                the trabecular bone is (-806) / (-5199) = 15.5%, while on the distal
                surface of the slice the proportion of the load carried by
                the trabecular bone is (3637) / (5199) = 70.0%.
              </p>
            </div>
            <div id="radius_slice_load_sharing" class="imageblock">
              <div class="content">
                <img src="images/radius_slice_load_sharing_hr.png" alt="radius slice load sharing hr">
              </div>
              <div class="title">Figure 25. Load Sharing table in analysis file.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_enabling_compression_for_large_model_files">7.2.7. Enabling compression for large model files</h4>
            <div class="paragraph">
              <p>The <code>n88model</code> file format supports compression internally and transparently.
                An <code>n88model</code> which contains compressed data can be read with every N88 tool just like
                any other <code>n88model</code>, without the need for the user to explicitly
                de-compress the data. Compression is not used by default, because it
                does have an increased calculation overhead for reading and writing
                (particularly for writing). However, once we are finished with processing
                the model, we typically want to keep the data around for archival
                purposes. It is recommended to compress the <code>n88model</code> files for archiving.
                This can be done with the <a href="#n88compress">n88compress</a> tool, as follows,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88compress radius_slice82_uniaxial.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>For this data file, enabling compression reduces its size from 438 MB to
                226 MB, a reduction of 47%.</p>
            </div>
            <div class="paragraph">
              <p>This ends the tutorial on a compression test on a radius bone slice. We
                were introduced to <a href="#n88modelinfo">n88modelinfo</a>, we solved a realistic
                model, we looked at using the residuals to evaluate the quality of the
                solution, we saw how to do load distribution calculations, and finally we
                learned how to enable compression to more efficiently
                store large <code>n88model</code> files.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="radius_bending_tutorial">7.3. Tutorial: Bending test of a radius bone with an uneven surface</h3>
          <div class="paragraph">
            <p>In the previous two tutorials, we had input images where the object in the
              image intersected the top and bottom bounds of the image, thus forming
              nice flat surfaces to which we could apply boundary conditions. This
              won&#8217;t always be the case. In this tutorial we&#8217;ll look at an object
              with a very uneven surface.</p>
          </div>
          <div class="paragraph">
            <p>In detail, this tutorial will demonstrate:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>How to use the uneven surface parameters of <a href="#n88modelgenerator">n88modelgenerator</a>.</p>
              </li>
              <li>
                <p>How to use <a href="#n88extractsets">n88extractsets</a> to examine our boundary
                  conditions.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>The data file is <code>radius82.aim</code>. As for the previous tutorial, there
              is also a reduced resolution version, <code>radius164.aim</code>. This data
              is particularly large, with the unreduced version having a
              size of 400&#215;350&#215;1100, or 154 million voxels; the resulting
              finite element model will have 14 million elements.</p>
          </div>
          <div class="paragraph">
            <p>The input image is shown in <a href="#radius_bending_input">Figure 26</a>.</p>
          </div>
          <div id="radius_bending_input" class="imageblock">
            <div class="content">
              <img src="images/radius_bending_input_hr.png" alt="radius bending input hr">
            </div>
            <div class="title">Figure 26. Radius bone image for bending test.</div>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>In this tutorial, we are no longer going to go into detail on how
                      to load and render data in ParaView, as we did in the previous two
                      tutorials. If you&#8217;re curious about how we generated that image of the
                      radius bone from the image file, these are the steps:</p>
                  </div>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>Open the <code>radius82.aim</code>, and before clicking Apply, deselect Data on Cells</p>
                      </li>
                      <li>
                        <p>Add a Contour filter. The default contour value (63.5) is fine.</p>
                      </li>
                      <li>
                        <p>In View Options, add a Headlight with value 0.06.</p>
                      </li>
                    </ol>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div class="sect3">
            <h4 id="_generating_the_model_with_n88modelgenerator">7.3.1. Generating the model with n88modelgenerator
            </h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>We are going to apply a bending test, as described in
                <a href="#bending_test">Bending test</a>. In order to identify the rough head of the
                bone as a boundary surface, we use the option
                <a href="#n88modelgenerator_bottom_surface">bottom_surface=visible</a>.
                As it implies, it will select nodes that are visible from a certain point of
                view. In this case, visible means &#8220;looking up from below&#8221; (effectively
                from an infinite distance, as parallel rays are used). Note that the
                distal head of the bone is in the &#8220;bottom&#8221; of the image, that is at
                smaller values of <em>z</em>. With this option, you can imagine that we might
                &#8220;see&#8221; parts of the object that are far away if they are not obscured by
                the foreground part of the image. We don&#8217;t want these distant parts of the object
                to form part of our boundary set, so when we use the
                <a href="#n88modelgenerator_bottom_surface">bottom_surface=visible</a>
                option, we nearly always want to set a depth limit as well using
                <a href="#n88modelgenerator_bottom_surface_maximum_depth">bottom_surface_maximum_depth</a>.
                In this case a suitable limit is 15 (units are the same as the image units,
                which are millimeters in this case). In general there may be a bit of
                experimentation to get the best depth limit.
              </p>
            </div>
            <div class="paragraph">
              <p>Since we have several parameters that we want to specify, it will be more
                convenient to create a configuration file for
                <a href="#n88modelgenerator">n88modelgenerator</a> than to specify them individually
                on the command line, as we have done previously. To do this, open
                a text editor, and create the following file. Save it to your working
                directory as <code>radius_bending_test.conf</code>.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># File: radius_bending_test.conf
#
# A configuration file for the radius bending tutorial.

input_file                    = radius82.aim
test                          = bending
bottom_surface                = visible
bottom_surface_maximum_depth  = 15</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Lines starting with # are comment lines: any line starting with # is
                ignored.</p>
            </div>
            <div class="paragraph">
              <p>We can now run <a href="#n88modelgenerator">n88modelgenerator</a> by specifying
                only the configuration file to use:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --config radius_bending_test.conf</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    Some text editors automatically add a <code>.txt</code> file extension.
                    You can either
                    subsequently rename the file, or just accept the <code>.txt</code> ending and
                    everywhere in this tutorial use the actual complete file name. Even more
                    confusing can be that many operating systems by default hide the
                    file extension in the file browser, so that you may save a file as
                    <code>radius_bending_test.conf</code>,
                    and the file browser in your operating system shows it with this name,
                    but its complete name is actually <code>radius_bending_test.conf.txt</code>. The
                    complete name must be specified to all Numerics88 tools.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_using_n88extractsets_to_obtain_and_visualize_boundary_conditions">7.3.2. Using n88extractsets to
              obtain and visualize boundary conditions</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>Because this is a non-trivial boundary set, we really want to
                visualize it to make sure it is reasonable and that it corresponds to
                what we expect. The
                best way to do this is with the tool <a href="#n88extractsets">n88extractsets</a>.
                This is the command to use:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88extractsets --constraints radius82_bending.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Here &#8220;--constraints&#8221; means both boundary conditions and applied loads.
                (We can leave off this option, but then we will get even more output files
                which in the present case we are not interested in.)</p>
            </div>
            <div class="paragraph">
              <p>The output looks like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Reading N88 Model file : radius82_bending.n88model
Writing constraint : radius82_bending_constraint_bottom_fixed.vtp
Writing constraint : radius82_bending_constraint_top_fixed.vtp
Writing constraint : radius82_bending_constraint_top_displacement.vtp
Writing constraint : radius82_bending_constraint_bottom_displacement.vtp</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We see that four files are generated, one for each constraint.
                These are VTK &#8220;PolyData&#8221; files, which consist of a set of &#8220;Vertices&#8221;
                (points), one for each node in the boundary condition set.
                <a href="#n88modelgenerator">n88modelgenerator</a> has separated the &#8220;fixed&#8221; constraints,
                which are degrees of freedom that are fixed at zero, and the
                &#8220;displacement&#8221; constraints, which are degrees of freedom that are fixed
                at some non-zero value. This distinction is sometimes useful, although
                the solver does not require it. In this case the nodes belonging to
                the constraint or boundary condition have <em>x</em> and <em>y</em> fixed at zero,
                and <em>z</em> at non-zero values. Thus the &#8220;fixed&#8221; and &#8220;displacement&#8221; sets
                will consist of the same set of nodes, but with different senses and
                values. We are going to open the file <code>radius82_bending_constraint_bottom_displacement.vtp</code>
                displacement and render it together with the contoured input image. This
                is shown in <a href="#radius_bending_boundary_points">Figure 27</a>. Each individual
                node belonging to the boundary condition is shown as a blue dot.
              </p>
            </div>
            <div id="radius_bending_boundary_points" class="imageblock">
              <div class="content">
                <img src="images/radius_bending_boundary_points_hr.png" alt="radius bending boundary points hr">
              </div>
              <div class="title">Figure 27. Set of nodes on bottom boundary condition for radius bone bending test.
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Generating this image is quite straightforward. We start with the
                        contoured input image data, as above, then we also open the file
                        <code>radius82_bending_constraint_bottom_displacement.vtp</code>, and simply render it as
                        &#8220;Solid Color&#8221;, setting the color to blue.
                      </p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>This looks good so we can go ahead and solve this model with <a href="#faim">faim</a>.
                Expect this to take a while - go grab a coffee.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim radius82_bending.n88model</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Just as in the previous model, if you have licensed the GPU solvers,
                        and have suitable GPU hardware, then you are going to want to use it.
                        <a href="#faim">faim</a> can take all the arguments that <a href="#n88solver">n88solver</a>
                        can so for example:
                      </p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>faim --engine=nv --device=0,1 radius82_bending.n88model</pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>where as before the device list will depend on the number of GPUs in
                        your system and their configuration .</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>As this is a very large file, once solved we should enable compression
                as in the previous tutorial. Compression can take a rather long time
                on a file this large. Remember that it is never necessary to uncompress
                an n88model file before reading it.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88compress radius82_bending.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>A comparison of the original input image with the solved model is shown
                in <a href="#radius_bending_bent">Figure 28</a>. Here we have used a Warp By Vector filter
                with a Scale Factor of 15 to make the distortion more evident to the
                eye.</p>
            </div>
            <div id="radius_bending_bent" class="imageblock">
              <div class="content">
                <img src="images/radius_bending_bent_hr.png" alt="radius bending bent hr">
              </div>
              <div class="title">Figure 28. Comparison of original input and solved model of bending radius bone, with
                15 times displacement amplification.</div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Generating an attractive rendering of the solved model (or any <code>n88model</code>
                        file) with ParaView takes a few additional steps. We saw that with an input image, we could use
                        the Contour filter to get a nice surface with curvature that reflects the
                        light in ways that give us visual clues about the shape of the object.
                        An <code>n88model</code> file by contrast consists of a collection of cubic voxels,
                        each of which has flat surfaces (however small they may be), all oriented the
                        same. A direct
                        rendering of it therefore lacks the visual lighting cues that we expect.
                        With a few additional steps, we can convert it to a smooth
                        surface with curvature. For <a href="#radius_bending_bent">Figure 28</a> we applied the
                        following steps (to the result of the Warp By Vector filter):</p>
                    </div>
                    <div class="olist arabic">
                      <ol class="arabic">
                        <li>
                          <p>Apply an Extract Surface filter. This converts the data from
                            an Unstructured Grid (in this case a bunch of Hexahedrons) to a surface
                            consisting of Polygons.</p>
                        </li>
                        <li>
                          <p>Apply a Smooth filter with Number of Iterations set to 300.</p>
                        </li>
                      </ol>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Another useful way to render this data is coloured by von Mises stress.
                See <a href="#n88derivedfields_von_mises_stress">VonMisesStress</a>.
                This is shown in <a href="#radius_bending_von_mises">Figure 29</a>.</p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    You will want to manually set the scale of the coloring for von Mises
                    stress, as the uneven contact surface has locally very high stresses, which
                    however are uninteresting (and even unphysical, as the microscopic contact
                    surface irregularities would yield). You can adjust the range by selecting
                    Color Map Editor from the View menu, then click on the Rescale to Custom Range
                    button to the left of the color map plot.
                  </td>
                </tr>
              </table>
            </div>
            <div id="radius_bending_von_mises" class="imageblock">
              <div class="content">
                <img src="images/radius_bending_von_mises.png" alt="radius bending von mises">
              </div>
              <div class="title">Figure 29. Radius in bending test with coloring by von Mises stress</div>
            </div>
            <div class="paragraph">
              <p>Showing the von Mises stress as in <a href="#radius_bending_von_mises">Figure 29</a> is
                informative, but only indicates the stress on the visible surfaces.
                Often we will want to look at the stresses within the volume. One way to
                do this is with a Slice filter. This is shown in <a href="#radius_bending_vm_slice">Figure 30</a>.
                Without going into a great deal of detail, you can see the filters used
                in this rendering in the Pipeline Browser.</p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    The Slice filter should be used on volume data, and not on surface
                    data. Notice that in <a href="#radius_bending_von_mises">Figure 29</a> we&#8217;ve applied the Slice
                    filter to the output of WarpByVector1, and not to ExtractSurface1 or
                    anything derived from it.
                  </td>
                </tr>
              </table>
            </div>
            <div id="radius_bending_vm_slice" class="imageblock">
              <div class="content">
                <img src="images/radius_bending_vm_slice.png" alt="radius bending vm slice">
              </div>
              <div class="title">Figure 30. von Mises stress on a slice of the radius in bending test</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_numerical_results">7.3.3. Numerical results</h4>
            <div class="paragraph">
              <p>The interesting quantity in the analysis file
                <code>radius82_bending_analysis.txt</code> (see <a href="#analysis_file_def">the section on
                  post-processing with n88postfaim</a>) is the torque around
                the bending axis, which in this case is in the <em>y</em> direction. Refer to
                <a href="#bending_test_figure">Figure 8</a>. This quantity
                is given as the <code>total</code> of <code>Ty</code> in the following table from
                <code>radius82_bending_analysis.txt</code>. By default, this is calculated
                around the center of mass of
                the object, although you can re-run <a href="#n88postfaim">n88postfaim</a> and
                specify an argument for the argument <a href="#n88postfaim_rotation_center">rotation_center</a>
                if you want the torques calculated around an axis passing through a different
                point. Because the head of the bone is &#8220;down&#8221;
                in the sense of smaller <em>z</em>, <code>face_z0</code> is the head of the bone, and
                <code>face_z1</code> is the cut face of the shaft. In any case, we can see that the torques
                balance. The numerical value of the <em>y</em> compenent of the torque is
                1997 N&#183;mm (see <a href="#note_about_units">A note about units</a>), or 1.997 N&#183;m.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>============================================================================
Table 11: Nodal Torques
---------------------------------------------------------------------------
Torque measured relative to:                            60.502 94.130 48.216
---------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Tx         Ty         Tz
total      -1.213E+02 -1.997E+03 -1.928E+01
average    -1.099E-02 -1.810E-01 -1.747E-03
std_dev     1.134E-01  1.252E-01  2.173E-02
minimum    -6.034E-01 -5.249E-01 -9.884E-02
maximum     3.538E-01  4.623E-01  6.071E-02
median     -8.431E-03 -1.915E-01  4.481E-05
---------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   Tx         Ty         Tz
total       1.215E+02  1.996E+03  1.927E+01
average     1.601E-03  2.630E-02  2.538E-04
std_dev     1.591E+00  5.163E+00  9.762E-01
minimum    -3.176E+01 -2.068E+01 -2.480E+01
maximum     2.722E+01  8.554E+01  2.405E+01
median     -2.631E-02 -7.920E-01 -1.935E-02
============================================================================</pre>
              </div>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="radius_bending_elastoplastic_tutorial">7.4. Tutorial: Radius bending with elasto-plastic material
            properties</h3>
          <div class="paragraph">
            <p>In this tutorial, we are going to repeat the radius bending test
              of the previous tutorial, but this time we will use nonlinear
              elasto-plastic material properties. We recommend that you first read the
              section on <a href="#plasticity">Plasticity</a>.</p>
          </div>
          <div class="sect3">
            <h4 id="_creating_the_model">7.4.1. Creating the model</h4>
            <div class="paragraph">
              <p>Because nonlinear models take substantially longer to solve than
                linear models, for this tutorial we are going to use the
                reduced-resolution image file <code>radius164.aim</code>. However, if you
                have the processing power and the time to obtain solutions, and
                you want to use the original resolution file <code>radius82.aim</code>, you
                can of course do so.</p>
            </div>
            <div class="paragraph">
              <p>Creating a model with elasto-plastic material properties with
                <code>n88modelgenerator</code> is straight-forward: one simply has to set the
                <a href="#n88modelgenerator_plasticity">plasticity</a> option. For example, the
                following configuration file is similar to the one in the last tutorial,
                but we have added <code>plasticity = vonmises,10</code>. This means that we
                want a <em>von Mises</em> yield criterion (see <a href="#von_mises_material">von Mises yield
                  criterion</a>) with a yield strength of 10 MPa. There
                is no scientific justification for choosing this numerical value
                for the yield strength: it was chosen simply because it produces
                interesting results for this tutorial.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># File: radius_bending_elastoplastic.conf
#
# A configuration file for the tutorial: radius bending with
# elasto-plastic material properties.

input_file       = radius164.aim
output_file      = radius_bending_elastoplastic.n88model
test                           = bending
bottom_surface                 = visible
bottom_surface_maximum_depth   = 15
plasticity                     = vonmises,10</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As before, we generate the model with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --config radius_bending_elastoplastic.conf</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We can verify that the resulting model file has elasto-plastic
                material definitions using the handy <a href="#n88modelinfo">n88modelinfo</a>
                command,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --materials radius_bending_elastoplastic.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The output is</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Materials:
----------------------------------------------------------------------

  Name : NewMaterial1
  Type : VonMisesIsotropic
  E : 6829.0
  nu : 0.3
  Y : 10.0
----------------------------------------------------------------------</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solving_the_model_3">7.4.2. Solving the model</h4>
            <div class="paragraph">
              <p>We can solve the model with <a href="#faim">faim</a>,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim radius_bending_elastoplastic.n88model</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>As before, if you have licensed the GPU solvers,
                        and have suitable GPU hardware, then you are going to want to use
                        the <a href="#n88solver_engine">engine</a> and <a href="#n88solver_device">device</a>
                        options to obtain faster solutions.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Let us look into the file to see what fields are present for a solved
                elasto-plastic model. The command to list the solutions is, as before,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --solutions radius_bending_elastoplastic.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>this gives an output of</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Solutions:
----------------------------------------------------------------------

  Name : Solution1
  Problem : Problem1
  Variables defined on nodes:
    Displacement
    ReactionForce
  Variables defined on elements:
    PlasticStrain
    Strain
    Stress
    StrainEnergyDensity
    VonMisesStress
  Variables defined on gauss points:
    PlasticStrain
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Everything here is as before for linear solutions, with the addition
                of a new field <code>PlasticStrain</code>. <code>PlasticStrain</code> is the irreversible strain
                that arises from exceeding the elastic limits as defined by the yield
                surface.
                See <a href="#n88derivedfields_plastic_strain">PlasticStrain</a> in the section <a
                  href="#using_n88derivedfields">Calculating additional solution fields with n88derivedfields</a>.
                You may also note that <em>variables defined on gauss points</em> is a new
                category. In essence, this is a higher accuracy version of <em>variables defined
                  on elements</em>, and it is required for accurately processing
                elastoplastic models.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_rendering_yielded_elements">7.4.3. Rendering yielded elements</h4>
            <div class="paragraph">
              <p>We can use ParaView to open the solved model file
                <code>radius_bending_elastoplastic.n88model</code>. In <a href="#radius_yielded_1">Figure 33</a>
                we&#8217;ve rendered the surface of the model such that unyielded elements
                are shown in grey, while yielded elements are shown in red. For
                elasto-plastic materials, there is a clear distinction between
                elements that remain within the elastic limits and therefore have
                zero plastic strain, and those
                which have exceeded the elastic limits and have non-zero plastic strain.
                (where non-zero means that at least one of the 6 components
                <em>xx</em>, <em>yy</em>, <em>zz</em>, <em>yz</em>, <em>zx</em> and <em>xy</em> of the plastic strain is
                non-zero).
                In order to generate the rendering of <a href="#radius_yielded_1">Figure 33</a> we set the
                <em>Coloring</em> to the <em>Magnitude</em> of <em>PlasticStrain</em>. You can find these
                in drop-down boxes in the toolbar in ParaView, as shown in
                <a href="#paraview_plasticstrain_magnitude">Figure 31</a>. Next we will manually set a tiny
                range for the color scale, thus ensuring that practically every element
                that is yielded is shown in fully saturated red. If we set a symmetric
                scale around zero, then unyielded elements, which have a <em>PlasticStrain</em>
                magnitude of zero, will be drawn in a neutral gray. To set the color
                scale, click <b class="button">Rescale to Custom Data Range</b>, which is just to
                the left of the drop-down box for <em>PlasticStrain</em>, as shown in
                <a href="#paraview_rescale">Figure 32</a>. For this rendering I used a range of -0.00001 to
                0.00001 . Note that in Paraview, the <em>Magnitude</em> of the <em>PlasticStrain</em>
                is simply the square root of the sum of the squares of the 6 components
                of plastic strain. This quantity has no physical
                interpretation, but it is useful for distinguishing yielded and unyielded
                elements, as here.
              </p>
            </div>
            <div id="paraview_plasticstrain_magnitude" class="imageblock">
              <div class="content">
                <img src="images/paraview_plasticstrain_magnitude.png" alt="paraview plasticstrain magnitude">
              </div>
              <div class="title">Figure 31. Setting the color display to the Magnitude of PlasticStrain.</div>
            </div>
            <div id="paraview_rescale" class="imageblock">
              <div class="content">
                <img src="images/paraview_rescale.png" alt="paraview rescale">
              </div>
              <div class="title">Figure 32. The Rescale to Custom Data Range button.</div>
            </div>
            <div id="radius_yielded_1" class="imageblock">
              <div class="content">
                <img src="images/radius_yielded_1.png" alt="radius yielded 1">
              </div>
              <div class="title">Figure 33. Bending radius test with elasto-plastic material properties. Yielded
                elements are shown in red.</div>
            </div>
            <div class="paragraph">
              <p>What we observe in <a href="#radius_yielded_1">Figure 33</a> rendering
                is that there are
                essentially three regions of plastic deformation in this bone
                subject to a bending force. They are,</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>The uneven head of the bone. This region yields fundamentally because
                    the deformation is applied here, and the surface is rough. Rough surfaces
                    yield easily in localised spots: crudely speaking, you don&#8217;t have to push
                    very hard on a pointy little protusion to bend it. This yielding is
                    uninteresting, and if you were to slice the model here, you would find
                    that the yielding is superficial, that is, not very deep.</p>
                </li>
                <li>
                  <p>On the inside surface of the bend, the bone yields in compression.</p>
                </li>
                <li>
                  <p>On the outside surface of the bend, the bone yields in tension.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>You can&#8217;t actually tell from <a href="#radius_yielded_1">Figure 33</a> what
                is yielding in compression and what in tension, but with a bit more manipulation,
                we can generate an image that does show this.
                Since we know <em>a priori</em> that the tension and compression on the sides
                of the bone shaft will be predominantly in the <em>z</em> direction, we can
                change the component of <em>YieldStrain</em> from <em>Magnitude</em> to <em>ZZ</em>.
                (You may need to manually re-adjust the color scale, as ParaView will automatically
                rescale to the data range when you change the variable for the color.)
                Elements yielded in compression now show as blue, as in <a href="#radius_yielded_2">Figure 34</a>.
                We have in addition used a <em>Slice</em> filter, as in the previous tutorial.
                This allows us to see that the yielded region is rather thick.</p>
            </div>
            <div id="radius_yielded_2" class="imageblock">
              <div class="content">
                <img src="images/radius_yielded_2.png" alt="radius yielded 2">
              </div>
              <div class="title">Figure 34. A slice through the radius. Yielded elements are shown in red for elements
                yielded in tension, and in blue for elements yielded in compression.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_numerical_results_2">7.4.4. Numerical results</h4>
            <div class="paragraph">
              <p>In comparison with the linear case, the <em>y</em> component of the torque has
                dropped about 1.5%, from 1.997 N&#183;m to 1.968 N&#183;m; hence
                a decrease in stiffness of 1.5%. In conclusion,
                this amount of plasticity has not significantly affected the results.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>============================================================================
Table 12: Nodal Torques
----------------------------------------------------------------------------
Torque measured relative to:                            60.546 94.150 48.216
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Tx         Ty         Tz
total      -1.066E+02 -1.967E+03 -3.557E+01
average    -3.555E-02 -6.560E-01 -1.186E-02
std_dev     4.106E-01  4.849E-01  7.938E-02
minimum    -1.796E+00 -1.831E+00 -2.889E-01
maximum     1.024E+00  1.301E+00  1.671E-01
median     -3.379E-02 -6.803E-01 -2.385E-03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   Tx         Ty         Tz
total       1.072E+02  1.968E+03  3.570E+01
average     5.497E-03  1.009E-01  1.831E-03
std_dev     2.888E+00  5.542E+00  1.195E+00
minimum    -2.380E+01 -2.593E+01 -9.494E+00
maximum     2.158E+01  4.561E+01  1.482E+01
median     -1.126E-01 -1.084E+00  1.470E-02
============================================================================</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_a_more_careful_calculation_incrementally_applying_the_load">7.4.5. A more careful calculation:
              incrementally applying the load</h4>
            <div class="paragraph">
              <p>There are always more subtle considerations for nonlinear calculations
                than for linear calculations. One aspect of elasto-plastic calculations
                is that they exhibit hysteresis, or irreversible changes to strain.
                In this way, the solutions depend in fact, not only on the current
                applied state, but in principle on the whole time-dependent history.</p>
            </div>
            <div class="paragraph">
              <p>Whether this is significant or not in practice is something that can
                be investigated experimentally - or rather computationally in our case.
                In the present case, we already know that there is only a 1.5% difference
                in numerical results
                between the linear model and the elastoplastic model. So this
                more careful method of applying the load in the nonlinear case is
                very unlikely to result in significant differences in the result.
                This tutorial is therefore more of a demonstration of principle,
                and an introduction to the possibility of modifying already-solved <code>n88model</code> files.</p>
            </div>
            <div class="paragraph">
              <p>To apply the bending in increments, we will take advantage of the fact
                that <a href="#n88modelgenerator">n88modelgenerator</a>
                can accept an existing <code>n88model</code> file as input. In this case, it
                will preserve the grid, <em>i.e.</em> the points and elements of the model,
                but generate new boundary conditions and/or material definitions.
                Crucially, it also preserves an existing solution, which is then
                automatically used as the starting value when the solver is
                subsequently called.</p>
            </div>
            <div class="paragraph">
              <p>We are first going to make a configuration file containing all the
                parameters of <a href="#n88modelgenerator">n88modegenerator</a> that
                are the same for each increment of bending.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># File: common.conf
#
# A configuration file for the tutorial: radius bending with
# elast-plastic material properties.
#
# This file contains all the parameters that don't change on
# each increment of bending.

test = bending
bottom_surface = visible
bottom_surface_maximum_depth = 15
plasticity = vonmises,10</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now we are going to call <a href="#n88modelgenerator">n88modegenerator</a>
                and <a href="#faim">faim</a> multiple times, in steps of 0.1&#186;, from bending
                angle 0.6&#186; up to bending angle 1.0&#186;. 0.6&#186; is chosen as a the starting
                angle because it happens to be just after the onset of nonlinear behaviour.
                In general, it takes a bit of experimentation to find the minimum
                applied test condition for which some elements start to exceed the linear
                region.</p>
            </div>
            <div class="paragraph">
              <p>Here are the commands. You may want to put these into a script file.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelgenerator --conf=common.conf --bending_angle=0.6 radius164.aim incremental_bending_0.6.n88model
n88solver_spt incremental_bending_0.6.n88model
n88modelgenerator --conf=common.conf --bending_angle=0.7 incremental_bending_0.6.n88model incremental_bending_0.7.n88model
n88solver_spt incremental_bending_0.7.n88model
n88modelgenerator --conf=common.conf --bending_angle=0.8 incremental_bending_0.7.n88model incremental_bending_0.8.n88model
n88solver_spt incremental_bending_0.8.n88model
n88modelgenerator --conf=common.conf --bending_angle=0.9 incremental_bending_0.8.n88model incremental_bending_0.9.n88model
n88solver_spt incremental_bending_0.9.n88model
n88modelgenerator --conf=common.conf --bending_angle=1.0 incremental_bending_0.9.n88model incremental_bending_1.0.n88model
n88solver_spt incremental_bending_1.0.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Once we have run all of these commands, we can verify that the final
                data file, <code>incremental_bending_1.0.n88model</code>, does indeed show the
                history of being processed multiple times:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --history incremental_bending_1.0.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This gives an output of:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>History:
----------------------------------------------------------------------
2016-Sep-27 12:53:47 Model created by n88modelgenerator version 8.0
2016-Sep-27 13:09:03 Solved by n88solver_spt 8.0
2016-Sep-27 13:09:07 Model modified by n88modelgenerator version 8.0
2016-Sep-27 13:21:12 Solved by n88solver_spt 8.0
2016-Sep-27 13:21:16 Model modified by n88modelgenerator version 8.0
2016-Sep-27 13:33:43 Solved by n88solver_spt 8.0
2016-Sep-27 13:33:47 Model modified by n88modelgenerator version 8.0
2016-Sep-27 13:46:27 Solved by n88solver_spt 8.0
2016-Sep-27 13:46:31 Model modified by n88modelgenerator version 8.0
2016-Sep-27 14:03:09 Solved by n88solver_spt 8.0
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As usual, the details can be recovered with the <code>--log</code> options of
                <a href="#n88modelinfo">n88modelinfo</a>, but the output is lengthy,
                so we will not show it here.
              </p>
            </div>
            <div class="paragraph">
              <p>To perform the post-processing on the final result, we call,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88derivedfields incremental_bending_1.0.n88model
n88postfaim incremental_bending_1.0.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Numerically, the results have changed little in this case, as
                expected. We now have a <em>y</em>-component of torque of 1.972 N&#183;m,
                which compares with 1.997 N&#183;m in the linear case, and
                1.968 N&#183;m for the &#8220;all at once&#8221; elastoplastic case.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>============================================================================
Table 12: Nodal Torques
----------------------------------------------------------------------------
Torque measured relative to:                            60.546 94.150 48.216
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Tx         Ty         Tz
total      -1.116E+02 -1.972E+03 -4.279E+01
average    -3.723E-02 -6.579E-01 -1.427E-02
std_dev     4.146E-01  4.921E-01  7.945E-02
minimum    -1.818E+00 -1.874E+00 -2.931E-01
maximum     9.960E-01  1.297E+00  1.614E-01
median     -4.138E-02 -6.728E-01 -3.365E-03
----------------------------------------------------------------------------
Node set:                                                                  2
Name:                                                                face_z0
............................................................................
                   Tx         Ty         Tz
total       1.116E+02  1.972E+03  4.286E+01
average     5.721E-03  1.011E-01  2.197E-03
std_dev     3.191E+00  6.173E+00  1.345E+00
minimum    -2.732E+01 -2.842E+01 -1.075E+01
maximum     2.276E+01  4.839E+01  1.579E+01
median     -1.405E-01 -1.222E+00  2.123E-02
============================================================================</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This tutorial is the final tutorial in the series presenting the Faim standard workflow,
                with models generated by <a href="#n88modelgenerator">n88modelgenerator</a>. Those
                interested in generating custom models will want to continue on to the
                tutorials presenting <code>vtkbone</code>. If you intend for the moment to use only
                <a href="#n88modelgenerator">n88modelgenerator</a> for generating your models, then
                you can stop here.
              </p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="cube_with_vtkbone_tutorial">7.5. Tutorial: Compressing a cube revisited using vtkbone</h3>
          <div class="paragraph">
            <p>In the preceding tutorials, we used <a href="#n88modelgenerator">n88modelgenerator</a>
              to quickly generate finite element models from segmented 3D images.
              <a href="#n88modelgenerator">n88modelgenerator</a> has many parameters that can
              be used to tune the models in produces, but inevitably, the variety of
              models that can be produced using the parameter-setting approach is limited.
              A far more flexible approach is scripting. Numerics88 contains a collection
              of objects suitable for constructing
              and manipulating finite element objects. These can be scripted with Python.
              Python is one of the easiest languages
              to learn, and yet retains a great deal of expressive power. This
              collection of objects is built on top of <a href="http://vtk.org">VTK</a> and is referred
              to as <code>vtkbone</code>. It is documented in <a href="#vtkbone">Preparing Finite Element Models with
                vtkbone</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>In this tutorial, we are going to revisit the first tutorial,
              <a href="#cube_tutorial">Introductory tutorial: Compressing a solid cube</a>.
              In fact we&#8217;re going to do it all over again, only this time, we will
              generate the model by writing a little script with <code>vtkbone</code>, instead
              of using <a href="#n88modelgenerator">n88modelgenerator</a>. It will be
              more work, but we will have a working model-generation script that could
              be further tweaked to do things that would not be possible with
              <a href="#n88modelgenerator">n88modelgenerator</a>.
            </p>
          </div>
          <div class="sect3">
            <h4 id="_getting_familiar_with_python_vtk_and_numpy">7.5.1. Getting familiar with Python, VTK and Numpy</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>It is not necessary to know Python in order to write and
                modify scripts using <code>vtkbone</code>, as very often you can make obvious
                modifications to existing scripts. However, having a basic familiarity
                can make you more comfortable with the following scripting. As
                Python is very widely used, there are any number of excellent
                introductory books. A suggested place to start is the on-line
                tutorial at <a href="http://docs.python.org/tutorial/" class="bare">http://docs.python.org/tutorial/</a>
                .</p>
            </div>
            <div class="paragraph">
              <p>One feature of Python which we will use that is not a part of the
                standard Python distribution (but is distributed with Numerics88
                software) is Numpy, which efficiently handles numerical arrays
                in Python. Again, prior knowledge of Numpy is not required, but will
                help. Documentation for Numpy can be found at <a href="http://docs.scipy.org/doc/"
                  class="bare">http://docs.scipy.org/doc/</a> .
                We
                recommend <a href="https://docs.scipy.org/doc/numpy-dev/user/quickstart.html"
                  class="bare">https://docs.scipy.org/doc/numpy-dev/user/quickstart.html</a> as
                an introduction.</p>
            </div>
            <div class="paragraph">
              <p>Finally, there is <a href="http://vtk.org">VTK</a> . VTK is quite complex and rather
                more difficult to learn than either Python or Numpy, but fortunately it
                is not necessary to know very much VTK. We will be using
                a mixture of custom <code>vtkbone</code> objects and standard VTK objects. When one
                of these comes up in the following tutorials, you may want to
                have a glance at the corresponding API documentation for that object.
                This is explained in <a href="#api_documentation">vtkbone API documentation</a>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_preliminaries_first_lines_of_python">7.5.2. Preliminaries: first lines of Python</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>First create a working directory. Using your favourite text editor, create a
                file <code>apply_compression.py</code>.</p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    You can also use an editor or an integrated
                    development environment specifically
                    intended for python, such as IDLE, but this is not necessary. A plain
                    old text editor will work fine. On Windows, Notepad
                    can be used. On OS X, you can use TextEdit, which you will
                    find in the Utilities folder within Applications. If using TextEdit, be sure
                    to select <span class="menuseq"><b class="menu">Format</b>&#160;<b class="caret">&#8250;</b> <b
                        class="menuitem">Make Plain Text</b></span>. Atom is an open-source text editor with a variety
                    of tools for scripting in Python.
                  </td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    If you want to cheat and not actually type this tutorial script
                    line-by-line as we go, you can find the finished version in the
                    directory <code>tutorials/cube_with_vtk</code>, once you unpack the archive
                    of tutorial data that can be downloaded from <a href="http://numerics88.com/n88/downloads"
                      class="bare">http://numerics88.com/n88/downloads</a> .
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Start by adding these
                lines, which import all the Python modules that we will be using:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>from __future__ import division
import argparse
import os
import sys
import vtk
import vtkbone</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Once you save this, you already have a script that you can run! In fact, you should run it,
                with just these lines
                in it - even though it does nothing yet, because it will verify that Python can
                successfully locate VTK and <code>vtkbone</code>. The script can be run like this
                (make sure you&#8217;ve saved <code>apply_compression.py</code>),</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py</pre>
              </div>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    The dollar sign (<code>$</code>) at the beginning of the line is the prompt:
                    don&#8217;t type that. On Windows the prompt will be something like <code>C:\&gt;</code> .
                    On all systems the prompt might contain additional information, such
                    as the current directory.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>You should get as output . . . nothing whatsoever. If you get an error like
                &#8220;ImportError: No module named vtk&#8221;, then it
                is likely that the n88tools is not installed, or that the anaconda python
                environment is not activated. Refer to <a href="#install_n88tools">Install n88tools and vtkbone</a>.</p>
            </div>
            <div class="paragraph">
              <p>We recommend also having a version number in your script. Increment it
                whenever you change the script (not every time you
                add a line, but if you modify the finished script later so that the
                resulting model is somewhat different, then increment the version number.)
                We&#8217;ll see soon how we can
                ensure that the script version number gets written into the log
                of the <code>n88model</code> file. Although we&#8217;re not accountants, we highly
                recommend having an audit trail that will allow you to know exactly how
                a given model was generated. (Obviously, you should archive copies of every
                version of your script, not just the most recent one. You should also
                floss daily, which we&#8217;re sure that you do.) For now, just add a version
                number to the script with this line. We are on version 3, since
                this tutorial has been in the manual for quite some time, and it has been
                tweaked a couple of times.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>script_version = 4</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now, we&#8217;re going to want to specify the input image file on the
                command line, because this will allow us to use the script on
                any input file, not just one hard-coded by name into the script.
                We&#8217;re also going to want to inform the user that an input
                file name is required if they don&#8217;t supply one. (&#8220;The user&#8221; is most likely
                you yourself, but don&#8217;t assume that next week you&#8217;ll remember how you
                intended to use the script you write this week.) The python module
                <code>argparse</code> is really handy for this. The following lines will do
                the desired thing:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>parser = argparse.ArgumentParser (
    description="""Apply a compression test.
This script does essentially the same as the command
"n88modelgenerator --test=uniaxial"
but uses vtkbone for this purpose.
""")

parser.add_argument ("input_file",
   help="An input image file of the segmented data; must be in VTK XML format (.vti).")

args = parser.parse_args()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>So now when we run it as before, this time we do get some output:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py
usage: apply_compression.py [-h] input_file
apply_compression.py: error: too few arguments</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Progress!</p>
            </div>
            <div class="paragraph">
              <p>Let&#8217;s see what happens if we run it with the <code>-h</code> flag. Note that
                <code>argparse</code> has
                automatically added a <code>-h</code> flag, the purpose of which is to get help about the
                command.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py -h
usage: apply_compression.py [-h] input_file

Apply a compression test. This script does essentially the same as the command
"n88modelgenerator --test=uniaxial" but uses vtkbone for this purpose.

positional arguments:
  input_file  An input image file of the segmented data; must be in VTK XML
              format (.vti).

optional arguments:
  -h, --help  show this help message and exit</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_reading_the_input_file">7.5.3. Reading the input file</h4>
            <div class="paragraph">
              <p>The input file is <code>cube6x6x6.vti</code> and as usual you can find it in the
                <code>data</code> folder of your distribution. We&#8217;ve seen it before in the
                <a href="#cube_tutorial">first tutorial</a>. Copy it to your working directory.
              </p>
            </div>
            <div class="paragraph">
              <p>As the data is in VTK&#8217;s <code>.vti</code> format (properly referred to as
                &#8220;VTK XML Image Data file format&#8221;), we&#8217;ll need a <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLImageDataReader.html">vtkXMLImageDataReader</a>
                object to read it. That will look like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>print(f"Reading, {args.input_file}")
reader = vtk.vtkXMLImageDataReader()
reader.SetFileName(args.input_file)
reader.Update()
image = reader.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p><a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLImageDataReader.html">vtkXMLImageDataReader</a>
                is a type of VTK &#8220;filter&#8221;
                (specifically a &#8220;source&#8221;). What we&#8217;ve done is very typical for
                VTK filters and we&#8217;ll see this sequence of steps for employing a VTK filter
                over and over again. It is,</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Create the filter object.</p>
                </li>
                <li>
                  <p>Set any inputs. (Here there are none, because a source doesn&#8217;t have any.)</p>
                </li>
                <li>
                  <p>Set any parameter values. In this case we set the parameter value <code>FileName()</code>.</p>
                </li>
                <li>
                  <p>Call <code>Update()</code>. (Otherwise nothing happens and we wonder why.)</p>
                </li>
                <li>
                  <p>Get any output.</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>In fact, this isn&#8217;t the only way to use VTK filter objects, but it is the
                simplest and it is the procedure we will nearly always employ in our scripts.</p>
            </div>
            <div class="paragraph">
              <p>Let&#8217;s provide some feedback at this point so we have some indication
                that the data was correctly read. While we&#8217;re at it, let&#8217;s do some error
                checking to stop things right here if that data wasn&#8217;t able to be read,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>if not image:
    print("No image data read.")
    sys.exit(1)

print(f"Read image with point dimensions: {image.GetDimensions()}")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now running it should result in,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py cube6x6x6.vti
Reading cube6x6x6.vti
Read image with point dimensions (7, 7, 7) <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Wait a minute! Why are the reported dimensions (7, 7, 7) when they are
                    really 6&#215;6&#215;6? It is because these are the reported
                    Point (or Node) dimensions, rather than the Cell (or Element) dimensions.
                    If you&#8217;re confused, review the discussion on this point in
                    <a href="#cube_tutorial">Introductory tutorial: Compressing a solid cube</a>.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_ensuring_connectivity">7.5.4. Ensuring connectivity</h4>
            <div class="paragraph">
              <p>We could assume that the input image is properly segmented and just
                proceed with generating a mesh.
                Since this is an introductory tutorial perhaps we should. However, it
                happens not infrequently for whatever reason that a finite element model is
                attempted on
                an image which does not consist of a single connected object. This can cause
                all sorts of trouble.
                Consider this: if there are disconnected floating bits
                in the model, where is the proper place for the solver to put them in the
                solution? Sometimes the solution of such models will be very slow,
                other times the model will solve OK, but some of the
                post-processing numbers may appear strange if you don&#8217;t realize that
                they are calculated over the entire model, including bits which are subject
                to no constraints.</p>
            </div>
            <div class="paragraph">
              <p>So to avoid potential grief, this is a good place to drop in a
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageConnectivityFilter.html">vtkboneImageConnectivityFilter</a>
                . It will strip away
                (actually zero-out) any parts of the input image that aren&#8217;t in some
                way connected to the largest object in the image. It is a safe and prudent step
                in the generation of a well-defined finite element model.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>print("Applying connectivity filter.")
connectivity_filter = vtkbone.vtkboneImageConnectivityFilter()
connectivity_filter.SetExtractionModeToLargestRegion()
connectivity_filter.SetInputData(image)
connectivity_filter.Update();
image = connectivity_filter.GetOutput()</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Is it legitimate to assign the output to the variable
                        <em>image</em> when that was also the name of the input? The answer is
                        yes. It&#8217;s quite kosher in Python to clobber a variable name by assigning
                        it to something else. Python is more clever than you might think about
                        this. It will in fact keep the data associated with the original
                        input variable around as long required, even though we have no means
                        to refer to it or access it now. (And
                        technically speaking, here it will be required, at least as long as
                        connectivity_filter exists, because connectivity_filter will still use the
                        original
                        input data. As long as connectivity_filter is around, we might decide to
                        use it again without changing the input, so Python won&#8217;t get rid of it.)
                      </p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_generating_a_mesh_2">7.5.5. Generating a mesh</h4>
            <div class="paragraph">
              <p>The filter object for generating an FE mesh from an input image is
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
                . The FE mesh represents the geometry of the model, and
                consists of elements and nodes (concretely, it will be an object of type
                <a href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
                ). Note that in VTK terminology, elements will be
                called Cells, and nodes will be called Points. Most of the time we don&#8217;t need
                to set any parameters to <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
                except the input.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Generate a finite element mesh from the input image

geometry_generator = vtkbone.vtkboneImageToMesh()
geometry_generator.SetInputData(image)
geometry_generator.Update()
geometry = geometry_generator.GetOutput()

print(f"Generated {geometry.GetNumberOfCells()} elements and {geometry.GetNumberOfPoints()} nodes.")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now our output is beginning to get interesting,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py cube6x6x6.vti
Reading cube6x6x6.vti
Read image with point dimensions (7, 7, 7)
Applying connectivity filter.
Generated 216 elements and 343 nodes.</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Quick check: 6<sup>3</sup> = 216 and 7<sup>3</sup> = 343, so we&#8217;re good.</p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>It is possible to write out the geometry to a file in VTK&#8217;s XML
                        Unstructured Grid format using <a
                          href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLUnstructuredGridWriter.html">vtkXMLUnstructuredGridWriter</a>
                        .
                        You will then be able to open it in ParaView. It should be very similar
                        to <a href="#cube6_surface">Figure 16</a>. (In contrast though to rendering the input image, if
                        there were any zero-valued voxels, there would
                        be no need to threshold to remove the corresponding cells, as they are
                        already absent from the meshed geometry.) The lines of code to
                        save the geometry to a file are as follows:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>writer = vtk.vtkXMLUnstructuredGridWriter()
geometry_file = "geometry.vtu"
print(f"Writing geometry to {geometry_file}")
writer.SetFileName(geometry_file)
writer.SetInputData(geometry)
writer.Write()</pre>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_defining_materials_and_creating_a_material_table">7.5.6. Defining materials and creating a material
              table</h4>
            <div class="paragraph">
              <p>Now we need to define some material properties. We can do this
                by creating an instance of some specific derived class of
                <a href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterial.html">vtkboneMaterial</a>
                . The one of these is
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneLinearIsotropicMaterial.html">vtkboneLinearIsotropicMaterial</a>
                . Let&#8217;s make one of them,
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>print("Creating a linear isotropic material.")
material = vtkbone.vtkboneLinearIsotropicMaterial()
material.SetName("linear_iso_material") <img src="./images/icons/callouts/1.png" alt="1">
material.SetYoungsModulus(6829) <img src="./images/icons/callouts/2.png" alt="2">
material.SetPoissonsRatio(0.3) <img src="./images/icons/callouts/2.png" alt="2"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>We can give it any name we want. If we need to access it later,
                    we can look it up by name.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>These are default values, so we actually didn&#8217;t really need these
                    lines, but it doesn&#8217;t hurt be explicit, and now it is
                    clear how to set different values should you want to do so.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>The other thing we must do is to make a material table, which associates
                the values in the input image (segmentation IDs or material IDs)
                with defined materials. Our image file <code>cube6x6x6.vti</code> has the uniform
                value of 1 on every voxel, so we need to make a material table that
                associates 1 with our material defined above. But perhaps we
                might want to run this script someday on an input file that uses different
                values (127 is very common for historical reasons). We could write
                here some fancy scripting that would examine the input data and produce a
                list of all the different values in the image, then map all those values
                to our material (since we&#8217;re only using one material here). This
                sounds a bit complicated, but fortunately, there is a <code>vtkbone</code> object,
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneGenerateHomogeneousMaterialTable.html">vtkboneGenerateHomogeneousMaterialTable</a>
                , that
                does exactly this for us:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>mt_generator = vtkbone.vtkboneGenerateHomogeneousMaterialTable()
mt_generator.SetMaterial(material)
mt_generator.SetMaterialIdList(image.GetCellData().GetScalars()) <img src="./images/icons/callouts/1.png" alt="1">
mt_generator.Update()
material_table = mt_generator.GetOutput()
print(f"Generated material table with {material_table.GetNumberOfMaterials()} entries.")</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Unfortunately, it is not as simple as just setting &#8220;image&#8221; as
                    the argument to <code>SetMaterialIdList</code>. We have to be quite explicit about specifying the
                    scalar data on the cells, in this manner.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_applying_a_compression_test">7.5.7. Applying a compression test</h4>
            <div class="paragraph">
              <p>To apply boundary conditions appropriate to a compression test, we can make
                use of the object <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                , which will do practically all
                the work for us. <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                requires as inputs both
                the mesh and the material table that we defined above.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Apply a compression test (uniaxial)

print("Applying a uniaxial compression test.")
generator = vtkbone.vtkboneApplyCompressionTest()
generator.SetInputData(0, geometry) <img src="./images/icons/callouts/1.png" alt="1">
generator.SetInputData(1, material_table) <img src="./images/icons/callouts/2.png" alt="2">
generator.Update()
model = generator.GetOutput()</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Input 0 to <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                    must be the
                    mesh geometry, as a <a
                      href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
                    object.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>Input 1 to <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                    must be the
                    material table, as a <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMaterialTable.html">vtkboneMaterialTable</a>
                    object.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_writing_an_n88model_file">7.5.8. Writing an n88model file</h4>
            <div class="paragraph">
              <p>The output of <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                is a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object, which is a complete representation of the problem we want to
                solve with finite element analysis. It remains to write out this model
                in <code>n88model</code> file format.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Write an n88model file

output_file = os.path.splitext(args.input_file)[0] + "_custom.n88model" <img src="./images/icons/callouts/1.png" alt="1">
# Remove directory, so file ends up in current directory.
output_file = os.path.split(output_file)[1]

print(f"Writing n88model file: {output_file}")
writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(output_file)
writer.Update()</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is some fancy Python to derive the output file name from the
                    input file name.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>That&#8217;s it. If everything works correctly, the output
                should look like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python apply_compression.py cube6x6x6.vti
Reading cube6x6x6.vti
Read image with point dimensions (7, 7, 7)
Applying connectivity filter.
Generated 216 elements and 343 nodes.
Creating a linear isotropic material.
Generated material table with 1 entries.
Applying a uniaxial compression test.
Writing n88model file: cube6x6x6_custom.n88model</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_modifying_the_file_history_and_log">7.5.9. Modifying the file history and log</h4>
            <div class="paragraph">
              <p>We promised at the beginning to record the script version number in the
                file, and so far we haven&#8217;t done this. First we&#8217;ll have a look
                at what is currently in the history field.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --history cube6x6x6_custom.n88model
History:
----------------------------------------------------------------------
2012-Sep-24 08:18:01 Model created by vtkboneApplyCompressionTest version 1.0 .
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This is useful information so instead of replacing it, we can just add to it.
                To do this, add the following line to the script, just before writing
                out the file:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.AppendHistory(f"Created by cube_compression.py version {script_version}.")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now run the script again, and this time when we run <a href="#n88modelinfo">n88modelinfo</a>, we get:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --history cube6x6x6_custom.n88model
History:
----------------------------------------------------------------------
2012-Sep-24 08:22:14 Model created by vtkboneApplyCompressionTest version 6.0 .
2012-Sep-24 08:22:14 Created by apply_compression.py version 2 .
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Good, now we&#8217;ll always know that the <code>cube6x6x6_custom.n88model</code> file was
                created with version 2 of the script (which called <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                from <code>vtkbone</code> version 6.0).</p>
            </div>
            <div class="paragraph">
              <p>We can also have a look at the log, which gives more detailed information:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --log cube6x6x6_custom.n88model
Log:
----------------------------------------------------------------------
2012-Sep-24 08:22:14
vtkboneApplyCompressionTest settings:

TopConstraintSpecificMaterial: -1
BottomConstraintSpecificMaterial: -1
UnevenTopSurface: 0
UnevenBottomSurface: 0
TestAxis: 2
AppliedStrain: -0.01
AppliedDisplacement: 0
TopSurfaceContactFriction: 0
BottomSurfaceContactFriction: 0
ConfineSides: 0
Pin: 0
PinCellClosestToXYCenter: 1
PinCellId: 0

----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>There is already quite a lot of information here, provided automatically
                by <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                . In particular we have all the
                parameters of <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyCompressionTest.html">vtkboneApplyCompressionTest</a>
                , which were all set to
                default values because we didn&#8217;t change any of them.
                We could, if we wanted, add even more information to the log, using the method
                <code>model.AppendLog</code>, just as we used <code>model.AppendHistory</code>. In this case, there is
                nothing lacking that we can&#8217;t query. For example, although no
                material information appears in the log, we can determine it
                with <a href="#n88modelinfo">n88modelinfo</a>,
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --materials cube6x6x6_custom.n88model
Materials:
----------------------------------------------------------------------

  Name : linear_iso_material
  Type : LinearIsotropic
  E : 6829.0
  nu : 0.3
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>You can now proceed if you want to solve and analyze the model
                exactly as in
                <a href="#cube_tutorial">An introductory tutorial: compressing a solid cube</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>This completes the tutorial on building the 6&#215;6&#215;6 cube
                compression model using <code>vtkbone</code>. We&#8217;ve seen that it takes considerably
                more work to write a script than to call <a href="#n88modelgenerator">n88modelgenerator</a>,
                so whenever it suffices,
                it is preferable to use <a href="#n88modelgenerator">n88modelgenerator</a>. However,
                although in this case we&#8217;ve done nothing that <a href="#n88modelgenerator">n88modelgenerator</a>
                couldn&#8217;t have done, we hope that you can imagine that now that we have
                a script, that we could potentially modify it in any number of ways beyond
                what would be possible with <a href="#n88modelgenerator">n88modelgenerator</a>.
                In subsequent tutorials, we&#8217;ll explore these possibilities.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="cantilever_tutorial">7.6. Tutorial: Deflection of a cantilevered beam; adding custom boundary
            conditions and loads</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>In this tutorial, we are going to use <code>vtkbone</code> to create a model that is
              different than anything that could create with <a href="#n88modelgenerator">n88modelgenerator</a>.
              The test will be the deflection
              of a uniform beam fixed at one end, in other words a cantilever. We have chosen this model
              because there is a simple analytic solution to which we can compare the result.</p>
          </div>
          <div class="paragraph">
            <p>One aspect that will be new to this tutorial will be an applied force as part of the
              problem definition. Generally though, it is preferable to define models with fixed position
              boundary conditions and solve for the forces, rather than to specify forces and solve
              for a displacement. The reason for this will be discussed in the subsequent tutorial.</p>
          </div>
          <div class="paragraph">
            <p>The completed script, <code>create_cantilever.py</code>, can be found in the <code>cantilever</code>
              subdirectory
              in the examples.</p>
          </div>
          <div class="sect3">
            <h4 id="_importing_the_required_python_modules">7.6.1. Importing the required python modules</h4>
            <div class="paragraph">
              <p>As in the previous tutorial, we start the python script by importing
                the python modules that we will need. This time we will also need the
                <code>numpy</code> module, as we are going to do some array manipulation.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>from __future__ import division
import argparse
import numpy
from numpy.core import * <img src="./images/icons/callouts/1.png" alt="1">
import vtk
import vtkbone
from vtk.util.numpy_support import vtk_to_numpy, numpy_to_vtk <img src="./images/icons/callouts/2.png" alt="2"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This just saves some typing later. For example we&#8217;ll be able to use the function
                    <code>array</code> instead of the longer <code>numpy.array</code>.
                  </td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>These are the functions that allow us to convert numpy arrays to and
                    from VTK data arrays.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>As before, we&#8217;ll also set a script version number:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>script_version = 3</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_setting_command_line_options">7.6.2. Setting command line options</h4>
            <div class="paragraph">
              <p>As before, we use the <code>argparse</code> module, which makes it quite simple to
                define a couple of arguments for running the script, one of which,
                the applied force, will have a numerical value.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>parser = argparse.ArgumentParser (
    description="""Generate a model for a cantilever with an
applied force to the end of the beam.""")

parser.add_argument ("applied_force", type=float,
   help="The applied force to the end of the beam.")

parser.add_argument ("output_file",
    help="Name for output n88model file.")

args = parser.parse_args()</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_generating_the_image_data">7.6.3. Generating the image data</h4>
            <div class="paragraph">
              <p>The beam is going to have a very simple geometry, one which we
                generate algorithmically without too much trouble. This is also going
                to serve as a brief introduction to numpy arrays. Because the analytic
                solution for the cantilever is essentially a 2D problem, we are going to
                use just a beam width of just a single element. To scale up to a realistic
                width, if desired, one can just scale all the forces. We are going to create
                a beam of 200&#215;1&#215;20 elements, with a cubic element
                of side length 0.5mm. Thus the beam has dimensions of length 100mm, height
                10mm, and width 0.5mm (but again, everything scales linearly with the width,
                so the obtained solution can be used for arbitrary widths).</p>
            </div>
            <div class="paragraph">
              <p>Here is how we create a 3-dimensional array data of size 200&#215;1&#215;20:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>dims = array ((20, 1, 200)) <img src="./images/icons/callouts/1.png" alt="1">
cellmap = ones (dims) <img src="./images/icons/callouts/2.png" alt="2"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The order of the dimensions is <em>z</em>,<em>y</em>,<em>x</em>, because numpy indices
                    always are ordered with the &#8220;fastest-changing&#8221; index last, which
                    must be <em>x</em>. On the other hand, VTK will generally
                    want arguments specified as <em>x</em>,<em>y</em>,<em>z</em>. We will have to be careful
                    about which order to use when.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td><code>ones</code> is a numpy function that creates an array (in this case a
                    3-dimensional array) filled with 1s.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We need to convert this from a <code>numpy</code> array, which is natural to Python, to
                a VTK data array:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>cellmap_vtk = numpy_to_vtk(ravel(cellmap), deep=1, array_type=vtk.VTK_INT)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>There are a couple of subtle points here. The first is that VTK is actually
                going to want the flattened data, meaning as one long 1-dimensional
                array, rather than as a 3-dimensional array. (It will keep track of the
                dimensionality separately, as we will see below.) Hence the use of <code>ravel</code>
                function, which is a numpy function that returns the input array as a
                one-dimensional array (without copying the underlying data if possible).
                The other aspect to note is that we specify <code>deep=1</code>, which specifies
                that the VTK array should create its own copy of the underlying
                data, instead of just referring to the numpy data. This is less memory
                efficient, but there are potential pitfalls with sharing the data, so we&#8217;ll
                go with the more robust method of making a copy.</p>
            </div>
            <div class="paragraph">
              <p>Now that we have the data, we&#8217;re going to create a <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> object
                which adds information such as the dimensions and the spacing.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>image = vtk.vtkImageData()
image.SetDimensions(dims[::-1] + 1) <img src="./images/icons/callouts/1.png" alt="1">
image.SetSpacing(0.5, 0.5, 0.5)
image.GetCellData().SetScalars(cellmap_vtk)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is a little bit tricky. First, <code>dims[::-1]</code> simply means
                    &#8220;dims reversed&#8221;, which we need because, as discussed above, dims
                    is ordered <em>z</em>,<em>y</em>,<em>x</em>, but VTK requires <em>x</em>,<em>y</em>,<em>z</em>.
                    Secondly we&#8217;re
                    adding 1 (to every dimension) because <a
                      href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> dimensions
                    are always in terms of the number of Points, rather than the number
                    of Cells. The end result is (201, 2, 21).</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We&#8217;ve set the spacing to 0.5 . In this tutorial, we are going to use
                units of millimetres. Units are not specified in the
                <code>n88model</code> file. Instead we will just have to ensure
                that all our units are consistent.
                See <a href="#note_about_units">A note about units</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>We can at this point write out the <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a> as a
                <code>.vti</code> file,
                and open it with ParaView to ensure that we have obtained the desired result.
                It should ressemble <a href="#beam_image">Figure 35</a>. As a beam, it looks absurdly thin, but
                to emphasise once again, we are solving essentially a 2D problem; the
                numerical results obtained can be scaled to any beam width.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Optional: write out image data to examine it

print("Writing geometry file: beam_image.vti")
writer = vtk.vtkXMLImageDataWriter()
writer.SetInputData(image)
writer.SetFileName("beam_image.vti")
writer.Update()</pre>
              </div>
            </div>
            <div id="beam_image" class="imageblock">
              <div class="content">
                <img src="images/beam_image.png" alt="beam image">
              </div>
              <div class="title">Figure 35. Generated beam image.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_generating_a_base_model_without_boundary_conditions">7.6.4. Generating a base model without
              boundary conditions</h4>
            <div class="paragraph">
              <p>Now that we have an image, as in the previous tutorial, we convert it
                to a geometric mesh:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Generate a geometrical mesh from the input image

mesh_generator = vtkbone.vtkboneImageToMesh()
mesh_generator.SetInputData(image)
mesh_generator.Update()
mesh = mesh_generator.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We also define a material (steel) and a material table.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create a material

material = vtkbone.vtkboneLinearIsotropicMaterial()
material.SetName("steel")
material.SetYoungsModulus(2.0E5) <img src="./images/icons/callouts/1.png" alt="1">
material.SetPoissonsRatio(0.3)

material_table = vtkbone.vtkboneMaterialTable()
material_table.AddMaterial (1, material) <img src="./images/icons/callouts/2.png" alt="2"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>200GPa is a typical value for the Young&#8217;s modulus
                    of steel. We will use units of MPa. We have already
                    declared that our length units are mm, hence all units will be
                    consistent provided that we use Newtons for forces.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>The value 1 comes from the fact that we filled our image with 1s. All
                    the elements will now be mapped to the material <em>steel</em>.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>In contrast to the previous tutorial, we won&#8217;t be using one of the standard
                test generation filters. Rather we will use the base test generation filter
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                , which creates a
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object without any boundary
                conditions.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create a model without boundary conditions.

generator = vtkbone.vtkboneApplyTestBase()
generator.SetInputData(0, mesh)
generator.SetInputData(1, material_table)
generator.Update()
model = generator.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Before we add displacement boundary conditions and applied loads, let&#8217;s save
                the model so we can examine the results as we build up our script.
                Of course the model isn&#8217;t complete yet, but that doesn&#8217;t prevent us from
                saving and examining it.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Write an n88model file

print(f"Writing n88model file: {args.output_file}")
writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(args.output_file)
writer.Update()</pre>
              </div>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    In everything that follows, it is intended that you add
                    new lines to the script <strong>before</strong> the code (shown just above) that saves
                    the model to a file. Otherwise of course the saved file won&#8217;t
                    include our additions and changes.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>To run the script will require both a numerical value for the applied force
                and an output file name. For now use these values:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python create_cantilever.py -10 cantilever.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We are choosing to use a negative applied force, because it is more natural to
                think of a downward force applied to a cantilever.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_fixed_boundary_conditions">7.6.5. Adding fixed boundary conditions</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>We want to fix one end of our beam, to weld it to the (virtual) wall.
                Usually the step requiring the most work in defining boundary
                condition is identifying the set of nodes that constitute the boundary
                surface we are interested in. In this case, <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                has done the work for us, because although it doesn&#8217;t define any
                boundary conditions, it does define node (and element) sets on all the faces. (To be more precise, it
                defines node and element sets consisting
                of any nodes/elements located at the <em>x</em>,<em>y</em> and <em>z</em> extents of the model.)
                This is discussed in <a href="#creating_sets">Creating node and element sets</a>.
                The names of these sets are listed there, but if you&#8217;ve run the script up to
                this point, you can also use <a href="#n88modelinfo">n88modelinfo</a> to query the
                set names:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --node_sets cantilever.n88model
NodeSets:
----------------------------------------------------------------------

  Name : face_z0
  Part : Part1
  NumberOfNodes : 402

  Name : face_z1
  Part : Part1
  NumberOfNodes : 402

  Name : face_x0
  Part : Part1
  NumberOfNodes : 42

  Name : face_x1
  Part : Part1
  NumberOfNodes : 42

  Name : face_y0
  Part : Part1
  NumberOfNodes : 4221

  Name : face_y1
  Part : Part1
  NumberOfNodes : 4221
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>There are also corresponding element sets, which can be listed with
                the <code>--element_sets</code> option to <a href="#n88modelinfo">n88modelinfo</a>.</p>
            </div>
            <div class="paragraph">
              <p>Node set <em>face_x0</em> is the one to which we are interested in applying a fixed
                boundary condition. If you refer
                to the the API documentation for <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>,
                you
                will see that there are a number of methods for defining boundary
                conditions. One possibility is to use the method <code>FixNodes</code>, which
                will fix the specified node set in all senses (directions). Only
                one line of code would be required:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.FixNodes ("face_x0", "fixed_beam_base") <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td><em>face_x0</em> is the name of an existing node set; <em>fixed_beam_base</em>
                    is the name we are assigning to the new constraint.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>However, as we are trying to obtain a result as close as possible to the
                analytic 2D solution, it is actually better to not limit the freedom of
                motion in the <em>y</em> direction on the boundary condition. This way, no
                <em>y</em> direction forces will arise. Were there to be any forces in the <em>y</em>
                direction, this would cause some essentially 3D effect on the <em>x-z</em> plane
                by the mechanism of Poisson&#8217;s ratio. So instead of using <code>FixNodes</code>,
                we will use the following slightly more verbose code
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create the fixed boundary conditions at the base of the beam.
# To obtain a more truely 2D result, no constraint is applied to
# displacements in the _y_ direction.

model.ApplyBoundaryCondition(
    "face_x0",
    vtkbone.vtkboneConstraint.SENSE_X,
    0,
    "fixed_beam_base_x")
model.ApplyBoundaryCondition(
    "face_x0",
    vtkbone.vtkboneConstraint.SENSE_Z,
    0,
    "fixed_beam_base_z")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>If you now run the script, you can then use <a href="#n88modelinfo">n88modelinfo</a> to verify
                that the boundary condition has indeed been generated:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --constraints cantilever.n88model
Constraints:
----------------------------------------------------------------------

  Name : fixed_beam_base_x
  Part : Part1
  Type : NodeAxisDisplacement
  NumberOfValues : 42

  Name : fixed_beam_base_z
  Part : Part1
  Type : NodeAxisDisplacement
  NumberOfValues : 42
----------------------------------------------------------------------</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_an_applied_load_to_tip_of_the_beam">7.6.6. Adding an applied load to tip of the beam</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>At the free end of the beam, we are going to apply a load.
                Creating an applied load is very similar to creating a displacement boundary
                condition. <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                provides a number of methods
                for this purpose. There are some important differences,</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Applied loads are applied to element sets; displacement boundary conditions are applied
                    to node sets.</p>
                </li>
                <li>
                  <p>Applied loads require the additional specification of a particular face of
                    the elements to which to apply the load, or else the specification that
                    it is a body force. We are going to apply the load to the outward faces
                    of the end elements (<em>i.e.</em> those facing in the <em>x</em> direction).</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>Here is the code to create an applied load constraint, named <em>end_force</em>
                to the pre-defined element set <em>face_x1</em>. corresponding to the end
                face of the beam.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Apply a force to the far end of the beam

model.ApplyLoad(
	"face_x1", <img src="./images/icons/callouts/1.png" alt="1">
	vtkbone.vtkboneConstraint.FACE_X1_DISTRIBUTION, <img src="./images/icons/callouts/2.png" alt="2">
	vtkbone.vtkboneConstraint.SENSE_Z, <img src="./images/icons/callouts/3.png" alt="3">
	args.applied_force, <img src="./images/icons/callouts/4.png" alt="4">
	"end_force") <img src="./images/icons/callouts/5.png" alt="5"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This node set was created by <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                    . Here
                    <em>face_x1</em> means elements on the <em>x1</em> face of the entire model.
                  </td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>This specifies the <em>x1</em> faces of the elements.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                  <td>This specifies the direction of the applied force. (The value of
                    <code>vtkbone.vtkboneConstraint.SENSE_Z</code> is 2, but the named constant conveys
                    the intent more clearly than the numerical value.)
                  </td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/4.png" alt="4"></td>
                  <td>The applied force will be equally divided among the element faces in the set.
                    Units, as discusssed above, are Newtons.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/5.png" alt="5"></td>
                  <td>The name of the newly-created constraint.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_a_convergence_set">7.6.7. Adding a convergence set</h4>
            <div class="paragraph">
              <p>As discussed in <a href="#convergence_measure">Convergence measure</a> there are different possibilites
                for
                the convergence measure, which is used by the solver to determine when the
                solution has iterated enough to obtain an acceptable solution. Generally,
                the best convergence measure to use for linear problems is <em>convergence set</em>.
                This convergence measure can only be used if we define a <em>convergence set</em> within the
                model file. A <em>convergence set</em> is something that we choose, and we generally want
                to choose the quantity that we are most interested in calculating. For example,
                for a cantilever, this quantity could be the displacement of the tip of the
                cantilever. You might imagine that this would be difficult to specify. But in most
                cases, this quantity of interest is the complement of some boundary condition or
                applied force. In this case, the displacement is the complement of the force
                applied to the tip. There is a method to generate a convergence set from a boundary
                condition or from an applied force, and it is very simple to use:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create a convergence set: the displacement of the tip

model.ConvergenceSetFromConstraint("end_force")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This method notices that the constraint named <em>end_force</em>, which we created previously,
                is an applied force,
                and that it is applied to the faces of certain elements. It then constructs the
                compliment, which is the displacement, averaged over all nodes located on those
                element faces. It is this
                average displacement of the tip that the solver will watch to determine when
                its value ceases to change meaningfully. At that point the solver is finished.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>In this case we have passed an applied force to <code>ConvergenceSetFromConstraint</code>,
                        and so the complement is naturally the average displacement of the corresponding
                        nodes. If instead you pass a boundary condition to <code>ConvergenceSetFromConstraint</code>,
                        then the resulting <em>convergence set</em> will be the total force on the nodes
                        belonging to the specified boundary condition.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>The fact the we define a convergence set in the model file
                        does not limit us to choosing the <em>convergence set</em> convergence measure.
                        Although the solver will default to using the <em>convergence set</em> convergence
                        measure if it finds a <em>convergence set</em> defined in the n88model file,
                        we can always run the solver while specifying a different convergence measure,
                        using the option <a href="#n88solver_convergence_measure">convergence_measure</a>.
                        Similarly, we can skip altogether defining a convergence set, and the solver
                        will default to a convergence measure that doesn&#8217;t require it. The only
                        drawback is that the other convergence measures are necessarily more
                        conservative, and so the solver will usually run for more iterations than
                        would be strictly necessary for the desired precision.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="cantilever_post_processing_sets">7.6.8. Specifying sets for post-processing</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>There is one more step required, and that is to identify the sets to
                be used for post-processing calculations by <a href="#n88postfaim">n88postfaim</a>.
                We are interested in values on the sets <em>face_x0</em> and <em>face_x1</em>.
                The magic lines of code are:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Set the node sets and element sets that will be used for post-processing

info = model.GetInformation()
pp_node_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()
pp_elem_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_ELEMENT_SETS()
pp_node_sets_key.Append(info, "face_x0")
pp_elem_sets_key.Append(info, "face_x0")
pp_node_sets_key.Append(info, "face_x1")
pp_elem_sets_key.Append(info, "face_x1")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>After running the script, we can verify that these post-processing sets
                are in fact specified in the <code>n88model</code> file:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --problems cantilever.n88model
Problems:
----------------------------------------------------------------------

  Name : Problem1
  Part : Part1
  Constraints : fixed_beam_base_x,fixed_beam_base_z,end_force
  ConvergenceSet : convergence_set
  PostProcessingNodeSets : face_x0,face_x1
  PostProcessingElementSets : face_x0,face_x1
----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>It is possible to skip this step, and instead to specify later the node and
                        element sets to be used by <a href="#n88postfaim">n88postfaim</a> on the
                        command line of <a href="#n88postfaim">n88postfaim</a> with the argument</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>--sets=face_x0,face_x1</pre>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_documenting_the_model_in_the_file_log">7.6.9. Documenting the model in the file log</h4>
            <div class="paragraph">
              <p>As discussed previously, it is good practice to document the
                model creation in both the file History and the file Log. Here we
                add these lines (again they must come before the code that saves
                the model):</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Update history and log

model.AppendHistory(f"Created by create_cantilever.py version {script_version} .")

model.AppendLog(
    f"""create_cantilever.py
    Cantilever beam model with applied force on far face edge of {args.applied_force} .
    Using vtkbone version {vtkbone.vtkboneVersion.GetvtkboneVersion()} .
    """
)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>If we run the script to generate the <code>n88model</code> file, we can at
                any later time get a brief description of the model and determine
                what versions were used (including what version of <code>vtkbone</code>).</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --history --log cantilever.n88model
History:
----------------------------------------------------------------------
2016-Sep-22 17:33:32 Created by create_cantilever.py version 3 .
----------------------------------------------------------------------

Log:
----------------------------------------------------------------------
2016-Sep-22 17:33:32
create_cantilever.py
Cantilever beam model with applied force on far face edge of -10.0 .
Using vtkbone version 1.0 .
----------------------------------------------------------------------</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solving_the_problem_and_comparing_with_theory">7.6.10. Solving the problem and comparing with
              theory</h4>
            <div class="paragraph">
              <p>The model is quickly solved with <a href="#faim">faim</a>:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ faim cantilever.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>If we open the solved file <code>cantilever.n88model</code> in ParaView, we can
                observe the beam deflection as shown in <a href="#beam_bending_deflection">Figure 36</a>.
                Here the deflection is amplified by 10 so as to be more evident.
                The figure is colored by the <em>xx</em> component of strain, with red being
                tensile and blue being compressive. This is easily done in ParaView, simply
                by selecting the relevant quantities from the drop-down boxes in the toolbar,
                as in <a href="#paraview_strain_xx">Figure 37</a>.</p>
            </div>
            <div id="beam_bending_deflection" class="imageblock">
              <div class="content">
                <img src="images/beam_bending_deflection.png" alt="beam bending deflection">
              </div>
              <div class="title">Figure 36. Deflection of loaded cantilever beam. Displacement amplified by 10.
                Coloration by xx component of strain.</div>
            </div>
            <div id="paraview_strain_xx" class="imageblock">
              <div class="content">
                <img src="images/paraview_strain_xx.png" alt="paraview strain xx">
              </div>
              <div class="title">Figure 37. XX component of strain selected in ParaView toolbar.</div>
            </div>
            <div class="paragraph">
              <p>Now let&#8217;s compare quantitatively with the analytical result for deflection of a cantilever beam
                as found in any Mechanics of Solids textbook
                or on wikipedia at <a href="https://en.wikipedia.org/wiki/Deflection_%28engineering%29"
                  class="bare">https://en.wikipedia.org/wiki/Deflection_%28engineering%29</a>. We have that
                the deflection &#948; of the end of a cantilever beam is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \delta = \frac {F L^3} {3 E I}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>where</p>
            </div>
            <div class="hdlist">
              <table>
                <tr>
                  <td class="hdlist1">
                    \(F\)
                  </td>
                  <td class="hdlist2">
                    <p>= force acting on the tip of the beam</p>
                  </td>
                </tr>
                <tr>
                  <td class="hdlist1">
                    \(L\)
                  </td>
                  <td class="hdlist2">
                    <p>= length of the beam (span)</p>
                  </td>
                </tr>
                <tr>
                  <td class="hdlist1">
                    \(E\)
                  </td>
                  <td class="hdlist2">
                    <p>= modulus of elasticity</p>
                  </td>
                </tr>
                <tr>
                  <td class="hdlist1">
                    \(I\)
                  </td>
                  <td class="hdlist2">
                    <p>= area moment of inertia</p>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>For a beam with a rectangular cross-section \(b \times h\), the area moment of
                inertia is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                I = \frac{b h^3}{12}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>so that we have</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \delta = \frac {4 F L^3}{E b h^3}
                = \frac {4 \,(10 \, \mathrm{N}) (100 \, \mathrm{mm})^3} {(2 \times 10^5 \, \mathrm{MPa}) (0.5 \,
                \mathrm{mm}) (10 \, \mathrm{mm})^3} = 0.4 \, \mathrm{mm}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>You can observe this deflection in ParaView, and we can get a
                precise number by looking in the <code>beam_analysis.txt</code> file, in the table
                <em>Nodal Displacements</em>. In this case
                the result, 0.4018, is very close to 0.4 .
              </p>
            </div>
            <div id="beam_nodal_displacements" class="imageblock">
              <div class="content">
                <img src="images/beam_nodal_displacements_hr.png" alt="beam nodal displacements hr">
              </div>
              <div class="title">Figure 38. Amount of deflection of the end face of the cantilever beam, as found in the
                analysis file.</div>
            </div>
            <div class="paragraph">
              <p>This concludes the cantilever beam tutorial. We learned how to create
                custom models using <code>vtkbone</code> that are beyond the standard types of models
                that <a href="#n88modelgenerator">n88modelgenerator</a> can generate. We were also
                introduced to a new type of constraint, which was the applied load.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="cantilever_elastoplastic_tutorial">7.7. Tutorial: A cantilevered beam with elastoplastic material
            properties</h3>
          <div class="paragraph">
            <p>This tutorial uses the same model as the previous one, but now we will solve
              it using nonlinear elastoplastic material properties.</p>
          </div>
          <div class="sect3">
            <h4 id="_analytic_solution">7.7.1. Analytic solution</h4>
            <div class="paragraph">
              <p>The cantilever problem has a known analytic solution even in the case of
                nonlinear elastoplastic material properties. This solution is due to
                <a href="#timoshenko1997">Timoshenko and Gere (1997)</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>Before building and solving some models, we will consider the analytic
                solution, because it will indicate what range of test loads are both
                interesting and reasonable, which is a non-trivial question for
                nonlinear problems.</p>
            </div>
            <div class="paragraph">
              <p>The applied load at which the cantilever begins to yield, F<sub>y</sub>, is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                F_y = \frac {\sigma_y b h^2} {6 L}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>where &#963;<sub>y</sub> is the material yield strength (<em>i.e.</em> the value of uniaxial stress
                at which the material starts to yield), and all other symbols are as in the
                previous section.</p>
            </div>
            <div class="paragraph">
              <p>For our current model, for which we will use &#963;<sub>y</sub> = 120 MPa, this evaluates to</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                F_y = \frac { (120 \, \mathrm{MPa}) (0.5 \, \mathrm{mm}) (10 \, \mathrm{mm})^2}
                {6 \, (100 \, \mathrm{mm})} = 10 \, \mathrm{N}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>You will notice that this value corresponds (not entirely coincidently) with the
                applied force used for the linear case in the previous section, for which we
                had calculated a deflection of 0.4 mm.</p>
            </div>
            <div class="paragraph">
              <p>In the yielding region, the beam deflection is</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \frac {\delta} {\delta_y} ~=~ \left ( \frac {F_y} {F} \right )^2 \left ( 5
                - \left ( 3 + \frac {F} {F_y} \right ) \sqrt {3 - \frac {2 F} {F_y} } \right )
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>This expression is only valid for 1 &#8804; <em>F</em> / <em>F<sub>y</sub></em> &#8804; 3/2; the
                cantilever
                will not withstand any force larger than this. For the current model this range corresponds
                to between 10 N and 15 N.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_changes_to_the_generation_script">7.7.2. Changes to the generation script</h4>
            <div class="paragraph">
              <p>The model generation script is named <code>create_cantilever_ep.py</code>. It differs from the script
                in the
                previous tutorial, <code>create_cantilever.py</code>, only in the definition of the
                material. This becomes</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create a material

material = vtkbone.vtkboneVonMisesIsotropicMaterial()
material.SetName("steel")
material.SetYoungsModulus(2.0E5)  # units are MPa
material.SetPoissonsRatio(0.3)
material.SetYieldStrength(120)   # units are MPa</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>For a <em>von Mises</em> elastoplastic material, we have exactly one new parameter
                as compared with a linear material, and that is the yield strength, here
                set to 120 MPa. The exact parameters required depend on the material. For
                example a <em>Mohr Coulomb</em> material would have two additional parameters,
                which are set with the method <code>SetYieldStrengths(Y_tension,Y_compression)</code>.
                As always, for exact usage refer to the <code>vtkbone</code> API documentation
                ( <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneVonMisesIsotropicMaterial.html">vtkboneVonMisesIsotropicMaterial</a>
                and
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneMohrCoulombIsotropicMaterial.html">vtkboneMohrCoulombIsotropicMaterial</a>
                ).
              </p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_generating_the_model_and_verifying_the_material">7.7.3. Generating the model and verifying the
              material</h4>
            <div class="paragraph">
              <p>As in the linear case, we generate the model with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python create_cantilever_ep.py -14.5 cantilever_ep_145.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>And we can quickly verify that this model uses a <em>von Mises</em> material
                with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88modelinfo --material cantilever_ep.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The output is</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Materials:
----------------------------------------------------------------------

  Name : steel
  Type : VonMisesIsotropic
  E : 200000.0
  nu : 0.3
  Y : 120.0
----------------------------------------------------------------------</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solving_the_model_4">7.7.4. Solving the model</h4>
            <div class="paragraph">
              <p>The cantilever is, for various reasons, a
                particularly difficult model for a finite element solver. When combined with
                nonlinear material properties, in order to get the most accurate results,
                it is necessary to tighten the convergence tolerance. Thus for the following
                results, we ran the solver as follows,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim --convergence_tolerance=1E-9 cantilever_ep_145.n88model <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Although this is a small model, elastoplastic models take considerably
                        longer to run than linear models, so if you have a system with a suitable
                        GPU, make use of the option <code>--engine=nv</code>. On the other hand, such a small
                        model is solved fastest all on one GPU, even in a system with multiple
                        available GPUs.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_plastic_strain_distribution">7.7.5. Plastic strain distribution</h4>
            <div class="paragraph">
              <p>A solution with applied force of 14.5 N is shown in <a href="#beam_bending_ep_deflection">Figure
                  39</a>.
                In comparison with the linear case of <a href="#beam_bending_deflection">Figure 36</a>,
                we see that the strain is much more concentrated near the fixed end of the beam.</p>
            </div>
            <div id="beam_bending_ep_deflection" class="imageblock">
              <div class="content">
                <img src="images/cantilever_total_strain.png" alt="cantilever total strain">
              </div>
              <div class="title">Figure 39. Deflection of loaded elastoplastic cantilever beam. Displacement amplified
                by 10. Coloration by xx component of total strain.</div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_comparison_of_finite_element_and_analytic_results">7.7.6. Comparison of finite element and analytic
              results</h4>
            <div class="paragraph">
              <p>By generating and solving models for various loads in the plastic range, we can
                generate table <a href="#elastoplastic_cantilever_results">Elastoplastic cantilever results</a>. To do
                this, first we create
                a number of sequence of models</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python create_cantilever_ep.py -10.0 cantilever_ep_100.n88model
python create_cantilever_ep.py -10.5 cantilever_ep_105.n88model
python create_cantilever_ep.py -11.0 cantilever_ep_110.n88model
python create_cantilever_ep.py -11.5 cantilever_ep_115.n88model
python create_cantilever_ep.py -12.0 cantilever_ep_120.n88model
python create_cantilever_ep.py -12.5 cantilever_ep_125.n88model
python create_cantilever_ep.py -13.0 cantilever_ep_130.n88model
python create_cantilever_ep.py -13.5 cantilever_ep_135.n88model
python create_cantilever_ep.py -14.0 cantilever_ep_140.n88model
python create_cantilever_ep.py -14.5 cantilever_ep_145.n88model
python create_cantilever_ep.py -15.0 cantilever_ep_150.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>You probably want to put all these commands in a script or batch file.</p>
            </div>
            <div class="paragraph">
              <p>And then we solve them all</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim --convergence_tolerance=1E-9 cantilever_ep_100.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_105.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_110.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_115.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_120.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_125.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_130.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_135.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_140.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_145.n88model
faim --convergence_tolerance=1E-9 cantilever_ep_150.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As we can see from the number
                of elements exceeding the plastic limit (the last column of the table), FAIM does
                indeed show plastic onset at 10 N load. The data from table <a
                  href="#elastoplastic_cantilever_results">Elastoplastic cantilever results</a>
                are visualized in <a href="#cantilever_elastoplastic">Figure 40</a>. Agreement is very good until the
                onset of
                beam failure approaches. Then there begins to be a some divergence between
                FAIM and the analytic results. Better agreement can be obtained with a
                smaller element size, but fundamentally near the singularity of failure,
                there are very rapid changes in plastic strain through the cross-section,
                and these cannot be well modelled by numerical discretisation. However,
                away from this singularity, numerical results are good.</p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>When running several models at different parameter points, it can
                        become tedious to open each analysis file and search out the relevant
                        quantity. We can use the <a href="#n88tabulate">n88tabulate</a> tool to save
                        some effort. In the present case, after we have solved all the models,
                        the following command will generate the 4<sup>th</sup> column of the table
                        (displacement as calculated by FAIM):</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>n88tabulate -V dz_avg_ns2 *_analysis.txt</pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>The variable name for the desired quantity (here <code>dz_avg_ns2</code>) can either be found
                        in the
                        <a href="#n88tabulate">n88tabulate</a> section of the manual, or by referring
                        to the on-line help from running <a href="#n88tabulate">n88tabulate</a> with the
                        <code>-h</code> flag.
                      </p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <table id="elastoplastic_cantilever_results" class="tableblock frame-all grid-all" style="width: 80%;">
              <caption class="title">Table 4. Elastoplastic cantilever results</caption>
              <colgroup>
                <col style="width: 20%;">
                <col style="width: 20%;">
                <col style="width: 20%;">
                <col style="width: 20%;">
                <col style="width: 20%;">
              </colgroup>
              <tbody>
                <tr>
                  <th class="tableblock halign-right valign-top">
                    <p class="tableblock">load</p>
                  </th>
                  <th class="tableblock halign-center valign-top" colspan="3">
                    <p class="tableblock">tip displacement</p>
                  </th>
                  <th class="tableblock halign-right valign-top">
                    <p class="tableblock">yielded</p>
                  </th>
                </tr>
                <tr>
                  <th class="tableblock halign-right valign-top"></th>
                  <th class="tableblock halign-right valign-top">
                    <p class="tableblock">linear</p>
                  </th>
                  <th class="tableblock halign-right valign-top">
                    <p class="tableblock">analytic elastoplastic</p>
                  </th>
                  <th class="tableblock halign-right valign-top">
                    <p class="tableblock">faim elastoplastic</p>
                  </th>
                  <th class="tableblock halign-right valign-top"></th>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.40</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4000</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4020</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>2</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.42</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4201</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4222</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>4</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.44</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4406</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4427</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>28</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.46</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4621</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4641</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>50</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.48</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4852</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4869</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>84</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.50</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5107</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5120</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>124</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.52</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5397</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5404</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>174</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.54</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5745</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5738</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>228</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>14.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.56</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6188</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6149</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>294</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>14.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.58</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6835</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6700</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>368</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>15.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.60</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.8889</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.7560</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>454</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
            <div id="cantilever_elastoplastic" class="imageblock">
              <div class="content">
                <img src="images/cantilever_elastoplastic.png" alt="cantilever elastoplastic">
              </div>
              <div class="title">Figure 40. Comparison of FAIM and analytic results for elastoplastic cantilever.</div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>If you want, you can experiment with increasing the number of elements
                        in the model (reducing the element size) to see how this affects the result.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_incremental_loading_and_hysteresis">7.7.7. Incremental loading and hysteresis</h4>
            <div class="paragraph">
              <p>Up to this point, we have solved a sequence of nonlinear models
                at different loads without giving a lot of thought about how these
                loads are applied. In fact we have solved each load point "from scratch".
                From a theoretical point of view, it would be better to start from
                the greatest load for which the model stays in the linear range,
                and then incrementally add small amounts of load, obtaining a sequence
                of slowly changing nonlinear solutions, each of which is used as the starting point
                for the solver for the subsequent load. This is discussed in
                <a href="#nonlinear_progressive_loads">Obtaining accurate nonlinear solutions by progressively applying
                  loads</a>. The question is, does this actually
                matter?
                Here we will investigate this and discover that the answer is
                "it depends".
              </p>
            </div>
            <div class="paragraph">
              <p>The first thing we need is a script to take an existing
                solved n88model file, and modify the applied force. You can find
                this script, named <code>modify_force.py</code>, in the <code>cantilever</code>
                subdirectory of the examples. Since you are getting by now pretty
                good at scripts, here are all the preliminaries, up to
                reading in an existing n88 model file:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>from __future__ import division
import argparse
import vtk
import vtkbone

script_version = 1

parser = argparse.ArgumentParser (
    description="""Take an existing cantilever model file, and modify the applied force
while leaving any existing solution unmodified. It can thus be used as the starting
value for a solution with the new applied force.""")

parser.add_argument ("input_file",
   help="An existing cantilever model file.")

parser.add_argument ("applied_force", type=float,
   help="The new applied force.")

parser.add_argument ("output_file",
    help="Name for output file.")

args = parser.parse_args()

# Read existing model (including possible solution)

print(f"Reading n88model file: {args.input_file}")
reader = vtkbone.vtkboneN88ModelReader()
reader.SetFileName (args.input_file)
reader.Update()
model = reader.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now, we could modify the numerical values of the force constraint,
                but from a programming view, it is easier to just delete it
                and re-create it.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Delete the old applied force.

model.GetConstraints().RemoveItem("end_force")

# Apply the new force to the far end of the beam.

model.ApplyLoad(
	"face_x1",
	vtkbone.vtkboneConstraint.FACE_X1_DISTRIBUTION,
	vtkbone.vtkboneConstraint.SENSE_Z,
	args.applied_force,
	"end_force")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>That&#8217;s the meat of it. Now we just finish up with the usual
                entires to the history and the log, and write out the
                modified file.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Update history and log

model.AppendHistory(f"Modified modify_force.py version {script_version} .")

model.AppendLog(
"""modify_force.py
Changed applied force on far face edge to {args.applied_force} .
Using vtkbone version {vtkbone.vtkboneVersion.GetvtkboneVersion()} .
"""
)

# Write an n88model file

print(f"Writing n88model file: {args.output_file}")
writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(args.output_file)
writer.Update()</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>Had we created the model with <a href="#n88modelgenerator">n88modelgenerator</a>,
                        it would have been even easier to change the load in the model
                        file: <a href="#n88modelgenerator">n88modelgenerator</a> can take as an input
                        an existing model file, and it will preserve any existing solutions
                        while modifying the material properties or constraints according
                        to the command line arguments in the usual fashion.</p>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now to run this, we first create and solve a nonlinear model as we
                did above, with an applied
                force that we know, from the previous analysis, is just at the
                limit of linear behaviour.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python create_cantilever_ep.py -10 cantilever_ep.n88model
faim --convergence_tolerance=1e-9 cantilever_ep.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As previously, we can extract from the analysis file just the numerical
                value for the deflection, like this</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88tabulate -V dz_avg_ns2 cantilever_ep_analysis.txt</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>which returns <code>-4.020E-01</code>.</p>
            </div>
            <div class="paragraph">
              <p>Now we use our <code>modify_force.py</code> script to increase to applied
                force to -10.5 .</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python modify_force.py cantilever_ep.n88model -10.5 from_100_to_105.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>And we solve it and extract the new deflection.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim --convergence_tolerance=1E-9 from_100_to_105.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>What we want to see, is that faim starts with the following
                two status lines:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Model contains elastoplastic material definitions.
Model contains existing solution.</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>And further on, once the solver <code>solver_sp</code> itself has been launched,
                we want to verify that we see the following status output:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Using existing solution as starting value.</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Then, rinse and repeat until the desired final load is reached:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python modify_force.py from_100_to_105.n88model -11 from_105_to_110.n88model
faim --convergence_tolerance=1E-9 from_105_to_110.n88model
n88tabulate -V dz_avg_ns2 from_105_to_110_analysis.txt
python modify_force.py from_105_to_110.n88model -11.5 from_110_to_115.n88model
faim --convergence_tolerance=1E-9 from_110_to_115.n88model
n88tabulate -V dz_avg_ns2 from_110_to_115_analysis.txt</pre>
              </div>
            </div>
            <div class="paragraph">
              <p><em>and so on</em> . . .</p>
            </div>
            <div class="paragraph">
              <p>We can thus add another column to <a href="#elastoplastic_cantilever_results">Elastoplastic cantilever
                  results</a>,
                and compare the &#8220;all-at-once&#8221; nonlinear solutions with the
                incremental solutions. <a href="#elastoplastic_cantilever_incr">Elastoplastic cantilever incremental
                  results</a>
                shows just these two columns. The results are practically
                indistinguishable. So can we therefore conclude that carefully applying
                an incremental load is pointless extra work? Not quite. We
                are not at the end of the story yet. Let us take our solution
                at a load of 14.5, and from there <em>decrement</em> the applied load back down
                to the linear region. Programmatically, this looks much like before:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>python modify_force.py from_140_to_145.n88model -14 from_145_to_140.n88model
faim --convergence_tolerance=1E-9 from_145_to_140.n88model
python modify_force.py from_145_to_140.n88model -13.5 from_140_to_135.n88model
faim --convergence_tolerance=1E-9 from_140_to_135.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p><em>and so on</em> . . .</p>
            </div>
            <div class="paragraph">
              <p>We can tabulate all the deflections at once,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88tabulate -V filename,dz_avg_ns2 *_analysis.txt</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>These additional load decreasing points are tabulated in
                <a href="#elastoplastic_cantilever_decr">Elastoplastic cantilever results for decreasing loads</a>.
                These are plotted
                together with the increasing load points up to 14.5 in
                <a href="#cantilever_hysteresis">Figure 41</a>. Now we see that that there is
                in fact a difference. Indeed we recognize the classic hysteresis
                curve. (Note that compared with <a href="#cantilever_elastoplastic">Figure 40</a>, we have swapped the
                axes, just so that it looks more conventional.)
              </p>
            </div>
            <table id="elastoplastic_cantilever_incr" class="tableblock frame-all grid-all" style="width: 80%;">
              <caption class="title">Table 5. Elastoplastic cantilever incremental results</caption>
              <colgroup>
                <col style="width: 33.3333%;">
                <col style="width: 33.3333%;">
                <col style="width: 33.3334%;">
              </colgroup>
              <thead>
                <tr>
                  <th class="tableblock halign-right valign-top">load</th>
                  <th class="tableblock halign-right valign-top">FAIM EP</th>
                  <th class="tableblock halign-right valign-top">FAIM incr</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4020</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4020</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4222</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4222</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4427</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4427</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4641</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4641</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4869</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4870</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5120</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5120</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5404</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5405</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5738</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5738</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>14.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6149</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6150</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>14.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6700</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6700</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>15.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.7560</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.7560</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>15.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.9611</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.9611</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
            <table id="elastoplastic_cantilever_decr" class="tableblock frame-all grid-all" style="width: 80%;">
              <caption class="title">Table 6. Elastoplastic cantilever results for decreasing loads</caption>
              <colgroup>
                <col style="width: 50%;">
                <col style="width: 50%;">
              </colgroup>
              <thead>
                <tr>
                  <th class="tableblock halign-right valign-top">load</th>
                  <th class="tableblock halign-right valign-top">FAIM decr</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>14.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6499</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6299</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>13.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.6098</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5897</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>12.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5696</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5495</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>11.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5294</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.5</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.5093</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>10.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.4892</code></p>
                  </td>
                </tr>
                <tr>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.0</code></p>
                  </td>
                  <td class="tableblock halign-right valign-top">
                    <p class="tableblock"><code>0.0874</code></p>
                  </td>
                </tr>
              </tbody>
            </table>
            <div id="cantilever_hysteresis" class="imageblock">
              <div class="content">
                <img src="images/cantilever_hysteresis.png" alt="cantilever hysteresis">
              </div>
              <div class="title">Figure 41. Hysteresis exhibited by elastoplastic cantilever.</div>
            </div>
            <div class="paragraph">
              <p>This concludes the tutorial on a cantilever with elastoplastic
                material properties. We learned how to use elastoplastic materials
                in <code>vtkbone</code> scripts, and also how to apply loads in incremental steps to
                nonlinear models by modifying an existing <code>n88model</code> file. By
                carefully applying incremental loading to the cantilever, we
                determined that results were essentailly unaffected as compared with an
                &#8220;all at once&#8221; solution for the initial deflection of the
                beam, but that a residual deflection remains during the subsequent
                unloading of the beam. This residual deflection, which is the hysteresis,
                can only be observed by applying the load incrementally.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="screw_pullout_tutorial">7.8. Advanced custom model: A screw pull-out test</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>In the preceding tutorials we were introduced to using <code>vtkbone</code> to create
              original models that cannot be generated using
              <a href="#n88modelgenerator">n88modelgenerator</a> . We mentioned
              that frequently the most challenging part of creating such
              models is identifying the sets of nodes and/or elements
              corresponding to the boundary conditions that
              we desire. In that tutorial, however, we didn&#8217;t actually need to identify
              any such sets ourselves, as we found that the standard node and element
              sets as provided by <a
                href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
              were suitable for
              our purposes. In this tutorial, by contrast, we will use
              some sophisticated criteria for identifying the desired sets
              for boundary conditions. This includes,
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Identifying and characterizing features in the input image. Namely, we will
                  determine the geometric location of a screw axis.</p>
              </li>
              <li>
                <p>Identifying nodes by spatial location (distance from the
                  screw, as well as depth from the top surface).</p>
              </li>
              <li>
                <p>We will further reduce the selection of nodes based on visibility
                  from a certain viewing angle, which is a useful technique
                  for locating nodes on an uneven surface.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>In the course of this example, we will generate the files <code>screwpullout.py</code>
              and <code>screwpullout.conf</code>. You can find the completed versions of these files in
              the <code>examples/screwpullout</code> directory of the distribution.</p>
          </div>
          <div class="sect3">
            <h4 id="_the_model_a_screw_pull_out_test">7.8.1. The model: a screw pull-out test</h4>
            <div class="paragraph">
              <p>This example is a finite element model of an important mechanical test for
                orthopaedic biomechanics. This tutorial is
                based on the work of <a href="#stadelmann2012">Stadelmann et al (2012)</a>. Physical
                tests were done in which a volume of bone substitute
                was constrained with a ring and the screw was pulled out. Here we
                construct a finite element model corresponding to this physical test.</p>
            </div>
            <div class="paragraph">
              <p>The geometry of the model is in the file <code>sawbone.aim</code> in the <code>data</code>
                directory of the distribution. It consists of a volume of bone substitute into which
                a screw has been embedded. This is shown in <a href="#screw_model_image">Figure 42</a>.
                The data have been segmented such that
                bone substitute is labelled with ID 127 (shown in beige), and the screw with ID 90
                (shown in blue). The mechanical test is to find the force
                required to pull out the screw.</p>
            </div>
            <div id="screw_model_image" class="imageblock">
              <div class="content">
                <img src="images/screw_model_image_hr.png" alt="screw model image hr">
              </div>
              <div class="title">Figure 42. Screw model segmented image</div>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    The script will look for the data file <code>sawbone.aim</code> in
                    whatever directory it is run from. On your distribution, the example
                    script and the data file are in different directories, <code>examples/screwpullout</code>
                    and <code>data</code> respectively. We recommend that you copy the files from both
                    these directories to a temporary working directory for this tutorial.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_preliminaries_first_lines_of_python_2">7.8.2. Preliminaries: first lines of Python</h4>
            <div class="paragraph">
              <p>Using your favourite text editor, create a file <code>screwpullout.py</code>.</p>
            </div>
            <div class="paragraph">
              <p>By now you should be pretty familiar with importing the necessary Python
                modules:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>from __future__ import division
import os
import sys
import time
import vtk
import vtkbone</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As before, we&#8217;ll also set a script version number:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>script_version = n <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>A version of this script has been used as a tutorial in previous versions
                    of Faim. In Faim 10.0 we are on the n<sup>th</sup> iteration
                    of this script.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Since generating a model from a large micro-CT scan can take a lot of time,
                it is convenient to print status messages as the script proceeds, and to have
                these messages time stamped, so that we can see what steps potentially should be
                optimized (or where the script fails). The following function will take one or more strings and print
                them
                out one per line, with a time stamp on the first, and indenting the subsequent
                lines.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>def message(msg, *additionalLines):
    """Print message with time stamp.

    The first argument is printed with a time stamp.
    Subsequent arguments are printed one to a line without a timestamp.
    """
    print(f"{(time.time()-start_time):8.2f} {msg}")
    for line in additionalLines:
        print(" "*9 + line)

start_time = time.time()</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_using_a_configuration_file_to_store_parameters">7.8.3. Using a configuration file to store
              parameters</h4>
            <div class="paragraph">
              <p>This model is going to be quite complicated. To keep things orderly,
                we will put all our parameters in a configuration file. The
                configuration file is a record of exactly which parameters were used to
                generate a particular model. We&#8217;re going to write the configuration file
                itself in Python code, so that we don&#8217;t have to write a file parser to read
                it. Here is what the configuration file (<code>screwpullout.conf</code>) looks like:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># -------------------------------------------------------------------------
#  Configuration file screwpullout.conf
#
#  This configuration file is in the format of python source code.
#  If you stick with simple assignments, then it looks like a typical
#  configuration file, and can probably be read with other file parsers,
#  if you wish to do so.

# Input image file.
input_image_file = "sawbone.aim"

# Output n88model file.
# - take the input file name and change the extension to .n88model
n88model_file = os.path.splitext(input_image_file)[0] + ".n88model"

# Bone material
bone_material_id = 127
bone_material_modulus = 6829.0    # 6829.0 MPa for bone
bone_material_poissons_ratio = 0.3

# Screw material
screw_material_id = 90
screw_material_modulus = 69000.0   # 69 GPa for Aluminum
screw_material_poissons_ratio = 0.3

# Displacement (in physical length units of the model) applied to the screw
# surface.
screw_displacement = 0.01

# Ring radii for finding nodes of bone material to which we will apply the
# constrained ring.
inner_ring_radius = 4.5
outer_ring_radius = 7.0

# Max depth for finding nodes of bone material to which we will apply the
# constrained ring.  The max is measured from the highest node of constrained
# bone found.
bone_constraint_max_depth = 1.5</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Now we add to our script the following:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>A bit of code to get the configuration file name from the command line.</p>
                </li>
                <li>
                  <p>A few lines to execute the configuration file as Python code.</p>
                </li>
                <li>
                  <p>Some lines to print out all the values that we expected to read in. This is very good practice so
                    when you run it, you can verify that everything is as you expect.</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>All that looks like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>if len(sys.argv) != 2:
  print("Usage: python screwpullout.py example.conf")
  sys.exit(1)
config_file = sys.argv[1]

# Read in configuration file.
message("Reading configuration file " + config_file)
# Here we are actually executing it as python code.
with open(config_file) as f:
    code = compile(f.read(), config_file, 'exec')
    exec(code)

# Print out values that we read in.  This also has the effect of causing
# this script to die if configuration values are missing (which is a good thing).
settings_text = ["Configuration:"]
settings_text.append( "input file                     = %s" % input_image_file)
settings_text.append( "output file                    = %s" % n88model_file)
settings_text.append( "bone material id               = %s" % bone_material_id)
settings_text.append( "bone material Young's modulus  = %s" % bone_material_modulus)
settings_text.append( "bone material Poisson's ratio  = %s" % bone_material_poissons_ratio)
settings_text.append( "screw material id              = %s" % screw_material_id)
settings_text.append( "screw material Young's modulus = %s" % screw_material_modulus)
settings_text.append( "screw material Poisson's ratio = %s" % screw_material_poissons_ratio)
settings_text.append( "screw displacement             = %s" % screw_displacement)
settings_text.append( "inner ring radius              = %s" % inner_ring_radius)
settings_text.append( "bone constraint max depth      = %s" % bone_constraint_max_depth)
message(*settings_text) <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is slightly advanced python, where the asterisk means that
                    we pass the list of <em>N</em> items (strings in this case) not as a single list
                    argument, but as <em>N</em> individual arguments. It just happens that given
                    the way we wrote our <code>message</code> function, this is the best thing to do
                    here.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now when we run our script, we also have to specify the name of the
                configuration file:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python screwpullout.py screwpullout.conf</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_reading_the_segmented_image_file">7.8.4. Reading the segmented image file</h4>
            <div class="paragraph">
              <p>We will use a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneAIMReader.html">vtkboneAIMReader</a>
                to read the data file, which is
                in the Scanco AIM file format. This file contains a segmented image.
                As well, we want to add some additional
                lines to report our progress, and print some values as a sanity check.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Reading input data.")
reader = vtkbone.vtkboneAIMReader()
reader.SetFileName(input_image_file)
reader.DataOnCellsOn() <img src="./images/icons/callouts/1.png" alt="1">
reader.Update()
image = reader.GetOutput()
message("Read %d points from image file." % image.GetNumberOfPoints())
image_bounds = image.GetBounds() <img src="./images/icons/callouts/2.png" alt="2">
message("Image bounds:", (" %.4f"*6) % image_bounds)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>As discussed in several previous tutorials, we can either have the image
                    data on the Cells or the Points. <code>vtkbone</code> is
                    generally agnostic on this point, but it is good to be clear.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>This is a standard VTK method for many types of VTK objects, returning an
                    array of six values: x<sub>min</sub>, x<sub>max</sub>, y<sub>min</sub>, y<sub>max</sub>,
                    z<sub>min</sub>, z<sub>max</sub>.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>The output so far, when we run the Python script, will look something like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python screwpullout.py screwpullout.conf
    0.00 Reading configuration file screwpullout.conf
    0.00 Configuration:
         input file                     = sawbone.aim
         output file                    = sawbone.n88model
         bone material id               = 127
         bone material Young's modulus  = 6829.0
         bone material Poisson's ratio  = 0.3
         screw material id              = 90
         screw material Young's modulus = 69000.0
         screw material Poisson's ratio = 0.3
         screw displacement             = 0.01
         inner ring radius              = 4.5
         bone constraint max depth      = 1.5
    0.00 Reading input data.
    0.07 Read 5775920 points from AIM file.
    0.07 Image bounds:
          11.9700 27.4740 11.7420 27.1320 0.1140 35.3400</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_converting_the_image_data_to_elements">7.8.5. Converting the image data to elements</h4>
            <div class="paragraph">
              <p>As in the tutorial <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using
                  <code>vtkbone</code></a>,
                we need to convert
                the input CT image data to a <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
                object representing the
                geometry. Again, we will use a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneImageToMesh.html">vtkboneImageToMesh</a>
                filter for this purpose.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Converting to hexahedral cells.")
mesher = vtkbone.vtkboneImageToMesh()
mesher.SetInputData(image)
mesher.Update()
mesh = mesher.GetOutput()
message("Generated %d hexahedrons" % mesh.GetNumberOfCells())</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_defining_material_properties">7.8.6. Defining material properties</h4>
            <div class="paragraph">
              <p>Once again, we repeat the steps of the tutorial
                <a href="#cube_with_vtkbone_tutorial">Compressing a cube revisited using <code>vtkbone</code></a>,
                and we generate a material table and two materials: bone and
                screw.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message ("Creating material table.")
material_table = vtkbone.vtkboneMaterialTable()

# Create an isotropic material for bone and add it to the table.
bone_material = vtkbone.vtkboneLinearIsotropicMaterial()
bone_material.SetName("bone")
bone_material.SetYoungsModulus(bone_material_modulus)
bone_material.SetPoissonsRatio(bone_material_poissons_ratio)
material_table.AddMaterial(bone_material_id, bone_material)

# Create an isotropic material for the screw and add it to the table.
screw_material = vtkbone.vtkboneLinearIsotropicMaterial()
screw_material.SetName("screw")
screw_material.SetYoungsModulus(screw_material_modulus)
screw_material.SetPoissonsRatio(screw_material_poissons_ratio)
material_table.AddMaterial(screw_material_id, screw_material)</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_creating_a_vtkbonefiniteelementmodel_object">7.8.7. Creating a vtkboneFiniteElementModel object
            </h4>
            <div class="paragraph">
              <p>In the tutorial,
                <a href="#cantilever_tutorial">Deflection of a cantilevered beam; adding custom boundary conditions and
                  loads</a>,
                we used <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                to combine the geometry with
                the model table into a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object.
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                didn&#8217;t create any displacement boundary conditions
                or applied loads for us, but it did define some standard sets that we
                subsequently used to define our displacement boundary conditions and applied load.
                This time, those standard sets won&#8217;t we very useful for us. So instead
                of <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneApplyTestBase.html">vtkboneApplyTestBase</a>
                , we&#8217;ll use an even more elementary
                model-creating filter called <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModelGenerator.html">vtkboneFiniteElementModelGenerator</a>
                ,
                which creates a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object without any
                pre-defined sets.
              </p>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    Actually, it is not quite true that we couldn&#8217;t use need any standard
                    sets. The standard set &#8220;face_z1&#8221; would be
                    the top surface of the screw, which is one of the sets that we need.
                    However, for the purposes of demonstration, we&#8217;ll show how to find
                    that node set manually.
                  </td>
                </tr>
              </table>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Constructing a finite element model object.")
generator = vtkbone.vtkboneFiniteElementModelGenerator()
generator.SetInputData(0, mesh)
generator.SetInputData(1, material_table)
generator.Update()
model = generator.GetOutput()
model.ComputeBounds() <img src="./images/icons/callouts/1.png" alt="1">
bounds = model.GetBounds()
message("Model bounds:", (" %.4f"*6) % bounds)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Unlike <a href="http://www.vtk.org/doc/release/6.3/html/classvtkImageData.html">vtkImageData</a>
                    objects, <a
                      href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>
                    objects,
                    from which <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                    objects are derived, don&#8217;t
                    know their bounds unless you explicitly request them to be computed.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_writing_an_n88model_file_2">7.8.8. Writing an n88model file</h4>
            <div class="paragraph">
              <p>Now that we have a <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object, we can save it.
                Of course, the model isn&#8217;t finished yet, but just as in the previous tutorial,
                we can still save it and examine it as we go.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Writing file %s" % n88model_file)
writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(n88model_file)
writer.Update()</pre>
              </div>
            </div>
            <div class="admonitionblock important">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/important.png" alt="Important">
                  </td>
                  <td class="content">
                    Once again, in everything that follows it is intended that you add
                    new lines to the script <strong>before</strong> the code (show just above) that saves
                    the model to a file. Otherwise of course the saved <code>n88model</code> file won&#8217;t
                    reflect our additions and changes.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_history_and_log_fields">7.8.9. Adding history and log fields</h4>
            <div class="paragraph">
              <p>By now you&#8217;ll be familiar with adding History and Log fields to help us
                later trace back the details of the creation of this model. Let&#8217;s add
                all this information (before the code to save the file!):</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.AppendHistory("Created by screwpullout.py version %s ." % script_version)

model.AppendLog(
"""screwpullout.py
Model of screw being pulled out of bone substitute material.
Using VTKBONE version %s .
Configuration file : %s
""" % (vtkbone.vtkboneVersion.GetVTKBONEVersion(), config_file)
+ "\n".join(settings_text)) <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This looks a little bit complicated. <code>"\n".join(settings_text))</code>
                    converts the Python list of strings to a single long string,
                    inserting a line return ("\n") between each list item. We then just
                    add it to the other string.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now run the script. As a reminder, this is done with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python screwpullout.py screwpullout.conf</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As shown in previous tutorials,
                we can retrieve the History and Log fields from the <code>n88model</code> file
                at any time with <a href="#n88modelinfo">n88modelinfo</a>:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --history --log sawbone.n88model
History:
----------------------------------------------------------------------
2016-Sep-27 16:12:21 Created by screwpullout.py version 8 .
----------------------------------------------------------------------

Log:
----------------------------------------------------------------------
2016-Sep-27 16:12:21
screwpullout.py
Model of screw being pulled out of bone substitute material.
Using vtkbone version 1.0 .
Configuration file : screwpullout.conf
Configuration:
input file                     = sawbone.aim
output file                    = sawbone.n88model
bone material id               = 127
bone material Young's modulus  = 6829.0
bone material Poisson's ratio  = 0.3
screw material id              = 90
screw material Young's modulus = 69000.0
screw material Poisson's ratio = 0.3
screw displacement             = 0.01
inner ring radius              = 4.5
bone constraint max depth      = 1.5
----------------------------------------------------------------------</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_determining_the_screw_orientation">7.8.10. Determining the screw orientation</h4>
            <div class="paragraph">
              <p>In order to properly apply the desired constraints, we will need to know where
                the screw is. We can do this algorithmically, by calculating the principal
                axes of inertia of the screw using <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneTensorOfInertia.html">vtkboneTensorOfInertia</a>
                . We are going to assume
                that the principal axis closest to the <em>z</em> axis is the screw axis. This won&#8217;t be
                exactly true. Consider for example if the screw is cut off unevenly, then the
                principal axis of inertia won&#8217;t be exactly the same as the screw axis, but for
                our purposes, it is good enough.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Determining screw geometry.")

moi = vtkbone.vtkboneTensorOfInertia()
moi.SetInputData(image)
moi.SetSpecificValue(screw_material_id) <img src="./images/icons/callouts/1.png" alt="1">
moi.Update()
message("Number of cells belonging to screw: %d" % moi.GetCount())
message("Volume of screw: %.2f" % moi.GetVolume())
screwCenterOfMass = (moi.GetCenterOfMassX(),
                     moi.GetCenterOfMassY(),
                     moi.GetCenterOfMassZ())
message("Center of mass of screw: %.5f, %.5f, %.5f" % screwCenterOfMass)
screwAxis = moi.GetPrincipalAxisClosestToZ()
message("Axis of screw: %.5f, %.5f, %.5f" % screwAxis)
screwDistanceToBoundary = (bounds[5] - screwCenterOfMass[2]) / screwAxis[2]
screwCenterAtBoundary = (
    screwCenterOfMass[0] + screwDistanceToBoundary * screwAxis[0],
    screwCenterOfMass[1] + screwDistanceToBoundary * screwAxis[1],
    bounds[5]) <img src="./images/icons/callouts/2.png" alt="2">
message("Distance from screw center of mass to top boundary: %.3f" % screwDistanceToBoundary)
message("Screw center at top boundary: %.3f, %.3f, %.3f" % screwCenterAtBoundary)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is how we limit the inertia tensor to be calculated only
                    over the screw elements.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>This is a simple geometric calculation: given the center of mass
                    of the screw and the direction of the screw axis, find the
                    intersection with the upper bound of the model.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now we run it, and this part of the script generates output like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>    1.55 Determining screw geometry.
    1.67 Number of cells belonging to screw: 449618
    1.67 Volume of screw: 666.13
    1.67 Center of mass of screw: 20.20622, 19.02016, 18.21310
    1.67 Axis of screw: -0.00733, -0.00243, 0.99997
    1.67 Distance from screw center of mass to boundary: 16.785
    1.67 Screw center at boundary: 20.083, 18.979, 34.998</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Comparing by eye with the rendering in ParaView, we can determine that these
                values are about right, so we give ourselves a gold star in advanced math
                and carry on.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_a_boundary_condition_applying_a_displacement_to_the_screw_end">7.8.11. Adding a boundary
              condition: applying a displacement to the screw end</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>We want to add a boundary condition to the screw where it intersects the
                boundary of the model. All these nodes lie on a plane, so they are easily
                found with the function <code>AddNodesOnPlane</code> provided in <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneNodeSetsByGeometry.html">vtkboneNodeSetsByGeometry</a>
                .
                Note that these nodes get associated with the FE model object, and we have
                to assign a name, in this case &#8220;screw_top&#8221;, so that we can refer later
                to this set.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Adding the screw_top boundary condition.")

vtkbone.vtkboneNodeSetsByGeometry.AddNodesOnPlane(
    2, <img src="./images/icons/callouts/1.png" alt="1">
    bounds[5], <img src="./images/icons/callouts/2.png" alt="2">
    "screw_top", <img src="./images/icons/callouts/3.png" alt="3">
    model,
    screw_material_id) <img src="./images/icons/callouts/4.png" alt="4">
message("Found %d nodes belonging to screw_top" %
     model.GetNodeSet("screw_top").GetNumberOfTuples())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The value 2 specified the z-axis (VTK and python being zero-indexed).</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>This is <em>z<sub>max</sub></em>.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                  <td>The name of the node set we are creating.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/4.png" alt="4"></td>
                  <td>This argument is optional, and specifies that we only want nodes
                    associated with material ID &#8220;screw_material_id&#8221;. This is not
                    actually necessary for the given data, since no elements of other
                    material IDs intersect the <em>z<sub>max</sub></em> surface.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We want to be able to inspect this result, and ensure that we have in fact
                selected the nodes on the top of the screw. To do this, run the script to
                update the model file. Now, as in the tutorial
                <a href="#radius_bending_tutorial">Bending test of a radius bone with an uneven surface</a>,
                we are going to use the tool
                <a href="#n88extractsets">n88extractsets</a> to extract and visualize the node set.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88extractsets sawbone.n88model
Reading N88 Model file : sawbone.n88model
Writing node set : sawbone_node_set_screw_top.vtp</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The file <code>sawbone_node_set_screw_top.vtp</code> can be opened an visualized with ParaView.
                The nodes are shown in <a href="#screw_top_nodes">Figure 43</a>, exactly on the end of the screw.
                This is what we want.</p>
            </div>
            <div id="screw_top_nodes" class="imageblock">
              <div class="content">
                <img src="images/screw_top_nodes_hr.png" alt="screw top nodes hr">
              </div>
              <div class="title">Figure 43. Screw top nodes, shown as white dots on the surface of the screw</div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>An alternative to using <a href="#n88extractsets">n88extractsets</a> is to add lines
                        to extract and save the node set directly to the script. We no
                        longer recommend this, as it makes the script longer, more complex, and
                        slower to run. However, for the record, this is how it would be done,</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>writer = vtk.vtkXMLUnstructuredGridWriter()
writer.SetInputData(model.DataSetFromNodeSet("screw_top"))
writer.SetFileName("screw_top_nodes.vtu")
writer.Update()</pre>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Having verified that we have found the set of nodes that we want, we can use
                the method <code>ApplyBoundaryCondition</code> of the <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                object to create a boundary condition. Note that we also give this the
                name &#8220;screw_top_displacement&#8221;.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.ApplyBoundaryCondition(
    "screw_top", <img src="./images/icons/callouts/1.png" alt="1">
    2, <img src="./images/icons/callouts/2.png" alt="2">
    screw_displacement, <img src="./images/icons/callouts/3.png" alt="3">
    "screw_top_displacement")</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The name of the set to which is applied the boundary condition.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>Once again the value 2 means the <em>z</em> direction</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                  <td>This variable is the numerical value of the displacement.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_fixing_the_nodes_in_a_ring_on_the_bone_surface">7.8.12. Fixing the nodes in a ring on the bone
              surface</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>This boundary condition is much more difficult, because we want to find nodes lying
                approximately in a ring on a rough surface. The approach we will take is to
                successively whittle down candidate nodes by applying a sequence of criteria,
                until we have finally just the nodes we want. These are the criteria:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Elements (cells) lie between a specified inner radius and outer radius, as
                    measured from the screw axis.</p>
                </li>
                <li>
                  <p>Nodes lie within a maximum specified depth from the highest node satisfying
                    the first criterion.</p>
                </li>
                <li>
                  <p>Nodes are visible from above.</p>
                </li>
              </ol>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    These selection criterion could in principle be applied in a different order.
                    The reason for doing the selection by visibility last, is that it is
                    computationally expensive, so we want to whittle down the candidate
                    nodes/elements as much as possible before applying a visibility test.
                  </td>
                </tr>
              </table>
            </div>
            <div id="selecting_cells_within_a_cylinder" class="paragraph">
              <div class="title">Step 1: Selecting cells within a hollow cylinder</div>
              <p>VTK uses the concept of implicit functions which can be used to select points and cells
                within or without a certain geometry. Here we are going to use two
                <a href="http://www.vtk.org/doc/release/6.3/html/classvtkCylinder.html">vtkCylinder</a> objects, and
                combine them with a difference operation with a
                <a href="http://www.vtk.org/doc/release/6.3/html/classvtkImplicitBoolean.html">vtkImplicitBoolean</a> .
                This will result in a hollow cylinder. VTK has a filter
                object, <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkExtractGeometry.html">vtkExtractGeometry</a> ,
                that will select points and cells based on a
                specified implicit function.
              </p>
            </div>
            <div class="paragraph">
              <p>One complication is that set of Points in the output of <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkExtractGeometry.html">vtkExtractGeometry</a> are
                different than the
                original Points, and so the Point IDs will be different. However, we need to know the
                original Point IDs in order to be able to apply boundary conditions to the FE model.
                The solution to this is to use a concept in VTK called &#8220;Pedigree ID&#8221;. These
                can be accessed with the method <code>GetPedigreeIds</code> from the PointData.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Not every VTK data set will have Pedigree IDs. They must be
                    added to the data set before we start chopping out subsets.
                    However, by default
                    <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModelGenerator.html">vtkboneFiniteElementModelGenerator</a>
                    creates <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                    objects with Pedigree IDs.
                  </td>
                </tr>
              </table>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Adding the fixed_bone_surface boundary condition.")

inner_cylinder = vtk.vtkCylinder() <img src="./images/icons/callouts/1.png" alt="1">
inner_cylinder.SetRadius(inner_ring_radius)
inner_cylinder.SetCenter(screwCenterAtBoundary[0], 0, screwCenterAtBoundary[1]) <img src="./images/icons/callouts/2.png" alt="2">

outer_cylinder = vtk.vtkCylinder()
outer_cylinder.SetRadius(outer_ring_radius)
outer_cylinder.SetCenter(screwCenterAtBoundary[0], 0, screwCenterAtBoundary[1]) <img src="./images/icons/callouts/2.png" alt="2">

rotate_Y_to_Z = vtk.vtkTransform() <img src="./images/icons/callouts/3.png" alt="3">
rotate_Y_to_Z.RotateX(90)

cylinder_difference = vtk.vtkImplicitBoolean()
cylinder_difference.AddFunction(outer_cylinder)
cylinder_difference.AddFunction(inner_cylinder)
cylinder_difference.SetOperationTypeToDifference()
cylinder_difference.SetTransform(rotate_Y_to_Z)

cylinder_extractor = vtk.vtkExtractGeometry()
cylinder_extractor.SetImplicitFunction(cylinder_difference)
cylinder_extractor.SetInputData(model)
cylinder_extractor.Update()
geometry_in_ring = cylinder_extractor.GetOutput() <img src="./images/icons/callouts/4.png" alt="4">

message("Found %d elements between inner and outer radii." % geometry_in_ring.GetNumberOfCells())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Important: <a href="http://www.vtk.org/doc/release/6.3/html/classvtkCylinder.html">vtkCylinder</a>
                    is by default oriented with a <em>y</em> axis of
                    rotation. We will rotate to <em>z</em> axis of rotation later.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>Note that the center is swapped <em>y</em> &#8596; <em>z</em> because of the transform that
                    will be applied.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                  <td>This is the transform we need to bring <em>y</em> &#8594; <em>z</em>. Note that the
                    transformation will be applied to input points, not to the cylinder
                    geometry.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/4.png" alt="4"></td>
                  <td>The output will be another <a
                      href="http://www.vtk.org/doc/release/6.3/html/classvtkUnstructuredGrid.html">vtkUnstructuredGrid</a>,
                    which consists
                    of a subset of the input geometry (including a subset of both Cells
                    and Points).</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now, this is a good place to see what we have so far for a selection.
                There are two possibilites: we could write out <code>geometry_in_ring</code> with
                a <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkXMLUnstructuredGridWriter.html">vtkXMLUnstructuredGridWriter</a>
                filter, or we could add the
                element IDs as a set to the model. Let&#8217;s do the latter:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>elements_in_ring = vtk.vtkIdTypeArray() <img src="./images/icons/callouts/1.png" alt="1">
elements_in_ring.DeepCopy(geometry_in_ring.GetCellData().GetPedigreeIds())
elements_in_ring.SetName("in_ring")
model.AddElementSet(elements_in_ring)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>To keep things clear, we&#8217;re going to make a copy of the data array
                    that is the PedigreeIds. This will allow us to modify it, by for
                    example re-naming it, without affecting the original. There are two steps
                    to this: creating a new empty <a
                      href="http://www.vtk.org/doc/release/6.3/html/classvtkIdTypeArray.html">vtkIdTypeArray</a> and
                    then using
                    its <code>DeepCopy</code> method on the data array we want to copy.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Again, run the script to update the <code>n88model</code> file. We can now
                extract this element set from it as follows:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88extractsets --element_sets sawbone.n88model
Reading N88 Model file : sawbone.n88model
Writing element set : sawbone_element_set_in_ring.vtp</pre>
              </div>
            </div>
            <div class="paragraph">
              <p><a href="#geometry_in_ring">Figure 44</a> shows this selection (<em>i.e.</em> the file
                <code>sawbone_element_set_in_ring.vtp</code>), together with the
                screw elements, shown for context. (We used a Threshold filter in ParaView to
                show just the screw cells from <code>sawbone.n88model</code>.) <a href="#geometry_in_ring_flat">Figure
                  45</a> is another view of the same data. This view
                is more suited to inspecting the ring geometry of our selection. To construct
                this view, first hit the +z button on the toolbar in order to view exactly
                along the <em>z</em> axis. Then from View Settings under the Edit menu, select Use
                Parallel Projection. Finally, change the Representation of both data sets to
                Surface With Edges in order to show individual Cells.
              </p>
            </div>
            <div id="geometry_in_ring" class="imageblock">
              <div class="content">
                <img src="images/geometry_in_ring_hr.png" alt="geometry in ring hr">
              </div>
              <div class="title">Figure 44. Geometry as selected by hollow cylinder filter</div>
            </div>
            <div id="geometry_in_ring_flat" class="imageblock">
              <div class="content">
                <img src="images/geometry_in_ring_flat_hr.png" alt="geometry in ring flat hr">
              </div>
              <div class="title">Figure 45. Geometry as selected by hollow cylinder filter, seen in flat projection
              </div>
            </div>
            <div id="eliminating_nodes_below_a_certain_depth" class="paragraph">
              <div class="title">Step 2: Eliminating nodes below a certain depth</div>
              <p>To select elements based on depth, as measured from the highest node in our
                set, we apply a similar approach as we did to select elements within the
                correct radii. We use a VTK implicit function, in this case a <a
                  href="http://www.vtk.org/doc/release/6.3/html/classvtkBox.html">vtkBox</a> ,
                to specify the geometrical volume to which we want to limit our element set.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Filtering node set by depth.")

geometry_in_ring_bounds = geometry_in_ring.GetBounds() <img src="./images/icons/callouts/1.png" alt="1">
message("Bounds of ring geometry: ", (" %.4f"*6) % geometry_in_ring_bounds)
box_bounds = (geometry_in_ring_bounds[0],
              geometry_in_ring_bounds[1],
              geometry_in_ring_bounds[2],
              geometry_in_ring_bounds[3],
              geometry_in_ring_bounds[5] - bone_constraint_max_depth,
              geometry_in_ring_bounds[5])
message("Limiting selection to box bounds: ", (" %.4f"*6) % box_bounds)

box = vtk.vtkBox()
box.SetBounds(box_bounds)

filter = vtk.vtkExtractGeometry()
filter.SetImplicitFunction(box)
filter.ExtractInsideOn()
filter.ExtractBoundaryCellsOn()
filter.SetInputData(geometry_in_ring)
filter.Update()
geometry_depth_filtered_ring = filter.GetOutput()

message("Found %d elements in bounding box." % geometry_depth_filtered_ring.GetNumberOfCells())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Note that the <em>z<sub>max</sub></em> bound of <code>geometry_in_ring</code> will be at the
                    highest bit of bone in the ring.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now just as before, we can create a corresponding element set for the
                purposes of inspection:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>elements_depth_filtered_ring = vtk.vtkIdTypeArray()
elements_depth_filtered_ring.DeepCopy(geometry_depth_filtered_ring.GetCellData().GetPedigreeIds())
elements_depth_filtered_ring.SetName("depth_filtered_ring")
model.AddElementSet(elements_depth_filtered_ring)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Run the script, and use <a href="#n88extractsets">n88extractsets</a> to
                extract the element sets, and it will create a new file,
                <code>sawbone_element_set_depth_filtered_ring.vtp</code>.
              </p>
            </div>
            <div class="paragraph">
              <p><a href="#ring_filtered_by_depth">Figure 46</a> shows the remaining elements after filtering by depth.
              </p>
            </div>
            <div id="ring_filtered_by_depth" class="imageblock">
              <div class="content">
                <img src="images/ring_filtered_by_depth_hr.png" alt="ring filtered by depth hr">
              </div>
              <div class="title">Figure 46. Ring geometry after filtering by depth</div>
            </div>
            <div id="selecting_only_the_nodes_visible_from_above" class="paragraph">
              <div class="title">Step 3: Selecting only the nodes visible from above</div>
              <p>We can use the function <code>FindNodesOnVisibleSurface</code> from
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneNodeSetsByGeometry.html">vtkboneNodeSetsByGeometry</a>
                for this purpose. We need to
                pass it a normal vector for the viewing direction, as well as an empty
                <a href="http://www.vtk.org/doc/release/6.3/html/classvtkIdTypeArray.html">vtkIdTypeArray</a> for
                storing the result.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Finding visible nodes.")

visibleNodesIds = vtk.vtkIdTypeArray() <img src="./images/icons/callouts/1.png" alt="1">
normalVector = (0,0,1) <img src="./images/icons/callouts/2.png" alt="2">
vtkbone.vtkboneNodeSetsByGeometry.FindNodesOnVisibleSurface(
  visibleNodesIds,
  geometry_depth_filtered_ring,
  normalVector,
  bone_material_id) <img src="./images/icons/callouts/3.png" alt="3">
visibleNodesIds.SetName("ring_top_visible")
model.AddNodeSet(visibleNodesIds)

message("Found %d visible nodes." % visibleNodesIds.GetNumberOfTuples())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This will store the result as a list of Point IDs.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>This is the negative of the viewing direction.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                  <td><code>FindNodesOnVisibleSurface</code> automatically returns the Pedigree Ids,
                    provided that they exist on in input object (they do).</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Again, run the script to update the <code>n88model</code> file. This time we want
                to extract the node sets</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88extractsets --node_sets sawbone.n88model
Reading N88 Model file : sawbone.n88model
Writing node set : sawbone_node_set_screw_top.vtp
Writing node set : sawbone_node_set_ring_top_visible.vtp</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>The resulting ring-shaped cloud of points (file
                <code>sawbone_node_set_ring_top_visible.vtp</code>) is shown in <a href="#visible_bone_nodes">Figure
                  47</a>.
                These are the nodes to which we will apply our fixed boundary condition.
              </p>
            </div>
            <div id="visible_bone_nodes" class="imageblock">
              <div class="content">
                <img src="images/visible_bone_nodes_hr.png" alt="visible bone nodes hr">
              </div>
              <div class="title">Figure 47. Bone nodes after filtering by visibility from above</div>
            </div>
            <div id="screw_ring_defining_the_constraint" class="paragraph">
              <div class="title">Defining the boundary condition on the bone</div>
              <p>Now that we have a named node set for this constraint, it is easy to create
                the desired boundary condition, which we will name &#8220;fixed_bone_surface&#8221;:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.FixNodes("ring_top_visible", "fixed_bone_surface")</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_adding_a_convergence_set_2">7.8.13. Adding a convergence set</h4>
            <div class="paragraph">
              <p>As we did in
                <a href="#cantilever_tutorial">Tutorial: Deflection of a cantilevered beam; adding custom boundary
                  conditions and loads</a>,
                we will add a <em>convergence set</em>. See <a href="#convergence_measure">Convergence measure</a> for
                discussion.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Create a convergence set: the force on the screw

model.ConvergenceSetFromConstraint("screw_top_displacement")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This method notices that the constraint named <em>screw_top_displacement</em>, which we
                created previously, is a boundary condition. It then constructs the compliment,
                which is the force summed over all nodes subject to the boundary conditions.
                It is this force that the solver will watch to determine when its value ceases
                to change meaningfully. At that point the solver is finished.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="screw_pullout_post_processing_sets">7.8.14. Specifying sets for post-processing</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Just as we saw in the tutorial
                <a href="#cantilever_tutorial">Deflection of a cantilevered beam; adding custom boundary conditions and
                  loads</a>,
                there remains one more step to complete the <code>n88model</code> file,
                and that is to identify the sets to
                be used for post-processing calculations by <a href="#n88postfaim">n88postfaim</a>.
                We are interested in values calculated on the sets &#8220;ring_top_visible&#8221;
                and &#8220;screw_top&#8221;. However, when we have generated our own custom sets,
                as we have here, we must be careful about providing both node sets
                and the corresponding element sets to <a href="#n88postfaim">n88postfaim</a>. If
                you review how we created the sets for generating boundary conditions,
                you will observe that we only generated the node sets. Fortunately,
                there is a method <code>GetAssociatedElementsFromNodeSet</code> of
                <a
                  href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneFiniteElementModel.html">vtkboneFiniteElementModel</a>
                that will identify the corresponding
                element set given a node set.
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>info = model.GetInformation()
pp_node_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()
pp_elem_sets_key = vtkbone.vtkboneSolverParameters.POST_PROCESSING_ELEMENT_SETS()
for setname in ["ring_top_visible", "screw_top"]:
    pp_node_sets_key.Append(info, setname)
    elementSet = model.GetAssociatedElementsFromNodeSet(setname)
    model.AddElementSet(elementSet)
    pp_elem_sets_key.Append(info, setname)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>After running the script, we can verify that these post-processing sets
                are in fact specified in the <code>n88model</code> file,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88modelinfo --problems sawbone.n88model
Problems:
 ----------------------------------------------------------------------

  Name : Problem1
  Part : Part1
  Constraints : screw_top_displacement,fixed_bone_surface
  PostProcessingNodeSets : ring_top_visible,screw_top
  PostProcessingElementSets : ring_top_visible,screw_top
 ----------------------------------------------------------------------</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    <div class="paragraph">
                      <p>As before, it is possible to skip this step, and instead to specify the
                        node and element sets to be used by <a href="#n88postfaim">n88postfaim</a> on the
                        command line of <a href="#n88postfaim">n88postfaim</a> with the arguments</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre>--node_sets=ring_top_visible,screw_top --element_sets=ring_top_visible,screw_top</pre>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We now have a complete <code>n88model</code> file. If you want, you can proceed to
                solve it using <a href="#faim">faim</a>, as in previous tutorials. We leave it
                as an exercise to identify, from the analysis file, the net forces between
                the screw top and the constrained ring of bone.</p>
            </div>
            <div class="paragraph">
              <p>This concludes the screw pull-out tutorial. In this tutorial we learned how
                to generate node sets based on complex criteria, to which we can then apply
                boundary conditions. This is the final tutorial in the series on
                learning <code>vtkbone</code>.</p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="longitudinal_fe_with_vtkbone_tutorial">7.9. Tutorial: Radius compression with transformed boundary
            conditions for longitudinal bone strength estimates</h3>
          <div class="paragraph">
            <p>In this tutorial, we will develop a Python script that can perform axial compression of a radius model
              from HR-pQCT, with boundary conditions that are transformed by the results of 3D rigid-body image
              registration. This application of Faim is used in a novel method for longitudinal estimates of bone
              strength, so-called registered FE (Plett et al. 2020 [in review]).</p>
          </div>
          <div class="paragraph">
            <p>Briefly, the method was developed to take an image from a longitudinal series that has been registered
              (3D rigid-body image registration) and cropped to the largest common volume of bone captured in the image
              series. The boundary conditions of the FE model are transformed using the output from image registration
              (IPL, Scanco Medical AG) to ensure that the compression test is performed in the same orientation for all
              images in the series.</p>
          </div>
          <div class="paragraph">
            <p>This tutorial uses <code>vtkbone</code> in a custom script that generates an <code>n88model</code> file.
              It is highly recommended to complete <a href="#cube_with_vtkbone_tutorial">Tutorial: Compressing a cube
                revisited using vtkbone</a> before proceeding to this tutorial.</p>
          </div>
          <div class="paragraph">
            <p>This tutorial will include:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><code>vtkbone</code>: How to initialize boundary conditions on an uneven load surface, such as when
                  using a 3D registered bone volume from longitudinal HR-pQCT.</p>
              </li>
              <li>
                <p><code>vtkbone</code>: How to transform boundary conditions and apply them to your finite element
                  model.</p>
              </li>
              <li>
                <p>Example: Registered FE on a distal radius segment.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>This tutorial assumes:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>You have a basic understanding of Python scripting and Faim.</p>
              </li>
              <li>
                <p>You have at least completed Tutorials 7.1-5 in this manual.</p>
              </li>
              <li>
                <p>You are familiar with 3D image registration and its outputs, specifically the implementation used for
                  longitudinal HR-pQCT images.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Registered FE is currently implemented using Python-based tools, packaged in <a href="#vtkbone">Preparing
                Finite Element Models with vtkbone</a>, to create custom finite element models that can be solved with
              Faim.</p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  If you do not wish to build the script on your own as you follow this tutorial, a finished version is
                  provided in the tutorial files (<a href="http://numerics88.com/n88/downloads/"
                    class="bare">http://numerics88.com/n88/downloads/</a>).
                </td>
              </tr>
            </table>
          </div>
          <div class="sect3">
            <h4 id="_script_setup">7.9.1. Script setup</h4>
            <div class="paragraph">
              <p>We will write the script in the following sequence:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Import packages.</p>
                </li>
                <li>
                  <p>Define utility functions.</p>
                </li>
                <li>
                  <p>Define model generator function.</p>
                </li>
                <li>
                  <p>Define and call main function.</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>Start by opening a new script file titled &#8220;_modelgenerator_registered_fe.py_&#8221; (or another
                name that describes the purpose of the script).</p>
            </div>
            <div class="paragraph">
              <p>Now we will import the packages that are needed for this script. Any additional packages that you wish
                to use may be added below this list:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>import os
import sys
import argparse
import numpy as np
import vtk
import vtkbone
# additional packages can be added here</pre>
              </div>
            </div>
            <div class="admonitionblock tip">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/tip.png" alt="Tip">
                  </td>
                  <td class="content">
                    If you provide an alias for a package (e.g. np for numpy, as shown above) the alias should be
                    used consistently throughout the script to avoid confusion.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Let&#8217;s give the script a quick test run to make sure everything is installed correctly:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ python modelgenerator_registered_fe.py</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Running this script should result in no output, so any output will indicate an error with the import
                commands. Most often, any errors that occur at this point are likely triggered by a package that is not
                installed in your Python environment, or your Python environment is not activated.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_optional_function_messages_with_a_time_stamp">7.9.2. Optional function: Messages with a time stamp
            </h4>
            <div class="paragraph">
              <p>A useful addition to any script, particularly a script with many sequential steps, is a utility
                function that can output messages (i.e. warnings, errors, other key outputs) with a time stamp. This can
                make debugging easier, but can also help you pinpoint errors that do not throw obvious errors in the
                code (e.g. flawed image data that leads to unusual FE results).</p>
            </div>
            <div class="paragraph">
              <p>Though there are many ways to accomplish this in Python, a utility function presents an excellent
                modular approach:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>def message(msg, *additionalLines):

  Print message with time stamp.

	The first argument is printed with a time stamp.
	Subsequent arguments are printed one to a line without a time stamp.
	

	print(('{0:8.2f} {1:s}'.format(time.time() - start_time,msg)))

  for line in additionalLines:
    print((" " * 9 + line))</pre>
              </div>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    You will need to import the <code>time</code> package (<code>import time</code>) with the packages
                    we imported earlier.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>We can also initialize the time stamp after this point:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>start_time = time.time()</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_utility_function_read_a_material_file">7.9.3. Utility function: Read a material file</h4>
            <div class="paragraph">
              <p>The registered FE method currently uses custom bone volumes from the XtremeCT II systems (insert bone
                image), so a material file makes it easy to identify the loading surfaces and assign material properties
                to the bone volume. For more details on creating material files, see <a
                  href="#material_definitions_file">Material definitions file</a>.</p>
            </div>
            <div class="paragraph">
              <p>Our material file will have the following format:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>MaterialDefinitions:
    Surface:
        Type: LinearIsotropic
        E: 8748 <img src="./images/icons/callouts/1.png" alt="1">
        nu: 0.3
    Bone:
        Type: LinearIsotropic
        E: 8748
        nu: 0.3
MaterialTable:
    127: Surface
    125: Bone</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is a typical modulus used for XtremeCT II images.</td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    A copy of this material file is stored with the tutorial files with the name
                    &#8220;material_cort_trab_xt2_reg.txt&#8221;.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now that we have a material file, we need to define a function that can read it for our model
                generator.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>def ReadMaterialFile(material_file):

    # Initialize material names and identifiers:
    bone_name = 'Bone'
    surface_name = 'Surface'
    bone_material_id = 125
    surface_material_id = 127

    # Read material_file and extract modulus and Poissons ratio:
    with open(material_file, encoding='cp1250') as searchfile:
        for line in searchfile:
            front = line.split(':')[0]
            if ("E" in front):
                bone_modulus = float(line.split(':')[1])
                surface_modulus = bone_modulus
            if ("nu" in front):
                bone_poissons_ratio = float(line.split(':')[1])
                surface_poissons_ratio = bone_poissons_ratio

    # Return material parameters to the model generator function:
    return bone_name, bone_material_id, bone_modulus, bone_poissons_ratio, surface_name, surface_modulus, surface_poissons_ratio, surface_material_id</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This function defines material names and identifiers based on the labels found in the bone volumes,
                then reads the material properties (i.e. modulus and Poissons ratio) from the material file. These
                properties will be assigned to the FE model via a material table in subsequent steps.</p>
            </div>
            <div class="paragraph">
              <p>To read the file, the function searches through each line in the material file to identify and extract
                the elastic modulus and the Poissons ratio. After reading the file, the material properties of the bone
                and load surfaces are returned.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_model_generator_function_first_steps">7.9.4. Model generator function: First steps</h4>
            <div class="paragraph">
              <p>The most important function in this script is the model generator function, which follows this
                sequence:</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Read the input image</p>
                </li>
                <li>
                  <p>Read/generate a transformation matrix to transform boundary conditions</p>
                </li>
                <li>
                  <p>Generate a voxel-based mesh and apply material properties from the material file</p>
                </li>
                <li>
                  <p>Define boundary conditions</p>
                </li>
                <li>
                  <p>Write the finite element model to an output file for the FE solver</p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>We want to read a standard HR-pQCT image file (AIM), so we will use <code>vtkboneAIMReader()</code>.
                Note the use of the <code>message()</code> function we defined earlier.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>def CreateN88Model(input_file, output_file, material_file, transform_file, overwrite, displacement):

    # Optional file checks ---
    # Ask the user if output_file should be overwritten:
    if os.path.isfile(output_file) and not overwrite: <img src="./images/icons/callouts/1.png" alt="1">
        result = eval(input('File \"{}\" already exists. Overwrite? [y/n]: '.format(output_file)))
        if result.lower() not in ['y', 'yes']:
            print('Not overwriting. Exiting...')
            os.sys.exit()

    # Check that input_file exists:
    if not os.path.isfile(input_file): <img src="./images/icons/callouts/2.png" alt="2">
        os.sys.exit('[ERROR] File \"{}\" not found!'.format(input_file))

    # Read input_file:
    message("Reading AIM file " + input_file + " as input...")
    reader = vtkbone.vtkboneAIMReader()
    reader.SetFileName(input_file)
    reader.DataOnCellsOn()
    reader.Update()

    image = reader.GetOutput()

    # Check that input_file is read correctly:
    if not reader.GetOutput():
        message("[ERROR] No image data read!")
        sys.exit(1)

    # Report image size (bounds):
    message("Image bounds:", (" %.4f" * 6) % image.GetBounds())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>If an output file already exists, the user may indicate whether or not the file should be
                    overwritten. This is an optional step.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>The script will stop with an error message if the input file is not found. This is an optional
                    code segment.</td>
                </tr>
              </table>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    All code segments related to this function (i.e. written below) must be nested within the function.
                    Be mindful of proper indentation to avoid errors, particularly if you copy-paste the code segments
                    in this document into a text editor.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now we want to define the transformation matrix by which we will transform the our boundary conditions
                of our model. For longitudinal image data, this transformation will likely be in the form of a 4x4
                affine matrix that is returned from 3D rigid-body image registration. This matrix contains the rotations
                and translations that are required to align two images (typically, follow-up images aligned to the
                baseline orientation). In the SCANCO implementation of image registration, the matrix is stored within a
                text file, as shown below.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>SCANCO TRANSFORMATION DATA VERSION:   10
R4_MAT:
  9.9992300E-01  1.0839380E-02 -6.0423953E-03 -5.5105441E-01
 -1.0396725E-02  9.9756137E-01  6.9016078E-02  2.8265885E+00
  6.7757516E-03 -6.8947942E-02  9.9759725E-01  3.9438124E+00
  0.0000000E+00  0.0000000E+00  0.0000000E+00  1.0000000E+00</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>To rotate the boundary conditions of any <em>follow-up</em> images (in a given image series) with
                respect to the baseline image, you will need to extract the 3x3 rotation matrix (the 9 elements in the
                upper-left of the 4x4 affine matrix) by adding the following lines to our <code>CreateN88Model()</code>
                function:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  if os.path.isfile(transform_file): <img src="./images/icons/callouts/1.png" alt="1">
      message("Reading IPL transformation matrix...")
      if(transform_file):
          t_mat = np.loadtxt(fname=transform_file, skiprows=2)
          rotation = t_mat[:3, :3]
  else: <img src="./images/icons/callouts/2.png" alt="2">
      message("[WARNING]No transformation matrix applied...")
      rotation = np.identity(3)</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This code segment is specifically designed for transformation matrices generated by 3D
                    registration in IPL (SCANCO Medical AG) for XtremeCT II images. If you are reading a transformation
                    matrix that has a different format than the one above, you will need to modify this code
                    accordingly.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>The <code>else</code> statement has been added to allow the user to skip the transformation step
                    altogether. This is primarily to allow users to analyze baseline images with the same script as the
                    follow-up images.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now would be a good time to read the material file by calling the function we defined earlier. Remember
                to place this code segment within the <code>CreateN88Model()</code> function.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  if os.path.isfile(material_file):
	   bone_name, bone_material_id, bone_modulus, bone_poissons_ratio, 	surface_name, surface_modulus, surface_poissons_ratio, 	surface_material_id = ReadMaterialFile(material_file)

  # Report error if file is missing or not read correctly:
  else:
      message("[ERROR] No material data read!")
      sys.exit(1)

  # Report material properties so the user can check values: <img src="./images/icons/callouts/1.png" alt="1">
  message('Material attributes:',
          '{:16s} = {:&gt;8s}'.format('Material name', bone_name),
          '   {:14s} = {:8d}'.format('ID', bone_material_id),
          '   {:14s} = {:8.2f} MPa'.format('Modulus', bone_modulus),
          '   {:14s} = {:8.2f}'.format('Poissons ratio', bone_poissons_ratio),
          '{:16s} = {:&gt;8s}'.format('Material name', surface_name),
          '   {:14s} = {:8d}'.format('ID', surface_material_id),
          '   {:14s} = {:8.2f} MPa'.format('Modulus', surface_modulus),
          '   {:14s} = {:8.2f}'.format('Poissons ratio', surface_poissons_ratio))</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>This is an optional step to make sure our material properties have been read correctly.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Since we have processed all our inputs, we can now create a finite element mesh from our image. We will
                apply a connectivity filter to our image, to make sure the model comprises a single object (i.e. with no
                floating pieces of bone or image noise in the model).</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  message("Applying connectivity filter...")
  confilt = vtkbone.vtkboneImageConnectivityFilter()
  confilt.SetInputData(image)
  confilt.Update()
  image = confilt.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Let&#8217;s mesh our image:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  message("Generating mesh...")
  mesher = vtkbone.vtkboneImageToMesh()
  mesher.SetInputData(image)
  mesher.Update()
  mesh = mesher.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>To apply the material properties to the mesh we just created, we will need to make a material table.
                This process takes the elastic modulus and Poissons ratio that we read from the material file and
                assigns them to a linear-elastic material in the table.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  message("Generating material table...")
  E = bone_modulus
  v = bone_poissons_ratio
  material_name = bone_name
  linear_material = vtkbone.vtkboneLinearIsotropicMaterial()
  linear_material.SetYoungsModulus(E)
  linear_material.SetPoissonsRatio(v)
  linear_material.SetName(material_name)

  material_table = vtkbone.vtkboneMaterialTable()
  material_table.AddMaterial(surface_material_id,linear_material)
  material_table.AddMaterial(bone_material_id,linear_material)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>We apply the material parameters to the mesh by compiling the mesh and material table into an
                initialized form of the finite element model, a test base.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  message("Compiling model...")
  # Compile the mesh and material_table into a test base:
  modelConfig = vtkbone.vtkboneApplyTestBase()
  modelConfig.SetInputData(0, mesh)
  modelConfig.SetInputData(1, material_table)</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Then we can tell Faim to identify the load surfaces, which are voxels/elements labeled with the number
                127.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  # Assign material_table properties to the appropriate voxels:
  modelConfig.SetTopConstraintSpecificMaterial(127)
  modelConfig.UnevenTopSurfaceOn()
  modelConfig.UseTopSurfaceMaximumDepthOn()
  modelConfig.SetTopSurfaceMaximumDepth(3.5) <img src="./images/icons/callouts/1.png" alt="1">

  modelConfig.SetBottomConstraintSpecificMaterial(127)
  modelConfig.UnevenBottomSurfaceOn()
  modelConfig.UseBottomSurfaceMaximumDepthOn()
  modelConfig.SetBottomSurfaceMaximumDepth(3.5)
  modelConfig.Update()

  model = modelConfig.GetOutput()

  # Report model size (bounds):
  message("Model bounds:", (" %.4f" * 6) % model.GetBounds())</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>3.5 mm was chosen as a distance slightly less than half of the standard XtremeCT II image volume
                    (10.2 mm).</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_model_generator_function_apply_transformed_boundary_conditions">7.9.5. Model generator function:
              Apply transformed boundary conditions</h4>
            <div class="paragraph">
              <p>Applying transformed boundary conditions is relatively simple and requires only a few additional lines
                of code from a standard non-registered test.</p>
            </div>
            <div class="paragraph">
              <p>First, we need to define a displacement vector for the model.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  message("Defining displacement boundary conditions...")

  # Initialize the displacement vector:
  e_init = np.array([0, 0, -float(displacement)]) <img src="./images/icons/callouts/1.png" alt="1">

  # Fix the bottom surface nodes of the model, completely:
  model.FixNodes('face_z0', 'bottom_fixed') <img src="./images/icons/callouts/2.png" alt="2"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Remember that we use &#8220;+np+&#8221; as an alias for the <code>numpy</code> package.</td>
                </tr>
                <tr>
                  <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                  <td>Since we are rotating the applied displacement, we need to use <em>axial</em> boundary conditions.
                    This means the fixed surface must be fixed in every direction.
                    A <em>uniaxial</em> boundary condition would be complex and require nodes to translate within a
                    plane defined perpendicular to the loading direction. A future challenge!</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>The displacement vector is typically oriented along the z-axis and has a magnitude of 0.102 mm, 1% of
                the image thickness, for a standard XtremeCT II bone model (to achieve 1% apparent strain).</p>
            </div>
            <div class="paragraph">
              <p>Since we are transforming the boundary conditions of follow-up images, so they are aligned in the same
                direction as the baseline image, the displacement vector needs to be transformed with the rotation
                matrix we generated earlier.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  # Transform the displacement vector:
  message("Setting boundary conditions...")
  e_trafo = np.dot(np.linalg.inv(rotation), e_init)</pre>
              </div>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Even though we are transforming the displacement vector, the magnitude will remain the same (i.e.
                    0.102mm). In the registered FE method, the magnitude of &#8220;+displacement+&#8221; can also be
                    changed to reflect the reduction in image thickness by 3D image registration.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Now we want to create a set of boundary conditions on the load surface, using the transformed
                displacement vector we just created. We will do this using the <code>ApplyBoundaryCondition()</code>
                function from vtkbone.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  # Apply boundary conditions by components of the displacement vector:
  model.ApplyBoundaryCondition('face_z1', vtkbone.vtkboneConstraint.SENSE_X, e_trafo[0], 'x_moved') <img src="./images/icons/callouts/1.png" alt="1">
  model.ApplyBoundaryCondition('face_z1', vtkbone.vtkboneConstraint.SENSE_Y, e_trafo[1], 'y_moved')
  model.ApplyBoundaryCondition('face_z1', vtkbone.vtkboneConstraint.SENSE_Z, e_trafo[2], z_moved')</pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>Make sure the vector components (x in <code>e_trafo[0]</code>; y in <code>e_trafo[2]</code>; z in
                    <code>e_trafo[2]</code>) match the corresponding boundary condition (<code>SENSE_X</code>,
                    <code>SENSE_Y</code>, <code>SENSE_Z</code>).
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_model_generator_function_define_model_outputs_and_write_n88model_file">7.9.6. Model generator
              function: Define model outputs and write n88model file</h4>
            <div class="paragraph">
              <p>Before writing the <code>n88model</code> file, we want to define the model outputs that will be
                recorded when the model is solved. So, we will define the node sets from which we acquire our bone
                strength estimates (e.g. reaction force), specifically the top and bottom surfaces (loaded and fixed) of
                the model we just created.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>  info = model.GetInformation()
  pp_node_sets_key =  vtkbone.vtkboneSolverParameters.POST_PROCESSING_NODE_SETS()

  pp_node_sets_key.Append(info, 'face_z1') # top surface nodes
  pp_node_sets_key.Append(info, 'face_z0') # bottom surface nodes
  model.AppendHistory("Created with   modelgenerator_registered_fe.py version 1.0")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Almost there! The last step in this function is to write the model to an <code>n88model</code> file.
                The filename will be defined by an input variable &#8220;+output_file+&#8221;.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>message("Writing n88model file: ", output_file)
writer = vtkbone.vtkboneN88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(output_file)
writer.Update()</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_main_function_process_input_variables_and_call_model_generator_function">7.9.7. Main function:
              Process input variables and call model generator function</h4>
            <div class="paragraph">
              <p>The main function of this script processes the user&#8217;s inputs and sends them to the model
                generator function to create our <code>n88model</code> file. The input arguments will be defined with an
                argument parser, including mandatory and optional variables. We can also include (brief) help
                documentation for the user to clarify what input variables are required for this script to run properly.
              </p>
            </div>
            <div class="paragraph">
              <p>The input arguments we will define are:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Input file (required): A segmented AIM file.</p>
                </li>
                <li>
                  <p>Output file (required): The output filename.</p>
                </li>
                <li>
                  <p>Material file (required): The material file.</p>
                </li>
                <li>
                  <p>Transform file (optional): The 4x4 transformation file from 3D image registration (*.txt).
                    Remember, this is not required if processing a baseline image and an identity matrix will be used
                    instead.</p>
                </li>
                <li>
                  <p>Overwrite (optional): Overwrite existing output_file. Remember, the program will ask if
                    <code>overwrite</code> is not indicated and <code>output_file</code> exists.
                  </p>
                </li>
                <li>
                  <p>Displacement (optional): Value to initialize displacement vector; default is 0.102 mm.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Written in code, this function will look like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Main function
def main():

    description = '''Generates an n88model from 3D registered images.

    			If no valid transform file is found, then no transform is applied.

    			Authors: Ryan M. Plett and Steven K. Boyd'''

    parser = argparse.ArgumentParser(formatter_class = argparse.RawTextHelpFormatter, prog = 'blmodelgenerator_reg', description = description)

    parser.add_argument('input_file', help = 'Input image file AIM).')
    parser.add_argument('output_file', help = 'Output n88model file (*.n88model).')
    parser.add_argument('--material_file', help = 'Material property file (*.txt).')
    parser.add_argument('--transform_file', default = 'dummy', help = 'Transformation matrix (*.txt).')
    parser.add_argument('--overwrite', action = 'store_true', help = 'Overwrite existing output.')
    parser.add_argument('--displacement', type = float, default = '0.102', help = 'Displacement boundary condition for registered volume (LCV).')
    args = parser.parse_args()

    CreateN88Model(**vars(args))</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>To end the script, it is important to make sure all of these functions will actually be called by the
                program when it is run from the command line. This is done by a short code segment that checks to make
                sure the script has been run correctly from the command line.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre># Call main function
if __name__ == '__main__':
    main()</pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_example_registered_fe_in_practice">7.9.8. Example: Registered FE in practice</h4>
            <div class="paragraph">
              <p>Now we will put this method into practice. We will test this script, using a registered XtremeCT II
                image (distal radius) and performing a standard compression test to 1% apparent strain.</p>
            </div>
            <div class="paragraph">
              <p>You will need the following files, provided in the tutorial files ( <a
                  href="http://numerics88.com/n88/downloads/" class="bare">http://numerics88.com/n88/downloads/</a> ):</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>input_file: <code>REPO_004_RR_S4_REG_HOM_LS.AIM</code></p>
                </li>
                <li>
                  <p>transform_file: <code>REPO_004_RR_S4_REG.TXT</code></p>
                </li>
                <li>
                  <p>material_file: <code>material_cort_trab_xt2_reg.txt</code></p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>The image file is an XtremeCT II image of a distal radius. The radius was imaged four times and each
                follow-up image (S2, S3, and S4) were misaligned from the baseline image (S1). The images were
                registered with 3D rigid-body image registration, identifying the the largest common volume (% overlap)
                between scans. For this radius, the volume was found to be 91.37% of the original bone volume. We will
                use this value to determine our compressive displacement for the test.</p>
            </div>
            <div class="paragraph">
              <p>The transform file contains the affine transformation that is needed to transform the image (S4) to
                baseline (S1); therefore, each follow-up image will have the same volume (defined by the overlap) and
                different transformation files.</p>
            </div>
            <div class="imageblock">
              <div class="content">
                <img src="images/longitudinal_fe_bone.png" alt="longitudinal fe bone">
              </div>
              <div class="title">Figure 48. 3D registered radius image (XtremeCT II, SCANCO Medical AG).</div>
            </div>
            <div class="paragraph">
              <p>Lets run our script in help mode (-h) to make sure we have all the inputs:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ Python modelgenerator_registered_fe.py -h

usage: blmodelgenerator_reg [-h] [--material_file MATERIAL_FILE]
                            [--transform_file TRANSFORM_FILE] [--overwrite]
                            [--displacement DISPLACEMENT]
                            input_file output_file

Generates an n88model from 3D registered images.

    If no valid transform file is found, then no transform is applied.

    Authors: Ryan M. Plett and Steven K. Boyd

positional arguments:
  input_file            Input image file (*.AIM).
  output_file           Output n88 model file (*.n88model).

optional arguments:
  -h, --help            show this help message and exit
  --material_file MATERIAL_FILE
                        Material property file (*.txt).
  --transform_file TRANSFORM_FILE
                        Transformation matrix (*.txt).
  --overwrite           Overwrite existing output.
  --displacement DISPLACEMENT
                        Displacement boundary condition for registered volume.</pre>
              </div>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    Make sure you activate your anaconda environment before executing the script.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>Here we can see the information that we added to the main function in our script with the argument
                parser. From this, we know that we are still missing the <code>output_file</code> and displacement
                arguments.</p>
            </div>
            <div class="paragraph">
              <p>We will set the output filename to be the same as the input, just with the n88model extension instead
                of AIM, so it will look something like: <code>REPO_004_RR_S4_REG_HOM_LS.n88model</code> .</p>
            </div>
            <div class="paragraph">
              <p>The volume of this image is 91.37% of the standard image volume (thickness 10.2mm), so we will scale
                the input displacement to be 91.37% of the standard displacement (0.102 mm): \(0.9137*0.102mm =
                0.093mm\) . Calculating the displacement in this way provides a simplified &#8220;scaling factor&#8221;
                so that the apparent strain remains close to 1% for every scan in a study.</p>
            </div>
            <div class="paragraph">
              <p>Now that we have all our inputs organized, lets test our script:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ Python modelgenerator_registered_fe.py REPO_004_RR_S4_REG_HOM_LS.AIM REPO_004_RR_S4_REG_HOM_LS.n88model --material_file material_cort_trab_xt2_reg.txt --transform_file REPO_004_RR_S4_REG.TXT --overwrite --displacement 0.093</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>If the script ran correctly, the output should look something like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>0.00 Reading AIM file REPO_004_RR_S4_REG_HOM_LS.AIM as input...
0.10 Image bounds:
      49.2881 67.5587 46.0103 69.4404 0.0000 10.1970
0.10 Reading IPL transformation matrix...
0.11 Material attributes:
     Material name    =     Bone
        ID             =      125
        Modulus        =  8748.00 MPa
        Poissons ratio =     0.30
     Material name    =  Surface
        ID             =      127
        Modulus        =  8748.00 MPa
        Poissons ratio =     0.30
0.11 Applying connectivity filter...
0.63 Generating mesh...
1.97 Generating material table...
1.97 Compiling model...
21.02 Model bounds:
      49.5309 67.4373 46.1317 69.0762 0.0000 9.4079
21.02 Defining displacement boundary conditions...
21.02 Setting boundary conditions...
21.02 Writing n88model file:
     REPO_004_RR_S4_REG_HOM_LS.n88model
257.88 Done. Have a nice day! <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>It&#8217;s never a bad idea to have a little fun with your scripts. The <code>message()</code>
                    function can make your day sometimes. :)</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>A warning may appear while the script is run,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>Warning: In ../Filters/Extraction/vtkValueSelector.cxx, line 547
vtkValueSelector (0x7fa8e6dbecd0): Warning: range selections should use two-component arrays to specify the range.  Using single component arrays with a tuple for the low and high ends of the range is legacy behavior and may be removed in future releases.</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This is nothing to worry about and will not affect the results of the script.</p>
            </div>
            <div class="imageblock">
              <div class="content">
                <img src="images/longitudinal_fe_n88model.png" alt="longitudinal fe n88model">
              </div>
              <div class="title">Figure 49. Unsolved n88model with load surfaces labeled (default colours in Paraview).
              </div>
            </div>
            <div class="paragraph">
              <p>You can now solve the model with <code>faim</code>:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>faim [additional options] [n88model file] <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>See the <a href="#faim">faim reference documentation</a> for details on the additional arguments
                    that can be used.</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_post_processing">7.9.9. Post-processing</h4>
            <div class="paragraph">
              <p>Once your <code>n88model</code> is solved, the results will need to be processed using a slightly
                altered procedure than in a typical &#8220;non-registered&#8221; analysis. The <em>non-registered</em>
                analysis extracts the results as the vertical component only (i.e. the z-component, as in reaction
                force, displacement, etc.), since the test is conducted in exactly the vertical direction. With the
                <em>registered</em> approach, the results are transformed and so the test is no longer conducted in the
                vertical direction alone; therefore, the resulting estimates must include all components (i.e. x-, y-,
                z-components). To do so, we will take the magnitude of a result (u) as:
              </p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \begin{aligned} u = \sqrt(u_{x}^{2}+u_{y}^{2}+u_{z}^{2}) \end{aligned}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>If the model used in our example above was solved correctly, the reaction force results (see
                <code>REPO_004_RR_S4_REG_HOM_LS_analysis.txt</code>) should look something like this:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>============================================================================
Table 9: Nodal Forces
----------------------------------------------------------------------------
Node set:                                                                  1
Name:                                                                face_z1
............................................................................
                   Fx         Fy         Fz
total      -9.520E+01  3.637E+02 -8.214E+03
average    -3.430E-03  1.310E-02 -2.959E-01
std_dev     1.583E-01  1.508E-01  4.905E-01
minimum    -2.011E+00 -1.950E+00 -8.329E+00
maximum     2.694E+00  3.698E+00  3.189E-01
median     -5.603E-06  0.000E+00 -7.541E-02</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Let&#8217;s say that we want to find the &#8220;registration-adjusted&#8221; reaction force estimate.
                Instead of using the total z-component of the reaction force (-8.214 kN), we want to calculate the total
                reaction force <em>magnitude</em> as:</p>
            </div>
            <div class="stemblock">
              <div class="content">
                \[
                \begin{aligned} F = \sqrt(Fx^{2}+Fy^{2}+Fz^{2}) =
                \sqrt((-9.520E+01)^{2}+(3.637E+02)^{2}+(-8.214E+03)^{2}) = 8.223 kN \end{aligned}
                \]
              </div>
            </div>
            <div class="paragraph">
              <p>This operation accounts for the transformed boundary conditions and allows us to report precise
                estimates of bone strength from longitudinal data. The easiest way to implement this adjustment is to
                calculate the magnitude of an estimate after the results have been parsed into a delimited file or
                spreadsheet for statistical analysis in Excel, SPSS, or R.</p>
            </div>
            <div class="paragraph">
              <p>To calculate failure load with <a href="#n88pistoia">n88pistoia</a> we will need to use a modified
                command than would be used in a standard analysis:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88pistoia [n88model file name] --constraint z_moved --critical_volume 2.0 --critical_strain 0.007 --output_file [pistoia file name]</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>From our example, this command should then look like:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88pistoia REPO_004_RR_S4_REG_HOM_LS.n88model --constraint z_moved --critical_volume 2.0 --critical_strain 0.007 --output_file REPO_004_RR_S4_REG_HOM_LS_pistoia.txt <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The constraint <code>z_moved</code> is a custom constraint that we added in the
                    <code>CreateN88Model</code> function. The default for <code>n88pistoia</code> is
                    &#8220;top_moved&#8221;, so be sure to use the correct constraint in your test.
                  </td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>The full results set from this example can be parsed from the results files
                (<code>*_analysis.txt</code> or <code>*_pistoia.txt</code>) using the following commands:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>$ n88tabulate -H -o [output_file] REPO_004_RR_S4_REG_HOM_LS_analysis.txt #OR
$
$ n88tabulate -H -V "pis_fx_fail,pis_fy_fail,pis_fz_fail" -o [output_file] REPO_004_RR_S4_REG_HOM_LS_pistoia.txt</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>This concludes the tutorial! You should now be able to transform displacement boundary conditions using
                <code>vtkbone</code> and inputs from 3D image registration. The example included in this tutorial is
                representative of the analysis that can be performed on a standard single-stack (10.2 mm) radius or
                tibia image from XtremeCT II.
              </p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="additional_examples">7.10. Additional examples</h3>
          <div class="paragraph">
            <p>In addition to the tutorials, there are additional examples included in
              the <code>other_examples</code> directory. Currently these consist of</p>
          </div>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="dlist">
            <dl>
              <dt class="hdlist1">segment_dicom</dt>
              <dd>
                <p>An example of reading a raw image file
                  and performing a simple segmentation based on a density threshold and
                  connectivity.</p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="special_topics">8. Special Topics</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="material_arrays">8.1. Efficient Handling of Large Numbers of Material Definitions</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>In typical usage of Faim, the number of defined materials is small. In fact,
              often we define just a single material as &#8220;bone&#8221;. We can, and do, take advantage
              of the expectation of relatively few defined materials in the following three ways:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>The solver can pre-calculate important values for each material. In particular,
                  the standard solver pre-calculates a 24&#215;24 <em>local stiffness matrix</em> for
                  each material. This saves quite a bit of time on each iteration, and the
                  storage is insignificant, provided that the number of material definitions
                  is substantially less than the number of elements.</p>
              </li>
              <li>
                <p>In the <a href="#n88model_file_format">n88model file format</a>, each individual material
                  definition is stored as a kind of object, with a name, a named type, and
                  named characteristics and
                  values. This allows great flexibility in defining material types.
                  The net impact on the file size is insignificant so long as the
                  number of material definitions is substantially less than the number of elements.</p>
              </li>
              <li>
                <p>When generating tables of post-processing results with <a href="#n88postfaim">n88postfaim</a>,
                  results can be tabulated in subtables broken down by material ID. This is
                  useful, but only
                  so long as the number of defined materials stays within a range easily
                  scanned by humans.</p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>Although these are important advantages, there are occasions when the assumption
              of few material definitions is not so good. Here are two such cases:</p>
          </div>
          <div class="hdlist">
            <table>
              <tr>
                <td class="hdlist1">
                  A
                </td>
                <td class="hdlist2">
                  <p>A <a href="#homminga_material_table">Homminga material table</a> is used, which generates
                    a sequence of varying material properties according to image density. In this
                    case, we are typically talking about a material table of the order of one
                    hundred material IDs. The assumptions <em>1</em> (solver pre-calculated values)
                    and <em>2</em> (efficient file storage of material definitions) still hold, but
                    the output of <a href="#n88postfaim">n88postfaim</a>, if broken down by material, becomes
                    cumbersome and excessive.</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="hdlist">
            <table>
              <tr>
                <td class="hdlist1">
                  B
                </td>
                <td class="hdlist2">
                  <p>Some researchers have proposed models in which the bone anisotropy is continuously
                    variable. To model this with FE software requires that each element have
                    its own stiffness matrix. Therefore the number of required material definitions
                    is equal to the number of elements. In this case, following assumptions <em>1</em> and <em>2</em>
                    results in a large inefficiencies: the solver uses greatly more memory, and
                    the model file is many times larger than it would be for geometric data only.</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>To address these issues, version 8 of Faim introduced the concept of <em>material
                arrays</em>, in contrast to the existing <em>material tables</em>. This is an expansion
              of the capabilities of Faim, and is really only relevant for the two cases
              listed above. For all other cases, one could say for normal usage, the
              previous concept of material tables is preferable, and it remains the default.</p>
          </div>
          <div class="paragraph">
            <p>For the file format, a simple extension of the <code>n88model</code> standard is adopted,
              wherein a material definition object within the file (in practice a <em>group</em> in netCDF terminology),
              may optionally, instead of having named attributes, have
              arrays of any length with the same names (where arrays in netCDF are called
              <em>variables</em>). The length of the array indicates then that <em>M</em> materials are
              being defined at once, and that they should get sequential material IDs.
              Here are how the two above cases can be handled:
            </p>
          </div>
          <div class="hdlist">
            <table>
              <tr>
                <td class="hdlist1">
                  A
                </td>
                <td class="hdlist2">
                  <p>Homminga material table: You could have in your model file a single material
                    array of
                    length 127 for example. It has material ID 1, which implies the definition
                    of materials 1..127. The material ID for each of your elements is in this range.
                    This is in fact the method of operation of <code>n88modelgenerator</code> if you
                    select a Homminga material table, and likewise for the vtkbone class
                    <a
                      href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneGenerateHommingaMaterialTable.html">vtkboneGenerateHommingaMaterialTable</a>
                    .
                  </p>
                </td>
              </tr>
            </table>
          </div>
          <div class="hdlist">
            <table>
              <tr>
                <td class="hdlist1">
                  B
                </td>
                <td class="hdlist2">
                  <p>Continuously variable anisotropy: You could have in your model file a single material
                    array of length equal to the number of elements N. It has material ID 1,
                    implying the definition of materials 1..N . Consequently, you must have
                    labelled your elements with sequential material IDs 1..N .</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>These are the typical cases, but more exotic combinations are allowed.
              You don&#8217;t need to necessarily start an array at material ID 1, and you
              may define multiple material arrays. You can also mix traditional
              single material definitions with material arrays, and there is no
              requirement that all the definitions in your file are of the same
              type. For example, you
              could have one material array of isotropic materials, and another
              of orthotropic materials. The only rule is that be no overlap of material IDs,
              but otherwise in principle anything is allowed.</p>
          </div>
          <div class="paragraph">
            <p>Let us look at the consequences for the solver.
              For linear models, there are two solvers. The traditional and commonly used
              solver <code>n88solver_slt</code>, which uses material tables internally, and the
              new solver <code>n88solver_sla</code>, which uses material arrays internally, and is
              efficient <em>only</em> when the number of material definitions is equal to or
              comparable to the number of materials. Firstly, the solvers are entirely
              independent of the <code>n88model</code> file. This is an important point:
              <strong>all solvers can read all model files</strong>. <code>n88solver_slt</code> always converts
              all material definitions in the model file, regardless of whether defined
              individually
              or in arrays, into a material table with entries for each material ID. This material table includes
              pre-calculated local stiffness matrices, and the number of entries is equal to the
              summed lengths of all defined material arrays, plus the number of
              individually defined materials.
              Conversely, <code>n88solver_sla</code> always generates an internal material
              array of the same length as the number of elements. Even if you only define
              one, or few, materials, these few materials will repeat over and over
              so that there is one entry per element.
              The critical efficiency of <code>n88solver_sla</code> as compared with <code>n88solver_slt</code>
              is that only the minimal number of material parameters is stored in
              the material array, and storage of pre-calculated values is avoied.
              As a consequence
              <code>n88solver_sla</code> is almost always slower than <code>n88solver_slt</code>; the trade-off
              is that <code>n88solver_slt</code> uses really huge amounts of memory when
              the number of defined materials becomes comparable to the number of
              elements.
            </p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  The script <code>faim</code> will always use the solver <code>n88solver_slt</code> except
                  in the single case where exactly one material array is defined,
                  and it has length equal to the number of elements. In this case,
                  <code>faim</code> will chose to use the <code>n88solver_sla</code> solver. You can
                  of course always run the solver of your choice manually.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>Finally, when it comes to post-processing with <a href="#n88postfaim">n88postfaim</a>,
              where sub-tables for each material ID are generated, all material IDs
              corresponding to a material array are grouped into a single subtable.
              This prevents the amount of output from becoming excessive.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="direct_mechanics">8.2. Direct Mechanics</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>Microstructural organization plays an important role in macroscopic mechanical
              behaviour. For example, bone microarchitectural organization, as shown here in
              a human proximal femur, can exhibit patterns that are related to the
              macrostructural mechanical behaviour, and those patterns vary depending on the
              mechanical requirements at each location within the bone. A useful approach to
              characterizing the microstructural patterns (also referred to as &#8220;fabric&#8221;) is
              to determine the anisotropic properties of sub-volumes of bone. In some
              regions of the femur, for example, the bone microarchitecture will be highly
              aligned with the bone axis, but in other parts the alignment may be
              predominantly in a transverse orientation. The anisotropic properties
              typically need to be defined at several locations due to spatial
              variation.</p>
          </div>
          <div class="paragraph">
            <p>Anisotropy can be defined in terms of either the fabric or mechanical
              behaviour. Methods for characterizing the fabric are based on techniques such
              as mean intercept length or star volume analysis, and a good resource is the
              paper by <a href="#odgaard1997a">Odgaard (1997a)</a>. Essentially, fabric methods focus on the
              distribution
              of tissue microarchitecture. Alternatively, the mechanical elastic behaviour
              can be determined, and has been shown by
              <a href="#odgaard1997b">Odgaard et al. (1997b)</a> that the
              anisotropic fabric and mechanical properties are similar. This observation
              makes sense, and reinforces the concept that underlying bone micro-architecture
              is an important factor in determining mechanical behaviour. Here we focus on
              the determination of bone anisotropic elastic behaviour using a so-called
              <em>direct mechanics</em> assessment as proposed by
              <a href="#vanrietbergen1996">van Rietbergen et al. (1996)</a>. In
              summary, six elastic finite element tests are performed on a cubic subvolume, and those
              results are used to define a 6&#215;6 stiffness matrix that relates stress to
              strain as per Hookes Law,
            </p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \mathbf{\sigma} = \mathbf{C} \mathbf{\varepsilon} \; .
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>The most general anisotropic material requires 21 independent coefficients to
              fully characterize, but it is usually most convenient to assume there are planes
              of elastic symmetry, in which case there exists an orientation of a
              coordinate system where only 9 independent elastic coefficients are needed.
              See the section <a href="#orthotropic_material">Linear Orthotropic Material</a>.
              In this case,</p>
          </div>
          <div class="stemblock">
            <div class="content">
              \[
              \mathbf{C} = \begin{bmatrix} C_{11} &amp; C_{12} &amp; C_{13} &amp; 0 &amp; 0 &amp; 0\\ &amp; C_{22} &amp;
              C_{23} &amp; 0 &amp; 0 &amp; 0 \\ &amp; &amp; C_{33} &amp; 0 &amp; 0 &amp; 0 \\ &amp; &amp; &amp; C_{44}
              &amp; 0 &amp; 0 \\ &amp; sym. &amp; &amp; &amp; C_{55} &amp; 0 \\ &amp; &amp; &amp; &amp; &amp; C_{66}
              \end{bmatrix} \; .
              \]
            </div>
          </div>
          <div class="paragraph">
            <p>Finite element models of real measurement data of biological materials do not
              exhibit perfect orthotropic symmetry,
              therefore the process of reducing the 6&#215;6 matrix from 21 independent
              coefficients to 9 involves finding an optimal coordinate system such that some
              of the coefficients are close to zero. It is reasonable to assume that bone
              mechanical behaviour can be reduced to a case of orthotropy; however, caution
              should be exercised as it is up to the user to determine whether this
              simplification is appropriate.</p>
          </div>
          <div class="paragraph">
            <p>The basis of the direct mechanics approach is the application of six finite
              element tests to an appropriate bone subvolume:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>uniaxial normal strain in the x-direction (<em>&#949;<sub>xx</sub></em>)</p>
              </li>
              <li>
                <p>uniaxial normal strain in the y-direction (<em>&#949;<sub>yy</sub></em>)</p>
              </li>
              <li>
                <p>uniaxial normal strain in the z-direction (<em>&#949;<sub>zz</sub></em>)</p>
              </li>
              <li>
                <p>uniaxial shear strain in the x-direction (<em>&#947;<sub>yz</sub></em>)</p>
              </li>
              <li>
                <p>uniaxial shear strain in the y-direction (<em>&#947;<sub>zx</sub></em>)</p>
              </li>
              <li>
                <p>uniaxial shear strain in the z-direction (<em>&#947;<sub>xy</sub></em>)</p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>These tests are applied under the conditions of unit engineering strain.
              Each test is evaluated for the six resulting stresses
              (<em>&#963;<sub>xx</sub></em>, <em>&#963;<sub>yy</sub></em>, <em>&#963;<sub>xx</sub></em>,
              <em>&#963;<sub>yz</sub></em>,
              <em>&#963;<sub>zx</sub></em>, <em>&#963;<sub>xy</sub></em>), thus providing directly the values of the
              6&#215;6 stiffness
              matrix. The stresses are calculated as a volume average, which can be
              shown to be equivalent to the surface stresses on the faces of the cube.
            </p>
          </div>
          <div class="paragraph">
            <p>Finding the optimal rotation of the coordinate system to represent orthotropic
              behaviour involves first decomposing the stiffness matrix into symmetric and
              asymmetric components. The asymmetric component is discarded, as conservation
              laws require that the stiffness matrix be symmetric. (The asymmetric
              component thus consists entirely of measurement error.) An optimal rotation
              is then found that minimizes the coefficients that
              would be zero for a true orthotropic material expressed in the coordinate
              system of its planes of symmetry.</p>
          </div>
          <div class="paragraph">
            <p>The primary outputs from the direct mechanics approach are the stiffness
              and compliance matrices (<strong>S</strong> = <strong>C</strong><sup>-1</sup>) in the original coordinate
              system,
              as well as
              in the coordinate system of optimal orthotropy. The 3&#215;3 rotation matrix <strong>R</strong> that
              describes the transformation from the
              specimen coordinate system to the optimal coordinate system is given;
              the rows are the principal axes in the original coordinate system.
              Finally, from the compliance matrix, the standard
              orthotropic elastic constants <em>E<sub>i</sub></em>,<em>&#957;<sub>ij</sub></em>,<em>G<sub>ii</sub></em>
              are extracted. See
              <a href="#orthotropic_material">Linear Orthotropic Material</a> for the definitions.
            </p>
          </div>
          <div class="paragraph">
            <p>The use of the <a href="#n88directmechanics">n88directmechanics</a> tool is described in
              detail in <a href="#n88directmechanics">n88directmechanics</a>.</p>
          </div>
          <div class="paragraph">
            <p>An example run of the <em>direct mechanics</em> analysis is shown below.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88directmechanics test25a.aim
n88directmechanics version 6.0
Copyright (c) 2012, Numerics88 Solutions Ltd.

input_file                   = test25a.aim
material_table               = homogeneous
youngs_modulus               = 6829.0
poissons_ratio               = 0.3
connectivity_filter          = on

    0.00 Reading image file test25a.aim
    0.00 Read 17576 points from image file.
    0.00 Applying connectivity filter.
    0.00 Masked out 0 unconnected voxels.
    0.00 Converting to hexahedral cells.
    0.01 Generated 7087 hexahedrons
    0.01 Creating material table.
    0.01 Creating three uniaxial models.
    0.03 Writing n88 model file: test25a_strain_xx.n88model
    0.14 Writing n88 model file: test25a_strain_yy.n88model
    0.25 Writing n88 model file: test25a_strain_zz.n88model
    0.34 Creating three symshear models.
    0.35 Writing n88 model file: test25a_strain_yz.n88model
    0.46 Writing n88 model file: test25a_strain_zx.n88model
    0.57 Writing n88 model file: test25a_strain_xy.n88model
    0.66 Calling solver on test25a_strain_xx.n88model
    2.20 Calling solver on test25a_strain_yy.n88model
    3.76 Calling solver on test25a_strain_zz.n88model
    5.23 Calling solver on test25a_strain_yz.n88model
    6.59 Calling solver on test25a_strain_zx.n88model
    7.87 Calling solver on test25a_strain_xy.n88model
    9.05 Reading n88 model file: test25a_strain_xx.n88model
    9.07 Reading n88 model file: test25a_strain_yy.n88model
    9.08 Reading n88 model file: test25a_strain_zz.n88model
    9.09 Reading n88 model file: test25a_strain_yz.n88model
    9.10 Reading n88 model file: test25a_strain_zx.n88model
    9.11 Reading n88 model file: test25a_strain_xy.n88model

    Volume fraction = 0.45357

    Apparent stiffness matrix in specimen coordinate system

[[ 1571.653   540.033   513.822     7.53   -121.22    -57.959]
 [  540.033  2029.046   469.974    78.591   -53.69    -50.673]
 [  513.822   469.974  1803.998    20.377   -57.014   -15.761]
 [    7.53     78.591    20.377   734.405   -23.127   -36.557]
 [ -121.22    -53.69    -57.014   -23.127   627.396    13.969]
 [  -57.959   -50.673   -15.761   -36.557    13.969   745.749]]

    Apparent compliance matrix in specimen coordinate system

[[  7.570e-04  -1.586e-04  -1.704e-04   1.977e-05   1.170e-04   4.323e-05]
 [ -1.586e-04   5.610e-04  -1.000e-04  -5.441e-05   5.808e-06   2.090e-05]
 [ -1.704e-04  -1.000e-04   6.294e-04  -4.883e-06   1.569e-05  -7.273e-06]
 [  1.977e-05  -5.441e-05  -4.883e-06   1.372e-03   4.787e-05   6.410e-05]
 [  1.170e-04   5.808e-06   1.569e-05   4.787e-05   1.621e-03  -1.819e-05]
 [  4.323e-05   2.090e-05  -7.273e-06   6.410e-05  -1.819e-05   1.349e-03]]

    Material parameters in specimen coordinate system
    -------------------------------------------
    Exx =  1320.98
    Eyy =  1782.54
    Ezz =  1588.79
    Gyz =   728.81
    Gzx =   617.06
    Gxy =   741.27
    -------------------------------------------
    nu_yx =  0.28270
    nu_zx =  0.27081
    nu_xy =  0.20950
    nu_zy =  0.15888
    nu_xz =  0.22516
    nu_yz =  0.17825
    -------------------------------------------

    Optimum rotation matrix R:

[[ 0.32957 -0.83991 -0.4312 ]
 [ 0.30346  0.52671 -0.79403]
 [ 0.89404  0.13084  0.42846]]

    Apparent stiffness matrix in best orthotropic coordinate system

[[ 2197.117   466.121   496.104    30.725    39.277     6.441]
 [  466.121  1852.499   506.856    32.259    14.028    -0.103]
 [  496.104   506.856  1464.576    -5.755   -28.362    14.264]
 [   30.725    32.259    -5.755   650.075   -35.665   -15.051]
 [   39.277    14.028   -28.362   -35.665   697.661     8.234]
 [    6.441    -0.103    14.264   -15.051     8.234   705.066]]

    Apparent compliance matrix in best orthotropic coordinate system

[[  5.068e-04  -8.804e-05  -1.419e-04  -2.273e-05  -3.367e-05  -1.863e-06]
 [ -8.804e-05   6.126e-04  -1.826e-04  -2.865e-05  -1.630e-05   4.167e-06]
 [ -1.419e-04  -1.826e-04   7.952e-04   2.496e-05   4.544e-05  -1.482e-05]
 [ -2.273e-05  -2.865e-05   2.496e-05   1.546e-03   8.154e-05   3.175e-05]
 [ -3.367e-05  -1.630e-05   4.544e-05   8.154e-05   1.442e-03  -1.571e-05]
 [ -1.863e-06   4.167e-06  -1.482e-05   3.175e-05  -1.571e-05   1.419e-03]]

    Material parameters in best orthotropic coordinate system

    -------------------------------------------
    Exx =  1973.20
    Eyy =  1632.50
    Ezz =  1257.55
    Gyz =   646.74
    Gzx =   693.58
    Gxy =   704.48
    -------------------------------------------
    nu_yx =  0.14372
    nu_zx =  0.17848
    nu_xy =  0.17371
    nu_zy =  0.22968
    nu_xz =  0.28004
    nu_yz =  0.29816
    -------------------------------------------

    9.47 Done.</pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88postfaim_pistoia_failure_load">8.3. Pistoia Failure Load Estimate</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>The failure load for a linear elastic model is based on the work by Dr. Walter Pistoia
              (<a href="#pistoia2001a">Pistoia 2001a</a> and <a href="#pistoia2001b">2001b</a>). Numerics88 provides a
              tool, <a href="#n88pistoia">n88pistoia</a> that can be used to carry out these calculations. In
              general, <strong>it is more accurate and preferable to solve an elastoplastic
                model in order to obtain failure loads</strong>. However, we include the Pistoia tool, mostly for those
              who wish to compare current data to older results on which a Pistoia analysis was done.</p>
          </div>
          <div class="paragraph">
            <p>The basic principal is that failure
              load is defined as the load at which a pre-defined volume of tissue (percentage critical
              volume) exceeds a pre-defined Energy Equivalent Strain (critical EES). Typical
              values are 2.0% and 0.007, respectively. It should be noted that the so-called
              Pistoia criterion is not a standard failure criteria used in classical
              mechanics of materials; however, it has been extensively validated with experimental
              testing of cadaver bones, and it is the most widely used and accepted
              criterion for image-based linear FE modelling.</p>
          </div>
          <div class="paragraph">
            <p>The <em>first</em> sub-table contains the failure load information (the sub-table is
              denoted by a series of horizontal dots). The calculation of the failure load
              requires post-processing the EES for each element of the solved linear FE
              model. After ordering the EES in a histogram, the actual strain at the
              critical volume threshold (e.g., 2%) is determined and reported in the table
              as <code>EES at vol_crit</code>. As this is a linear FE model, a scale-factor for this
              EES can be determined relative to the critical EES, and this is captured in
              a defined factor. A table of factors is provided at the bottom of the Pistoia Failure Load Estimate table,
              and the
              factor associated with the defined critical volume and critical EES is
              reported specifically in this first sub-table (other values of critical volume
              and critical EES could be applied if necessary using the alternative table
              factors). Knowing the total reaction force of the solved model (usually <code>RFz</code>) and the
              actual EES value at the critical volume, a linear factor can be applied to
              estimate the failure load: <code>failure load = RFz &#215; factor</code> .</p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  Although a similar process can be applied to determine the torsional
                  failure load (and is reported as torsional failure load) there have not been
                  any experimental validations of this technique published to date. It is not
                  recommended to use the reported torsional failure load until experimental
                  validation is completed. Nevertheless, it is provided here for the users
                  convenience.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The <em>second</em> sub-table contains a summary of the axial and torsional stiffness
              values, and these are identical to the previous corresponding tables. For
              example, <code>RFz</code> from node set 1 has already been reported in
              <a href="#n88postfaim_nodal_forces">Nodal Forces</a> as total <code>F_z_</code>. They are reported
              again in this table for convenience.
            </p>
          </div>
          <div class="admonitionblock important">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/important.png" alt="Important">
                </td>
                <td class="content">
                  All failure loads are calculated assuming that
                  axial compression or torsion was applied along the <code>z</code>-axis in the Data Frame.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>The <em>third</em> sub-table contains a summary of the histogram results for the
              analysis of EES. All materials defined in the model are pooled for this
              histogram (i.e., cortical bone and trabecular bone), and it is the basis for
              determining the EES at the critical volume used for the failure load
              calculation. It is important to note that the user has the option to
              pre-define a material that is to be excluded from the failure load analysis,
              and that excluded material is reported at the top of the table (<code>Excluded
material id</code>). This is useful, for example, if the FE model contains platens
              that should not be included in the failure load analysis (i.e., the failure
              load of the platens are not of interest).</p>
          </div>
          <div class="paragraph">
            <p>The <em>fourth</em> sub-table contains a summary of the number of elements that exceed
              critical EES, and is broken down by material definition. This information
              allows the user to determine, for example, whether failure was based on
              cortical bone versus trabecular bone.</p>
          </div>
          <div class="paragraph">
            <p>The <em>fifth</em> sub-table contains factors that could be used (by user hand
              calculation) to determine the estimated failure load for different critical
              volumes or critical EES.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre> Table 1: Pistoia Failure Load Estimate
 -----------------------------------------------------------
 Pistoia Criterion for Energy-Equivalent-Strain (EES)
   (*) Results valid for linear, isotropic model only.
   (*) Warning: Torsion failure load not validated. Caution!
 -----------------------------------------------------------
 Number of elements in analysis:                      349829
 Excluded material id:                                  none
 ...........................................................
 Critical volume (%):                                 2.0000
 Critical EES:                                        0.0070
 EES at vol_crit:                                     0.0131
 Factor (from table):                             0.5332E+00
 Failure load (RFz * factor) [N]:                -0.3248E+04 <img src="./images/icons/callouts/1.png" alt="1">
 Torsional failure load (Tz * factor) [Nmm]:      0.9764E-03
 -----------------------------------------------------------
 Axial and Torsional Stiffness:
 ...........................................................
 RFz (node set 1) [N]:                           -0.6091E+04
 Uz (node set 1) [mm]:                           -0.9020E-01
 Axial stiffness [N/mm]:                          0.6753E+05 <img src="./images/icons/callouts/2.png" alt="2">
 Tz (node set 1) [Nmm]:                           0.1831E-02
 Rotz (node set 1) [rad]:                        -0.1787E-03
 Torsional stiffness [Nmm/rad]:                  -0.1025E+02 <img src="./images/icons/callouts/3.png" alt="3">
 -----------------------------------------------------------
 Distribution of energy-equivalent-strain: EES = sqrt(2U/E).
 ...........................................................
                             EES
             average  0.6135E-02
             std_dev  0.3210E-02
             minimum  0.1332E-07
             maximum  0.3725E-01
            skewness  0.4787E+00
            kurtosis  0.9386E+00
              median  0.6089E-02
 -----------------------------------------------------------
 Distribution of failed materials.
 ...........................................................
            material       # els           %
                 127        1454     20.7803
                 100        5543     79.2197 <img src="./images/icons/callouts/4.png" alt="4">
          ----------  ----------  ----------
               total        6997    100.0000
 -----------------------------------------------------------
 Factor table:
          crit_vol |    crit_ees
       %     # vox |      0.0050      0.0060      0.0070      0.0080      0.0090
  ------  -------- |  ----------  ----------  ----------  ----------  ----------
    1.00    349829 |  0.3400E+00  0.4080E+00  0.4759E+00  0.5439E+00  0.6119E+00
    2.00    699658 |  0.3809E+00  0.4570E+00  0.5332E+00  0.6094E+00  0.6855E+00
    3.00   1049487 |  0.4071E+00  0.4886E+00  0.5700E+00  0.6514E+00  0.7329E+00
    4.00   1399316 |  0.4274E+00  0.5129E+00  0.5984E+00  0.6838E+00  0.7693E+00
    5.00   1749145 |  0.4444E+00  0.5333E+00  0.6222E+00  0.7111E+00  0.8000E+00
    6.00   2098974 |  0.4582E+00  0.5498E+00  0.6414E+00  0.7331E+00  0.8247E+00
    7.00   2448803 |  0.4703E+00  0.5644E+00  0.6585E+00  0.7525E+00  0.8466E+00</pre>
            </div>
          </div>
          <div class="colist arabic">
            <table>
              <tr>
                <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                <td>Estimated failure load of the bone in uniaxial compression, given the critical volume of 2% and
                  critical EES of 0.0070.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/2.png" alt="2"></td>
                <td>Calculated based on the total Fz (also termed RFz) of node set 1 divided by the average displacement
                  Uz of the surface defined by node set 1.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/3.png" alt="3"></td>
                <td>Calculated based on the total Tz of node set 1 divided by the average displacement Uz of the surface
                  defined by node set 1.</td>
              </tr>
              <tr>
                <td><img src="./images/icons/callouts/4.png" alt="4"></td>
                <td>Indicates that approximately 79% of the failed voxels comprising the 2% critical volume were in the
                  trabecular tissue, while only 21% were in the cortical tissue.</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_command_reference">9. Command Reference</h2>
      <div class="sectionbody">
        <table class="tableblock frame-all grid-all stretch">
          <caption class="title">Table 7. List of Faim command-line programs</caption>
          <colgroup>
            <col style="width: 28.5714%;">
            <col style="width: 71.4286%;">
          </colgroup>
          <thead>
            <tr>
              <th class="tableblock halign-left valign-top">Module   </th>
              <th class="tableblock halign-left valign-top">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#faim">faim</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Convenience utility that calls <a href="#n88solver">n88solver</a>,
                  <a href="#n88derivedfields">n88derivedfields</a> and <a href="#n88postfaim">n88postfaim</a>
                  in sequence.
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88coarsen">n88coarsen</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Reduce the size of finite element models so that an approximate solution can be
                  obtained quicker and with less memory.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88copymodel">n88copymodel</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Copy, convert or compress a finite element model file.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88compress">n88compress</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Compress a finite element model file in-place.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88derivedfields">n88derivedfields</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Calculate additional field values (forces, stress, strain, etc) that are
                  not generated by n88solver.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88directmechanics">n88directmechanics</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Perform <em>direct mechanics</em> calculations.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88evaluate">88evaluate</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Calculate some values that indicate the correctness of the solution.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88extractfields">n88extractfields</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Extracts specified solution fields as tabular text data.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88extractsets">n88extractsets</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Extract node sets, element sets and constraint sets and write them to VTK
                  PolyData (<code>.vtp</code>) files.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88interpolatesolution">n88interpolatesolution</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Copies and interpolates a solution from a solved reduced-resolution n88model
                  file, produced using n88coarsen, into the original n88model file.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88modelgenerator">n88modelgenerator</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Generate a finite element model from a segmented 3D image.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88modelinfo">n88modelinfo</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Print summary information for a Numerics88 FE model file.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88pistoia">n88pistoia</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Estimate failure loads from a linear model.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88postfaim">n88postfaim</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Generate tables of standard post-processing quantities.</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88solver">n88solver (_slt, _sla and _spt)</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Solvers suitable for small-strain models with linear elastic material definitions
                  (_el) or with non-linear elastoplastic material definitions (_ep).</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="#n88tabulate">n88tabulate</a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Tabulate values from <a href="#n88postfaim">n88postfaim</a> output files for
                  importing
                  into a spreadsheet.</p>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="sect2">
          <h3 id="faim">9.1. faim</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>A convenience utility that calls <a href="#n88solver">n88solver</a>,
              <a href="#n88derivedfields">n88derivedfields</a> and <a href="#n88postfaim">n88postfaim</a> in
              sequence on the specified model file.
            </p>
          </div>
          <div class="paragraph">
            <p>The analysis file produced by n88postfaim will be named after the input file,
              with "_analysis.txt" replacing the extension of the input file.</p>
          </div>
          <div class="paragraph">
            <p>The most appropriate solver for your input model will be used.</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>If your model contains elastoplastic material definitions, <code>n88solver_spt</code>
                  will be used.</p>
              </li>
              <li>
                <p>If your model contains exactly one material array with length equal to
                  the number of elements, <code>n88solver_sla</code> will be used.</p>
              </li>
              <li>
                <p>In all other cases, <code>n88solver_slt</code> will be used.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>The analysis file produced by n88postfaim will be named after the input
              file, with &#8220;_analysis.txt&#8221; replacing the extension of the input file.</p>
          </div>
          <div class="paragraph">
            <p>The command line arguments of faim are listed below. As they are passed
              through to the programs doing the work, they are grouped by program
              that they are passed to. In each case the options are identical to those
              of the program doing the work.</p>
          </div>
          <div class="literalblock">
            <div class="title">Arguments passed to n88solver</div>
            <div class="content">
              <pre>convergence_measure
convergence_tolerance
device
engine
license_check
maximum_iterations
maximum_plastic_iterations
quiet
restart
threads
threshold_window
plastic_threshold_window</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>For details, refer to <a href="#n88solver">n88solver</a>.</p>
          </div>
          <div class="literalblock">
            <div class="title">Arguments passed to n88derivedfields</div>
            <div class="content">
              <pre>device
engine
quiet
threads</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>For details, refer to <a href="#n88derivedfields">n88derivedfields</a>.</p>
          </div>
          <div class="literalblock">
            <div class="title">Arguments passed to n88postfaim</div>
            <div class="content">
              <pre>element_sets
node_sets
quiet
rotation_center</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>For details, refer to <a href="#n88postfaim">n88postfaim</a>.</p>
          </div>
          <table id="faim_arguments" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 8. faim arguments not passed to any program</caption>
            <colgroup>
              <col style="width: 33.3333%;">
              <col style="width: 66.6667%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--use_coarsen</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Generate a coarsened model if possible to
                    calculate an initial estimate of the solution.
                    For certain models, this may speed-up finding the final solution.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--no_post</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Do not run the postprocessor.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88coarsen">9.2. n88coarsen</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div id="n88coarsen_description" class="paragraph">
            <div class="title">Description</div>
            <p>This tool is used to reduce the size of finite element models so that an
              approximate solution can be obtained quickly and with less memory. It
              operates either directly on FE models, or on segmented image data.</p>
          </div>
          <div id="n88coarsen_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88coarsen [-h] [--material_averaging {linear,homminga_density}]
                  input_file output_file</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>When operating on n88model files, it will increase the size of elements by a
              factor of 2 in each dimension (thus a factor of 8 in volume), resulting in
              fewer larger elements. The output model is coarser: the coarsening is always
              done by adding volume to make larger elements, never by removing material, so
              that as compared with the input model, the output model always has greater or
              equal volume. Material properties are averaged over all the input elements
              corresponding to each output element. Empty space is treated as having
              identically zero stiffness, wherever empty space in the input is encompassed
              within an output element. All essential features of the model, including
              boundary conditions, applied forces, and post-processing sets, are translated
              to the new coarser mesh.</p>
          </div>
          <div class="paragraph">
            <p>When the input is an image, the resolution is reduced by exactly 1/2 in each
              linear dimension. Each 2x2x2 cube in the input becomes a single voxel in the
              output, with value equal to the maximum in the corresponding input 2x2x2.
              This operation does not average input values, since it does not make any
              sense to average segmentation values, which are just labels. Instead, it
              takes the maximum value over all the input voxels corresponding to an output
              voxel. This is a somewhat arbitrary choice. For this reason it is preferable
              to use <code>n88coarsen</code> directly on <code>n88model</code> files, where material averaging is
              possible.</p>
          </div>
          <div id="n88coarsen_usage_input_formats" class="ulist">
            <div class="title">Supported input formats</div>
            <ul>
              <li>
                <p>Numerics88 model file (.n88model)</p>
              </li>
              <li>
                <p>DICOM (a directory)</p>
              </li>
              <li>
                <p>Scanco AIM (.aim)</p>
              </li>
              <li>
                <p>MetaImage (.mha or .mhd)</p>
              </li>
              <li>
                <p>VTK XML ImageData (.vti)</p>
              </li>
            </ul>
          </div>
          <div id="n88coarsen_usage_output_formats" class="ulist">
            <div class="title">Supported output formats</div>
            <ul>
              <li>
                <p>Numerics88 model file (.n88model). If the input is an n88model file.</p>
              </li>
              <li>
                <p>VTK XML ImageData (.vti). If the input is an image.</p>
              </li>
            </ul>
          </div>
          <table id="n88coarsen_arguments" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 9. n88coarsen optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--material_averaging</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Determine how the material averaging is done. If
                    <code>linear</code>, then stress-strain matrices will be linearly
                    averaged. If <code>homminga_density</code>, then the stress-
                    strain matrices are first scaled to a density using
                    the Homminga formula (i.e. raised to the power 1/1.7),
                    then averaged, then converted back the stiffness by
                    raising to the power 1.7. <code>homminga_density</code> nearly
                    always gives more accurate approximations than
                    <code>linear</code>.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88copymodel">9.3. n88copymodel</h3>
          <div class="paragraph">
            <p>






            </p>
          </div>
          <div id="n88copymodel_description" class="paragraph">
            <div class="title">Description</div>
            <p>Copy, convert or compress a finite element model file.</p>
          </div>
          <div id="n88copymodel_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88copymodel [-h] [--compress] input [input2] output</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>File formats are automatically identified by their extensions. Ambiguous input file
              extensions are resolved by examining the file.</p>
          </div>
          <div class="paragraph">
            <p>Two input files are allowed if the first is a FAIM version 5 input file (<code>.inp</code>),
              and the second is a FAIM version 5 output file (<code>.dat</code>). This will create
              a complete, solved <code>n88model</code> file. Either <code>.inp</code> or <code>.dat</code> can also be
              converted individually,
              but in the case of <code>.dat</code> files, the resulting <code>n88model</code> file will be incomplete,
              as the <code>.dat</code> file alone does not contain either material definitions or
              constraints; however, it can be rendered and processed by <code>n88postfaim</code>, but not re-solved.</p>
          </div>
          <div id="n88copymodel_input_formats" class="ulist">
            <div class="title">Supported input formats</div>
            <ul>
              <li>
                <p>Numerics88 model file (.n88model)</p>
              </li>
              <li>
                <p>Abaqus input file (.inp)</p>
              </li>
              <li>
                <p>Faim version 5 input file (.inp)</p>
              </li>
              <li>
                <p>Faim version 5 output file (.dat)</p>
              </li>
            </ul>
          </div>
          <div id="n88copymodel_output_formats" class="ulist">
            <div class="title">Supported output formats</div>
            <ul>
              <li>
                <p>Numerics88 model file (.n88model)</p>
              </li>
              <li>
                <p>Abaqus input file (.inp)</p>
              </li>
              <li>
                <p>VTK XML Unstructured Grid file (.vtu)</p>
              </li>
            </ul>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  VTK XML Unstructured Grid files can be read be and rendered by ParaView,
                  even without the Numerics88 plugins. They include the complete geometry,
                  plus any solution fields, but lack any constraint or material information.
                </td>
              </tr>
            </table>
          </div>
          <table id="n88copymodel_arguments" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 10. n88copymodel optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--compress, -c</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Use compression when writing the output file if the file
                    format supports it. Compressed <code>n88model</code> files do not need
                    to be uncompressed in order to use them: they can be
                    used in all cases exactly like uncompressed files. Compressed files
                    may be slower to read, and are particularly slower to write.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  If you compress an <code>n88model</code> file, and then run either <code>n88solver</code>
                  or <code>n88derivedfields</code> on it, it will end up in a mixed state, where the
                  original data is compressed, but the new data added by <code>n88solver</code>
                  or <code>n88derivedfields</code> is uncompressed. There is nothing wrong with this as
                  the file is still completely valid and useable. However, usually if
                  compression is important, one wants the entire file data compressed.
                  Therefore, we recommend not compressing the file until you have completed
                  all the normal processing steps on it. It is of course possible to
                  convert a partially compressed <code>n88model</code> file to a fully compressed
                  <code>n88model</code> file by running <code>n88copymodel</code> or <code>n88compress</code> on it
                  again.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>See also the section <a href="#converting_version_5_file_formats">Converting Faim version 5 file
                formats</a>.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88compress">9.4. n88compress</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88compress FILENAME</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>is an alias for</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88copymodel --compress FILENAME FILENAME</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Refer to the documentation for <a href="#n88copymodel">n88copymodel</a>.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88derivedfields">9.5. n88derivedfields</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div id="n88derivedfields_description" class="paragraph">
            <div class="title">Description</div>
            <p>Calculates additional field values (forces, stress, strain, etc) that are
              not generated by <a href="#n88solver">n88solver</a>.</p>
          </div>
          <div class="paragraph">
            <p>For discussion of use, see the <a href="#using_n88derivedfields">section on using n88derivedfields</a>
              in the Post-processing chapter.</p>
          </div>
          <div id="n88derivedfields_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88derivedfields [options] input_file</pre>
            </div>
          </div>
          <div id="n88derivedfields_arguments" class="paragraph">
            <div class="title">Arguments</div>
            <p></p>
          </div>
          <table id="n88derivedfields_option_list" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 11. n88derivedfields arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--help [-h]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--version[-v]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print version information.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--quiet [-q]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Suppress output to terminal (except for error messages).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--precision arg (=single)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the floating point precision used.
                    Values: single, mixed, double.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88directmechanics">9.6. n88directmechanics</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div id="n88directmechanics_description" class="paragraph">
            <div class="title">Description</div>
            <p>Perform direct mechanics calculations. See <a href="#direct_mechanics">Direct Mechanics</a> in the
              Special Topics chapter.</p>
          </div>
          <div id="n88directmechanics_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88directmechanics [-h] [-c FILE] [--generate] [--solve] [--analyze]
                   [--material_table {homogeneous,homminga}]
                   [--youngs_modulus YOUNGS_MODULUS]
                   [--poissons_ratio POISSONS_RATIO]
                   [--orthotropic_parameters ORTHOTROPIC_PARAMETERS]
                   [--homminga_maximum_material_id HOMMINGA_MAXIMUM_MATERIAL_ID]
                   [--homminga_modulus_exponent HOMMINGA_MODULUS_EXPONENT]
                   [--connectivity_filter {on,off}]
                   input_file</pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 12. n88directmechanics input arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">input_file</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">An image file with segmented
                    data. Note
                    that the file name of the original image file should
                    be used even when the only action is <code>--solve</code> and/or
                    <code>--analyze</code>; the n88model file names will be derived
                    from the image file name. Supported input formats:
                  </p>
                  <p class="tableblock">- DICOM (a directory)</p>
                  <p class="tableblock">- Scanco AIM (.aim)</p>
                  <p class="tableblock">- MetaImage (.mha or .mhd)</p>
                  <p class="tableblock">- VTK XML ImageData (.vti)</p>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 13. n88directmechanics action arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--generate</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Generate models. (Generates 6 n88model files.)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--solve</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Solve models. (n88model files are updated with solutions.)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--analyze</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Perform direct mechanics analysis on solved files.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Multiple action arguments may be specified. If no action argument is
              specified, it is equivalent to specifying them all.</p>
          </div>
          <div id="n88directmechanics_material_specification_arguments" class="literalblock">
            <div class="title">n88directmechanics material specification arguments</div>
            <div class="content">
              <pre>material_table
youngs_modulus
poissons_ratio
orthotropic_parameters
homminga_maximum_material_id
homminga_modulus_exponent</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>These arguments are identical to the equivalent arguments of
              <a href="#n88modelgenerator">n88modelgenerator</a>. See <a
                href="#n88modelgenerator_material_arguments">Material specification parameters</a>.
            </p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 14. n88directmechanics optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-c FILE, --config FILE</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify a configuration file. The configuration file
                    may specify any arguments that take a value, one per
                    line, in the format name=value (leave the double dash
                    "--" off of the argument name). This format is
                    identical to <a href="#n88modelgenerator">n88modelgenerator</a>.
                    See <a href="#running_n88modelgenerator">Running n88modelgenerator</a>.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88directmechanics_additional_parameters" class="literalblock">
            <div class="title">n88directmechanics additional parameters</div>
            <div class="content">
              <pre>connectivity_filter
spacing</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>These arguments are identical to the equivalent arguments of
              <a href="#n88modelgenerator">n88modelgenerator</a>.
              See <a href="#n88modelgenerator_image_parameters">Input image parameters</a>.
            </p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  There are no options passed to the solver. If this is required, run
                  <code>n88directmechanics</code> with the <code>--generate</code> action, then manually run
                  <a href="#n88solver">n88solver</a> on
                  each of the resulting <code>n88model</code> files, using the desired solver options, then
                  run <code>n88directmechanics</code> again with the <code>--analyze</code> action.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88evaluate">9.7. n88evaluate</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div id="n88evaluate_description" class="paragraph">
            <div class="title">Description</div>
            <p>A tool to evaluate the quality of solutions.</p>
          </div>
          <div class="paragraph">
            <p>For discussion of use, see the
              <a href="#evaluating_solution_quality">section on using evaluating solution quality</a>
              and the section
              <a href="#evaluating_nonlinear_solution_quality">section on using evaluating nonlinear solution
                quality</a>.
            </p>
          </div>
          <div id="n88evaluate_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88evaluate [options] input_file</pre>
            </div>
          </div>
          <div id="n88evaluate_arguments" class="paragraph">
            <div class="title">Arguments</div>
            <p></p>
          </div>
          <table id="n88evaluate_option_list" class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 15. n88evaluate arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--help [-h]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--sparse [-s]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Use sparse matrices for calculation. This is the default, but requires that
                    scipy be installed.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--dense [-t]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Use dense matrices for calculation. This does not require scipy to be installed,
                    but as the memory requirements scale as the square of the number of degrees of
                    freedom in the problem, this is feasible only for very small problems.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88extractfields">9.8. n88extractfields</h3>
          <div class="paragraph">
            <p>




            </p>
          </div>
          <div id="n88extractfields_description" class="paragraph">
            <div class="title">Description</div>
            <p>Extracts specified solution fields as tabular text data.</p>
          </div>
          <div id="n88extractfields_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88extractfields [-h] [--output_file OUTPUT_FILE] fields input_file</pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 16. n88extractfields positional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fields</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">A comma-delimited list of names of solution fields to extract.
                    May be the name of either a solution node value (<em>e.g.</em>
                    &#8220;Displacement&#8221;) or a solution element value (<em>e.g.</em> &#8220;Stress&#8221;;
                    see also
                    <a href="#n88derivedfields">Calculating additional solution fields with n88derivedfields</a>)
                    Additionally, &#8220;NodeNumber&#8221;, &#8220;ElementNumber&#8221;, &#8220;MaterialID&#8221;,
                    &#8220;NodeCoordinates&#8221;,
                    &#8220;ElementCoordinates&#8221; or &#8220;Topology&#8221; can be specified.
                    Element coordinates are the centers of the elements. Topology
                    gives for each element the 8 node numbers of the nodes
                    constituting the element. The order is as in the <code>n88model</code> file,
                    refer to the <a href="#n88file_parts">file specification</a>. All fields must be
                    the same length, which
                    practically means that they must either be all node values or all
                    element values.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">input</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The model file.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 17. n88extractfields optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--output_file OUTPUT_FILE, -o OUTPUT_FILE</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Output file. If not specified, output will go to
                    STDOUT.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88extractfields_examples" class="paragraph">
            <div class="title">Examples</div>
            <p>This will extract the displacement values as an N&#215;3 array, where N is
              the number of nodes:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88extractfields Displacement mymodel.n88model
-0.00136573     -0.00136573     0.0
-0.000770869    -0.00142601     0.0
-0.000218384    -0.00141035     0.0
0.000218384     -0.00141035     0.0
0.000770869     -0.00142601     0.0
0.00136573      -0.00136573     0.0
-0.00142601     -0.000770869    0.0
...</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>This example will extract both element number and corresponding stress.
              As the stress is 6-valued, this makes a total of 7 values per row of
              output:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88extractfields ElementNumber,Stress mymodel.n88model
1       -0.752387       -0.752387       -69.0185        0.965844        0.965844        -0.00933552
2       -4.98979        -1.50565        -73.2319        0.629349        0.690826        1.61737
3       -6.35569        -0.494144       -74.5778        0.486541        -4.27155e-16    -5.6954e-16
4       -4.98979        -1.50565        -73.2319        0.629349        -0.690826       -1.61737
5       -0.752385       -0.752386       -69.0185        0.965844        -0.965844       0.00933552
6       -1.50565        -4.98979        -73.2319        0.690826        0.629349        1.61737
7       -1.50565        -4.98979        -73.2319        0.690826        -0.62934
...</pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88extractsets">9.9. n88extractsets</h3>
          <div class="paragraph">
            <p>





            </p>
          </div>
          <div id="n88extractsets_description" class="paragraph">
            <div class="title">Description</div>
            <p>Extract node sets, element sets and constraint sets and write them to VTK
              PolyData (.vtp) files which can be opened with ParaView. This is mostly useful for
              visualizing sets, boundary conditions and applied forces. For nodes sets and
              constraints, these files will consist of a collection of vertices.</p>
          </div>
          <div id="n88extractsets_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88extractsets [-h] [--constraints] [--node_sets] [--element_sets] input</pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 18. n88extractsets arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">show this help message and exit</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--constraints, -C</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Extract constraints.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--node_sets, -N</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Extract node sets.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--element_sets, -E</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Extract element sets.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>If no arguments are specified, all types of sets will be extracted.</p>
          </div>
          <div class="admonitionblock warning">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/warning.png" alt="Warning">
                </td>
                <td class="content">
                  This utility will generate file names based on the names of the sets,
                  and will overwrite existing files with the same names without warning.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88interpolatesolution">9.10. n88interpolatesolution</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div id="n88interpolatesolution_description" class="paragraph">
            <div class="title">Description</div>
            <p>Copies and interpolates a solution from a solved reduced-resolution n88model
              file, produced using <a href="#n88coarsen">n88coarsen</a>, into the original n88model file. This may
              help to obtain faster solutions.</p>
          </div>
          <div id="n88interpolatesolution_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88interpolatesolution [-h] full_model reduced_model</pre>
            </div>
          </div>
          <div class="admonitionblock warning">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/warning.png" alt="Warning">
                </td>
                <td class="content">
                  For linear models only.
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88modelgenerator">9.11. n88modelgenerator</h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div id="n88modelgenerator_description" class="paragraph">
            <div class="title">Description</div>
            <p>Generates a finite element model from a segmented 3D image.</p>
          </div>
          <div class="paragraph">
            <p>Refer to the <a href="#using_n88modelgenerator">chapter on using n88modelgenerator</a>.</p>
          </div>
          <div id="n88modelgenerator_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88modelgenerator [options] input_file [output_file]</pre>
            </div>
          </div>
          <div id="n88modelgenerator_input_formats" class="paragraph">
            <div class="title">Supported input image file formats</div>
            <p>




            </p>
          </div>
          <div class="paragraph">
            <p>n88modelgenerator currently supports the following input formats:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>DICOM (automatically selected when a directory is given as the input),</p>
              </li>
              <li>
                <p>Scanco <code>.aim</code> files,</p>
              </li>
              <li>
                <p>ITK MetaImage files (<code>.mha</code>) or (<code>.mhd</code>),</p>
              </li>
              <li>
                <p>VTK XML Image Data files (<code>.vti</code>),</p>
              </li>
              <li>
                <p>existing Numerics88 Model file (<code>.n88model</code>)</p>
              </li>
            </ul>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  There are some limitations when reading DICOM files. In particular,
                  encapsulated format cannot be read. It is sometimes not possible to
                  determine the <em>z</em>-spacing from DICOM files. In this case use
                  the option <a href="#n88modelgenerator_spacing">spacing</a>.
                </td>
              </tr>
            </table>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  If an n88model file is provided as an input file, the mesh (i.e. the points
                  and elements) will be taken from the input, as well as any possible solution
                  fields. A new material table and new constraints will be generated. This
                  is useful for incremental loading tests of nonlinear models, as it allows
                  the boundary conditions to be updated while preserving an existing solution.
                </td>
              </tr>
            </table>
          </div>
          <div id="n88modelgenerator_output_formats" class="paragraph">
            <div class="title">Supported output file formats</div>
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>The standard output format of <code>n88modelgenerator</code> is an <code>n88model</code> file
              (see <a href="#n88model_file_format">n88model File Format</a>). If you specify an output file with
              extension <code>.n88model</code>, the <code>n88model</code> file format will be used. This
              is the default output type, and if no output file is specified, an
              output file will be generated from the stem of the input file, with the
              extension <code>.n88model</code> appended.</p>
          </div>
          <div class="paragraph">
            <p><code>n88modelgenerator</code> also supports the output of Abaqus input files.
              An Abaqus input file will be generated whenever an output file with
              extension <code>.inp</code> is specified.</p>
          </div>
          <div id="n88modelgenerator_io_parameters" class="paragraph">
            <div class="title">Input and output parameters</div>
            <p>Input and output parameters specify the files that are used for input
              and output.</p>
          </div>
          <div class="paragraph">
            <p></p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 19. n88modelgenerator Input and Output Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_input_file"></a>input_file</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the name of the input file. Note that it is not
                    necessary to explicitly use &#8220;--input_file&#8221; on the command line, as
                    the first positional argument (i.e. the first argument not starting
                    with a dash), is taken to be the input file.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_output_file"></a>output_file</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the name of the output file. If not specified, a default
                    output file name will be used, which is of the form
                    <code>[input]_[test_type].n88model</code> . Note that it is not
                    necessary to explicitly use &#8220;--output_file&#8221; on the command line even
                    if you want to specify the output file name, as
                    the second positional argument, (i.e. the second argument not starting
                    with a dash), if present, is taken to be the output file.
                    However the type of output file is determined by the extension of
                    output_file, therefore if output different than the default type
                    (<code>n88model</code>) is desired, the output file must be explicitly specified.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88modelgenerator_image_parameters" class="paragraph">
            <div class="title">Input image parameters</div>
            <p></p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 20. n88modelgenerator Input Image Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description

                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_spacing"></a>spacing</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Force the spacing of the input image. This
                    is sometimes required for DICOM files, for
                    which the <em>z</em>-spacing sometimes cannot be
                    determined. Values should be given as a
                    comma-delimited list of <em>x</em>,<em>y</em>,<em>z</em> values. <em>e.g.</em>
                    <code>0.5,0.5,0.5</code> .
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_connectivity_filter"></a>connectivity_filter</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Enable/disable connectivity filtering which extracts
                    only the largest connected object in the input image. See
                    <a href="#ensuring_connectivity">Ensuring connectivity</a> in the chapter about <code>vtkbone</code>
                    for a discussion of this issue. Valid values are <code>on</code>, <code>off</code> and
                    <code>warn</code>.
                    The default is <code>on</code>.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88modelgenerator_test_parameters" class="paragraph">
            <div class="title">Test configuration parameters</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p>Test configuration parameters define the mechanical test that will be
              applied to the object in the image.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 21. n88modelgenerator Test Configuration Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description

                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_test"></a>test</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify test type. Valid values are <code>uniaxial</code>, <code>axial</code>,
                    <code>confined</code>, <code>bending</code>, <code>torsion</code>, <code>symshear</code>
                    and <code>dshear</code>. See <a href="#standard_tests">Standard Tests</a>.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_test_axis"></a>test_axis</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the test axis. See <a href="#test_orientation">Test Orientation</a>.
                    Valid values are <em>x</em>, <em>y</em>, and <em>z</em>. The default is <em>z</em>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_normal_strain"></a>normal_strain</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">For a compression type test, specifies an apparent level strain.
                    Negative values correspond to compression.
                    Strain is the default if neither strain nor displacement are specified.
                    Default -0.01, corresponding to 1% compressive strain.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_shear_strain"></a>shear_strain</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">For a <a href="#symshear_test">symshear test</a>, this sets the apparent
                    engineering shear strain applied to the model.
                    Unitless.
                    Default 0.01.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">strain</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Shortened equivalent of either normal_strain or shear_strain, depending
                    on the test type.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_displacement"></a>displacement</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify an applied displacement (with units of length) for a compression type
                    test.
                    Negative values correspond to compression.
                    This parameter is exclusive with <code>normal_strain</code>: one or the other may be used, but
                    not both.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_pin"></a>pin</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Fully define the constraints for a uniaxial model by adding an arbitrary
                    pinned point to prevent lateral translation, and a second partially
                    pinned point to prevent lateral rotation. If this option is off, the
                    system of equations for a uniaxial test is singular. Faim can solve it
                    regardless, and will in fact typically solve it faster. This option is
                    ignored for test types other than uniaxial.
                    Valid values are <code>off</code>, <code>center</code>, <code>corner</code> and <code>on</code>. The
                    value <code>corner</code> adds a pin
                    at the element with the minimum <em>z</em>,<em>y</em>,<em>x</em> coordinates in the Test Frame
                    (<em>i.e.</em> select by minimum <em>z</em>, then by minimum <em>y</em>, then by minimum
                    <em>x</em>).
                    <code>center</code> adds a pin at the element closest to the center <em>x</em>,<em>y</em> position
                    in the Test Frame. (The <em>z</em> coordinate is not considered, unless two
                    elements are equally close to the <em>x</em>,<em>y</em> center, in which case the one
                    with smallest <em>z</em> is selected.) The value <code>on</code> is equivalent to
                    <code>center</code>.
                    Default is <code>off</code>.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_central_axis"></a>central_axis</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The <em>x</em>,<em>y</em> coordinates (in the Test Frame) of the central axis,
                    which is parallel to the <em>z</em> axis (in the Test Frame).
                    Example: <code>0,0</code> . Alternatively, you can specify <code>center_of_mass</code> or
                    <code>center_of_bounds</code>.
                    The default is <code>center_of_mass</code>.
                    The central axis is used in <a href="#bending_test">bending</a> and
                    <a href="#torsion_test">torsion</a> tests.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_bending_angle"></a>bending_angle</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The degree of tilt between the top and bottom surfaces in a
                    <a href="#bending_test">bending test</a>.
                    Units are degrees. The default is 1.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_neutral_axis_angle"></a>neutral_axis_angle</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The angle of the neutral axis in the <em>x</em>,<em>y</em> plane (in the Test
                    Frame) in a
                    <a href="#bending_test">bending test</a>. 0 is parallel to the <em>x</em>-axis.
                    Units are degrees. Default is 90, parallel to the <em>y</em>-axis.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_shear_vector"></a>shear_vector</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The amount of shear displacement of the top surface as a vector in the
                    <em>x</em>,<em>y</em> plane (in the Test Frame) for a <a href="#dshear_test">dshear test</a>. Units
                    are
                    length units if scale_shear_to_height is off, otherwise a unitless ratio.
                    Default is 0.01,0 .
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_scale_shear_to_height"></a>scale_shear_to_height</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">If <code>on</code>, shear_vector will be scaled by the height of the model
                    extent (in
                    the <em>z</em> direction in the Test Frame) to determine the shear displacement
                    applied for a <a href="#dshear_test">dshear test</a>.
                    Valid values are <code>on</code> and <code>off</code>. Default is <code>on</code>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_twist_angle"></a>twist_angle</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Amount of rotation of the top surface in a torsion test. Units are degrees.
                    Default is 1.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88modelgenerator_surface_detection_parameters" class="paragraph">
            <div class="title">Surface detection parameters</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p>Surface detection parameters modify how the top and bottom surfaces of the
              object image are identified. For most test types, the principle
              boundary conditions are applied to these two surfaces. If not specified,
              by default these surfaces are identified as all nodes (or elements) at the top
              or bottom extent of the input.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 22. n88modelgenerator Surface Detection Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description

                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_top_surface"></a>top_surface</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify method of selecting top surface. Valid values are
                    <code>intersection</code>
                    and <code>visible</code>. See <a href="#uneven_surfaces">Uneven surfaces</a>.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_bottom_surface"></a>bottom_surface</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify method of selecting bottom
                    surface. Valid values are <code>intersection</code> and <code>visible</code>. See
                    <a href="#uneven_surfaces">Uneven surfaces</a>.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_top_surface_maximum_depth"></a>top_surface_maximum_depth</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the maximum depth for identifying the top surface. Only applies
                    if <code>top_surface</code> = <code>visible</code>. If unspecified, depth is unlimited. Depth is
                    measured from the top boundary of the volume.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_bottom_surface_maximum_depth"></a>bottom_surface_maximum_depth</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the maximum depth for identifying the bottom surface. Only applies
                    if <code>bottom_surface</code> = <code>visible</code>. If unspecified, depth is unlimited. Depth is
                    measured (upwards) from the bottom boundary of the volume.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_top_constraint_material_id"></a>top_constraint_material_id</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Apply boundary conditions at the top surface only to cells and nodes of the
                    specified material ID.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_bottom_constraint_material_id"></a>bottom_constraint_material_id</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Apply boundary conditions at the bottom surface only to cells and nodes of
                    the specified material ID.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88modelgenerator_material_arguments" class="paragraph">
            <div class="title">Material specification parameters</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p>Material specification parameters are used to specify material definitions,
              and to select a material table that maps material IDs to material definitions.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 23. n88modelgenerator Material Specification Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description


                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_poissons_ratio"></a>poissons_ratio</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify isotropic Poisson&#8217;s ratio. The default is 0.3 .</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_youngs_modulus"></a>youngs_modulus</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify isotropic Young&#8217;s modulus. The default is 6829.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_orthotropic_parameters"></a>orthotropic_parameters</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify orthotropic parameters as
                    <em>E<sub>x</sub></em>,<em>E<sub>y</sub></em>,<em>E<sub>z</sub></em>,<em>&#957;<sub>yz</sub></em>,<em>&#957;<sub>zx</sub></em>,<em>&#957;<sub>xy</sub></em>,<em>G<sub>yz</sub></em>,<em>G<sub>zx</sub></em>,<em>G<sub>xy</sub></em>
                    .
                    If not set, isotropic parameters will be assumed.
                    <strong>Important</strong>: There are two common conventions for ordering the mixed index
                    quantities <em>&#957;<sub>ij</sub></em> and <em>G<sub>ij</sub></em>. Numerics88 software uses the
                    ordering <em>YZ</em>,
                    <em>ZX</em>, <em>XY</em>. It is important to observe this when specifying orthotropic
                    properties in <code>n88modelgenerator</code>, as these are input in the form of an
                    ordered list.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_plasticity"></a>plasticity</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify an elastoplastic yield criterion.
                    Specify as several values separated by
                    commas. The first value is an elastoplastic yield criterion
                    name; subsequent values are numeric
                    arguments appropriate to the method.</p>
                  <p class="tableblock"> Supported methods:</p>
                  <p class="tableblock"> <code>VonMises,Y</code> : <code>Y</code> is the yield strength. Refer to <a
                      href="#von_mises_material">von Mises yield criterion</a>.</p>
                  <p class="tableblock"> <code>MohrCoulomb,YT,YC</code> : <code>YT</code> is the yield
                    strength in tension and <code>YC</code> is the
                    yield strength in compression. Refer to <a href="#mohr_coulomb_material">Mohr-Coulomb yield
                      criterion</a>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_material_table"></a>material_table</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify method for generating material table.
                    Valid values are <code>homogeneous</code> and
                    <code>homminga</code>. <code>homogeneous</code> assigns the same
                    material to all material IDs.
                    <code>homminga</code> generates a table of materials
                    according to Homminga et al. Refer to
                    <a href="#homminga_material_table">Homminga material table</a> for details.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_homminga_maximum_material_id"></a>homminga_maximum_material_id</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the maximum material ID used in Homminga density to modulus conversion.
                    The default is 127.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_homminga_modulus_exponent"></a>homminga_modulus_exponent</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify exponent used in Homminga density to modulus conversion.
                    The default is 1.7 .</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_material_definitions"></a>material_definitions</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify a material definitions file for advanced material specification.
                    If specified, all other material specification arguments will be ignored.
                    Refer to the section <a href="#material_definitions_file">material definitions file</a>
                    in the chapter on Preparing Finite Element Models With n88modelgenerator.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div id="n88modelgenerator_solver_parameters" class="paragraph">
            <div class="title">Solver parameters</div>
            <p></p>
          </div>
          <div class="paragraph">
            <p>Solver parameters affect the execution of the solver. They are independent
              of the model creation, and are specific to the solver used. If given
              as arguments to <code>n88modelgenerator</code>, they will be stored in the <code>n88model</code>
              file. However for most purposes, it is better to leave these out of the
              <code>n88model</code> file and either use the defaults as selected by the solver,
              or else to specify them as command line arguments directly to the solver. See
              <a href="#n88solver">n88solver</a>.
            </p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 24. n88modelgenerator Solver Parameters</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description

                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_convergence_tolerance"></a>convergence_tolerance</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify convergence tolerance for conjugate gradient iterations. If not
                    specified
                    a default value will be used. See <a href="#n88solver">Generating the displacements with
                      n88solver</a>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88modelgenerator_maximum_iterations"></a>maximum_iterations</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the maximum number of conjugate gradient iterations. If not specified
                    a default value will be used. The default is 30000. See <a href="#n88solver">Generating the
                      displacements with n88solver</a>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_plastic_convergence_tolerance"></a>plastic_convergence_tolerance</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify convergence tolerance for plastic iterations. If not specified
                    a default value will be used.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a
                      id="n88modelgenerator_maximum_plastic_iterations"></a>maximum_plastic_iterations</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the maximum number of plastic iterations. If not specified
                    a default value will be used. The default is 100.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88modelinfo">9.12. n88modelinfo</h3>
          <div class="paragraph">
            <p>

            </p>
          </div>
          <div id="n88modelinfo_description" class="paragraph">
            <div class="title">Description</div>
            <p>Print summary information for a Numerics88 finite element model file.</p>
          </div>
          <div id="n88modelinfo_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88modelinfo [-h] [--active] [--history] [--log] [--materials]
             [--parts] [--node_sets] [--element_sets] [--sets]
             [--constraints] [--problems] [--solutions]
             input_file</pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 25. n88modelinfo positional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">input_file</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The .n88model file to read.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 26. n88modelinfo action arguments:</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--active</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">List active solution, problem and part.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--history</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show history.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--log</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show log.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--materials</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">List defined materials.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--parts</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show parts.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--node_sets</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show nodesets.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--element_sets</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show elementsets.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--sets</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show both node and element sets. (Equivalent to --node_sets and --element_sets.)
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--constraints</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show constraints.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--problems</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show problems.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--solutions</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show solutions.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Multiple action arguments may be specified. If no action argument is
              specified, it is equivalent to specifying them all.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 27. n88modelinfo optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Show help and exit.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88pistoia">9.13. n88pistoia</h3>
          <div id="n88pistoia_description" class="paragraph">
            <div class="title">Description</div>
            <p>Calculate Pistoia yield critera. This is a method if estimating yield strength
              from linear solutions. In general, it would be preferable to use a non-linear
              elastoplastic model to calculate yield strengths. This utility is provided
              mostly for comparing with older results.</p>
          </div>
          <div class="paragraph">
            <p>For discussion of use, see the
              <a href="#n88postfaim_pistoia_failure_load">section on the Pistoia failure load estimate</a>
              in the special topics chapter.
            </p>
          </div>
          <div class="paragraph">
            <p>Note that <code>n88pistoia</code> is implemented in python (in <code>tools/pistoia.py</code>), so you
              can copy it and modify it should you wish to modify the analysis.</p>
          </div>
          <div id="n88pistoia_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88pistoia [options] input_file</pre>
            </div>
          </div>
          <div id="n88pistoia_arguments" class="paragraph">
            <div class="title">Arguments</div>
            <p></p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 28. n88pistoia arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--help [-h]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--output_file [-o] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify an output file.
                    If no output file is specified, output will
                    go to STDOUT.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--constraint [-n] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the constraint (i.e. boundary condition or
                    applied load) to use for analysis. This is the surface
                    to which forces are applied. The default
                    ("top_displacement") will work for models generated
                    with n88modelgenerator.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--rotation_center [-c] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the spatial center used for calculation of angular
                    quantities. The argument must be given as
                    a triplet of coordinates. If not specified, the
                    value will be read from the input file. If not available,
                    no angular quantities will be calculated.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--include [-i] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Only elements with the specified material IDs will be
                    included in the calculation. Multiple IDs can be
                    specified in a comma-delimited list (e.g.
                    100,101,105).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--exclude [-e] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">All elements with the specified material IDs will be
                    excluded from the calculation. Multiple IDs can be
                    specified in a comma-delimited list (e.g.
                    100,101,105).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--critical_volume arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the fixed critical volume (as percent) (e.g. 2.0).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--critical_strain arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the fixed critical strain (e.g. 0.007).</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88postfaim">9.14. n88postfaim</h3>
          <div id="n88postfaim_description" class="paragraph">
            <div class="title">Description</div>
            <p>Generate tables of standard post-processing quantities.</p>
          </div>
          <div class="paragraph">
            <p>For discussion of use, see the <a href="#using_n88postfaim">section on using n88postfaim</a>
              in the post-processing chapter.</p>
          </div>
          <div class="paragraph">
            <p>Note that <code>n88postfaim</code> is implemented in python (in <code>tools/postfaim.py</code>), so you
              can copy it and modify it should you wish to modify the analysis.</p>
          </div>
          <div id="n88postfaim_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88postfaim [options] input_file</pre>
            </div>
          </div>
          <div id="n88postfaim_arguments" class="paragraph">
            <div class="title">Arguments</div>
            <p></p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 29. n88postfaim arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--help [-h]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--output_file [-o] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify an output file.
                    If no output file is specified, output will
                    go to STDOUT.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--node_sets [-N] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the node sets to use for analysis.
                    The argument should be a list of node set names,
                    separated by commas. If not specified, the value
                    will be read from the input file.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--element_sets [-E] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the element sets to use for analysis.
                    The argument should be a list of element set names,
                    separated by commas. Each node set must be matched
                    by the corresponding set of elements. If not specified,
                    the value will be read from the input file.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--sets [-s] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">A convenience option that sets both node_sets and
                    elements_sets. This is only useful if corresponding
                    node and element sets are identically named.</p>
                  <p class="tableblock"><a id="n88postfaim_rotation_center"></a></p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--rotation_center [-c] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify the spatial center used for calculation of angular
                    quantities. The argument must be given as
                    a triplet of coordinates. If not specified, the
                    value will be read from the input file. If not available,
                    no angular quantities will be calculated.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="n88solver">9.15. n88solver (_slt, _sla and _spt)</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div id="n88solver_description" class="paragraph">
            <div class="title">Description</div>
            <p><code>n88solver_slt</code> and <code>n88solver_sla</code> are solvers suitable for small-strain models
              with linear elastic material definitions. <code>n88solver_spt</code> can solve nonlinear models
              containing elastoplastic material definitions.</p>
          </div>
          <div class="paragraph">
            <p><code>n88solver_slt</code> and <code>n88solver_spt</code> use material tables internally: they are most
              efficient when the number of defined materials is substantially less than
              the number of elements in the model. This is the usual case. <code>n88solver_sla</code>
              is a special-purpose solver that uses a material array internally: it is more
              efficient when the number of defined materials is comparable to the number
              of elements. See
              <a href="#material_arrays">Efficient Handling of Large Numbers of Material Definitions</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>See the chapters on <a href="#solving_linear_problems">Solving Linear Problems</a>
              and <a href="#solving_nonlinear_problems">Solving Nonlinear Problems</a> for discussion
              of use.</p>
          </div>
          <div id="n88solver_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88solver_slt [options] input_file
n88solver_sla [options] input_file
n88solver_spt [options] input_file</pre>
            </div>
          </div>
          <div id="n88solver_option_list" class="paragraph">
            <div class="title">Arguments</div>
            <p></p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 30. n88solver arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Argument</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--help [-h]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print help and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--version [-v]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print version information and exit.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--quiet [-q]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Suppress output to terminal (except for error messages).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--license-check [-l]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print licensing information.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_engine"></a>--engine [-g] arg (=mt)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the solver engine. Valid values are
                    <code>mt</code> for the multi-threaded CPU engine and <code>nv</code> for the nVidia GPU engine.
                    Note that a license from Numerics88 Solutions is required to use the GPU
                    engine.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_threads"></a>--threads [-t] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the number of threads for the mt engine. If not specified,
                    the number of threads will be set to one per CPU
                    core on the system, or one thread per 2048 elements,
                    whichever is less.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_device"></a>--device [d] arg (=0)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the nVidia CUDA device to use (applies only to nv solver). Multiple
                    devices may be specified in a comma delimited list.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--precision arg (=double)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the floating point precision used.
                    Values: <code>single</code>, <code>mixed</code>, <code>double</code>.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_restart"></a>--restart [-r]</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Do not use the existing solution as initial value.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_convergence_measure"></a>--convergence_measure [-m] arg (=auto)
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the convergence measure.
                    See <a href="#convergence_measure">convergence measure</a> in the section on
                    solving linear models. For linear models, if <code>auto</code> is selected,
                    <code>set</code> will be used if a convergence set is defined in the model;
                    otherwise the fallback is <code>dumax</code>. For elastoplastic models, the
                    default is always <code>dumax</code>, even when a convergence set is defined.
                    Values: <code>set</code>, <code>dumax</code>, <code>durms</code>, <code>auto</code>.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_convergence_tolerance"></a>--convergence_tolerance [-e] arg
                    (=1E-6)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the convergence tolerance.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_convergence_window"></a>-convergence_window [-w] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the linear convergence window.
                    Convergence is not considered reached until the
                    convergence measure
                    remains below the threshold for at least this number
                    of consecutive iterations.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_plastic_convergence_window"></a>-plastic_convergence_window
                    [-W] arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set the plastic convergence window.
                    Plastic convergence is not considered reached until the
                    convergence measure
                    remains below the threshold for at least this number
                    of consecutive iterations.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_maximum_iterations"></a>--maximum_iterations [-n] arg (=30000)
                  </p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set maximum number of linear iterations.
                    Note that for elastoplastic models the count of linear iterations is reset
                    on each plastic iteration.</p>
                  <p class="tableblock"> [-N] arg</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_maximum_plastic_iterations"></a>--maximum_plastic_iterations
                    arg (=1000)</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Set maximum number of plastic iterations.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><a id="n88solver_iterations_file"></a>--iterations_file -i arg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Specify a file to output all iteration data.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>The <code>convergence_tolerance</code>, <code>maximum_iterations</code>, and
              <code>maximum_plastic_iterations</code>
              may also be set in the input file. If present in both the input
              file as well as specified on the command line as options to <code>n88solver</code>,
              the options on the command line to <code>n88solver</code> take precedence.
            </p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="n88tabulate">9.16. n88tabulate</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div id="n88tabulate_description" class="paragraph">
            <div class="title">Description</div>
            <p>Extract and tabulate values from <a href="#n88postfaim">n88postfaim</a> output files.
              The result is suitable for importing into a spreadsheet.</p>
          </div>
          <div id="n88tabulate_usage" class="listingblock">
            <div class="title">Usage</div>
            <div class="content">
              <pre>n88tabulate [-h] [--variables VARIABLES] [--from FROM] [--header]
                   [--delimiter DELIMITER] [--output_file OUTPUT_FILE]
                   [input_files [input_files ...]]</pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 31. n88tabulate positional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">input_files</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>n88postfaim</code> output files to process. Any number may be
                    specified, and wildcard expansion of <code>*</code> and <code>?</code> is performed
                    on systems where the shell does not do this.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 32. n88tabulate optional arguments</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">Option</th>
                <th class="tableblock halign-left valign-top">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">-h, --help</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">show this help message and exit</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--variables VARIABLES, -V VARIABLES</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">A list of the variables to extract from the input
                    files. Separate variable names with commas. See below
                    for a list of valid variable names. If not specified
                    all possible variables will be selected (this makes
                    for a very large table).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--from FROM, -f FROM</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Obtain the list of variables from the first line of a
                    text file. The variable names may be separated by any
                    kind of delimiter (white space or commas). Note that
                    an output file (from n88tabulate, generated with the
                    <code>--header</code> option) can be used as a <code>--from</code> argument, in
                    which case the same selection of variables will be
                    used.
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--header, -H</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Print a header line first. May be used even if no
                    input files are specified.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--delimiter DELIMITER, -d DELIMITER</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Delimiter character to separate columns. Default is a
                    tab (&#8220;\t&#8221;).</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">--output_file OUTPUT_FILE, -o OUTPUT_FILE</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Output file. If not specified, output will go to
                    STDOUT.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>For any variables not found in the analysis file, a dash (&#8220;-&#8221;) will be
              inserted into the output table.</p>
          </div>
          <div id="n88tabulate_examples" class="paragraph">
            <div class="title">Examples</div>
            <p>In the following example, every possible variable will be extracted from
              every file ending in &#8220;_analysis.txt&#8221; in the directory. This will result
              in a very large number of values. The output will be written to the file
              <code>summary.txt</code>.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88tabulate -H -o summary.txt *_analysis.txt</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>In the following example, we request the total forces along the z direction
              on the first two node sets for two different analysis files.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88tabulate -H -V "filename,fz_ns1,fz_ns2" test25a_analysis.txt test42a_analysis.txt
filename	fz_ns1	fz_ns2
test25a_uniaxial.n88model	-0.1019E+02	0.1019E+02
test42a_uniaxial.n88model	-0.4641E+02	0.4641E+02</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The following example is exactly the same, but the output goes to a file.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>n88tabulate -H -V "filename,fz_ns1,fz_ns2" -o summary.txt test25a_analysis.txt test42a_analysis.txt</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Now suppose we want the same selection of variables on a different
              analysis file, we could do the following. Notice that we are getting the
              list of variables from the existing file <code>summary.txt</code>.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88tabulate -H --from summary.txt test99a_analysis.txt
filename    fz_ns1  fz_ns2
test99a_uniaxial.n88model   -0.6442E+02     0.6442E+02</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>In the following example, we are interested in the strain energy density,
              and request some statistical values. We also use a comma as the delimiter.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ n88tabulate -H -d ',' -V "sed_avg,sed_stddev,sed_skew,sed_kurt" analysis.txt
sed_avg,sed_stddev,sed_skew,sed_kurt
0.2990E+00,0.1127E+00,-0.1512E+01,0.8999E+00</pre>
            </div>
          </div>
          <div id="n88tabulate_variables" class="paragraph">
            <div class="title">Variables</div>
            <p>In the variable list, certain variables can take one or more numeric indices.
              This is denoted with <code>%</code>. For example, for <code>id_mat%m</code>, actual variable names
              are <code>id_mat1</code> for the first defined material, <code>id_mat2</code> for the second
              defined material, and so on. Similarly for <code>dx_avg_ns%n</code>, actual variables
              names are <code>dx_avg_ns1</code> for the first node set, <code>dx_avg_ns2</code> for the second
              node set, and so on.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 33. Variables corresponding to values in table &#8220;Model Input&#8221;
            </caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">filename</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Filename</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">num_els</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Number of elements</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">num_nodes</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Number of nodes</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_model_input">Model Input</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 34. Variables corresponding to values in table &#8220;Materials&#8221;
            </caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">mats_mats</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Number of materials</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">id_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The material ID of the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">count_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Number of elements for the m<sup>th</sup> defined material</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_materials">Materials</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 35. Variables corresponding to values in table &#8220;Post-processing
              Sets&#8221;</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">num_pp_sets</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The number of sets used in post-processing.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_postprocessing_sets">Post-processing sets</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 36. Variables corresponding to values in table &#8220;Strain Energy
              Density&#8221;</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_avg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">average (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_stddev</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">std_dev (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_skew</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">skewness (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_kurt</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">kurtosis (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_min</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">minimum (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_max</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">maximum (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_median</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">median (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_avg_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">average over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_stddev_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_dev over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_skew_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">skewness over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_kurt_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">kurtosis over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_min_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">minimum over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_max_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">maximum over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">sed_median_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">median over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_strain_energy_density">Strain Energy Density</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 37. Variables corresponding to values in table &#8220;Von Mises Stress&#8221;
            </caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_avg</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">average (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_stddev</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">std_dev (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_skew</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">skewness (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_kurt</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">kurtosis (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_min</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">minimum (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_max</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">maximum (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_median</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">median (all materials)</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_avg_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">average over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_stddev_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_dev over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_skew_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">skewness over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_kurt_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">kurtosis over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_min_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">minimum over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_max_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">maximum over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">svm_median_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">median over the m<sup>th</sup> defined material</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_von_mises_stress">Von Mises Stress</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 38. Variables corresponding to values in table &#8220;Nodal
              Displacements&#8221;</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dx_avg_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The average displacement in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dx_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the displacement in the x
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dx_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum displacement in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dx_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum displacement in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dx_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median displacement in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dy_avg_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The average displacement in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dy_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the displacement in the y
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dy_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum displacement in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dy_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum displacement in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dy_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median displacement in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dz_avg_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The average displacement in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dz_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the displacement in the z
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dz_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum displacement in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dz_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum displacement in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">dz_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median displacement in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_nodal_displacements">Nodal Displacements</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 39. Variables corresponding to values in table &#8220;Nodal Forces&#8221;
            </caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The total force in the x direction over all nodes in
                    the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the force in the x
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum force in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum force in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median force in the x direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The total force in the y direction over all nodes in
                    the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the force in the y
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum force in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum force in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median force in the y direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The total force in the z direction over all nodes in
                    the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_stddev_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The standard deviation of the force in the z
                    direction over all nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_min_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The minimum force in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_max_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The maximum force in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_median_ns%n</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The median force in the z direction over all
                    nodes in the n<sup>th</sup> node set.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_nodal_forces">Nodal Forces</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 40. Variables corresponding to values in table &#8220;Load Sharing&#8221;
            </caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fx_ns%n_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The force in the x direction over nodes in the n<sup>th</sup> node
                    set, summed over nodes belonging to the m<sup>th</sup> defined
                    material.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fy_ns%n_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The force in the y direction over nodes in the n<sup>th</sup> node
                    set, summed over nodes belonging to the m<sup>th</sup> defined
                    material.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">fz_ns%n_mat%m</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The force in the z direction over nodes in the n<sup>th</sup> node
                    set, summed over nodes belonging to the m<sup>th</sup> defined
                    material.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_load_sharing">Load Sharing</a>.</p>
          </div>
          <table class="tableblock frame-all grid-all stretch">
            <caption class="title">Table 41. Variables corresponding to values in table &#8220;Pistoia Failure Load
              Estimate&#8221;</caption>
            <colgroup>
              <col style="width: 28.5714%;">
              <col style="width: 71.4286%;">
            </colgroup>
            <thead>
              <tr>
                <th class="tableblock halign-left valign-top">variable name</th>
                <th class="tableblock halign-left valign-top">value in analysis file table</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_stiffx</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The stiffness in the x direction.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_stiffy</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The stiffness in the y direction.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_stiffz</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The stiffness in the z direction.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_fx_fail</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The estimated failure load in the <em>x</em> direction.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_fy_fail</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The estimated failure load in the <em>y</em> direction.</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">pis_fz_fail</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">The estimated failure load in the <em>z</em> direction.</p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  The Pistoia Failure Load Estimate table is no longer generated by
                  n88postfaim, but may be generated by the tool n88pistoia if desired.
                  The corresponding variables are by default not included, unless a variable
                  list which includes them is specified.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>Refer to <a href="#n88postfaim_pistoia_failure_load">Pistoia Failure Load Estimate</a> and <a
                href="#n88pistoia">n88pistoia</a>.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="upgrading_from_previous_versions">Appendix A: Upgrading from previous versions</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="upgrading_from_version_7">A.1. Upgrading from Faim version 7</h3>
          <div class="sect3">
            <h4 id="_changing_from_vtkn88_to_vtkbone">A.1.1. Changing from <code>vtkn88</code> to <code>vtkbone</code>
            </h4>
            <div class="paragraph">
              <p>In version 8, the closed-source <code>vtkn88</code> is replaced with the open-source
                <code>vtkbone</code>.
                Therefore, in all your python scripts, you will have to search for <code>vtkn88</code>
                and replace it with <code>vtkbone</code>. (Similarly for the capitalized versions: <code>VTKN88</code>
                &#8594;
                <code>VTKBONE</code>.)
              </p>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="upgrading_from_version_6">A.2. Upgrading from Faim version 6</h3>
          <div class="sect3">
            <h4 id="updating_version_6_scripts">A.2.1. Updating version 6 <code>vtkn88</code> scripts to work with
              version 7</h4>
            <div class="paragraph">
              <p><code>vtkn88</code> is now based on VTK version 6. Many of the example scripts in <code>vtkn88</code>
                version 6 and earlier used the VTK method <code>SetInput</code>, which has been deprecated and replaced
                with <code>SetInputData</code>. Simply replacing <code>SetInput</code> with <code>SetInputData</code>
                is sufficient to fix these scripts.</p>
            </div>
            <div class="paragraph">
              <p>For example, here is a simple operation, in Python, that writes a n88model file.
                This is the version 6 version:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>writer = vtkn88.vtkn88N88ModelWriter()
writer.SetInput(model)
writer.SetFileName(output_file)
writer.Update()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>For version 7, it needs to be updated to:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>writer = vtkn88.vtkn88N88ModelWriter()
writer.SetInputData(model)
writer.SetFileName(output_file)
writer.Update()</pre>
              </div>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="upgrading_from_version_5">A.3. Upgrading from Faim version 5</h3>
          <div class="sect3">
            <h4 id="converting_version_5_file_formats">A.3.1. Converting Faim version 5 file formats</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Faim version 5 used two file formats: <code>.inp</code> files for input files to faim,
                and <code>.dat</code> files for output. These can be upgraded to version 6 style
                <code>n88model</code> files with the <a href="#n88copymodel">n88copymodel</a> tool. You may
                want to upgrade old archived files. Besides being much more space efficient,
                the new file format is also more robust. It is also standards-compliant,
                and is more easily read with third party software. (See <a href="#n88model_file_format">n88model File
                  Format</a>.)
              </p>
            </div>
            <div class="paragraph">
              <p>To convert a version 5 style file, use <a href="#n88copymodel">n88copymodel</a> like this,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88copymodel olddata.inp newdata.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>You can also specify that compression be used in writing the <code>n88model</code>
                file, like this</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88copymodel --compress olddata.inp newdata.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Compressed <code>n88model</code> files take less disk space, but are slower to read
                and particularly to write. They are otherwise identical to uncompressed
                <code>n88model</code> files. You never need to uncompress them before using them.
              </p>
            </div>
            <div class="paragraph">
              <p>Version 5 <code>.dat</code> output files are somewhat more problematic to convert
                to version 6 <code>n88model</code> files, because the <code>.dat</code> files do not contain the
                complete model information. In particular, they lack any information
                about material parameters or about boundary conditions or applied loads.
                Nevertheless, if you have only a <code>.dat</code> file, it is still possible to convert
                it to a <code>n88model</code> file, but the resulting model will be incomplete. It can
                be opened and visualized with ParaView, and it is possible to read the
                solution fields out of it, but it cannot be re-solved, nor can it be processed
                with <a href="#n88postfaim">n88postfaim</a>.</p>
            </div>
            <div class="paragraph">
              <p>A <code>.dat</code> file can be converted with</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88copymodel olddata.dat newdata.n88model</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>As before, you may optionally specify <code>--compress</code>.</p>
            </div>
            <div class="paragraph">
              <p>If you have both the original <code>.inp</code> and the <code>.dat</code> file, they can be
                converted to a single <code>n88model</code> file by specifying both as input arguments,</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>n88copymodel olddata.inp olddata.dat newdata.n88model <img src="./images/icons/callouts/1.png" alt="1"></pre>
              </div>
            </div>
            <div class="colist arabic">
              <table>
                <tr>
                  <td><img src="./images/icons/callouts/1.png" alt="1"></td>
                  <td>The order is important: the <code>.inp</code> should be specified first.</td>
                </tr>
              </table>
            </div>
            <div class="paragraph">
              <p>This will create a <code>n88model</code> file that can used either as a complete input
                file to <code>n88solver</code>, should you wish to solve it again, and that also
                contains the complete solution fields.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="updating_version_5_scripts">A.3.2. Updating 5 <code>vtkn88</code> scripts to work with 6</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Here we outline the steps required to update a version 5.x <code>vtkn88</code>
                script to work in 6.0 . We do not document all the changes and additions
                to <code>vtkn88</code> in 6.0, instead we only concentrate on those changes that must
                be made to get old scripts to work correctly in 6.0</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p><code>vtkn88Material</code> instances should be assigned a name.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>All materials are now required to have a unique name. In fact, if you
                don&#8217;t explicitly set a name, <code>vtkn88</code> will assign a unique name for you,
                but it will be an uninformative name such as &#8220;NewMaterial1&#8221;. Names can
                be assigned like this:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>bone_material = vtkn88.vtkn88LinearIsotropicMaterial()
bone_material.SetName("bone")</pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Method <code>SetModelSourceDescription</code> of <code>vtkn88FiniteElementModel</code> is
                    deprecated.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Having this method present will not prevent the scripts from running, but
                will generate a warning message. The functionality is now encompassed
                by the Log field of <code>vtkn88FiniteElementModel</code> , which allows
                a much greater amount of information to be recorded.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Method <code>NodeIdsFromSelection</code> of <code>vtkn88FiniteElementModel</code> is deprecated.
                  </p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Use the method <code>GetNodeSet</code> instead.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Method <code>CreateDisplacementConstraint</code> of <code>vtkn88FiniteElementModel</code> is
                    renamed to <code>ApplyBoundaryCondition</code>.</p>
                </li>
                <li>
                  <p>Method <code>CreateFixedConstraint</code> of <code>vtkn88FiniteElementModel</code> is renamed to
                    <code>FixNodes</code>.
                  </p>
                </li>
                <li>
                  <p>Method <code>CreateForceConstraint</code> of <code>vtkn88FiniteElementModel</code> is renamed to
                    <code>ApplyLoad</code>.
                  </p>
                </li>
                <li>
                  <p>Method <code>DataSetFromSelection</code> of <code>vtkn88FiniteElementModel</code> is deprecated.
                  </p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Use either <code>DataSetFromNodeSet</code> or <code>DataSetFromElementSet</code>.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Method <code>PolyDataFromSelection</code> of <code>vtkn88FiniteElementModel</code> is deprecated.
                  </p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>You can duplicate this functionality as follows. Instead of</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>visible_bone_vertices = model.PolyDataFromSelection("bone_top")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>the following code can be used instead:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>reduceToPolyData = vtk.vtkGeometryFilter()
reduceToPolyData.SetInput(model.DataSetFromNodeSet("bone_top"))
reduceToPolyData.MergingOff()
reduceToPolyData.Update()
visible_bone_vertices = reduceToPolyData.GetOutput()</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Note that this functionality is rarely required, as its main use was to
                write node sets as VTK PolyData files (which are slightly more efficient
                than VTK Unstructured Grid files). We now recommend not performing this
                within scripts at all, but instead to use <a href="#n88extractsets">n88extractsets</a>
                to extract the node sets from <code>.n88model</code> files.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>The names of node sets (and element sets) must be set on the data array
                    of Point IDs.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Instead of this</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>model.AddNodeSet(visibleNodesIds, "bone_top")</pre>
              </div>
            </div>
            <div class="paragraph">
              <p>we now write this</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre>visibleNodesIds.SetName("bone_top")
model.AddNodeSet(visibleNodesIds)</pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Class <code>vtkn88FiniteElementRun</code> is renamed to <code>vtkn88SolverParameters</code> .</p>
                </li>
                <li>
                  <p>Specify element sets as well as node sets for post-processing. For examples,
                    refer to the tutorials on <code>vtkn88</code>, specifically
                    <a href="#cantilever_post_processing_sets">Specifying sets for post-processing</a> and <a
                      href="#screw_pullout_post_processing_sets">Specifying sets for post-processing</a>.
                  </p>
                </li>
                <li>
                  <p>You should make use of the History and Log fields. See any of the tutorials on <code>vtkn88</code>
                    for examples.</p>
                </li>
                <li>
                  <p>Instead of <code>vtkn88FAIMInputWriter</code> use <code>vtkn88N88ModelWriter</code> . Don&#8217;t
                    forget to use a file name extention &#8220;.n88model&#8221; instead of &#8220;.inp&#8221;.</p>
                </li>
                <li>
                  <p>Don&#8217;t specify the iteration limit for the convergence tolerance. If you really want to change
                    these from their defaults, use the command line
                    arguments to <a href="#n88solver">n88solver</a>.</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="n88model_file_format">Appendix B: n88model File Format</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>




          </p>
        </div>
        <div class="paragraph">
          <p>The n88model format is a type of NetCDF4/HDF5 file. NetCDF4/HDF5 is a very
            widely used, high performance and robust file format for scientific and
            numerical data. Many standard data processing packages are able to read
            either NetCDF4 or HDF5, which makes it generally straightforward to import
            Faim data for custom processing.</p>
        </div>
        <div class="admonitionblock note">
          <table>
            <tr>
              <td class="icon">
                <img src="./images/icons/note.png" alt="Note">
              </td>
              <td class="content">
                The curious may be wondering how a file can be both NetCDF4 and HDF5.
                Historically, NetCDF and HDF were different
                formats. As they served largely similar purposes, starting with NetCDF 4, NetCDF
                adopted the HDF5 file format (amongst other options), while retaining its API or
                programming interface. Functionally, the NetCDF file format is a subset of HDF5, with a
                somewhat simpler API. HDF5 files must be structured in a specific way to
                be a NetCDF4 file; not any HDF5 file can be read through the NetCDF4
                library.
              </td>
            </tr>
          </table>
        </div>
        <div class="sect2">
          <h3 id="_converting_a_n88model_file_to_and_from_a_text_file">B.1. Converting a n88model file to and from a
            text file</h3>
          <div class="paragraph">
            <p>


            </p>
          </div>
          <div class="paragraph">
            <p>Sometimes it is useful to examine or modify a data file by hand. Users of
              faim 5.x may recall that it used a text format, which while subject to many
              disadvantages, was easy to edit manually. <code>n88model</code> files cannot
              be modified directly by hand, however they can be converted to a type of
              text file, called CDL, that is human readable. Furthermore,
              CDL text files, provided they are consistent with the <code>n88model</code> format
              convention, can easily be converted back into an <code>n88model</code> file.</p>
          </div>
          <div class="paragraph">
            <p>To convert an <code>n88model</code> file to text, the command <code>ncdump</code> can be used. For
              example:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>ncdump 1x1x2_uniaxial.n88model &gt; 1x1x2_uniaxial.txt</pre>
            </div>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  You can create this example file with the command
                  <code>n88modelgenerator 1x1x2.vti</code>. The file <code>1x1x2.vti</code> can be found in
                  the <code>data</code> directory of faim. It is a trivial 2-element geometry.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>To convert it back again (perhaps after modifying it), follow this
              example</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>ncgen -k hdf5 -o 1x1x2_uniaxial.n88model 1x1x2_uniaxial.txt</pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_example_n88model_file_in_cdl_text_format">B.2. Example n88model file in CDL text format</h3>
          <div class="paragraph">
            <p>The easiest way to understand the structure of an <code>n88model</code> file is
              to examine it in text format. Here is the <code>1x1x2_uniaxial.txt</code> file,
              generated in the previous section example. This model has been solved and
              the file contains solution data. Although it is only two elements, the
              text representation of the <code>n88model</code> file is rather lengthy!</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>netcdf \1x1x2_uniaxial {
dimensions:
    Dimensionality = 3 ;

// global attributes:
        :Conventions = "Numerics88/Finite_Element_Model-1.0" ;
        :ActiveProblem = "Problem1" ;
        :Log = "2012-Jul-18 08:59:45\nn88modelgenerator parameters:\n\ninput_file   = /Applications/faim-6.0/data/1x1x2.vti\noutput_file  = 1x1x2_uniaxial.n88model\ntest                          = uniaxial\ntest_axis                     = z\nstrain                        = -0.01\npin                           = off\ntop_surface                   = intersection\nbottom_surface                = intersection\nmaterial_table                = homogeneous\nyoungs_modulus                = 6829\npoissons_ratio                = 0.3\nconnectivity_filter           = warn\n\n2012-Jul-18 09:19:26\nn88solver parameters:\n\nengine                   = mt\nthreads                  = 1\nrestart                  = 0\nlimit                    = 30000\nconvergence tolerance    = 1e-06\nresidual tolerance       = 0\nwindow                   = 4\n" ;
        :History = "2012-Jul-18 08:59:45 Model created by n88modelgenerator version 6.0\n2012-Jul-18 09:19:26 Solved by n88solver version 6.0\n2012-Jul-18 09:19:26 Derived fields calculated by n88derivedfields version 6.0" ;
        :ActiveSolution = "Solution1" ;

group: MaterialDefinitions {

  group: NewMaterial1 {

    // group attributes:
            :Type = "LinearIsotropic" ;
            :E = 6829. ;
            :nu = 0.3 ;
    } // group NewMaterial1
  } // group MaterialDefinitions

group: Parts {

  group: Part1 {
    dimensions:
        NumberOfNodes = 12 ;
    variables:
        float NodeCoordinates(NumberOfNodes, Dimensionality) ;
    data:

     NodeCoordinates =
  0, 0, 0,
  1, 0, 0,
  0, 1, 0,
  1, 1, 0,
  0, 0, 1,
  1, 0, 1,
  0, 1, 1,
  1, 1, 1,
  0, 0, 2,
  1, 0, 2,
  0, 1, 2,
  1, 1, 2 ;

    group: Elements {

      group: Hexahedrons {
        dimensions:
            NumberOfNodesPerElement = 8 ;
            NumberOfElements = 2 ;
        variables:
            uint ElementNumber(NumberOfElements) ;
            uint NodeNumbers(NumberOfElements, NumberOfNodesPerElement) ;
            ushort MaterialID(NumberOfElements) ;
        data:

         ElementNumber = 1, 2 ;

         NodeNumbers =
  1, 2, 3, 4, 5, 6, 7, 8,
  5, 6, 7, 8, 9, 10, 11, 12 ;

         MaterialID = 127, 127 ;
        } // group Hexahedrons
      } // group Elements

    group: MaterialTable {
      dimensions:
        Size = 1 ;
      variables:
        ushort ID(Size) ;
        string MaterialName(Size) ;
      data:

       ID = 127 ;

       MaterialName = "NewMaterial1" ;
      } // group MaterialTable
    } // group Part1
  } // group Parts

group: Constraints {

  group: bottom_fixed {
    dimensions:
        NumberOfValues = 4 ;
    variables:
        uint NodeNumber(NumberOfValues) ;
        byte Sense(NumberOfValues) ;
        float Value(NumberOfValues) ;

    // group attributes:
            :Part = "Part1" ;
            :Type = "NodeAxisDisplacement" ;
    data:

     NodeNumber = 1, 2, 3, 4 ;

     Sense = 3, 3, 3, 3 ;

     Value = 0, 0, 0, 0 ;
    } // group bottom_fixed

  group: top_displacement {
    dimensions:
        NumberOfValues = 4 ;
    variables:
        uint NodeNumber(NumberOfValues) ;
        byte Sense(NumberOfValues) ;
        float Value(NumberOfValues) ;

    // group attributes:
            :Part = "Part1" ;
            :Type = "NodeAxisDisplacement" ;
    data:

     NodeNumber = 9, 10, 11, 12 ;

     Sense = 3, 3, 3, 3 ;

     Value = -0.02, -0.02, -0.02, -0.02 ;
    } // group top_displacement
  } // group Constraints

group: Sets {

  group: NodeSets {

    group: face_z0 {
      dimensions:
        NumberOfNodes = 4 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 1, 2, 3, 4 ;
      } // group face_z0

    group: face_z1 {
      dimensions:
        NumberOfNodes = 4 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 9, 10, 11, 12 ;
      } // group face_z1

    group: face_x0 {
      dimensions:
        NumberOfNodes = 6 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 1, 3, 5, 7, 9, 11 ;
      } // group face_x0

    group: face_x1 {
      dimensions:
        NumberOfNodes = 6 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 2, 4, 6, 8, 10, 12 ;
      } // group face_x1

    group: face_y0 {
      dimensions:
        NumberOfNodes = 6 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 1, 2, 5, 6, 9, 10 ;
      } // group face_y0

    group: face_y1 {
      dimensions:
        NumberOfNodes = 6 ;
      variables:
        uint NodeNumber(NumberOfNodes) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       NodeNumber = 3, 4, 7, 8, 11, 12 ;
      } // group face_y1
    } // group NodeSets

  group: ElementSets {

    group: face_z0 {
      dimensions:
        NumberOfElements = 1 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 1 ;
      } // group face_z0

    group: face_z1 {
      dimensions:
        NumberOfElements = 1 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 2 ;
      } // group face_z1

    group: face_x0 {
      dimensions:
        NumberOfElements = 2 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 1, 2 ;
      } // group face_x0

    group: face_x1 {
      dimensions:
        NumberOfElements = 2 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 1, 2 ;
      } // group face_x1

    group: face_y0 {
      dimensions:
        NumberOfElements = 2 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 1, 2 ;
      } // group face_y0

    group: face_y1 {
      dimensions:
        NumberOfElements = 2 ;
      variables:
        uint ElementNumber(NumberOfElements) ;

      // group attributes:
            :Part = "Part1" ;
      data:

       ElementNumber = 1, 2 ;
      } // group face_y1
    } // group ElementSets
  } // group Sets

group: Problems {

  group: Problem1 {

    // group attributes:
            :Part = "Part1" ;
            :Constraints = "bottom_fixed,top_displacement" ;
            :PostProcessingNodeSets = "face_z1,face_z0" ;
            :PostProcessingElementSets = "face_z1,face_z0" ;
            :RotationCenter = 0.5, 0.5, 1. ;
    } // group Problem1
  } // group Problems

group: Solutions {

  group: Solution1 {

    // group attributes:
            :Problem = "Problem1" ;

    group: NodeValues {
      dimensions:
        NumberOfNodes = 12 ;
      variables:
        float Displacement(NumberOfNodes, Dimensionality) ;
        float Residual(NumberOfNodes, Dimensionality) ;
        float ReactionForce(NumberOfNodes, Dimensionality) ;
      data:

       Displacement =
  -0.001500001, -0.001500001, 0,
  0.001500001, -0.001500001, 0,
  -0.001500001, 0.001500001, 0,
  0.001500001, 0.001500001, 0,
  -0.001500001, -0.001500001, -0.01000001,
  0.001500001, -0.001500001, -0.01000001,
  -0.001500001, 0.001500001, -0.01000001,
  0.001500001, 0.001500001, -0.01000001,
  -0.001500001, -0.001500001, -0.02,
  0.001500001, -0.001500001, -0.02,
  -0.001500001, 0.001500001, -0.02,
  0.001500001, 0.001500001, -0.02 ;

       Residual =
  -1.528847e-07, -1.528847e-07, 0,
  1.528847e-07, -1.528847e-07, 0,
  -1.528847e-07, 1.528847e-07, 0,
  1.528847e-07, 1.528847e-07, 0,
  1.437116e-05, 1.437116e-05, 3.424616e-05,
  -1.437116e-05, 1.437116e-05, 3.424616e-05,
  1.437116e-05, -1.437116e-05, 3.424616e-05,
  -1.437116e-05, -1.437116e-05, 3.424616e-05,
  1.452404e-05, 1.452404e-05, 0,
  -1.452404e-05, 1.452404e-05, 0,
  1.452404e-05, -1.452404e-05, 0,
  -1.452404e-05, -1.452404e-05, 0 ;

       ReactionForce =
  1.528847e-07, 1.528847e-07, 17.07251,
  -1.528847e-07, 1.528847e-07, 17.07251,
  1.528847e-07, -1.528847e-07, 17.07251,
  -1.528847e-07, -1.528847e-07, 17.07251,
  -1.437116e-05, -1.437116e-05, -3.424616e-05,
  1.437116e-05, -1.437116e-05, -3.424616e-05,
  -1.437116e-05, 1.437116e-05, -3.424616e-05,
  1.437116e-05, 1.437116e-05, -3.424616e-05,
  -1.452404e-05, -1.452404e-05, -17.07248,
  1.452404e-05, -1.452404e-05, -17.07248,
  -1.452404e-05, 1.452404e-05, -17.07248,
  1.452404e-05, 1.452404e-05, -17.07248 ;
      } // group NodeValues

    group: ElementValues {
      dimensions:
        NumberOfElements = 2 ;
        NumberOfStressStrainComponents = 6 ;
      variables:
        float Stress(NumberOfElements, NumberOfStressStrainComponents) ;
        float VonMisesStress(NumberOfElements) ;
        float Strain(NumberOfElements, NumberOfStressStrainComponents) ;
        float StrainEnergyDensity(NumberOfElements) ;
      data:

       Stress =
  -6.115387e-07, -6.115387e-07, -68.29005, 0, 0, 0,
  5.809617e-05, 5.809617e-05, -68.28991, 0, 0, 0 ;

       VonMisesStress = 68.29005, 68.28997 ;

       Strain =
  0.003000002, 0.003000002, -0.01000001, 0, 0, 0,
  0.003000002, 0.003000002, -0.009999992, 0, 0, 0 ;

       StrainEnergyDensity = 0.3414505, 0.3414495 ;
      } // group ElementValues
    } // group Solution1
  } // group Solutions
}</pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_specification">B.3. Specification</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>NetCDF4 files consist of dimensions, variables and attributes, as well as
              groups. Groups can contain dimensions, variables and attributes,
              as well as other groups, thus forming a nested tree structure. Variables
              can also contain attributes.</p>
          </div>
          <div class="paragraph">
            <p>Types specified below as &#8220;numeric&#8221; may be any concrete numeric type.
              Similarly &#8220;integral&#8221; may be any concrete integer type.</p>
          </div>
          <div class="paragraph">
            <p>It is convenient to refer to the text format example when trying to
              follow the file specification.</p>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  In some cases dimensions may be named differently than specified
                  below. (For complex reasons some of the n88 tools are unable to deduce the
                  correct dimension names in certain rare cases.) This should be avoided where
                  possible when writing a file. For
                  reading files, the most reliable method is to inquire about the dimensions of the
                  variables, rather than looking up dimensions by name.
                </td>
              </tr>
            </table>
          </div>
          <div class="sect3">
            <h4 id="_root_group">B.3.1. Root group</h4>
            <div class="paragraph">
              <p>The root group exists for all NetCDF4 files. It does not need to be created.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">attribute [text] <em>Conventions</em></dt>
                <dd>
                  <p>Specifies that this is a <code>n88model</code> file. Must be
                    &#8220;Numerics88/Finite_Element_Model-1.0&#8221;. Required.</p>
                </dd>
                <dt class="hdlist1">attribute [text] <em>ActiveProblem</em></dt>
                <dd>
                  <p>Specifies the problem that will be used as input to the solver. Must
                    be set to a name of a subgroup of the <em>Problems</em> group.
                    Required by the solver.</p>
                </dd>
                <dt class="hdlist1">attribute [text] <em>ActiveSolution</em></dt>
                <dd>
                  <p>Specifies the active solution set, which is typically the one that will
                    be used for post-processing or rendering. Must
                    be set to a name of a subgroup of the <em>Solution</em> group.
                    Required by <code>n88postfaim</code>, but not required by the solver.</p>
                </dd>
              </dl>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">attribute [text] <em>History</em></dt>
                <dd>
                  <p>Brief history of the operations that have been performed on the file.
                    By convention, add one line to the history for each operation performed
                    on the file. Each line should start with a time/date stamp. Additional
                    detail should go into the <em>Log</em> attribute. Required.</p>
                </dd>
              </dl>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">attribute [text] <em>Log</em></dt>
                <dd>
                  <p>As much additional detail as required about operations that have
                    been performed on the file. Each addition or section in <em>Log</em> may be
                    multiple lines. It is recommended that each section start with a time/date
                    stamp, in order to make it easy to correlate with <em>History</em>. Optional.</p>
                </dd>
                <dt class="hdlist1">dimension <em>Dimensionality</em></dt>
                <dd>
                  <p>Specifies the dimension of the problem. Currently it must be 3, although
                    future versions of Faim might also support 2D models. Required.</p>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="MaterialDefinitions_group">B.3.2. MaterialDefinitions group</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>This group contains material definitions. Each material definition is
                implemented as a subgroup, where the name of the subgroup is the name
                of the material being defined. Each subgroup is required to have an
                attribute <em>Type</em>. Required.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroups of <em>MaterialDefinitions</em> of <em>Type</em>
                  &#8220;LinearIsotropic&#8221;</dt>
                <dd>
                  <p>A subgroup that defines a linear isotropic material. Optional. As many
                    may be defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>&#8220;LinearIsotropic&#8221;. Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>MaterialArrayLength</em></dt>
                      <dd>
                        <p>Specifies the number of materials, if a material array if being
                          defined. Optional; if not present a single material is being
                          defined.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>E</em></dt>
                      <dd>
                        <p>Specifies the Young&#8217;s Modulus of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Young&#8217;s Modulii for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>nu</em></dt>
                      <dd>
                        <p>Specifies the Poisson&#8217;s Ratio of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Poisson&#8217;s Ratios for the materials.
                          Required.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroups of <em>MaterialDefinitions</em> of <em>Type</em>
                  &#8220;LinearOrthotropic&#8221;</dt>
                <dd>
                  <p>A subgroup that defines a linear orthotropic material. Optional. As many
                    may be defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>&#8220;LinearOrthotropic&#8221;. Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>MaterialArrayLength</em></dt>
                      <dd>
                        <p>Specifies the number of materials, if a material array if being
                          defined. Optional; if not present a single material is being
                          defined.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric, length 3] or variable <em>E</em></dt>
                      <dd>
                        <p>Specifies the Young&#8217;s Modulii of the material as <em>E<sub>xx</sub></em>,
                          <em>E<sub>yy</sub></em>, <em>E<sub>zz</sub></em>. Alternatively, if a variable, must be of
                          dimensions
                          <em>MaterialArrayLength</em>&#215;3. Required.
                        </p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric, length 3] or variable <em>nu</em></dt>
                      <dd>
                        <p>Specifies the Poisson&#8217;s Ratio of the material as <em>&#957;<sub>yz</sub></em>,
                          <em>&#957;<sub>zx</sub></em>,
                          <em>&#957;<sub>xy</sub></em>. Alternatively, if a variable, must be of dimensions
                          <em>MaterialArrayLength</em>&#215;3. Required.
                        </p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric, length 3] or variable <em>G</em></dt>
                      <dd>
                        <p>Specifies the Shear Modulus of the material as <em>G<sub>yz</sub></em>,
                          <em>G<sub>zx</sub></em>,
                          <em>G<sub>xy</sub></em>. Alternatively, if a variable, must be of dimensions
                          <em>MaterialArrayLength</em>&#215;3. Required.
                        </p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroups of <em>MaterialDefinitions</em> of <em>Type</em>
                  &#8220;LinearAnisotropic&#8221;</dt>
                <dd>
                  <p>A subgroup that defines a linear anisotropic material. Optional. As many
                    may be defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>&#8220;LinearAnisotropic&#8221;. Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>MaterialArrayLength</em></dt>
                      <dd>
                        <p>Specifies the number of materials, if a material array if being
                          defined. Optional; if not present a single material is being
                          defined.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric, length 36] or variable <em>StressStrainMatrix</em></dt>
                      <dd>
                        <p>Specifies the 36 elements of the stress-strain matrix. Note that since the
                          stress-strain matrix is symmetric, there are only 21 unique values, but for a
                          single material all
                          36 must be given. They must be specified in the order K<sub>11</sub>, K<sub>12</sub>,
                          K<sub>13</sub> . . .
                          K<sub>66</sub>, but since the matrix is symmetric, this is equivalent to
                          K<sub>11</sub>, K<sub>21</sub>, K<sub>31</sub> . . . K<sub>66</sub>.
                          Alternatively, if a variable, must be of dimensions
                          <em>MaterialArrayLength</em>&#215;21. Note that in the case of a material
                          array, the upper triangular packed form of the matrix stored
                          for efficiency. Then for each material in the array the indices required are
                          K<sub>11</sub>, K<sub>12</sub>, K<sub>22</sub>, K<sub>13</sub>, K<sub>23</sub>, K<sub>33</sub>
                          . . . K<sub>66</sub>
                          , which are the 21
                          unique values. Due to symmetry,
                          this sequence is the same as K<sub>11</sub>, K<sub>21</sub>, K<sub>22</sub>, K<sub>31</sub>,
                          K<sub>32</sub>, K<sub>33</sub> . . . K<sub>66</sub>. Required.
                        </p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroups of <em>MaterialDefinitions</em> of <em>Type</em>
                  &#8220;VonMisesIsotropic&#8221;</dt>
                <dd>
                  <p>A subgroup that defines an isotropic von Mises elastoplastic material. Optional.
                    As many may be defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>&#8220;VonMisesIsotropic&#8221;. Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>MaterialArrayLength</em></dt>
                      <dd>
                        <p>Specifies the number of materials, if a material array if being
                          defined. Optional; if not present a single material is being
                          defined.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>E</em></dt>
                      <dd>
                        <p>Specifies the Young&#8217;s Modulus of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Young&#8217;s Modulii for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>nu</em></dt>
                      <dd>
                        <p>Specifies the Poisson&#8217;s Ratio of the material, or, if a variable,
                          a ssequence of length <em>MaterialArrayLength</em> of Poisson&#8217;s Ratios for the
                          materials. Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] <em>Y</em></dt>
                      <dd>
                        <p>Specifies the Yield Strength of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Yield Strengths for the materials.
                          Required.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroups of <em>MaterialDefinitions</em> of <em>Type</em>
                  &#8220;MohrCoulombIsotropic&#8221;</dt>
                <dd>
                  <p>A subgroup that defines an isotropic Mohr Coulomb elastoplastic material.
                    Optional. As many may be defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>&#8220;MohrCoulombIsotropic&#8221;. Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>MaterialArrayLength</em></dt>
                      <dd>
                        <p>Specifies the number of materials, if a material array if being
                          defined. Optional; if not present a single material is being
                          defined.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>E</em></dt>
                      <dd>
                        <p>Specifies the Young&#8217;s Modulus of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Young&#8217;s Modulii for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>nu</em></dt>
                      <dd>
                        <p>Specifies the Poisson&#8217;s Ratio of the material, or, if a variable,
                          a sequence of length <em>MaterialArrayLength</em> of Poisson&#8217;s Ratios for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>c</em></dt>
                      <dd>
                        <p>Specifies the Mohr Coulomb <em>c</em> parameter (cohesion) of the material, or, if a
                          variable,
                          a sequence of length <em>MaterialArrayLength</em> of <em>c</em> values for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>phi</em></dt>
                      <dd>
                        <p>Specifies the Mohr Coulomb &#966; parameter (friction angle) of the material, or, if a
                          variable,
                          a ssequence of length <em>MaterialArrayLength</em> of &#966; values for the materials.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] or variable <em>psi</em></dt>
                      <dd>
                        <p>Specifies the Mohr Coulomb &#968; parameter (dilation angle) of the material, or, if a
                          variable,
                          a sequence of length <em>MaterialArrayLength</em> of &#968; values for the materials.
                          Optional, assumed
                          zero if not specified.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="n88file_parts">B.3.3. Parts group</h4>
            <div class="paragraph">
              <p>This group defines parts. A part is a geometric collection of
                elements, along with the associated nodes and the material
                assignments for the elements. Each part is
                implemented as a subgroup, where the name of the subgroup is the name
                of the part being defined.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroups of <em>Part</em></dt>
                <dd>
                  <p>The subgroup name gives the part name. At least one subgroup is required,
                    and multiple ones may be defined.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">dimension <em>NumberOfNodes</em></dt>
                      <dd>
                        <p>The number of nodes in the variable NodeCoordinates.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>NodeCoordinates</em> (NumberOfNodes, Dimensionality) [numeric]
                      </dt>
                      <dd>
                        <p>Specifies the <em>x</em>,<em>y</em>,<em>z</em> coordinates of the nodes. The node
                          numbering is implicit, and 1-based. Hence the first row is
                          node 1, the second node 2, etc&#8230;&#8203;</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroup <em>MaterialTable</em> of subgroups of <em>Part</em></dt>
                <dd>
                  <p>Maps material names, as defined in <em>MaterialDefinitions</em>, to material ID
                    numbers. Material ID numbers are then assigned to each element.
                    Required by the solver.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">dimension <em>Size</em></dt>
                      <dd>
                        <p>The number of entries in the material table for this part.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>MaterialName</em> (Size) [text]</dt>
                      <dd>
                        <p>The material names, corresponding to subgroups in
                          <em>MaterialDefinitions</em>.
                          Required.
                        </p>
                      </dd>
                      <dt class="hdlist1">variable <em>ID</em> (Size) [integral]</dt>
                      <dd>
                        <p>The IDs assigned to to materials. Any IDs in the range 1-32768
                          may be assigned, provided they are unique.
                          Required.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroup <em>Element</em> of subgroups of <em>Part</em></dt>
                <dd>
                  <p>Required. Currently must itself contain exactly the single subgroup,
                    <em>Hexahedrons</em>.
                  </p>
                </dd>
                <dt class="hdlist1">subgroup <em>Hexahedron</em> of subgroup <em>Element</em> of subgroups of
                  <em>Part</em>
                </dt>
                <dd>
                  <p>Defines the hexahedral elements of the part. Note that the current
                    version of <code>n88solver</code> only handles regular hexahedrons, although the
                    file format does not enforce this. Currently required, although in
                    future versions supporting multiple element types, may become optional.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">dimension <em>NumberOfNodesPerElement</em> [=8]</dt>
                      <dd>
                        <p>The number of nodes per element, which for hexahedrons is 8.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>NumberOfElements</em></dt>
                      <dd>
                        <p>The number of hexahedral elements.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>ElementNumber</em> (NumberOfElements) [integral]</dt>
                      <dd>
                        <p>Explicitly assigned element numbers. In the current version, the
                          solver requires consecutively-numbered elements starting with
                          element 1, but this restriction may be relaxed in future versions.
                          Required.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>NodeNumbers</em> (NumberOfElements, NumberOfNodesPerElement)</dt>
                      <dd>
                        <p>The node numbers of the nodes defining each hexahedron. The
                          topology is as the VTK type <code>VTK_VOXEL</code>, and is shown in
                          <a href="#element_topology">Figure 50</a>. The global node numbers (1-indexed) must be
                          given for each element in the order as shown in the figure.
                          Required.
                        </p>
                      </dd>
                      <dt class="hdlist1">variable <em>MaterialID</em> (NumberOfElements) [integral]</dt>
                      <dd>
                        <p>The material IDs of the materials assigned to each element. IDs
                          correspond to values in the MaterialTable for this part.
                          Required.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
            <div id="element_topology" class="imageblock">
              <div class="content">
                <img src="images/element_topology.png" alt="element topology">
              </div>
              <div class="title">Figure 50. Topology of hexahedral elements in n88model file (1-indexed).</div>
            </div>
            <div class="admonitionblock warning">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/warning.png" alt="Warning">
                  </td>
                  <td class="content">
                    The ordering of the elements in the input file has a strong influence
                    on the solver. Certain orderings are optimal and will solve in the fastest
                    time. There exist orderings which will cause the solver to fail with
                    an error. A future version of Faim might reorder the input elements as
                    required, but in the current version, we strongly recommend that elements
                    be ordered in the file according to &#8220;x fastest, z slowest&#8221;.
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_constraints_group">B.3.4. Constraints group</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Constraints are sets of values assigned to nodes, and used
                to define both boundary conditions and applied loads.
                Each constraint (which itself is a set of values) is
                implemented as a subgroup, where the name of the subgroup is the name
                of the constraint being defined.
                Optional, although a well-defined problem will always have some constraints.</p>
            </div>
            <div class="admonitionblock note">
              <table>
                <tr>
                  <td class="icon">
                    <img src="./images/icons/note.png" alt="Note">
                  </td>
                  <td class="content">
                    <code>vtkbone</code> supports constraints defined on elements as well, which the
                    <code>n88model</code> file format does not currently support. This is the
                    natural way to define applied loads. The file writers in
                    <code>vtkbone</code> distribute element forces appropriately on to the nodes on writing.
                    Because of this, <code>vtkboneN88ModelWriter</code> and <code>vtkboneN88ModelReader</code> are not
                    quite
                    inverses. Using them in sequence can result in a model with a different,
                    although physically equivalent, set of constraints.
                  </td>
                </tr>
              </table>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroups of <em>Constraints</em></dt>
                <dd>
                  <p>The subgroup name gives the Constraint name. Optional. Any number of
                    subgroups may be defined.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Part</em></dt>
                      <dd>
                        <p>The part to which the constraint is associated. Note that
                          this does not necessarily imply that the constraint will in fact
                          be applied to the named part. Refer to the attribute <em>Constraints</em> in
                          the <em>Problems</em> group.</p>
                      </dd>
                      <dt class="hdlist1">attribute [text] <em>Type</em></dt>
                      <dd>
                        <p>Currently two types are supported, <em>NodeAxisDisplacement</em> and
                          <em>NodeAxisForce</em>. For the former, specific displacements for
                          given nodes along given axis directions (the &#8220;sense&#8221;) are defined.
                          The latter is similar but the specified values are forces.
                        </p>
                      </dd>
                      <dt class="hdlist1">dimension <em>NumberOfValues</em></dt>
                      <dd>
                        <p>The number of values specified by this constraint.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>NodeNumber</em> (NumberOfValues) [integral]</dt>
                      <dd>
                        <p>A list of the node numbers to which the constraint is applied.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>Sense</em> (NumberOfValues) [integral]</dt>
                      <dd>
                        <p>A list of the senses along which the constraint is applied. Valid
                          values are 1,2,3 for x,y,z respectively.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>Value</em> (NumberOfValues) [integral]</dt>
                      <dd>
                        <p>A list of the values (displacement or force) of the constraint.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_sets_group">B.3.5. Sets group</h4>
            <div class="paragraph">
              <p>
              </p>
            </div>
            <div class="paragraph">
              <p>Sets are collections of nodes or of elements. The primary use of sets
                in <code>n88model</code> files is for post-processing. <code>n88postfaim</code> requires
                at least two-post processing sets of nodes, which must be matched by
                sets of the corresponding elements. Quantities (<em>e.g.</em> the difference
                between the sum of the forces on the node sets) are then calculated between
                pairs of sets. A secondary use of sets is simply to store sets
                that can be further refined and transformed into boundary conditions
                during model generation. This is particularly useful when the model
                generation occurs in several stages.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroup <em>NodeSets</em> of <em>Sets</em></dt>
                <dd>
                  <p>Defines node sets. Each node set is
                    implemented as a subgroup, where the name of the subgroup is the name
                    of the node set being defined. Required by <code>n88postfaim</code>.</p>
                </dd>
                <dt class="hdlist1">subgroups of subgroup <em>NodeSets</em> of <em>Sets</em></dt>
                <dd>
                  <p>The subgroup name gives the node set name. Optional. As many may be
                    defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Part</em></dt>
                      <dd>
                        <p>The part with which the node set is associated.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>NumberOfNodes</em></dt>
                      <dd>
                        <p>The number of nodes in the node set.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>NodeNumber</em></dt>
                      <dd>
                        <p>A list of the node numbers of the nodes in the set.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroup <em>ElementSets</em> of <em>Sets</em></dt>
                <dd>
                  <p>Defines element sets. Each element set is
                    implemented as a subgroup, where the name of the subgroup is the name
                    of the element set being defined. Optional, although element sets must be
                    defined if <code>n88postfaim</code> is to be used.</p>
                </dd>
                <dt class="hdlist1">subgroups of subgroup <em>ElementSets</em> of <em>Sets</em></dt>
                <dd>
                  <p>The subgroup name gives the element set name. Optional. As many may be
                    defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Part</em></dt>
                      <dd>
                        <p>The part with which the element set is associated.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>NumberOfElements</em></dt>
                      <dd>
                        <p>The number of elements in the element set.</p>
                      </dd>
                      <dt class="hdlist1">variable <em>ElementNumber</em></dt>
                      <dd>
                        <p>A list of the element numbers of the elements in the set.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_problems_group">B.3.6. Problems group</h4>
            <div class="paragraph">
              <p>The <em>Problems</em> group defines problems that can be solved by the solver.
                Multiple problems may be defined. Each problem is
                implemented as a subgroup, where the name of the subgroup is the name
                of the problem being defined. In the current version, only the
                problem specified by the root-level attribute <em>ActiveProblem</em> will be solved
                when the file is submitted to the solver. Required by the solver.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroups of <em>Problem</em></dt>
                <dd>
                  <p>The subgroup name gives the problem name. Optional. As many may be
                    defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Part</em></dt>
                      <dd>
                        <p>Gives the part that will be used for this problem. Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [text] <em>Constraints</em></dt>
                      <dd>
                        <p>Gives a list of constraints that will be applied to the problem.
                          Takes the form of a list of constraint names separated by
                          commas. It is clearly a logical error to assign constraints
                          that are associated with a different part. Required.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] <em>ConvergenceTolerance</em></dt>
                      <dd>
                        <p>Specifies the convergence tolerance to be used by the solver.
                          Optional, and recommended that you not set this in the <code>n88model</code>
                          file, because the optimum value depends on the solver. The solver
                          will typically choose an appropriate value, but the choice can be
                          specified with a command line option to <code>n88solver</code>, which is the
                          recommended way to set the convergence tolerance should you wish to
                          change it.</p>
                      </dd>
                      <dt class="hdlist1">attribute [numeric] <em>ConvergenceWindow</em></dt>
                      <dd>
                        <p>Specifies the convergence window to be used by the solver.
                          Optional, and recommended that you not set this in the <code>n88model</code>
                          file, because the optimum value depends on the solver. The solver
                          will typically choose an appropriate value, but the choice can be
                          specified with a command line option to <code>n88solver</code>, which is the
                          recommended way to set the convergence window should you wish to
                          change it.</p>
                      </dd>
                      <dt class="hdlist1">attribute [integral] <em>MaximumIterations</em></dt>
                      <dd>
                        <p>Specifies the maximum iterations to be used by the solver.
                          Optional, and recommended that you not set this in the <code>n88model</code>
                          file, because the optimum value depends on the solver. The solver
                          will typically choose an appropriate value, but the choice can be
                          specified with a command line option to <code>n88solver</code>, which is the
                          recommended way to set the maximum iterations should you wish to
                          change it.</p>
                      </dd>
                      <dt class="hdlist1">attribute [text] <em>PostProcessingNodeSets</em></dt>
                      <dd>
                        <p>Gives a list of node sets that will be used for post-processing.
                          Takes the form of a list of node set names separated by
                          commas. <code>n88postfaim</code> requires that at least two
                          post-processing node sets to be defined. <code>n88postfaim</code>
                          has an equivalent command-line option which takes precedence.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">attribute [text] <em>PostProcessingElementSets</em></dt>
                <dd>
                  <p>Gives a list of element sets that will be used for post-processing.
                    Takes the form of a list of element set names separated by
                    commas. <code>n88postfaim</code> requires that every
                    node set specified in <em>PostProcessingNodeSets</em> be exactly matched
                    with an element set of the associated elements.
                    <code>n88postfaim</code> has an equivalent command-line option which takes
                    precedence.
                  </p>
                </dd>
                <dt class="hdlist1">attribute [numeric, length 3] <em>RotationCenter</em></dt>
                <dd>
                  <p>Gives the rotation center. This value is used only for
                    post-processing. Optional.</p>
                </dd>
              </dl>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_solutions_group">B.3.7. Solutions group</h4>
            <div class="paragraph">
              <p></p>
            </div>
            <div class="paragraph">
              <p>The solutions group contains solution values as calculated by <code>n88solver</code>
                or <code>n88derivedfields</code>. Any number of solution sets may be defined
                (including multiple solution sets per problem). Each solution set is
                implemented as a subgroup, where the name of the subgroup is the name
                of the problem being defined. The solution set specified by the root level
                attribute <em>ActiveSolution</em> is the one that will be used for post-processing.</p>
            </div>
            <div class="dlist">
              <dl>
                <dt class="hdlist1">subgroups of <em>Solutions</em></dt>
                <dd>
                  <p>The subgroup name gives the solution set name. Optional. As many may be
                    defined as required.</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">attribute [text] <em>Problem</em></dt>
                      <dd>
                        <p>The problem to which the solution applies. Required.</p>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroup <em>NodeValues</em> of subgroups of <em>Solutions</em></dt>
                <dd>
                  <p>A group containing variables that specify values on each node. Variables
                    are identified by name, and may be either one-dimensional (scalar values
                    on the nodes), or two-dimensional (vector values on the nodes).</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">dimension <em>NumberOfNodes</em></dt>
                      <dd>
                        <p>The number of nodes in the problem. This is redundant with the
                          number of nodes defined in the part, and must be equal to it.
                          (The NetCDF4 format requires that it be re-defined here.) Required.</p>
                      </dd>
                      <dt class="hdlist1">typical variables in <em>NodeValues</em></dt>
                      <dd>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p><em>Displacement</em> (NumberOfNodes, Dimensionality)</p>
                            </li>
                            <li>
                              <p><em>Residual</em> (NumberOfNodes, Dimensionality)</p>
                            </li>
                            <li>
                              <p><em>ReactionForce</em> (NumberOfNodes, Dimensionality)</p>
                            </li>
                          </ul>
                        </div>
                      </dd>
                    </dl>
                  </div>
                </dd>
                <dt class="hdlist1">subgroup <em>ElementValues</em> of subgroups of <em>Solutions</em></dt>
                <dd>
                  <p>A group containing variables that specify values on each element.
                    Variables are identified by name, and may be either one-dimensional
                    (scalar values on the elements), or two-dimensional (vector values on the
                    elements).</p>
                  <div class="dlist">
                    <dl>
                      <dt class="hdlist1">dimension <em>NumberOfElements</em></dt>
                      <dd>
                        <p>The number of elements in the problem. This is redundant with the
                          number of elements defined in the part, and must be equal to it.
                          (The NetCDF4 format requires that it be re-defined here.) Required.</p>
                      </dd>
                      <dt class="hdlist1">dimension <em>NumberOfStressStrainComponents</em> [=6]</dt>
                      <dd>
                        <p>Stress and strain are defined on the elements, and have 6 components,
                          so a dimension equal to 6 must be defined. The order must be
                          xx,yy,zz,yz,zx,xy.</p>
                      </dd>
                      <dt class="hdlist1">typical variables in <em>ElementValues</em></dt>
                      <dd>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p><em>Stress</em> (NumberOfElements, NumberOfStressStrainComponents)</p>
                            </li>
                            <li>
                              <p><em>Strain</em> (NumberOfElements, NumberOfStressStrainComponents)</p>
                            </li>
                            <li>
                              <p><em>VonMisesStress</em> (NumberOfElements)</p>
                            </li>
                            <li>
                              <p><em>StrainEnergyDensity</em> (NumberOfElements)</p>
                            </li>
                          </ul>
                        </div>
                      </dd>
                    </dl>
                  </div>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_writing_code_to_read_and_write_n88model_files">B.4. Writing code to read and write n88model files
          </h3>
          <div class="paragraph">
            <p></p>
          </div>
          <div class="paragraph">
            <p>The following methods are possible for reading and writing n88model files:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Use the <code>vtkbone</code>
                  classes <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelReader.html">vtkboneN88ModelReader</a>
                  and <a
                    href="http://numerics88.com/n88/documentation/vtkbone/1.0/classvtkboneN88ModelWriter.html">vtkboneN88ModelWriter</a>
                  , either
                  in C++ or in python.</p>
              </li>
              <li>
                <p>Use the python class <code>N88ModelReader</code> which is part of n88tools.</p>
              </li>
              <li>
                <p>Directly read or write the file with the netCDF4 library in C or C++,
                  following the
                  above file standard. Refer to
                  <a href="http://www.unidata.ucar.edu/software/netcdf/docs/"
                    class="bare">http://www.unidata.ucar.edu/software/netcdf/docs/</a> for documentation on
                  using the NetCDF interface.
                </p>
              </li>
              <li>
                <p>Directly read or write the file with the netCDF4 python module
                  (<a href="http://unidata.github.io/netcdf4-python/"
                    class="bare">http://unidata.github.io/netcdf4-python/</a>), following the above file
                  standard. See for example the source file <code>modelinfo.py</code> which is
                  part of n88tools. If you have installed n88tools using Anaconda
                  Python, then the netCDF4 module is automatically installed as
                  a dependency.</p>
              </li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="scripting">Appendix C: Automating the Processing of Multiple Models With Scripts</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>


          </p>
        </div>
        <div class="admonitionblock important">
          <table>
            <tr>
              <td class="icon">
                <img src="./images/icons/important.png" alt="Important">
              </td>
              <td class="content">
                This section currently applies only to OS-X and Linux.
              </td>
            </tr>
          </table>
        </div>
        <div class="paragraph">
          <p>Very often one has not just a single model to solve, but a whole series
            of data sets that needs to be modelled by FE analysis. The section will
            show how to use simple shell scripts to automate this task.</p>
        </div>
        <div class="admonitionblock tip">
          <table>
            <tr>
              <td class="icon">
                <img src="./images/icons/tip.png" alt="Tip">
              </td>
              <td class="content">
                We highly recommend initially running the models one at a time,
                and visualizing the results as you go, to ensure that your models
                and results are reasonable and as you expect, before sending hundreds
                of models to be solved in a batch script.
              </td>
            </tr>
          </table>
        </div>
        <div class="admonitionblock note">
          <table>
            <tr>
              <td class="icon">
                <img src="./images/icons/note.png" alt="Note">
              </td>
              <td class="content">
                Shell scripts are a standard part of any Unix-based operating
                system, including OS-X.
                If you want to learn more about shell scripting than we
                present here, there are many good tutorials on the web. Search for &#8220;bash
                scripting tutorial&#8221;.
              </td>
            </tr>
          </table>
        </div>
        <div class="sect2">
          <h3 id="_a_script_to_generate_a_mesh_and_solve_it">C.1. A script to generate a mesh and solve it</h3>
          <div class="paragraph">
            <p>The first step to is to make a script that can generate a mesh, solve it, and
              clean up, all with one command. The following shell script does this. You can
              find a copy of it, named <code>mesh_solve_analyze</code> in the
              <code>examples/batch_processing</code> directory of the distribution. Alternatively,
              you can just copy and paste the commands below into a text editor and save
              it to a file named <code>mesh_solve_analyze</code> .
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-bash" data-lang="bash">#!/bin/bash
#
# This is a simple script that takes a segmented image file name as input,
# generates a finite element model using n88modelgenerator, then solves
# it with the FAIM solver.
#
# Assuming this script is in the current directory, it can be run as follows:
#
#    ./mesh_solve_analyze image_file config_file
#
# where image_file is the segmented image file to be processed, and
# config_file is an n88modelgenerator configuration file.
#
# You may want to edit this script in order to customize it.


if [ $# -ne 2 ] ; then
  echo "Usage: mesh_solve_analyze image_file config_file"
  exit 1
fi


INPUT_IMAGE_FILE="$1"
MODEL_GENERATOR_CONFIG_FILE="$2"

# Strip off the extension of the input file
ROOT_FILE_NAME=`echo "${INPUT_IMAGE_FILE}" | sed 's/\(.*\)\..*/\1/'`
MODEL_FILE="${ROOT_FILE_NAME}.n88model"

date

echo
echo "    ==== Generating ${MODEL_FILE} ===="
echo
n88modelgenerator --config="${MODEL_GENERATOR_CONFIG_FILE}" \
    "${INPUT_IMAGE_FILE}" "${MODEL_FILE}"

if [ $? -ne 0 ] ; then
  echo "Mesh generation returned error."
  exit 1
fi

echo
echo "    ==== Solving and post-processing FE model ===="
echo
faim "${MODEL_FILE}"

if [ $? -ne 0 ] ; then
  echo "faim returned error."
  exit 1
fi

echo
echo "    ==== Compressing data file ===="
echo
n88compress "${MODEL_FILE}"
if [ $? -ne 0 ] ; then
  echo "compress returned error."
  exit 1
fi

echo</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>If this script does exactly what you want, it can be run directly from
              the installation directory, like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>/Applications/faim-6.0/examples/batch_processing/mesh_solve_analyze input_file config_file</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>On Linux, <code>Faim</code> is typically installed in <code>/opt</code> rather than
              <code>/Applications</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>where <code>input_file</code> is the segmented image file to be processed, and
              <code>config_file</code> is an <code>n88modelgenerator</code> configuration file. See <a
                href="#running_n88modelgenerator">Running n88modelgenerator</a> for information on the configuration
              file
              format. The very simplest configuration file might contain just a single line specifying the test type:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>test = uniaxial</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>You can use a text editor to create this file, and save it, for example,
              as <code>myconfig.conf</code> in your working directory.</p>
          </div>
          <div class="paragraph">
            <p>You can also copy this script to your working data directory and customize it
              to your preferences. In this case you would most likely run it like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>./mesh_solve_analyze input_file config_file</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>As a tiny little tutorial, you may want to try to following:</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Copy <code>mesh_solve_analyze</code> to your working directory.</p>
              </li>
              <li>
                <p>Copy <code>test25a.aim</code> from the <code>data</code> subdirectory of your installation to your
                  working directory.</p>
              </li>
              <li>
                <p>Create <code>myconfig.conf</code> as above using a text editor, and save it to your working
                  directory.</p>
              </li>
              <li>
                <p>Run <code>mesh_solve_analyze</code>:</p>
              </li>
            </ol>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>./mesh_solve_analyze test25a.aim myconfig.conf</pre>
            </div>
          </div>
          <div class="admonitionblock note">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/note.png" alt="Note">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>The script must be made "executable" before it can be run. The
                      script in the example directory should already be executable, but if you
                      write your own, you may need to change permissions to make it executable
                      before the script can be run:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>chmod +x mesh_solve_analyze</pre>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>Some further notes about this script:</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_scripting_several_models">C.2. Scripting several models</h3>
          <div class="paragraph">
            <p>Now that we have a command to do everything required for a single data set,
              we can write a very simple script that will call it several times for
              a number of different data sets.</p>
          </div>
          <div class="paragraph">
            <p>Here is an example. Open a text editor and copy in the following lines.
              Of course, you should replace <code>mydata1.aim</code>, etc&#8230;&#8203; with real data
              file names. Save it for example as <code>runjobs.sh</code>.</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>source /Applications/faim-6.0/setenv.sh
./mesh_solve_analyze mydata1.aim myconfig.conf
./mesh_solve_analyze mydata2.aim myconfig.conf
./mesh_solve_analyze mydata3.aim myconfig.conf</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>It can now be run with this command:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>bash runjobs.sh</pre>
            </div>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  <div class="paragraph">
                    <p>Alternatively, you can make it executable with</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>chmod +x runjobs.sh</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>and then run it like this:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre>./runjobs.sh</pre>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_unattended_execution_of_scripts">C.3. Unattended execution of scripts</h3>
          <div class="paragraph">
            <p>
            </p>
          </div>
          <div class="paragraph">
            <p>One issue when running scripts or very long jobs is that if the Terminal
              in which they were started is closed, or the user logs out, the
              execution will stop. This is obviously undesirable. The solution
              is to prepend &#8220;nohup&#8221; to the command. For example:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>nohup bash runjobs.sh</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Now it will keep running until completed or manually stopped.</p>
          </div>
          <div class="admonitionblock tip">
            <table>
              <tr>
                <td class="icon">
                  <img src="./images/icons/tip.png" alt="Tip">
                </td>
                <td class="content">
                  The etymology of nohup is that is is derived from "No Hang Up", which may help to remember it.
                </td>
              </tr>
            </table>
          </div>
          <div class="paragraph">
            <p>However, if you try this, you will note that the messages that usually appear
              in the Terminal to keep you informed of progress no longer appear. Where did that go? Well, the command
              has been
              "detached" from the Terminal window so it can outlive the Terminal. nohup
              instead will send all the output messages ("STDOUT" in Unix jargon) to a file named <code>nohup.out</code>
              . You can choose
              to send it to a file of your choice like this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>nohup bash runjobs.sh &amp;&gt; runjobs.out</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>As well, since nothing is being output to the Terminal, you might as
              well get the prompt back so you can continue to use the Terminal for other
              purposes. Just add an ampersand to the end of the command line, like
              this:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>nohup bash runjobs.sh &amp;&gt; runjobs.out &amp;</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Now you can examine <code>runjobs.out</code> as you like, for example with the command:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>cat runjobs.out</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>However, it may be inconvenient to keep re-running this command if you want
              to monitor the progress in real time. There is a command for that too though:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>tail -f runjobs.out</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Here the <code>-f</code> flag means &#8220;follow&#8221;. The will continue to echo new lines
              as they are added to <code>runjobs.out</code> . When you tire of watching this,
              just hit CONTROL-C. This only stops the <code>tail</code> command; <code>runjobs.sh</code>
              continues to execute.</p>
          </div>
          <div class="paragraph">
            <p>Finally, when you start a process with nohup, you may need to know how to stop
              it as well. If the original Terminal is still open, this is not too
              difficult. First find the job number with the <code>jobs</code> command:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ jobs
[1]+  Running                 nohup ./runjobs.sh &gt;&amp;runjobs.out &amp;</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>(Note that the <code>$</code> is the command prompt - shown here to distinguish the input
              from the output. Don&#8217;t type the <code>$</code> character.)
              In this example, the job number is 1. It can be stopped with the command</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>kill %1</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>If the original Terminal is no longer open, then it gets a little more
              complicated, because we will need to find the Process ID (which is system
              wide) instead of the Job ID (which is specific to the Terminal). This
              command will do it in most cases:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>$ ps -A | grep runjobs.sh
55713 ttys007    0:00.00 sh ./runjobs.sh
55719 ttys007    0:00.00 grep runjobs.sh</pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The Process ID in this example is 55713. We can kill that process with</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre>kill 55713</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="bibliography">Bibliography</h2>
      <div class="sectionbody">
        <div class="ulist bibliography">
          <div class="title">Books</div>
          <ul class="bibliography">
            <li>
              <p><a id="timoshenko1997"></a> Gere JM, Timoshenko SP, 1997. <em>Mechanics of materials</em>, 4 ed. PWS
                Publishing Company, Boston.</p>
            </li>
          </ul>
        </div>
        <div class="ulist bibliography">
          <div class="title">Articles</div>
          <ul class="bibliography">
            <li>
              <p><a id="cusano2015"></a> Cusano NE, Nishiyama KK, Zhang C, Rubin MR, Boutroy S, McMahon DJ,
                Guo XE, Bilezikian JP (2015). <em>Noninvasive Assessment of Skeletal Microstructure
                  and Estimated Bone Strength in Hypoparathyroidism</em>. J Bone Miner Res. 10.1002/jbmr.2609</p>
            </li>
            <li>
              <p><a id="boyd2002"></a> Boyd SK, Mller R, Zernicke RF (2002). <em>Mechanical and
                  architectural bone adaptation in early stage experimental osteoarthritis</em>. J
                Bone Miner Res 17(4):687-694.</p>
            </li>
            <li>
              <p><a id="boyd2011"></a> Boyd SK, Ammann P (2011). <em>Increased bone strength is
                  associated with improved bone microarchitecture in intact female rats
                  treated with strontium ranelate: A finite element analysis study</em>. Bone
                48(5):1109-16.</p>
            </li>
            <li>
              <p><a id="campbell2010"></a> Campbell GM, Ominsky MS, Boyd SK (2010). <em>Bone quality is
                  partially recovered after the discontinuation of RANKL administration in
                  rats by increased bone mass on existing trabeculae: an in vivo micro-CT
                  study</em>. Osteoporos Int 10.1007/s00198-010-1283-5.</p>
            </li>
            <li>
              <p><a id="gilchrist2014"></a> Gilchrist S, Nishiyama KK, de Bakker P, Guy P, Boyd SK,
                Oxland T, Cripton PA (2014). <em>Proximal femur elastic behaviour is the same
                  in impact and constant displacement rate fall simulation</em>. J Biomech 47,
                3744-3749. 10.1016/j.jbiomech.2014.06.040</p>
            </li>
            <li>
              <p><a id="homminga2001"></a> Homminga J, Huiskes R, Van Rietbergen B, Regsegger P,
                Weinans H (2001). <em>Introduction and evaluation of a gray-value voxel
                  conversion technique</em>. J Biomech 34(4):513-7.</p>
            </li>
            <li>
              <p><a id="iyer2014"></a> Iyer SP, Nikkel LE, Nishiyama KK, Dworakowski E, Cremers S,
                Zhang C, McMahon DJ, Boutroy S, Liu XS, Ratner LE, Cohen DJ, Guo XE, Shane E,
                Nickolas TL (2014). <em>Kidney transplantation with early corticosteroid
                  withdrawal: paradoxical effects at the central and peripheral skeleton.</em>
                J Am Soc Nephrol 25, 1331-1341. 10.1681/ASN.2013080851</p>
            </li>
            <li>
              <p><a id="kim2013"></a> Kim S, Macdonald HM, Nettlefold L, McKay HA (2013). <em>A comparison
                  of bone quality at the distal radius between Asian and white adolescents and
                  young adults: an HR-pQCT study.</em> J Bone Miner Res 28, 2035-2042. 10.1002/jbmr.1939</p>
            </li>
            <li>
              <p><a id="maatta2015"></a> Maatta M, Macdonald HM, Mulpuri K, McKay HA (2015). <em>Deficits in distal
                  radius bone strength, density and microstructure are associated with forearm fractures
                  in girls: an HR-pQCT study.</em> Osteoporos Int 26, 1163-1174. 10.1007/s00198-014-2994-9</p>
            </li>
            <li>
              <p><a id="macdonald2011a"></a> Macdonald HM, Nishiyama KK, Hanley DA, Boyd SK (2011a).
                <em>Changes in trabecular and cortical bone microarchitecture at peripheral sites
                  associated with 18 months of teriparatide therapy in postmenopausal women with
                  osteoporosis.</em> Osteoporos Int 22, 357-362. 10.1007/s00198-010-1226-1
              </p>
            </li>
            <li>
              <p><a id="macdonald2011b"></a> Macdonald HM, Nishiyama KK, Kang J, Hanley DA, Boyd SK
                (2011). <em>Age-related patterns of trabecular and cortical bone loss differ
                  between sexes and skeletal sites: A population-based HR-pQCT study</em>. J Bone
                Miner Res 26(1):50-62.</p>
            </li>
            <li>
              <p><a id="macneil2008"></a> MacNeil JA, Boyd SK (2008). <em>Bone strength at the distal
                  radius can be estimated from high-resolution peripheral quantitative
                  computed tomography and the finite element method.</em> Bone 42(6):1203-1213.</p>
            </li>
            <li>
              <p><a id="nickolas2013"></a> Nickolas TL, Stein EM, Dworakowski E, Nishiyama KK, Komandah-Kosseh M,
                Zhang CA, McMahon DJ, Liu XS, Boutroy S, Cremers S, Shane E (2013).
                <em>Rapid cortical bone loss in patients with chronic kidney disease.</em>
                J Bone Miner Res 28, 1811-1820. 10.1002/jbmr.1916
              </p>
            </li>
            <li>
              <p><a id="nishiyama2014a"></a> Nishiyama KK, Cohen A, Young P, Wang J, Lappe JM, Guo XE,
                Dempster DW, Recker RR, Shane E (2014a). <em>Teriparatide increases strength
                  of the peripheral skeleton in premenopausal women with idiopathic
                  osteoporosis: a pilot HR-pQCT study.</em> J Clin Endocrinol Metab 99, 2418-2425.
                10.1210/jc.2014-1041</p>
            </li>
            <li>
              <p><a id="nishiyama2014b"></a> Nishiyama KK, Ito M, Harada A, Boyd SK (2014b). <em>Classification
                  of women with and without hip fracture based on quantitative computed tomography
                  and finite element analysis.</em> Osteoporos Int 25, 619-626. 10.1007/s00198-013-2459-6</p>
            </li>
            <li>
              <p><a id="nishiyama2010"></a> Nishiyama KK, Macdonald HM, Buie HR, Hanley DA, Boyd SK
                (2010). <em>Postmenopausal women with osteopenia have higher cortical porosity
                  and thinner cortices at the distal radius and tibia than women with normal
                  aBMD: an in vivo HR-pQCT study.</em> J Bone Miner Res 25 (4):882-890.</p>
            </li>
            <li>
              <p><a id="nishiyama2013"></a> Nishiyama KK, Macdonald HM, Hanley DA, Boyd SK (2013).
                <em>Women with previous fragility fractures can be classified based on bone
                  microarchitecture and finite element analysis measured with HR-pQCT.</em>
                Osteoporos Int 24, 1733-1740. 10.1007/s00198-012-2160-1
              </p>
            </li>
            <li>
              <p><a id="nishiyama2012"></a> Nishiyama KK, Macdonald HM, Moore SA, Fung T, Boyd SK,
                McKay HA (2012). <em>Cortical porosity is higher in boys compared with girls
                  at the distal radius and distal tibia during pubertal growth: an HR-pQCT
                  study.</em> J Bone Miner Res 27, 273-282. 10.1002/jbmr.552</p>
            </li>
            <li>
              <p><a id="odgaard1997a"></a> Odgaard A (1997a). <em>Three-dimensional methods for
                  quantification of cancellous bone architecture.</em> Bone 20(4):315-328.</p>
            </li>
            <li>
              <p><a id="odgaard1997b"></a> Odgaard A, Kabel J, Van Rietbergen B, Dalstra M, Huiskes R
                (1997b). <em>Fabric and elastic principal directions of cancellous bone are
                  closely related.</em> J Biomech 30(5):487-495.</p>
            </li>
            <li>
              <p><a id="pistoia2001a"></a> Pistoia W, Van Rietbergen B, Eckstein F, Lill C, Lochmuller
                EM, Regsegger P (2001). <em>Prediction of distal radius failure with microFE
                  models based on 3d- PQCT scans.</em> Adv Exp Med Biol 496:143-51.</p>
            </li>
            <li>
              <p><a id="pistoia2001b"></a> Pistoia W, van Rietbergen B, Laib A, Regsegger P (2001).
                <em>High-resolution three-dimensional-pQCT images can be an adequate basis for
                  in-vivo microFE analysis of bone.</em> J Biomech Eng 123(2):176-83.
              </p>
            </li>
            <li>
              <p><a id="stadelmann2015a"></a> Stadelmann VA, Guenther C, Eberli U, Camenisch K,
                Zeiter S (2015a). <em>The effects of age on implant integration.</em> Osteologie 2, A53.</p>
            </li>
            <li>
              <p><a id="stadelmann2015b"></a> Stadelmann VA, Potapova I, Camenisch K, Nehrbass D,
                Richards RG, Moriarty TF (2015b). <em>In Vivo MicroCT Monitoring of Osteomyelitis
                  in a Rat Model.</em> Biomed Res Int 2015, 587857. 10.1155/2015/587857</p>
            </li>
            <li>
              <p><a id="stadelmann2012"></a> Stadelmann VA, Conway CM, Boyd SK (2012).
                <em>In vivo monitoring of bone  implant bond strength by microCT and finite
                  element modelling</em>. Computer Methods in Biomechanics and Biomedical
                Engineering, DOI:10.1080/10255842.2011.648625
              </p>
            </li>
            <li>
              <p><a id="su2006"></a> Su R, Campbell GM, Boyd SK (2006). <em>Establishment of an
                  architecture-specific experimental validation approach for finite element
                  modeling of bone by rapid prototyping and high resolution computed
                  tomography.</em> Med Eng Phys 29(4):480-490.</p>
            </li>
            <li>
              <p><a id="su2014"></a> Sutter S, Nishiyama KK, Kepley A, Zhou B, Wang J, McMahon DJ,
                Guo XE, Stein EM (2014). <em>Abnormalities in cortical bone, trabecular plates,
                  and stiffness in postmenopausal women treated with glucocorticoids.</em>
                J Clin Endocrinol Metab 99, 4231-4240. 10.1210/jc.2014-2177</p>
            </li>
            <li>
              <p><a id="vanrietbergen1996"></a> van Rietbergen B, Odgaard A, Kabel J, Huiskes R.
                <em>Direct mechanics assessment of elastic symmetries and properties of
                  trabecular bone architecture.</em> J Biomechanics 29(12):1653-7.
              </p>
            </li>
            <li>
              <p><a id="zderc2014"></a> Zderic I, Windolf M, Gueorguiev B, Stadelmann VA (2014).
                <em>Monitoring of cement distribution in vertebral bodies during
                  vertebroplasty.</em> Bone Joint J 96-B:(SUPP 11), 183.
              </p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_index">Index</h2>
      <div class="sectionbody">

      </div>
    </div>
    <div class="sect1">
      <h2 id="_colophon">Colophon</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>This documentation was written with asciidoc
            (<a href="http://www.methods.co.nz/asciidoc/" class="bare">http://www.methods.co.nz/asciidoc/</a>).
            The PDF is generated by compiling asciidoc into DocBook
            (<a href="http://www.oasis-open.org/docbook/" class="bare">http://www.oasis-open.org/docbook/</a>) and
            processing with dblatex
            (<a href="http://dblatex.sourceforge.net/" class="bare">http://dblatex.sourceforge.net/</a>).</p>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
    <div id="footer-text">
      Last updated 2021-06-18 12:47:47 -0600
    </div>
  </div>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>

</html>